(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[179],{751:(Lm,Au,ku)=>{"use strict";function ar(e){return"function"==typeof e}function qh(e){const n=e(r=>{Error.call(r),r.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const Nm=qh(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function b(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class wr{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const a of n)a.remove(this);else n.remove(this);const{initialTeardown:r}=this;if(ar(r))try{r()}catch(a){t=a instanceof Nm?a.errors:[a]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const a of i)try{Il(a)}catch(c){t=t??[],c instanceof Nm?t=[...t,...c.errors]:t.push(c)}}if(t)throw new Nm(t)}}add(t){var n;if(t&&t!==this)if(this.closed)Il(t);else{if(t instanceof wr){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&b(n,t)}remove(t){const{_finalizers:n}=this;n&&b(n,t),t instanceof wr&&t._removeParent(this)}}wr.EMPTY=(()=>{const e=new wr;return e.closed=!0,e})();const ks=wr.EMPTY;function us(e){return e instanceof wr||e&&"closed"in e&&ar(e.remove)&&ar(e.add)&&ar(e.unsubscribe)}function Il(e){ar(e)?e():e.unsubscribe()}const Zt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ie={setTimeout(e,t,...n){const{delegate:r}=Ie;return r?.setTimeout?r.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=Ie;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function Bi(e){Ie.setTimeout(()=>{const{onUnhandledError:t}=Zt;if(!t)throw e;t(e)})}function Ps(){}const Rs=Ci("C",void 0,void 0);function Ci(e,t,n){return{kind:e,value:t,error:n}}let io=null;function fn(e){if(Zt.useDeprecatedSynchronousErrorHandling){const t=!io;if(t&&(io={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:r}=io;if(io=null,n)throw r}}else e()}class kc extends wr{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,us(t)&&t.add(this)):this.destination=Pu}static create(t,n,r){return new oo(t,n,r)}next(t){this.isStopped?Gn(function Al(e){return Ci("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Gn(function Pa(e){return Ci("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Gn(Rs,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const To=Function.prototype.bind;function ta(e,t){return To.call(e,t)}class Fs{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(r){Ra(r)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(r){Ra(r)}else Ra(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){Ra(n)}}}class oo extends kc{constructor(t,n,r){let i;if(super(),ar(t)||!t)i={next:t??void 0,error:n??void 0,complete:r??void 0};else{let a;this&&Zt.useDeprecatedNextContext?(a=Object.create(t),a.unsubscribe=()=>this.unsubscribe(),i={next:t.next&&ta(t.next,a),error:t.error&&ta(t.error,a),complete:t.complete&&ta(t.complete,a)}):i=t}this.destination=new Fs(i)}}function Ra(e){Zt.useDeprecatedSynchronousErrorHandling?function si(e){Zt.useDeprecatedSynchronousErrorHandling&&io&&(io.errorThrown=!0,io.error=e)}(e):Bi(e)}function Gn(e,t){const{onStoppedNotification:n}=Zt;n&&Ie.setTimeout(()=>n(e,t))}const Pu={closed:!0,next:Ps,error:function hs(e){throw e},complete:Ps},It="function"==typeof Symbol&&Symbol.observable||"@@observable";function Wr(e){return e}function Os(e){return 0===e.length?Wr:1===e.length?e[0]:function(n){return e.reduce((r,i)=>i(r),n)}}let Bn=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const r=new e;return r.source=this,r.operator=n,r}subscribe(n,r,i){const a=function Oa(e){return e&&e instanceof kc||function kl(e){return e&&ar(e.next)&&ar(e.error)&&ar(e.complete)}(e)&&us(e)}(n)?n:new oo(n,r,i);return fn(()=>{const{operator:c,source:d}=this;a.add(c?c.call(a,d):d?this._subscribe(a):this._trySubscribe(a))}),a}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return new(r=Pc(r))((i,a)=>{const c=new oo({next:d=>{try{n(d)}catch(p){a(p),c.unsubscribe()}},error:a,complete:i});this.subscribe(c)})}_subscribe(n){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(n)}[It](){return this}pipe(...n){return Os(n)(this)}toPromise(n){return new(n=Pc(n))((r,i)=>{let a;this.subscribe(c=>a=c,c=>i(c),()=>r(a))})}}return e.create=t=>new e(t),e})();function Pc(e){var t;return null!==(t=e??Zt.Promise)&&void 0!==t?t:Promise}const Rc=qh(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let pi=(()=>{class e extends Bn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const r=new La(this,this);return r.operator=n,r}_throwIfClosed(){if(this.closed)throw new Rc}next(n){fn(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(n)}})}error(n){fn(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:r}=this;for(;r.length;)r.shift().error(n)}})}complete(){fn(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:r,isStopped:i,observers:a}=this;return r||i?ks:(this.currentObservers=null,a.push(n),new wr(()=>{this.currentObservers=null,b(a,n)}))}_checkFinalizedStatuses(n){const{hasError:r,thrownError:i,isStopped:a}=this;r?n.error(i):a&&n.complete()}asObservable(){const n=new Bn;return n.source=this,n}}return e.create=(t,n)=>new La(t,n),e})();class La extends pi{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===r||r.call(n,t)}error(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===r||r.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,r;return null!==(r=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==r?r:ks}}function na(e){return ar(e?.lift)}function yr(e){return t=>{if(na(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function tr(e,t,n,r,i){return new Ae(e,t,n,r,i)}class Ae extends kc{constructor(t,n,r,i,a,c){super(t),this.onFinalize=a,this.shouldUnsubscribe=c,this._next=n?function(d){try{n(d)}catch(p){t.error(p)}}:super._next,this._error=i?function(d){try{i(d)}catch(p){t.error(p)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(d){t.error(d)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function Pe(e,t){return yr((n,r)=>{let i=0;n.subscribe(tr(r,a=>{r.next(e.call(t,a,i++))}))})}function lo(e){return this instanceof lo?(this.v=e,this):new lo(e)}function Rl(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),a=[];return i={},c("next"),c("throw"),c("return"),i[Symbol.asyncIterator]=function(){return this},i;function c(T){r[T]&&(i[T]=function(P){return new Promise(function(N,G){a.push([T,P,N,G])>1||d(T,P)})})}function d(T,P){try{!function p(T){T.value instanceof lo?Promise.resolve(T.value.v).then(v,E):D(a[0][2],T)}(r[T](P))}catch(N){D(a[0][3],N)}}function v(T){d("next",T)}function E(T){d("throw",T)}function D(T,P){T(P),a.shift(),a.length&&d(a[0][0],a[0][1])}}function ia(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function ra(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(a){n[a]=e[a]&&function(c){return new Promise(function(d,p){!function i(a,c,d,p){Promise.resolve(p).then(function(v){a({value:v,done:d})},c)}(d,p,(c=e[a](c)).done,c.value)})}}}const co=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Xr(e){return ar(e?.then)}function $r(e){return ar(e[It])}function mi(e){return Symbol.asyncIterator&&ar(e?.[Symbol.asyncIterator])}function gi(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const J=function Ns(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function V(e){return ar(e?.[J])}function $(e){return Rl(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:r,done:i}=yield lo(n.read());if(i)return yield lo(void 0);yield yield lo(r)}}finally{n.releaseLock()}})}function K(e){return ar(e?.getReader)}function te(e){if(e instanceof Bn)return e;if(null!=e){if($r(e))return function ce(e){return new Bn(t=>{const n=e[It]();if(ar(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(co(e))return function ge(e){return new Bn(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(Xr(e))return function he(e){return new Bn(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,Bi)})}(e);if(mi(e))return xe(e);if(V(e))return function ue(e){return new Bn(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(K(e))return function Me(e){return xe($(e))}(e)}throw gi(e)}function xe(e){return new Bn(t=>{(function je(e,t){var n,r,i,a;return function ps(e,t,n,r){return new(n||(n=Promise))(function(a,c){function d(E){try{v(r.next(E))}catch(D){c(D)}}function p(E){try{v(r.throw(E))}catch(D){c(D)}}function v(E){E.done?a(E.value):function i(a){return a instanceof n?a:new n(function(c){c(a)})}(E.value).then(d,p)}v((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=ia(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(c){i={error:c}}finally{try{r&&!r.done&&(a=n.return)&&(yield a.call(n))}finally{if(i)throw i.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function Te(e,t,n,r=0,i=!1){const a=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(a),!i)return a}function ht(e,t,n=1/0){return ar(t)?ht((r,i)=>Pe((a,c)=>t(r,a,i,c))(te(e(r,i))),n):("number"==typeof t&&(n=t),yr((r,i)=>function Dt(e,t,n,r,i,a,c,d){const p=[];let v=0,E=0,D=!1;const T=()=>{D&&!p.length&&!v&&t.complete()},P=G=>v<r?N(G):p.push(G),N=G=>{a&&t.next(G),v++;let U=!1;te(n(G,E++)).subscribe(tr(t,Z=>{i?.(Z),a?P(Z):t.next(Z)},()=>{U=!0},void 0,()=>{if(U)try{for(v--;p.length&&v<r;){const Z=p.shift();c?Te(t,c,()=>N(Z)):N(Z)}T()}catch(Z){t.error(Z)}}))};return e.subscribe(tr(t,P,()=>{D=!0,T()})),()=>{d?.()}}(r,i,e,n)))}function dt(e=1/0){return ht(Wr,e)}const xt=new Bn(e=>e.complete());function an(e){return e[e.length-1]}function lr(e){return function sn(e){return e&&ar(e.schedule)}(an(e))?e.pop():void 0}function Pr(e,t=0){return yr((n,r)=>{n.subscribe(tr(r,i=>Te(r,e,()=>r.next(i),t),()=>Te(r,e,()=>r.complete(),t),i=>Te(r,e,()=>r.error(i),t)))})}function Va(e,t=0){return yr((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function $a(e,t){if(!e)throw new Error("Iterable cannot be null");return new Bn(n=>{Te(n,t,()=>{const r=e[Symbol.asyncIterator]();Te(n,t,()=>{r.next().then(i=>{i.done?n.complete():n.next(i.value)})},0,!0)})})}function Cr(e,t){return t?function Ou(e,t){if(null!=e){if($r(e))return function kf(e,t){return te(e).pipe(Va(t),Pr(t))}(e,t);if(co(e))return function Ua(e,t){return new Bn(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if(Xr(e))return function Pf(e,t){return te(e).pipe(Va(t),Pr(t))}(e,t);if(mi(e))return $a(e,t);if(V(e))return function Fu(e,t){return new Bn(n=>{let r;return Te(n,t,()=>{r=e[J](),Te(n,t,()=>{let i,a;try{({value:i,done:a}=r.next())}catch(c){return void n.error(c)}a?n.complete():n.next(i)},0,!0)}),()=>ar(r?.return)&&r.return()})}(e,t);if(K(e))return function sa(e,t){return $a($(e),t)}(e,t)}throw gi(e)}(e,t):te(e)}function Ll(e,t,...n){if(!0===t)return void e();if(!1===t)return;const r=new oo({next:()=>{r.unsubscribe(),e()}});return t(...n).subscribe(r)}function zn(e){for(let t in e)if(e[t]===zn)return t;throw Error("Could not find renamed property on target object.")}function Mn(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Mn).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function Lu(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Rf=zn({__forward_ref__:zn});function Jn(e){return e.__forward_ref__=Jn,e.toString=function(){return Mn(this())},e}function Mt(e){return function Nl(e){return"function"==typeof e&&e.hasOwnProperty(Rf)&&e.__forward_ref__===Jn}(e)?e():e}class nt extends Error{constructor(t,n){super(function wn(e,t){return`NG0${Math.abs(e)}${t?": "+t.trim():""}`}(t,n)),this.code=t}}function $t(e){return"string"==typeof e?e:null==e?"":String(e)}function Nu(e,t){throw new nt(-201,!1)}function ji(e,t){null==e&&function Rn(e,t,n,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${n} ${r} ${t} <=Actual]`))}(t,e,null,"!=")}function zt(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Di(e){return{providers:e.providers||[],imports:e.imports||[]}}function Uu(e){return Nc(e,mn)||Nc(e,ju)}function Nc(e,t){return e.hasOwnProperty(t)?e[t]:null}function ja(e){return e&&(e.hasOwnProperty($u)||e.hasOwnProperty(Ha))?e[$u]:null}const mn=zn({\u0275prov:zn}),$u=zn({\u0275inj:zn}),ju=zn({ngInjectableDef:zn}),Ha=zn({ngInjectorDef:zn});var Rt=(()=>((Rt=Rt||{})[Rt.Default=0]="Default",Rt[Rt.Host=1]="Host",Rt[Rt.Self=2]="Self",Rt[Rt.SkipSelf=4]="SkipSelf",Rt[Rt.Optional=8]="Optional",Rt))();let aa;function uo(e){const t=aa;return aa=e,t}function Hu(e,t,n){const r=Uu(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&Rt.Optional?null:void 0!==t?t:void Nu(Mn(e))}function Wo(e){return{toString:e}.toString()}var Xo=(()=>((Xo=Xo||{})[Xo.OnPush=0]="OnPush",Xo[Xo.Default=1]="Default",Xo))(),ms=(()=>{return(e=ms||(ms={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",ms;var e})();const nr=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),la={},Cn=[],Ga=zn({\u0275cmp:zn}),zc=zn({\u0275dir:zn}),Bc=zn({\u0275pipe:zn}),rd=zn({\u0275mod:zn}),Ao=zn({\u0275fac:zn}),ca=zn({__NG_ELEMENT_ID__:zn});let ko=0;function zs(e){return Wo(()=>{const n=!0===e.standalone,r={},i={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:r,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Xo.OnPush,directiveDefs:null,pipeDefs:null,standalone:n,dependencies:n&&e.dependencies||null,getStandaloneInjector:null,selectors:e.selectors||Cn,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||ms.Emulated,id:"c"+ko++,styles:e.styles||Cn,_:null,setInput:null,schemas:e.schemas||null,tView:null},a=e.dependencies,c=e.features;return i.inputs=zf(e.inputs,r),i.outputs=zf(e.outputs),c&&c.forEach(d=>d(i)),i.directiveDefs=a?()=>("function"==typeof a?a():a).map(od).filter(qa):null,i.pipeDefs=a?()=>("function"==typeof a?a():a).map(kt).filter(qa):null,i})}function od(e){return Lt(e)||Kr(e)}function qa(e){return null!==e}function li(e){return Wo(()=>({type:e.type,bootstrap:e.bootstrap||Cn,declarations:e.declarations||Cn,imports:e.imports||Cn,exports:e.exports||Cn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function zf(e,t){if(null==e)return la;const n={};for(const r in e)if(e.hasOwnProperty(r)){let i=e[r],a=i;Array.isArray(i)&&(a=i[1],i=i[0]),n[i]=r,t&&(t[i]=a)}return n}const Ot=zs;function Hi(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function Lt(e){return e[Ga]||null}function Kr(e){return e[zc]||null}function kt(e){return e[Bc]||null}function cn(e,t){const n=e[rd]||null;if(!n&&!0===t)throw new Error(`Type ${Mn(e)} does not have '\u0275mod' property.`);return n}function Xe(e){return Array.isArray(e)&&"object"==typeof e[1]}function po(e){return Array.isArray(e)&&!0===e[1]}function ld(e){return 0!=(8&e.flags)}function Zu(e){return 2==(2&e.flags)}function Vl(e){return 1==(1&e.flags)}function Po(e){return null!==e.template}function Uc(e){return 0!=(256&e[2])}function _s(e,t){return e.hasOwnProperty(Ao)?e[Ao]:null}class wt{constructor(t,n,r){this.previousValue=t,this.currentValue=n,this.firstChange=r}isFirstChange(){return this.firstChange}}function yt(){return Ja}function Ja(e){return e.type.prototype.ngOnChanges&&(e.setInput=pd),fd}function fd(){const e=jc(this),t=e?.current;if(t){const n=e.previous;if(n===la)e.previous=t;else for(let r in t)n[r]=t[r];e.current=null,this.ngOnChanges(t)}}function pd(e,t,n,r){const i=jc(e)||function Ko(e,t){return e[Si]=t}(e,{previous:la,current:null}),a=i.current||(i.current={}),c=i.previous,d=this.declaredInputs[n],p=c[d];a[d]=new wt(p&&p.currentValue,t,c===la),e[r]=t}yt.ngInherit=!0;const Si="__ngSimpleChanges__";function jc(e){return e[Si]||null}function Sr(e){for(;Array.isArray(e);)e=e[0];return e}function Mi(e,t){return Sr(t[e.index])}function Hl(e,t){return e.data[t]}function Ti(e,t){const n=t[e];return Xe(n)?n:n[0]}function Gl(e){return 64==(64&e[2])}function vs(e,t){return null==t?null:e[t]}function $s(e){e[18]=0}function ql(e,t){e[5]+=t;let n=e,r=e[3];for(;null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}const Vt={lFrame:ie(null),bindingsEnabled:!0};function qc(){return Vt.bindingsEnabled}function He(){return Vt.lFrame.lView}function en(){return Vt.lFrame.tView}function Rr(){let e=ih();for(;null!==e&&64===e.type;)e=e.parent;return e}function ih(){return Vt.lFrame.currentTNode}function bs(e,t){const n=Vt.lFrame;n.currentTNode=e,n.isParent=t}function xd(){return Vt.lFrame.isParent}function h(){const e=Vt.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function w(){return Vt.lFrame.bindingIndex++}function R(e,t){const n=Vt.lFrame;n.bindingIndex=n.bindingRootIndex=e,L(t)}function L(e){Vt.lFrame.currentDirectiveIndex=e}function Q(){return Vt.lFrame.currentQueryIndex}function ee(e){Vt.lFrame.currentQueryIndex=e}function Y(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function ae(e,t,n){if(n&Rt.SkipSelf){let i=t,a=e;for(;!(i=i.parent,null!==i||n&Rt.Host||(i=Y(a),null===i||(a=a[15],10&i.type))););if(null===i)return!1;t=i,e=a}const r=Vt.lFrame=ye();return r.currentTNode=t,r.lView=e,!0}function _e(e){const t=ye(),n=e[1];Vt.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function ye(){const e=Vt.lFrame,t=null===e?null:e.child;return null===t?ie(e):t}function ie(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function we(){const e=Vt.lFrame;return Vt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const De=we;function Se(){const e=we();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Le(){return Vt.lFrame.selectedIndex}function Ne(e){Vt.lFrame.selectedIndex=e}function Ht(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const a=e.data[n].type.prototype,{ngAfterContentInit:c,ngAfterContentChecked:d,ngAfterViewInit:p,ngAfterViewChecked:v,ngOnDestroy:E}=a;c&&(e.contentHooks||(e.contentHooks=[])).push(-n,c),d&&((e.contentHooks||(e.contentHooks=[])).push(n,d),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,d)),p&&(e.viewHooks||(e.viewHooks=[])).push(-n,p),v&&((e.viewHooks||(e.viewHooks=[])).push(n,v),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,v)),null!=E&&(e.destroyHooks||(e.destroyHooks=[])).push(n,E)}}function rn(e,t,n){yo(e,t,3,n)}function Fn(e,t,n,r){(3&e[2])===n&&yo(e,t,n,r)}function yn(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function yo(e,t,n,r){const a=r??-1,c=t.length-1;let d=0;for(let p=void 0!==r?65535&e[18]:0;p<c;p++)if("number"==typeof t[p+1]){if(d=t[p],null!=r&&d>=r)break}else t[p]<0&&(e[18]+=65536),(d<a||-1==a)&&(Fo(e,n,t,p),e[18]=(4294901760&e[18])+p+2),p++}function Fo(e,t,n,r){const i=n[r]<0,a=n[r+1],d=e[i?-n[r]:n[r]];if(i){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{a.call(d)}finally{}}}else try{a.call(d)}finally{}}class ci{constructor(t,n,r){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r}}function Jr(e,t,n){let r=0;for(;r<n.length;){const i=n[r];if("number"==typeof i){if(0!==i)break;r++;const a=n[r++],c=n[r++],d=n[r++];e.setAttribute(t,c,d,a)}else{const a=i,c=n[++r];Qo(a)?e.setProperty(t,a,c):e.setAttribute(t,a,c),r++}}return r}function rr(e){return 3===e||4===e||6===e}function Qo(e){return 64===e.charCodeAt(0)}function Wi(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const i=t[r];"number"==typeof i?n=i:0===n||sh(e,n,i,null,-1===n||2===n?t[++r]:null)}}return e}function sh(e,t,n,r,i){let a=0,c=e.length;if(-1===t)c=-1;else for(;a<e.length;){const d=e[a++];if("number"==typeof d){if(d===t){c=-1;break}if(d>t){c=a-1;break}}}for(;a<e.length;){const d=e[a];if("number"==typeof d)break;if(d===n){if(null===r)return void(null!==i&&(e[a+1]=i));if(r===e[a+1])return void(e[a+2]=i)}a++,null!==r&&a++,null!==i&&a++}-1!==c&&(e.splice(c,0,t),a=c+1),e.splice(a++,0,n),null!==r&&e.splice(a++,0,r),null!==i&&e.splice(a++,0,i)}function ma(e){return-1!==e}function Hs(e){return 32767&e}function xs(e,t){let n=function ah(e){return e>>16}(e),r=t;for(;n>0;)r=r[15],n--;return r}let wd=!0;function Mr(e){const t=wd;return wd=e,t}let Cd=0;const ga={};function lh(e,t){const n=Gm(e,t);if(-1!==n)return n;const r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,Wf(r.data,e),Wf(t,null),Wf(r.blueprint,null));const i=ch(e,t),a=e.injectorIndex;if(ma(i)){const c=Hs(i),d=xs(i,t),p=d[1].data;for(let v=0;v<8;v++)t[a+v]=d[c+v]|p[c+v]}return t[a+8]=i,a}function Wf(e,t){e.push(0,0,0,0,0,0,0,0,t)}function Gm(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function ch(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,i=t;for(;null!==i;){if(r=P_(i),null===r)return-1;if(n++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return-1}function Ed(e,t,n){!function Zf(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(ca)&&(r=n[ca]),null==r&&(r=n[ca]=Cd++);const i=255&r;t.data[e+(i>>5)]|=1<<i}(e,t,n)}function uh(e,t,n){if(n&Rt.Optional||void 0!==e)return e;Nu()}function Lo(e,t,n,r){if(n&Rt.Optional&&void 0===r&&(r=null),0==(n&(Rt.Self|Rt.Host))){const i=e[9],a=uo(void 0);try{return i?i.get(t,r,n&Rt.Optional):Hu(t,r,n&Rt.Optional)}finally{uo(a)}}return uh(r,0,n)}function Zm(e,t,n,r=Rt.Default,i){if(null!==e){if(1024&t[2]){const c=function qx(e,t,n,r,i){let a=e,c=t;for(;null!==a&&null!==c&&1024&c[2]&&!(256&c[2]);){const d=k_(a,c,n,r|Rt.Self,ga);if(d!==ga)return d;let p=a.parent;if(!p){const v=c[21];if(v){const E=v.get(n,ga,r);if(E!==ga)return E}p=P_(c),c=c[15]}a=p}return i}(e,t,n,r,ga);if(c!==ga)return c}const a=k_(e,t,n,r,ga);if(a!==ga)return a}return Lo(t,n,r,i)}function k_(e,t,n,r,i){const a=function Yf(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(ca)?e[ca]:void 0;return"number"==typeof t?t>=0?255&t:Gx:t}(n);if("function"==typeof a){if(!ae(t,e,r))return r&Rt.Host?uh(i,0,r):Lo(t,n,r,i);try{const c=a(r);if(null!=c||r&Rt.Optional)return c;Nu()}finally{De()}}else if("number"==typeof a){let c=null,d=Gm(e,t),p=-1,v=r&Rt.Host?t[16][6]:null;for((-1===d||r&Rt.SkipSelf)&&(p=-1===d?ch(e,t):t[d+8],-1!==p&&Xl(r,!1)?(c=t[1],d=Hs(p),t=xs(p,t)):d=-1);-1!==d;){const E=t[1];if(Wm(a,d,E.data)){const D=Hx(d,t,n,c,r,v);if(D!==ga)return D}p=t[d+8],-1!==p&&Xl(r,t[1].data[d+8]===v)&&Wm(a,d,t)?(c=E,d=Hs(p),t=xs(p,t)):d=-1}}return i}function Hx(e,t,n,r,i,a){const c=t[1],d=c.data[e+8],E=Xf(d,c,n,null==r?Zu(d)&&wd:r!=c&&0!=(3&d.type),i&Rt.Host&&a===d);return null!==E?nl(t,c,E,d):ga}function Xf(e,t,n,r,i){const a=e.providerIndexes,c=t.data,d=1048575&a,p=e.directiveStart,E=a>>20,T=i?d+E:e.directiveEnd;for(let P=r?d:d+E;P<T;P++){const N=c[P];if(P<p&&n===N||P>=p&&N.type===n)return P}if(i){const P=c[p];if(P&&Po(P)&&P.type===n)return p}return null}function nl(e,t,n,r){let i=e[n];const a=t.data;if(function Ii(e){return e instanceof ci}(i)){const c=i;c.resolving&&function Wh(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new nt(-200,`Circular dependency in DI detected for ${e}${n}`)}(function gn(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():$t(e)}(a[n]));const d=Mr(c.canSeeViewProviders);c.resolving=!0;const p=c.injectImpl?uo(c.injectImpl):null;ae(e,r,Rt.Default);try{i=e[n]=c.factory(void 0,a,e,r),t.firstCreatePass&&n>=r.directiveStart&&function An(e,t,n){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:a}=t.type.prototype;if(r){const c=Ja(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,c),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,c)}i&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,i),a&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,a),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,a))}(n,a[n],t)}finally{null!==p&&uo(p),Mr(d),c.resolving=!1,De()}}return i}function Wm(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function Xl(e,t){return!(e&Rt.Self||e&Rt.Host&&t)}class ya{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,r){return Zm(this._tNode,this._lView,t,r,n)}}function Gx(){return new ya(Rr(),He())}function P_(e){const t=e[1],n=t.type;return 2===n?t.declTNode:1===n?e[6]:null}const Yl="__parameters__";function ir(e,t,n){return Wo(()=>{const r=function Ym(e){return function(...n){if(e){const r=e(...n);for(const i in r)this[i]=r[i]}}}(t);function i(...a){if(this instanceof i)return r.apply(this,a),this;const c=new i(...a);return d.annotation=c,d;function d(p,v,E){const D=p.hasOwnProperty(Yl)?p[Yl]:Object.defineProperty(p,Yl,{value:[]})[Yl];for(;D.length<=E;)D.push(null);return(D[E]=D[E]||[]).push(c),p}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i})}class Tt{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=zt({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function _o(e,t){void 0===t&&(t=e);for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)?(t===e&&(t=e.slice(0,n)),_o(r,t)):t!==e&&t.push(r)}return t}function rl(e,t){e.forEach(n=>Array.isArray(n)?rl(n,t):t(n))}function N_(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function ep(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}const il={},np="__NG_DI_FLAG__",rp="ngTempTokenPath",r1=/\n/gm,U_="__source";let Pd;function Xc(e){const t=Pd;return Pd=e,t}function ig(e,t=Rt.Default){if(void 0===Pd)throw new nt(-203,!1);return null===Pd?Hu(e,void 0,t):Pd.get(e,t&Rt.Optional?null:void 0,t)}function St(e,t=Rt.Default){return(function Bl(){return aa}()||ig)(Mt(e),t)}function Or(e,t=Rt.Default){return"number"!=typeof t&&(t=0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)),St(e,t)}function ip(e){const t=[];for(let n=0;n<e.length;n++){const r=Mt(e[n]);if(Array.isArray(r)){if(0===r.length)throw new nt(900,!1);let i,a=Rt.Default;for(let c=0;c<r.length;c++){const d=r[c],p=o1(d);"number"==typeof p?-1===p?i=d.token:a|=p:i=d}t.push(St(i,a))}else t.push(St(r))}return t}function Rd(e,t){return e[np]=t,e.prototype[np]=t,e}function o1(e){return e[np]}const Fd=Rd(ir("Optional"),8),Ir=Rd(ir("SkipSelf"),4);var Yi=(()=>((Yi=Yi||{})[Yi.Important=1]="Important",Yi[Yi.DashCase=2]="DashCase",Yi))();const cp=new Map;let Jl=0;const hp="__ngContext__";function hi(e,t){Xe(t)?(e[hp]=t[20],function Y_(e){cp.set(e[20],e)}(t)):e[hp]=t}function bg(e,t){return undefined(e,t)}function Vd(e){const t=e[3];return po(t)?t[3]:t}function _h(e){return nv(e[13])}function Ud(e){return nv(e[4])}function nv(e){for(;null!==e&&!po(e);)e=e[4];return e}function ec(e,t,n,r,i){if(null!=r){let a,c=!1;po(r)?a=r:Xe(r)&&(c=!0,r=r[0]);const d=Sr(r);0===e&&null!==n?null==i?Sg(t,n,d):rc(t,n,d,i||null,!0):1===e&&null!==n?rc(t,n,d,i||null,!0):2===e?function Gd(e,t,n){const r=vh(e,t);r&&function yp(e,t,n,r){e.removeChild(t,n,r)}(e,r,t,n)}(t,d,c):3===e&&t.destroyNode(d),null!=a&&function T1(e,t,n,r,i){const a=n[7];a!==Sr(n)&&ec(t,e,r,a,i);for(let d=10;d<n.length;d++){const p=n[d];sl(p[1],p,e,t,r,a)}}(t,e,a,n,i)}}function pp(e,t,n){return e.createElement(t,n)}function ov(e,t){const n=e[9],r=n.indexOf(t),i=t[3];512&t[2]&&(t[2]&=-513,ql(i,-1)),n.splice(r,1)}function $d(e,t){if(e.length<=10)return;const n=10+t,r=e[n];if(r){const i=r[17];null!==i&&i!==e&&ov(i,r),t>0&&(e[n-1][4]=r[4]);const a=ep(e,10+t);!function mp(e,t){sl(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(r[1],r);const c=a[19];null!==c&&c.detachView(a[1]),r[3]=null,r[4]=null,r[2]&=-65}return r}function br(e,t){if(!(128&t[2])){const n=t[11];n.destroyNode&&sl(e,t,n,3,null,null),function E1(e){let t=e[13];if(!t)return nc(e[1],e);for(;t;){let n=null;if(Xe(t))n=t[13];else{const r=t[10];r&&(n=r)}if(!n){for(;t&&!t[4]&&t!==e;)Xe(t)&&nc(t[1],t),t=t[3];null===t&&(t=e),Xe(t)&&nc(t[1],t),n=t&&t[4]}t=n}}(t)}}function nc(e,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function av(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const i=t[n[r]];if(!(i instanceof ci)){const a=n[r+1];if(Array.isArray(a))for(let c=0;c<a.length;c+=2){const d=i[a[c]],p=a[c+1];try{p.call(d)}finally{}}else try{a.call(i)}finally{}}}}(e,t),function sv(e,t){const n=e.cleanup,r=t[7];let i=-1;if(null!==n)for(let a=0;a<n.length-1;a+=2)if("string"==typeof n[a]){const c=n[a+1],d="function"==typeof c?c(t):Sr(t[c]),p=r[i=n[a+2]],v=n[a+3];"boolean"==typeof v?d.removeEventListener(n[a],p,v):v>=0?r[i=v]():r[i=-v].unsubscribe(),a+=2}else{const c=r[i=n[a+1]];n[a].call(c)}if(null!==r){for(let a=i+1;a<r.length;a++)(0,r[a])();t[7]=null}}(e,t),1===t[1].type&&t[11].destroy();const n=t[17];if(null!==n&&po(t[3])){n!==t[3]&&ov(n,t);const r=t[19];null!==r&&r.detachView(e)}!function K_(e){cp.delete(e[20])}(t)}}function Eg(e,t,n){return function Dg(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[0];if(2&r.flags){const i=e.data[r.directiveStart].encapsulation;if(i===ms.None||i===ms.Emulated)return null}return Mi(r,n)}(e,t.parent,n)}function rc(e,t,n,r,i){e.insertBefore(t,n,r,i)}function Sg(e,t,n){e.appendChild(t,n)}function gp(e,t,n,r,i){null!==r?rc(e,t,n,r,i):Sg(e,t,n)}function vh(e,t){return e.parentNode(t)}let _,Mg=function bh(e,t,n){return 40&e.type?Mi(e,n):null};function jd(e,t,n,r){const i=Eg(e,r,t),a=t[11],d=function No(e,t,n){return Mg(e,t,n)}(r.parent||t[6],r,t);if(null!=i)if(Array.isArray(n))for(let p=0;p<n.length;p++)gp(a,i,n[p],d,!1);else gp(a,i,n,d,!1)}function Hd(e,t){if(null!==t){const n=t.type;if(3&n)return Mi(t,e);if(4&n)return Ag(-1,e[t.index]);if(8&n){const r=t.child;if(null!==r)return Hd(e,r);{const i=e[t.index];return po(i)?Ag(-1,i):Sr(i)}}if(32&n)return bg(t,e)()||Sr(e[t.index]);{const r=Ig(e,t);return null!==r?Array.isArray(r)?r[0]:Hd(Vd(e[16]),r):Hd(e,t.next)}}return null}function Ig(e,t){return null!==t?e[16][6].projection[t.projection]:null}function Ag(e,t){const n=10+e+1;if(n<t.length){const r=t[n],i=r[1].firstChild;if(null!==i)return Hd(r,i)}return t[7]}function vp(e,t,n,r,i,a,c){for(;null!=n;){const d=r[n.index],p=n.type;if(c&&0===t&&(d&&hi(Sr(d),r),n.flags|=4),64!=(64&n.flags))if(8&p)vp(e,t,n.child,r,i,a,!1),ec(t,e,i,d,a);else if(32&p){const v=bg(n,r);let E;for(;E=v();)ec(t,e,i,E,a);ec(t,e,i,d,a)}else 16&p?Pg(e,t,r,n,i,a):ec(t,e,i,d,a);n=c?n.projectionNext:n.next}}function sl(e,t,n,r,i,a){vp(n,r,e.firstChild,t,i,a,!1)}function Pg(e,t,n,r,i,a){const c=n[16],p=c[6].projection[r.projection];if(Array.isArray(p))for(let v=0;v<p.length;v++)ec(t,e,i,p[v],a);else vp(e,t,p,c[3],i,a,!0)}function bp(e,t,n){e.setAttribute(t,"style",n)}function xh(e,t,n){""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n)}const Zd=new Tt("ENVIRONMENT_INITIALIZER"),va=new Tt("INJECTOR",-1),Rg=new Tt("INJECTOR_DEF_TYPES");class wp{get(t,n=il){if(n===il){const r=new Error(`NullInjectorError: No provider for ${Mn(t)}!`);throw r.name="NullInjectorError",r}return n}}function Fg(...e){return{\u0275providers:Og(0,e)}}function Og(e,...t){const n=[],r=new Set;let i;return rl(t,a=>{const c=a;Lg(c,n,[],r)&&(i||(i=[]),i.push(c))}),void 0!==i&&cv(i,n),n}function cv(e,t){for(let n=0;n<e.length;n++){const{providers:i}=e[n];rl(i,a=>{t.push(a)})}}function Lg(e,t,n,r){if(!(e=Mt(e)))return!1;let i=null,a=ja(e);const c=!a&&Lt(e);if(a||c){if(c&&!c.standalone)return!1;i=e}else{const p=e.ngModule;if(a=ja(p),!a)return!1;i=p}const d=r.has(i);if(c){if(d)return!1;if(r.add(i),c.dependencies){const p="function"==typeof c.dependencies?c.dependencies():c.dependencies;for(const v of p)Lg(v,t,n,r)}}else{if(!a)return!1;{if(null!=a.imports&&!d){let v;r.add(i);try{rl(a.imports,E=>{Lg(E,t,n,r)&&(v||(v=[]),v.push(E))})}finally{}void 0!==v&&cv(v,t)}if(!d){const v=_s(i)||(()=>new i);t.push({provide:i,useFactory:v,deps:Cn},{provide:Rg,useValue:i,multi:!0},{provide:Zd,useValue:()=>St(i),multi:!0})}const p=a.providers;null==p||d||rl(p,E=>{t.push(E)})}}return i!==e&&void 0!==e.providers}const k1=zn({provide:String,useValue:zn});function Ng(e){return null!==e&&"object"==typeof e&&k1 in e}function eu(e){return"function"==typeof e}const wh=new Tt("Set Injector scope."),Wd={},wo={};let Ss;function oc(){return void 0===Ss&&(Ss=new wp),Ss}class Ms{}class zg extends Ms{constructor(t,n,r,i){super(),this.parent=n,this.source=r,this.scopes=i,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,P1(t,c=>this.processProvider(c)),this.records.set(va,Cp(void 0,this)),i.has("environment")&&this.records.set(Ms,Cp(void 0,this));const a=this.records.get(wh);null!=a&&"string"==typeof a.value&&this.scopes.add(a.value),this.injectorDefTypes=new Set(this.get(Rg.multi,Cn,Rt.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}runInContext(t){this.assertNotDestroyed();const n=Xc(this),r=uo(void 0);try{return t()}finally{Xc(n),uo(r)}}get(t,n=il,r=Rt.Default){this.assertNotDestroyed();const i=Xc(this),a=uo(void 0);try{if(!(r&Rt.SkipSelf)){let d=this.records.get(t);if(void 0===d){const p=function Sz(e){return"function"==typeof e||"object"==typeof e&&e instanceof Tt}(t)&&Uu(t);d=p&&this.injectableDefInScope(p)?Cp(cl(t),Wd):null,this.records.set(t,d)}if(null!=d)return this.hydrate(t,d)}return(r&Rt.Self?oc():this.parent).get(t,n=r&Rt.Optional&&n===il?null:n)}catch(c){if("NullInjectorError"===c.name){if((c[rp]=c[rp]||[]).unshift(Mn(t)),i)throw c;return function s1(e,t,n,r){const i=e[rp];throw t[U_]&&i.unshift(t[U_]),e.message=function $_(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let i=Mn(t);if(Array.isArray(t))i=t.map(Mn).join(" -> ");else if("object"==typeof t){let a=[];for(let c in t)if(t.hasOwnProperty(c)){let d=t[c];a.push(c+":"+("string"==typeof d?JSON.stringify(d):Mn(d)))}i=`{${a.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${e.replace(r1,"\n  ")}`}("\n"+e.message,i,n,r),e.ngTokenPath=i,e[rp]=null,e}(c,t,"R3InjectorError",this.source)}throw c}finally{uo(a),Xc(i)}}resolveInjectorInitializers(){const t=Xc(this),n=uo(void 0);try{const r=this.get(Zd.multi,Cn,Rt.Self);for(const i of r)i()}finally{Xc(t),uo(n)}}toString(){const t=[],n=this.records;for(const r of n.keys())t.push(Mn(r));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new nt(205,!1)}processProvider(t){let n=eu(t=Mt(t))?t:Mt(t&&t.provide);const r=function Cz(e){return Ng(e)?Cp(void 0,e.useValue):Cp(function k2(e,t,n){let r;if(eu(e)){const i=Mt(e);return _s(i)||cl(i)}if(Ng(e))r=()=>Mt(e.useValue);else if(function hv(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...ip(e.deps||[]));else if(function uv(e){return!(!e||!e.useExisting)}(e))r=()=>St(Mt(e.useExisting));else{const i=Mt(e&&(e.useClass||e.provide));if(!function Ez(e){return!!e.deps}(e))return _s(i)||cl(i);r=()=>new i(...ip(e.deps))}return r}(e),Wd)}(t);if(eu(t)||!0!==t.multi)this.records.get(n);else{let i=this.records.get(n);i||(i=Cp(void 0,Wd,!0),i.factory=()=>ip(i.multi),this.records.set(n,i)),n=t,i.multi.push(t)}this.records.set(n,r)}hydrate(t,n){return n.value===Wd&&(n.value=wo,n.value=n.factory()),"object"==typeof n.value&&n.value&&function Dz(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=Mt(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}}function cl(e){const t=Uu(e),n=null!==t?t.factory:_s(e);if(null!==n)return n;if(e instanceof Tt)throw new nt(204,!1);if(e instanceof Function)return function wz(e){const t=e.length;if(t>0)throw function Id(e,t){const n=[];for(let r=0;r<e;r++)n.push(t);return n}(t,"?"),new nt(204,!1);const n=function td(e){const t=e&&(e[mn]||e[ju]);if(t){const n=function nd(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new nt(204,!1)}function Cp(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function Mz(e){return!!e.\u0275providers}function P1(e,t){for(const n of e)Array.isArray(n)?P1(n,t):Mz(n)?P1(n.\u0275providers,t):t(n)}class P2{}class Az{resolveComponentFactory(t){throw function Iz(e){const t=Error(`No component factory found for ${Mn(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let Bg=(()=>{class e{}return e.NULL=new Az,e})();function kz(){return Ep(Rr(),He())}function Ep(e,t){return new qs(Mi(e,t))}let qs=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=kz,e})();function Pz(e){return e instanceof qs?e.nativeElement:e}class F2{}let sc=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>function Rz(){const e=He(),n=Ti(Rr().index,e);return(Xe(n)?n:e)[11]}(),e})(),Fz=(()=>{class e{}return e.\u0275prov=zt({token:e,providedIn:"root",factory:()=>null}),e})();class Vg{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const Oz=new Vg("14.3.0"),R1={};function O1(e){return e.ngOriginalError}class Dp{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t);this._console.error("ERROR",t),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&O1(t);for(;n&&O1(n);)n=O1(n);return n||null}}function tu(e){return e instanceof Function?e():e}function L2(e,t,n){let r=e.length;for(;;){const i=e.indexOf(t,n);if(-1===i)return i;if(0===i||e.charCodeAt(i-1)<=32){const a=t.length;if(i+a===r||e.charCodeAt(i+a)<=32)return i}n=i+1}}const N2="ng-template";function qz(e,t,n){let r=0;for(;r<e.length;){let i=e[r++];if(n&&"class"===i){if(i=e[r],-1!==L2(i.toLowerCase(),t,0))return!0}else if(1===i){for(;r<e.length&&"string"==typeof(i=e[r++]);)if(i.toLowerCase()===t)return!0;return!1}}return!1}function z2(e){return 4===e.type&&e.value!==N2}function Zz(e,t,n){return t===(4!==e.type||n?e.value:N2)}function Wz(e,t,n){let r=4;const i=e.attrs||[],a=function Kz(e){for(let t=0;t<e.length;t++)if(rr(e[t]))return t;return e.length}(i);let c=!1;for(let d=0;d<t.length;d++){const p=t[d];if("number"!=typeof p){if(!c)if(4&r){if(r=2|1&r,""!==p&&!Zz(e,p,n)||""===p&&1===t.length){if(ul(r))return!1;c=!0}}else{const v=8&r?p:t[++d];if(8&r&&null!==e.attrs){if(!qz(e.attrs,v,n)){if(ul(r))return!1;c=!0}continue}const D=Xz(8&r?"class":p,i,z2(e),n);if(-1===D){if(ul(r))return!1;c=!0;continue}if(""!==v){let T;T=D>a?"":i[D+1].toLowerCase();const P=8&r?T:null;if(P&&-1!==L2(P,v,0)||2&r&&v!==T){if(ul(r))return!1;c=!0}}}}else{if(!c&&!ul(r)&&!ul(p))return!1;if(c&&ul(p))continue;c=!1,r=p|1&r}}return ul(r)||c}function ul(e){return 0==(1&e)}function Xz(e,t,n,r){if(null===t)return-1;let i=0;if(r||!n){let a=!1;for(;i<t.length;){const c=t[i];if(c===e)return i;if(3===c||6===c)a=!0;else{if(1===c||2===c){let d=t[++i];for(;"string"==typeof d;)d=t[++i];continue}if(4===c)break;if(0===c){i+=4;continue}}i+=a?1:2}return-1}return function Jz(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function B2(e,t,n=!1){for(let r=0;r<t.length;r++)if(Wz(e,t[r],n))return!0;return!1}function V2(e,t){return e?":not("+t.trim()+")":t}function e6(e){let t=e[0],n=1,r=2,i="",a=!1;for(;n<e.length;){let c=e[n];if("string"==typeof c)if(2&r){const d=e[++n];i+="["+c+(d.length>0?'="'+d+'"':"")+"]"}else 8&r?i+="."+c:4&r&&(i+=" "+c);else""!==i&&!ul(c)&&(t+=V2(a,i),i=""),r=c,a=a||!ul(r);n++}return""!==i&&(t+=V2(a,i)),t}const tn={};function kr(e){U2(en(),He(),Le()+e,!1)}function U2(e,t,n,r){if(!r)if(3==(3&t[2])){const a=e.preOrderCheckHooks;null!==a&&rn(t,a,n)}else{const a=e.preOrderHooks;null!==a&&Fn(t,a,0,n)}Ne(n)}function G2(e,t=null,n=null,r){const i=q2(e,t,n,r);return i.resolveInjectorInitializers(),i}function q2(e,t=null,n=null,r,i=new Set){const a=[n||Cn,Fg(e)];return r=r||("object"==typeof e?void 0:Mn(e)),new zg(a,t||oc(),r||null,i)}let Zs=(()=>{class e{static create(n,r){if(Array.isArray(n))return G2({name:""},r,n,"");{const i=n.name??"";return G2({name:i},n.parent,n.providers,i)}}}return e.THROW_IF_NOT_FOUND=il,e.NULL=new wp,e.\u0275prov=zt({token:e,providedIn:"any",factory:()=>St(va)}),e.__NG_ELEMENT_ID__=-1,e})();function qe(e,t=Rt.Default){const n=He();return null===n?St(e,t):Zm(Rr(),n,Mt(e),t)}function V1(){throw new Error("invalid")}function cM(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const i=n[r],a=n[r+1];if(-1!==a){const c=e.data[a];ee(i),c.contentQueries(2,t[a],a)}}}function gv(e,t,n,r,i,a,c,d,p,v,E){const D=t.blueprint.slice();return D[0]=i,D[2]=76|r,(null!==E||e&&1024&e[2])&&(D[2]|=1024),$s(D),D[3]=D[15]=e,D[8]=n,D[10]=c||e&&e[10],D[11]=d||e&&e[11],D[12]=p||e&&e[12]||null,D[9]=v||e&&e[9]||null,D[6]=a,D[20]=function X_(){return Jl++}(),D[21]=E,D[16]=2==t.type?e[16]:D,D}function Tp(e,t,n,r,i){let a=e.data[t];if(null===a)a=function K1(e,t,n,r,i){const a=ih(),c=xd(),p=e.data[t]=function L6(e,t,n,r,i,a){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:a,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,c?a:a&&a.parent,n,t,r,i);return null===e.firstChild&&(e.firstChild=p),null!==a&&(c?null==a.child&&null!==p.parent&&(a.child=p):null===a.next&&(a.next=p)),p}(e,t,n,r,i),function I(){return Vt.lFrame.inI18n}()&&(a.flags|=64);else if(64&a.type){a.type=n,a.value=r,a.attrs=i;const c=function js(){const e=Vt.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();a.injectorIndex=null===c?-1:c.injectorIndex}return bs(a,!0),a}function Ip(e,t,n,r){if(0===n)return-1;const i=t.length;for(let a=0;a<n;a++)t.push(r),e.blueprint.push(r),e.data.push(null);return i}function J1(e,t,n){_e(t);try{const r=e.viewQuery;null!==r&&sw(1,r,n);const i=e.template;null!==i&&uM(e,t,i,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&cM(e,t),e.staticViewQueries&&sw(2,e.viewQuery,n);const a=e.components;null!==a&&function R6(e,t){for(let n=0;n<t.length;n++)J6(e,t[n])}(t,a)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[2]&=-5,Se()}}function yv(e,t,n,r){const i=t[2];if(128!=(128&i)){_e(t);try{$s(t),function y(e){return Vt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&uM(e,t,n,2,r);const c=3==(3&i);if(c){const v=e.preOrderCheckHooks;null!==v&&rn(t,v,null)}else{const v=e.preOrderHooks;null!==v&&Fn(t,v,0,null),yn(t,0)}if(function Y6(e){for(let t=_h(e);null!==t;t=Ud(t)){if(!t[2])continue;const n=t[9];for(let r=0;r<n.length;r++){const i=n[r],a=i[3];0==(512&i[2])&&ql(a,1),i[2]|=512}}}(t),function X6(e){for(let t=_h(e);null!==t;t=Ud(t))for(let n=10;n<t.length;n++){const r=t[n],i=r[1];Gl(r)&&yv(i,r,i.template,r[8])}}(t),null!==e.contentQueries&&cM(e,t),c){const v=e.contentCheckHooks;null!==v&&rn(t,v)}else{const v=e.contentHooks;null!==v&&Fn(t,v,1),yn(t,1)}!function k6(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let r=0;r<n.length;r++){const i=n[r];if(i<0)Ne(~i);else{const a=i,c=n[++r],d=n[++r];R(c,a),d(2,t[a])}}}finally{Ne(-1)}}(e,t);const d=e.components;null!==d&&function P6(e,t){for(let n=0;n<t.length;n++)K6(e,t[n])}(t,d);const p=e.viewQuery;if(null!==p&&sw(2,p,r),c){const v=e.viewCheckHooks;null!==v&&rn(t,v)}else{const v=e.viewHooks;null!==v&&Fn(t,v,2),yn(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,ql(t[3],-1))}finally{Se()}}}function uM(e,t,n,r,i){const a=Le(),c=2&r;try{Ne(-1),c&&t.length>22&&U2(e,t,22,!1),n(r,i)}finally{Ne(a)}}function Q1(e,t,n){!qc()||(function U6(e,t,n,r){const i=n.directiveStart,a=n.directiveEnd;e.firstCreatePass||lh(n,t),hi(r,t);const c=n.initialInputs;for(let d=i;d<a;d++){const p=e.data[d],v=Po(p);v&&q6(t,n,p);const E=nl(t,e,d,n);hi(E,t),null!==c&&Z6(0,d-i,E,p,0,c),v&&(Ti(n.index,t)[8]=E)}}(e,t,n,Mi(n,t)),128==(128&n.flags)&&function $6(e,t,n){const r=n.directiveStart,i=n.directiveEnd,a=n.index,c=function z(){return Vt.lFrame.currentDirectiveIndex}();try{Ne(a);for(let d=r;d<i;d++){const p=e.data[d],v=t[d];L(d),(null!==p.hostBindings||0!==p.hostVars||null!==p.hostAttrs)&&_M(p,v)}}finally{Ne(-1),L(c)}}(e,t,n))}function ew(e,t,n=Mi){const r=t.localNames;if(null!==r){let i=t.index+1;for(let a=0;a<r.length;a+=2){const c=r[a+1],d=-1===c?n(t,e):e[c];e[i++]=d}}}function dM(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=tw(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function tw(e,t,n,r,i,a,c,d,p,v){const E=22+r,D=E+i,T=function F6(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:tn);return n}(E,D),P="function"==typeof v?v():v;return T[1]={type:e,blueprint:T,template:n,queries:null,viewQuery:d,declTNode:t,data:T.slice().fill(null,E),bindingStartIndex:E,expandoStartIndex:D,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof a?a():a,pipeRegistry:"function"==typeof c?c():c,firstChild:null,schemas:p,consts:P,incompleteFirstPass:!1}}function fM(e,t,n,r){const i=CM(t);null===n?i.push(r):(i.push(n),e.firstCreatePass&&EM(e).push(r,i.length-1))}function pM(e,t,n){for(let r in e)if(e.hasOwnProperty(r)){const i=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,i):n[r]=[t,i]}return n}function mM(e,t){const r=t.directiveEnd,i=e.data,a=t.attrs,c=[];let d=null,p=null;for(let v=t.directiveStart;v<r;v++){const E=i[v],D=E.inputs,T=null===a||z2(t)?null:W6(D,a);c.push(T),d=pM(D,v,d),p=pM(E.outputs,v,p)}null!==d&&(d.hasOwnProperty("class")&&(t.flags|=16),d.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=c,t.inputs=d,t.outputs=p}function gM(e,t){const n=Ti(t,e);16&n[2]||(n[2]|=32)}function nw(e,t,n,r){let i=!1;if(qc()){const a=function j6(e,t,n){const r=e.directiveRegistry;let i=null;if(r)for(let a=0;a<r.length;a++){const c=r[a];B2(n,c.selectors,!1)&&(i||(i=[]),Ed(lh(n,t),e,c.type),Po(c)?(vM(e,n),i.unshift(c)):i.push(c))}return i}(e,t,n),c=null===r?null:{"":-1};if(null!==a){i=!0,bM(n,e.data.length,a.length);for(let E=0;E<a.length;E++){const D=a[E];D.providersResolver&&D.providersResolver(D)}let d=!1,p=!1,v=Ip(e,t,a.length,null);for(let E=0;E<a.length;E++){const D=a[E];n.mergedAttrs=Wi(n.mergedAttrs,D.hostAttrs),xM(e,n,t,v,D),G6(v,D,c),null!==D.contentQueries&&(n.flags|=8),(null!==D.hostBindings||null!==D.hostAttrs||0!==D.hostVars)&&(n.flags|=128);const T=D.type.prototype;!d&&(T.ngOnChanges||T.ngOnInit||T.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),d=!0),!p&&(T.ngOnChanges||T.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),p=!0),v++}mM(e,n)}c&&function H6(e,t,n){if(t){const r=e.localNames=[];for(let i=0;i<t.length;i+=2){const a=n[t[i+1]];if(null==a)throw new nt(-301,!1);r.push(t[i],a)}}}(n,r,c)}return n.mergedAttrs=Wi(n.mergedAttrs,n.attrs),i}function yM(e,t,n,r,i,a){const c=a.hostBindings;if(c){let d=e.hostBindingOpCodes;null===d&&(d=e.hostBindingOpCodes=[]);const p=~t.index;(function V6(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(d)!=p&&d.push(p),d.push(r,i,c)}}function _M(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function vM(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function G6(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;Po(t)&&(n[""]=e)}}function bM(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function xM(e,t,n,r,i){e.data[r]=i;const a=i.factory||(i.factory=_s(i.type)),c=new ci(a,Po(i),qe);e.blueprint[r]=c,n[r]=c,yM(e,t,0,r,Ip(e,n,i.hostVars,tn),i)}function q6(e,t,n){const r=Mi(t,e),i=dM(n),a=e[10],c=_v(e,gv(e,i,null,n.onPush?32:16,r,t,a,a.createRenderer(r,n),null,null,null));e[t.index]=c}function Z6(e,t,n,r,i,a){const c=a[t];if(null!==c){const d=r.setInput;for(let p=0;p<c.length;){const v=c[p++],E=c[p++],D=c[p++];null!==d?r.setInput(n,D,v,E):n[E]=D}}}function W6(e,t){let n=null,r=0;for(;r<t.length;){const i=t[r];if(0!==i)if(5!==i){if("number"==typeof i)break;e.hasOwnProperty(i)&&(null===n&&(n=[]),n.push(i,e[i],t[r+1])),r+=2}else r+=2;else r+=4}return n}function wM(e,t,n,r){return new Array(e,!0,!1,t,null,0,r,n,null,null)}function K6(e,t){const n=Ti(t,e);if(Gl(n)){const r=n[1];48&n[2]?yv(r,n,r.template,n[8]):n[5]>0&&iw(n)}}function iw(e){for(let r=_h(e);null!==r;r=Ud(r))for(let i=10;i<r.length;i++){const a=r[i];if(Gl(a))if(512&a[2]){const c=a[1];yv(c,a,c.template,a[8])}else a[5]>0&&iw(a)}const n=e[1].components;if(null!==n)for(let r=0;r<n.length;r++){const i=Ti(n[r],e);Gl(i)&&i[5]>0&&iw(i)}}function J6(e,t){const n=Ti(t,e),r=n[1];(function Q6(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(r,n),J1(r,n,n[8])}function _v(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function ow(e){for(;e;){e[2]|=32;const t=Vd(e);if(Uc(e)&&!t)return e;e=t}return null}function vv(e,t,n,r=!0){const i=t[10];i.begin&&i.begin();try{yv(e,t,e.template,n)}catch(c){throw r&&SM(t,c),c}finally{i.end&&i.end()}}function sw(e,t,n){ee(0),t(e,n)}function CM(e){return e[7]||(e[7]=[])}function EM(e){return e.cleanup||(e.cleanup=[])}function SM(e,t){const n=e[9],r=n?n.get(Dp,null):null;r&&r.handleError(t)}function aw(e,t,n,r,i){for(let a=0;a<n.length;){const c=n[a++],d=n[a++],p=t[c],v=e.data[c];null!==v.setInput?v.setInput(p,i,r,d):p[d]=i}}function ru(e,t,n){const r=function jl(e,t){return Sr(t[e])}(t,e);!function iv(e,t,n){e.setValue(t,n)}(e[11],r,n)}function bv(e,t,n){let r=n?e.styles:null,i=n?e.classes:null,a=0;if(null!==t)for(let c=0;c<t.length;c++){const d=t[c];"number"==typeof d?a=d:1==a?i=Lu(i,d):2==a&&(r=Lu(r,d+": "+t[++c]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=i:e.classesWithoutHost=i}function xv(e,t,n,r,i=!1){for(;null!==n;){const a=t[n.index];if(null!==a&&r.push(Sr(a)),po(a))for(let d=10;d<a.length;d++){const p=a[d],v=p[1].firstChild;null!==v&&xv(p[1],p,v,r)}const c=n.type;if(8&c)xv(e,t,n.child,r);else if(32&c){const d=bg(n,t);let p;for(;p=d();)r.push(p)}else if(16&c){const d=Ig(t,n);if(Array.isArray(d))r.push(...d);else{const p=Vd(t[16]);xv(p[1],p,d,r,!0)}}n=i?n.projectionNext:n.next}return r}class Ug{constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,n=t[1];return xv(n,t,n.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(po(t)){const n=t[8],r=n?n.indexOf(this):-1;r>-1&&($d(t,r),ep(n,r))}this._attachedToViewContainer=!1}br(this._lView[1],this._lView)}onDestroy(t){fM(this._lView[1],this._lView,null,t)}markForCheck(){ow(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){vv(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new nt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function C1(e,t){sl(e,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new nt(902,!1);this._appRef=t}}class eB extends Ug{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;vv(t[1],t,t[8],!1)}checkNoChanges(){}get context(){return null}}class lw extends Bg{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=Lt(t);return new $g(n,this.ngModule)}}function MM(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}class nB{constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,r){const i=this.injector.get(t,R1,r);return i!==R1||n===R1?i:this.parentInjector.get(t,n,r)}}class $g extends P2{constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function t6(e){return e.map(e6).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return MM(this.componentDef.inputs)}get outputs(){return MM(this.componentDef.outputs)}create(t,n,r,i){let a=(i=i||this.ngModule)instanceof Ms?i:i?.injector;a&&null!==this.componentDef.getStandaloneInjector&&(a=this.componentDef.getStandaloneInjector(a)||a);const c=a?new nB(t,a):t,d=c.get(F2,null);if(null===d)throw new nt(407,!1);const p=c.get(Fz,null),v=d.createRenderer(null,this.componentDef),E=this.componentDef.selectors[0][0]||"div",D=r?function O6(e,t,n){return e.selectRootElement(t,n===ms.ShadowDom)}(v,r,this.componentDef.encapsulation):pp(v,E,function tB(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(E)),T=this.componentDef.onPush?288:272,P=tw(0,null,null,1,0,null,null,null,null,null),N=gv(null,P,null,T,null,null,d,v,p,c,null);let G,U;_e(N);try{const Z=function oB(e,t,n,r,i,a){const c=n[1];n[22]=e;const p=Tp(c,22,2,"#host",null),v=p.mergedAttrs=t.hostAttrs;null!==v&&(bv(p,v,!0),null!==e&&(Jr(i,e,v),null!==p.classes&&xh(i,e,p.classes),null!==p.styles&&bp(i,e,p.styles)));const E=r.createRenderer(e,t),D=gv(n,dM(t),null,t.onPush?32:16,n[22],p,r,E,a||null,null,null);return c.firstCreatePass&&(Ed(lh(p,n),c,t.type),vM(c,p),bM(p,n.length,1)),_v(n,D),n[22]=D}(D,this.componentDef,N,d,v);if(D)if(r)Jr(v,D,["ng-version",Oz.full]);else{const{attrs:ne,classes:X}=function n6(e){const t=[],n=[];let r=1,i=2;for(;r<e.length;){let a=e[r];if("string"==typeof a)2===i?""!==a&&t.push(a,e[++r]):8===i&&n.push(a);else{if(!ul(i))break;i=a}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);ne&&Jr(v,D,ne),X&&X.length>0&&xh(v,D,X.join(" "))}if(U=Hl(P,22),void 0!==n){const ne=U.projection=[];for(let X=0;X<this.ngContentSelectors.length;X++){const re=n[X];ne.push(null!=re?Array.from(re):null)}}G=function sB(e,t,n,r){const i=n[1],a=function B6(e,t,n){const r=Rr();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),xM(e,r,t,Ip(e,t,1,null),n),mM(e,r));const i=nl(t,e,r.directiveStart,r);hi(i,t);const a=Mi(r,t);return a&&hi(a,t),i}(i,n,t);if(e[8]=n[8]=a,null!==r)for(const d of r)d(a,t);if(t.contentQueries){const d=Rr();t.contentQueries(1,a,d.directiveStart)}const c=Rr();return!i.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(Ne(c.index),yM(n[1],c,0,c.directiveStart,c.directiveEnd,t),_M(t,a)),a}(Z,this.componentDef,N,[aB]),J1(P,N,null)}finally{Se()}return new iB(this.componentType,G,Ep(U,N),N,U)}}class iB extends class Tz{}{constructor(t,n,r,i,a){super(),this.location=r,this._rootLView=i,this._tNode=a,this.instance=n,this.hostView=this.changeDetectorRef=new eB(i),this.componentType=t}setInput(t,n){const r=this._tNode.inputs;let i;if(null!==r&&(i=r[t])){const a=this._rootLView;aw(a[1],a,i,t,n),gM(a,this._tNode.index)}}get injector(){return new ya(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function aB(){const e=Rr();Ht(He()[1],e)}let wv=null;function Xd(){if(!wv){const e=nr.Symbol;if(e&&e.iterator)wv=e.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<t.length;++n){const r=t[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(wv=r)}}}return wv}function jg(e){return!!uw(e)&&(Array.isArray(e)||!(e instanceof Map)&&Xd()in e)}function uw(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function lc(e,t,n){return e[t]=n}function Vo(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function Yd(e,t,n,r){const i=Vo(e,t,n);return Vo(e,t+1,r)||i}function Pp(e,t,n,r,i,a){const d=Yd(e,function m(){return Vt.lFrame.bindingIndex}(),n,i);return function S(e){const t=Vt.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}(2),d?t+$t(n)+r+$t(i)+a:tn}function Dh(e,t,n,r,i,a,c,d){const p=He(),v=en(),E=e+22,D=v.firstCreatePass?function vB(e,t,n,r,i,a,c,d,p){const v=t.consts,E=Tp(t,e,4,c||null,vs(v,d));nw(t,n,E,vs(v,p)),Ht(t,E);const D=E.tViews=tw(2,E,r,i,a,t.directiveRegistry,t.pipeRegistry,null,t.schemas,v);return null!==t.queries&&(t.queries.template(t,E),D.queries=t.queries.embeddedTView(E)),E}(E,v,p,t,n,r,i,a,c):v.data[E];bs(D,!1);const T=p[11].createComment("");jd(v,p,T,D),hi(T,p),_v(p,p[E]=wM(T,p,T,D)),Vl(D)&&Q1(v,p,D),null!=c&&ew(p,D,d)}function Co(e,t,n){const r=He();return Vo(r,w(),t)&&function Ws(e,t,n,r,i,a,c,d){const p=Mi(t,n);let E,v=t.inputs;!d&&null!=v&&(E=v[r])?(aw(e,n,E,r,i),Zu(t)&&gM(n,t.index)):3&t.type&&(r=function N6(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),i=null!=c?c(i,t.value||"",r):i,a.setProperty(p,r,i))}(en(),function ze(){const e=Vt.lFrame;return Hl(e.tView,e.selectedIndex)}(),r,e,t,r[11],n,!1),Co}function hw(e,t,n,r,i){const c=i?"class":"style";aw(e,n,t.inputs[c],c,r)}function jn(e,t,n,r){const i=He(),a=en(),c=22+e,d=i[11],p=i[c]=pp(d,t,function In(){return Vt.lFrame.currentNamespace}()),v=a.firstCreatePass?function wB(e,t,n,r,i,a,c){const d=t.consts,v=Tp(t,e,2,i,vs(d,a));return nw(t,n,v,vs(d,c)),null!==v.attrs&&bv(v,v.attrs,!1),null!==v.mergedAttrs&&bv(v,v.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,v),v}(c,a,i,0,t,n,r):a.data[c];bs(v,!0);const E=v.mergedAttrs;null!==E&&Jr(d,p,E);const D=v.classes;null!==D&&xh(d,p,D);const T=v.styles;return null!==T&&bp(d,p,T),64!=(64&v.flags)&&jd(a,i,p,v),0===function _d(){return Vt.lFrame.elementDepthCount}()&&hi(p,i),function Gf(){Vt.lFrame.elementDepthCount++}(),Vl(v)&&(Q1(a,i,v),function hM(e,t,n){if(ld(t)){const i=t.directiveEnd;for(let a=t.directiveStart;a<i;a++){const c=e.data[a];c.contentQueries&&c.contentQueries(1,n[a],a)}}}(a,v,i)),null!==r&&ew(i,v),jn}function Wn(){let e=Rr();xd()?function oh(){Vt.lFrame.isParent=!1}():(e=e.parent,bs(e,!1));const t=e;!function vd(){Vt.lFrame.elementDepthCount--}();const n=en();return n.firstCreatePass&&(Ht(n,e),ld(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function Fr(e){return 0!=(16&e.flags)}(t)&&hw(n,t,He(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function dr(e){return 0!=(32&e.flags)}(t)&&hw(n,t,He(),t.stylesWithoutHost,!1),Wn}function xa(e,t,n,r){return jn(e,t,n,r),Wn(),xa}function Gg(e){return!!e&&"function"==typeof e.then}const pw=function VM(e){return!!e&&"function"==typeof e.subscribe};function Ri(e,t,n,r){const i=He(),a=en(),c=Rr();return function $M(e,t,n,r,i,a,c,d){const p=Vl(r),E=e.firstCreatePass&&EM(e),D=t[8],T=CM(t);let P=!0;if(3&r.type||d){const U=Mi(r,t),Z=d?d(U):U,ne=T.length,X=d?fe=>d(Sr(fe[r.index])):r.index;let re=null;if(!d&&p&&(re=function EB(e,t,n,r){const i=e.cleanup;if(null!=i)for(let a=0;a<i.length-1;a+=2){const c=i[a];if(c===n&&i[a+1]===r){const d=t[7],p=i[a+2];return d.length>p?d[p]:null}"string"==typeof c&&(a+=2)}return null}(e,t,i,r.index)),null!==re)(re.__ngLastListenerFn__||re).__ngNextListenerFn__=a,re.__ngLastListenerFn__=a,P=!1;else{a=HM(r,t,D,a,!1);const fe=n.listen(Z,i,a);T.push(a,fe),E&&E.push(i,X,ne,ne+1)}}else a=HM(r,t,D,a,!1);const N=r.outputs;let G;if(P&&null!==N&&(G=N[i])){const U=G.length;if(U)for(let Z=0;Z<U;Z+=2){const ve=t[G[Z]][G[Z+1]].subscribe(a),Re=T.length;T.push(a,ve),E&&E.push(i,r.index,Re,-(Re+1))}}}(a,i,i[11],c,e,t,0,r),Ri}function jM(e,t,n,r){try{return!1!==n(r)}catch(i){return SM(e,i),!1}}function HM(e,t,n,r,i){return function a(c){if(c===Function)return r;ow(2&e.flags?Ti(e.index,t):t);let p=jM(t,0,r,c),v=a.__ngNextListenerFn__;for(;v;)p=jM(t,0,v,c)&&p,v=v.__ngNextListenerFn__;return i&&!1===p&&(c.preventDefault(),c.returnValue=!1),p}}function qg(e=1){return function ke(e){return(Vt.lFrame.contextLView=function Be(e,t){for(;e>0;)t=t[15],e--;return t}(e,Vt.lFrame.contextLView))[8]}(e)}function zr(e,t=""){const n=He(),r=en(),i=e+22,a=r.firstCreatePass?Tp(r,i,1,t,null):r.data[i],c=n[i]=function tc(e,t){return e.createText(t)}(n[11],t);jd(r,n,c,a),bs(a,!1)}function Sh(e){return Kd("",e,""),Sh}function Kd(e,t,n){const r=He(),i=function kp(e,t,n,r){return Vo(e,w(),n)?t+$t(n)+r:tn}(r,e,t,n);return i!==tn&&ru(r,Le(),i),Kd}function yw(e,t,n,r,i){const a=He(),c=Pp(a,e,t,n,r,i);return c!==tn&&ru(a,Le(),c),yw}const Jd=void 0;var h8=["en",[["a","p"],["AM","PM"],Jd],[["AM","PM"],Jd,Jd],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Jd,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Jd,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Jd,"{1} 'at' {0}",Jd],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function u8(e){const n=Math.floor(Math.abs(e)),r=e.toString().replace(/^[^.]*\.?/,"").length;return 1===n&&0===r?1:5}];let Vp={};function is(e){const t=function d8(e){return e.toLowerCase().replace(/_/g,"-")}(e);let n=RT(t);if(n)return n;const r=t.split("-")[0];if(n=RT(r),n)return n;if("en"===r)return h8;throw new nt(701,!1)}function RT(e){return e in Vp||(Vp[e]=nr.ng&&nr.ng.common&&nr.ng.common.locales&&nr.ng.common.locales[e]),Vp[e]}var vt=(()=>((vt=vt||{})[vt.LocaleId=0]="LocaleId",vt[vt.DayPeriodsFormat=1]="DayPeriodsFormat",vt[vt.DayPeriodsStandalone=2]="DayPeriodsStandalone",vt[vt.DaysFormat=3]="DaysFormat",vt[vt.DaysStandalone=4]="DaysStandalone",vt[vt.MonthsFormat=5]="MonthsFormat",vt[vt.MonthsStandalone=6]="MonthsStandalone",vt[vt.Eras=7]="Eras",vt[vt.FirstDayOfWeek=8]="FirstDayOfWeek",vt[vt.WeekendRange=9]="WeekendRange",vt[vt.DateFormat=10]="DateFormat",vt[vt.TimeFormat=11]="TimeFormat",vt[vt.DateTimeFormat=12]="DateTimeFormat",vt[vt.NumberSymbols=13]="NumberSymbols",vt[vt.NumberFormats=14]="NumberFormats",vt[vt.CurrencyCode=15]="CurrencyCode",vt[vt.CurrencySymbol=16]="CurrencySymbol",vt[vt.CurrencyName=17]="CurrencyName",vt[vt.Currencies=18]="Currencies",vt[vt.Directionality=19]="Directionality",vt[vt.PluralCase=20]="PluralCase",vt[vt.ExtraData=21]="ExtraData",vt))();const Up="en-US";let FT=Up;class Qd{}class sI{}class aI extends Qd{constructor(t,n){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new lw(this);const r=cn(t);this._bootstrapComponents=tu(r.bootstrap),this._r3Injector=q2(t,n,[{provide:Qd,useValue:this},{provide:Bg,useValue:this.componentFactoryResolver}],Mn(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class Ew extends sI{constructor(t){super(),this.moduleType=t}create(t){return new aI(this.moduleType,t)}}class hV extends Qd{constructor(t,n,r){super(),this.componentFactoryResolver=new lw(this),this.instance=null;const i=new zg([...t,{provide:Qd,useValue:this},{provide:Bg,useValue:this.componentFactoryResolver}],n||oc(),r,new Set(["environment"]));this.injector=i,i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function Av(e,t,n=null){return new hV(e,t,n).injector}let dV=(()=>{class e{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n.id)){const r=Og(0,n.type),i=r.length>0?Av([r],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n.id,i)}return this.cachedInjectors.get(n.id)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}}return e.\u0275prov=zt({token:e,providedIn:"environment",factory:()=>new e(St(Ms))}),e})();function lI(e){e.getStandaloneInjector=t=>t.get(dV).getOrCreateStandaloneInjector(e)}function ef(e,t,n,r){return function mI(e,t,n,r,i,a){const c=t+n;return Vo(e,c,i)?lc(e,c+1,a?r.call(a,i):r(i)):Qg(e,c+1)}(He(),h(),e,t,n,r)}function Qg(e,t){const n=e[t];return n===tn?void 0:n}function kv(e,t){const n=en();let r;const i=e+22;n.firstCreatePass?(r=function AV(e,t){if(t)for(let n=t.length-1;n>=0;n--){const r=t[n];if(e===r.name)return r}}(t,n.pipeRegistry),n.data[i]=r,r.onDestroy&&(n.destroyHooks||(n.destroyHooks=[])).push(i,r.onDestroy)):r=n.data[i];const a=r.factory||(r.factory=_s(r.type)),c=uo(qe);try{const d=Mr(!1),p=a();return Mr(d),function bB(e,t,n,r){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=r}(n,He(),i,p),p}finally{uo(c)}}function Pv(e,t,n,r){const i=e+22,a=He(),c=function fa(e,t){return e[t]}(a,i);return function ey(e,t){return e[1].data[t].pure}(a,i)?function gI(e,t,n,r,i,a,c){const d=t+n;return Yd(e,d,i,a)?lc(e,d+2,c?r.call(c,i,a):r(i,a)):Qg(e,d+2)}(a,h(),t,c.transform,n,r,c):c.transform(n,r)}function Sw(e){return t=>{setTimeout(e,void 0,t)}}const ti=class OV extends pi{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,r){let i=t,a=n||(()=>null),c=r;if(t&&"object"==typeof t){const p=t;i=p.next?.bind(p),a=p.error?.bind(p),c=p.complete?.bind(p)}this.__isAsync&&(a=Sw(a),i&&(i=Sw(i)),c&&(c=Sw(c)));const d=super.subscribe({next:i,error:a,complete:c});return t instanceof wr&&t.add(d),d}};function LV(){return this._results[Xd()]()}class Mw{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=Xd(),r=Mw.prototype;r[n]||(r[n]=LV)}get changes(){return this._changes||(this._changes=new ti)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){const r=this;r.dirty=!1;const i=_o(t);(this._changesDetected=!function Qm(e,t,n){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){let i=e[r],a=t[r];if(n&&(i=n(i),a=n(a)),a!==i)return!1}return!0}(r._results,i,n))&&(r._results=i,r.length=i.length,r.last=i[this.length-1],r.first=i[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let iu=(()=>{class e{}return e.__NG_ELEMENT_ID__=BV,e})();const NV=iu,zV=class extends NV{constructor(t,n,r){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=r}createEmbeddedView(t,n){const r=this._declarationTContainer.tViews,i=gv(this._declarationLView,r,t,16,null,r.declTNode,null,null,null,null,n||null);i[17]=this._declarationLView[this._declarationTContainer.index];const c=this._declarationLView[19];return null!==c&&(i[19]=c.createEmbeddedView(r)),J1(r,i,t),new Ug(i)}};function BV(){return Rv(Rr(),He())}function Rv(e,t){return 4&e.type?new zV(t,e,Ep(e,t)):null}let pl=(()=>{class e{}return e.__NG_ELEMENT_ID__=VV,e})();function VV(){return wI(Rr(),He())}const UV=pl,bI=class extends UV{constructor(t,n,r){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=r}get element(){return Ep(this._hostTNode,this._hostLView)}get injector(){return new ya(this._hostTNode,this._hostLView)}get parentInjector(){const t=ch(this._hostTNode,this._hostLView);if(ma(t)){const n=xs(t,this._hostLView),r=Hs(t);return new ya(n[1].data[r+8],n)}return new ya(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=xI(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,n,r){let i,a;"number"==typeof r?i=r:null!=r&&(i=r.index,a=r.injector);const c=t.createEmbeddedView(n||{},a);return this.insert(c,i),c}createComponent(t,n,r,i,a){const c=t&&!function Td(e){return"function"==typeof e}(t);let d;if(c)d=n;else{const D=n||{};d=D.index,r=D.injector,i=D.projectableNodes,a=D.environmentInjector||D.ngModuleRef}const p=c?t:new $g(Lt(t)),v=r||this.parentInjector;if(!a&&null==p.ngModule){const T=(c?v:this.parentInjector).get(Ms,null);T&&(a=T)}const E=p.create(v,i,void 0,a);return this.insert(E.hostView,d),E}insert(t,n){const r=t._lView,i=r[1];if(function th(e){return po(e[3])}(r)){const E=this.indexOf(t);if(-1!==E)this.detach(E);else{const D=r[3],T=new bI(D,D[6],D[3]);T.detach(T.indexOf(t))}}const a=this._adjustIndex(n),c=this._lContainer;!function D1(e,t,n,r){const i=10+r,a=n.length;r>0&&(n[i-1][4]=t),r<a-10?(t[4]=n[i],N_(n,10+r,t)):(n.push(t),t[4]=null),t[3]=n;const c=t[17];null!==c&&n!==c&&function S1(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(c,t);const d=t[19];null!==d&&d.insertView(e),t[2]|=64}(i,r,c,a);const d=Ag(a,c),p=r[11],v=vh(p,c[7]);return null!==v&&function Cg(e,t,n,r,i,a){r[0]=i,r[6]=t,sl(e,r,n,1,i,a)}(i,c[6],p,r,v,d),t.attachToViewContainerRef(),N_(Tw(c),a,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=xI(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),r=$d(this._lContainer,n);r&&(ep(Tw(this._lContainer),n),br(r[1],r))}detach(t){const n=this._adjustIndex(t,-1),r=$d(this._lContainer,n);return r&&null!=ep(Tw(this._lContainer),n)?new Ug(r):null}_adjustIndex(t,n=0){return t??this.length+n}};function xI(e){return e[8]}function Tw(e){return e[8]||(e[8]=[])}function wI(e,t){let n;const r=t[e.index];if(po(r))n=r;else{let i;if(8&e.type)i=Sr(r);else{const a=t[11];i=a.createComment("");const c=Mi(e,t);rc(a,vh(a,c),i,function lv(e,t){return e.nextSibling(t)}(a,c),!1)}t[e.index]=n=wM(r,t,i,e),_v(t,n)}return new bI(n,e,t)}class Iw{constructor(t){this.queryList=t,this.matches=null}clone(){return new Iw(this.queryList)}setDirty(){this.queryList.setDirty()}}class Aw{constructor(t=[]){this.queries=t}createEmbeddedView(t){const n=t.queries;if(null!==n){const r=null!==t.contentQueries?t.contentQueries[0]:n.length,i=[];for(let a=0;a<r;a++){const c=n.getByIndex(a);i.push(this.queries[c.indexInDeclarationView].clone())}return new Aw(i)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)null!==MI(t,n).matches&&this.queries[n].setDirty()}}class CI{constructor(t,n,r=null){this.predicate=t,this.flags=n,this.read=r}}class kw{constructor(t=[]){this.queries=t}elementStart(t,n){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let r=0;r<this.length;r++){const i=null!==n?n.length:0,a=this.getByIndex(r).embeddedTView(t,i);a&&(a.indexInDeclarationView=r,null!==n?n.push(a):n=[a])}return null!==n?new kw(n):null}template(t,n){for(let r=0;r<this.queries.length;r++)this.queries[r].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class Pw{constructor(t,n=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new Pw(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let r=t.parent;for(;null!==r&&8&r.type&&r.index!==n;)r=r.parent;return n===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(t,n){const r=this.metadata.predicate;if(Array.isArray(r))for(let i=0;i<r.length;i++){const a=r[i];this.matchTNodeWithReadOption(t,n,HV(n,a)),this.matchTNodeWithReadOption(t,n,Xf(n,t,a,!1,!1))}else r===iu?4&n.type&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,Xf(n,t,r,!1,!1))}matchTNodeWithReadOption(t,n,r){if(null!==r){const i=this.metadata.read;if(null!==i)if(i===qs||i===pl||i===iu&&4&n.type)this.addMatch(n.index,-2);else{const a=Xf(n,t,i,!1,!1);null!==a&&this.addMatch(n.index,a)}else this.addMatch(n.index,r)}}addMatch(t,n){null===this.matches?this.matches=[t,n]:this.matches.push(t,n)}}function HV(e,t){const n=e.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function qV(e,t,n,r){return-1===n?function GV(e,t){return 11&e.type?Ep(e,t):4&e.type?Rv(e,t):null}(t,e):-2===n?function ZV(e,t,n){return n===qs?Ep(t,e):n===iu?Rv(t,e):n===pl?wI(t,e):void 0}(e,t,r):nl(e,e[1],n,t)}function EI(e,t,n,r){const i=t[19].queries[r];if(null===i.matches){const a=e.data,c=n.matches,d=[];for(let p=0;p<c.length;p+=2){const v=c[p];d.push(v<0?null:qV(t,a[v],c[p+1],n.metadata.read))}i.matches=d}return i.matches}function Rw(e,t,n,r){const i=e.queries.getByIndex(n),a=i.matches;if(null!==a){const c=EI(e,t,i,n);for(let d=0;d<a.length;d+=2){const p=a[d];if(p>0)r.push(c[d/2]);else{const v=a[d+1],E=t[-p];for(let D=10;D<E.length;D++){const T=E[D];T[17]===T[3]&&Rw(T[1],T,v,r)}if(null!==E[9]){const D=E[9];for(let T=0;T<D.length;T++){const P=D[T];Rw(P[1],P,v,r)}}}}}return r}function $p(e){const t=He(),n=en(),r=Q();ee(r+1);const i=MI(n,r);if(e.dirty&&function gd(e){return 4==(4&e[2])}(t)===(2==(2&i.metadata.flags))){if(null===i.matches)e.reset([]);else{const a=i.crossesNgTemplate?Rw(n,t,r,[]):EI(n,t,i,r);e.reset(a,Pz),e.notifyOnChanges()}return!0}return!1}function Fv(e,t,n){const r=en();r.firstCreatePass&&(function SI(e,t,n){null===e.queries&&(e.queries=new kw),e.queries.track(new Pw(t,n))}(r,new CI(e,t,n),-1),2==(2&t)&&(r.staticViewQueries=!0)),function DI(e,t,n){const r=new Mw(4==(4&n));fM(e,t,r,r.destroy),null===t[19]&&(t[19]=new Aw),t[19].queries.push(new Iw(r))}(r,He(),t)}function jp(){return function WV(e,t){return e[19].queries[t].queryList}(He(),Q())}function MI(e,t){return e.queries.getByIndex(t)}function Lv(...e){}const Nv=new Tt("Application Initializer");let zv=(()=>{class e{constructor(n){this.appInits=n,this.resolve=Lv,this.reject=Lv,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,i)=>{this.resolve=r,this.reject=i})}runInitializers(){if(this.initialized)return;const n=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let i=0;i<this.appInits.length;i++){const a=this.appInits[i]();if(Gg(a))n.push(a);else if(pw(a)){const c=new Promise((d,p)=>{a.subscribe({complete:d,error:p})});n.push(c)}}Promise.all(n).then(()=>{r()}).catch(i=>{this.reject(i)}),0===n.length&&r(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)(St(Nv,8))},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const ny=new Tt("AppId",{providedIn:"root",factory:function qI(){return`${Bw()}${Bw()}${Bw()}`}});function Bw(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const ZI=new Tt("Platform Initializer"),Vw=new Tt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),WI=new Tt("appBootstrapListener");let gU=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const ou=new Tt("LocaleId",{providedIn:"root",factory:()=>Or(ou,Rt.Optional|Rt.SkipSelf)||function yU(){return typeof $localize<"u"&&$localize.locale||Up}()});class vU{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let Uw=(()=>{class e{compileModuleSync(n){return new Ew(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const r=this.compileModuleSync(n),a=tu(cn(n).declarations).reduce((c,d)=>{const p=Lt(d);return p&&c.push(new $g(p)),c},[]);return new vU(r,a)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const wU=(()=>Promise.resolve(0))();function $w(e){typeof Zone>"u"?wU.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class Oi{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ti(!1),this.onMicrotaskEmpty=new ti(!1),this.onStable=new ti(!1),this.onError=new ti(!1),typeof Zone>"u")throw new nt(908,!1);Zone.assertZonePatched();const i=this;if(i._nesting=0,i._outer=i._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const a=Zone.AsyncStackTaggingZoneSpec;i._inner=i._inner.fork(new a("Angular"))}Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&n,i.shouldCoalesceRunChangeDetection=r,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function CU(){let e=nr.requestAnimationFrame,t=nr.cancelAnimationFrame;if(typeof Zone<"u"&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function SU(e){const t=()=>{!function DU(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(nr,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Hw(e),e.isCheckStableRunning=!0,jw(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Hw(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,i,a,c,d)=>{try{return KI(e),n.invokeTask(i,a,c,d)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===a.type||e.shouldCoalesceRunChangeDetection)&&t(),JI(e)}},onInvoke:(n,r,i,a,c,d,p)=>{try{return KI(e),n.invoke(i,a,c,d,p)}finally{e.shouldCoalesceRunChangeDetection&&t(),JI(e)}},onHasTask:(n,r,i,a)=>{n.hasTask(i,a),r===i&&("microTask"==a.change?(e._hasPendingMicrotasks=a.microTask,Hw(e),jw(e)):"macroTask"==a.change&&(e.hasPendingMacrotasks=a.macroTask))},onHandleError:(n,r,i,a)=>(n.handleError(i,a),e.runOutsideAngular(()=>e.onError.emit(a)),!1)})}(i)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Oi.isInAngularZone())throw new nt(909,!1)}static assertNotInAngularZone(){if(Oi.isInAngularZone())throw new nt(909,!1)}run(t,n,r){return this._inner.run(t,n,r)}runTask(t,n,r,i){const a=this._inner,c=a.scheduleEventTask("NgZoneEvent: "+i,t,EU,Lv,Lv);try{return a.runTask(c,n,r)}finally{a.cancelTask(c)}}runGuarded(t,n,r){return this._inner.runGuarded(t,n,r)}runOutsideAngular(t){return this._outer.run(t)}}const EU={};function jw(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Hw(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function KI(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function JI(e){e._nesting--,jw(e)}class MU{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ti,this.onMicrotaskEmpty=new ti,this.onStable=new ti,this.onError=new ti}run(t,n,r){return t.apply(n,r)}runGuarded(t,n,r){return t.apply(n,r)}runOutsideAngular(t){return t()}runTask(t,n,r,i){return t.apply(n,r)}}const QI=new Tt(""),Bv=new Tt("");let Zw,Gw=(()=>{class e{constructor(n,r,i){this._ngZone=n,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Zw||(function TU(e){Zw=e}(i),i.addToWindow(r)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Oi.assertNotInAngularZone(),$w(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())$w(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(n)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,r,i){let a=-1;r&&r>0&&(a=setTimeout(()=>{this._callbacks=this._callbacks.filter(c=>c.timeoutId!==a),n(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:n,timeoutId:a,updateCb:i})}whenStable(n,r,i){if(i&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,r,i),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,r,i){return[]}}return e.\u0275fac=function(n){return new(n||e)(St(Oi),St(qw),St(Bv))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})(),qw=(()=>{class e{constructor(){this._applications=new Map}registerApplication(n,r){this._applications.set(n,r)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,r=!0){return Zw?.findTestabilityInTree(this,n,r)??null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})(),Mh=null;const eA=new Tt("AllowMultipleToken"),Ww=new Tt("PlatformDestroyListeners");class tA{constructor(t,n){this.name=t,this.token=n}}function rA(e,t,n=[]){const r=`Platform: ${t}`,i=new Tt(r);return(a=[])=>{let c=Xw();if(!c||c.injector.get(eA,!1)){const d=[...n,...a,{provide:i,useValue:!0}];e?e(d):function kU(e){if(Mh&&!Mh.get(eA,!1))throw new nt(400,!1);Mh=e;const t=e.get(oA);(function nA(e){const t=e.get(ZI,null);t&&t.forEach(n=>n())})(e)}(function iA(e=[],t){return Zs.create({name:t,providers:[{provide:wh,useValue:"platform"},{provide:Ww,useValue:new Set([()=>Mh=null])},...e]})}(d,r))}return function RU(e){const t=Xw();if(!t)throw new nt(401,!1);return t}()}}function Xw(){return Mh?.get(oA)??null}let oA=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,r){const i=function aA(e,t){let n;return n="noop"===e?new MU:("zone.js"===e?void 0:e)||new Oi(t),n}(r?.ngZone,function sA(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!e||!e.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!e||!e.ngZoneRunCoalescing)||!1}}(r)),a=[{provide:Oi,useValue:i}];return i.run(()=>{const c=Zs.create({providers:a,parent:this.injector,name:n.moduleType.name}),d=n.create(c),p=d.injector.get(Dp,null);if(!p)throw new nt(402,!1);return i.runOutsideAngular(()=>{const v=i.onError.subscribe({next:E=>{p.handleError(E)}});d.onDestroy(()=>{Uv(this._modules,d),v.unsubscribe()})}),function lA(e,t,n){try{const r=n();return Gg(r)?r.catch(i=>{throw t.runOutsideAngular(()=>e.handleError(i)),i}):r}catch(r){throw t.runOutsideAngular(()=>e.handleError(r)),r}}(p,i,()=>{const v=d.injector.get(zv);return v.runInitializers(),v.donePromise.then(()=>(function OT(e){ji(e,"Expected localeId to be defined"),"string"==typeof e&&(FT=e.toLowerCase().replace(/_/g,"-"))}(d.injector.get(ou,Up)||Up),this._moduleDoBootstrap(d),d))})})}bootstrapModule(n,r=[]){const i=cA({},r);return function IU(e,t,n){const r=new Ew(n);return Promise.resolve(r)}(0,0,n).then(a=>this.bootstrapModuleFactory(a,i))}_moduleDoBootstrap(n){const r=n.injector.get(Vv);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(i=>r.bootstrap(i));else{if(!n.instance.ngDoBootstrap)throw new nt(403,!1);n.instance.ngDoBootstrap(r)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new nt(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const n=this._injector.get(Ww,null);n&&(n.forEach(r=>r()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(St(Zs))},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function cA(e,t){return Array.isArray(t)?t.reduce(cA,e):{...e,...t}}let Vv=(()=>{class e{constructor(n,r,i){this._zone=n,this._injector=r,this._exceptionHandler=i,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const a=new Bn(d=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{d.next(this._stable),d.complete()})}),c=new Bn(d=>{let p;this._zone.runOutsideAngular(()=>{p=this._zone.onStable.subscribe(()=>{Oi.assertNotInAngularZone(),$w(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,d.next(!0))})})});const v=this._zone.onUnstable.subscribe(()=>{Oi.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{d.next(!1)}))});return()=>{p.unsubscribe(),v.unsubscribe()}});this.isStable=function Ol(...e){const t=lr(e),n=function ai(e,t){return"number"==typeof an(e)?e.pop():t}(e,1/0),r=e;return r.length?1===r.length?te(r[0]):dt(n)(Cr(r,t)):xt}(a,c.pipe(function Zh(e={}){const{connector:t=(()=>new pi),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=e;return a=>{let c,d,p,v=0,E=!1,D=!1;const T=()=>{d?.unsubscribe(),d=void 0},P=()=>{T(),c=p=void 0,E=D=!1},N=()=>{const G=c;P(),G?.unsubscribe()};return yr((G,U)=>{v++,!D&&!E&&T();const Z=p=p??t();U.add(()=>{v--,0===v&&!D&&!E&&(d=Ll(N,i))}),Z.subscribe(U),!c&&v>0&&(c=new oo({next:ne=>Z.next(ne),error:ne=>{D=!0,T(),d=Ll(P,n,ne),Z.error(ne)},complete:()=>{E=!0,T(),d=Ll(P,r),Z.complete()}}),te(G).subscribe(c))})(a)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,r){const i=n instanceof P2;if(!this._injector.get(zv).done)throw!i&&function Bs(e){const t=Lt(e)||Kr(e)||kt(e);return null!==t&&t.standalone}(n),new nt(405,false);let c;c=i?n:this._injector.get(Bg).resolveComponentFactory(n),this.componentTypes.push(c.componentType);const d=function AU(e){return e.isBoundToModule}(c)?void 0:this._injector.get(Qd),v=c.create(Zs.NULL,[],r||c.selector,d),E=v.location.nativeElement,D=v.injector.get(QI,null);return D?.registerApplication(E),v.onDestroy(()=>{this.detachView(v.hostView),Uv(this.components,v),D?.unregisterApplication(E)}),this._loadComponent(v),v}tick(){if(this._runningTick)throw new nt(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const r=n;this._views.push(r),r.attachToAppRef(this)}detachView(n){const r=n;Uv(this._views,r),r.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(WI,[]).concat(this._bootstrapListeners).forEach(i=>i(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>Uv(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new nt(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return e.\u0275fac=function(n){return new(n||e)(St(Oi),St(Ms),St(Dp))},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Uv(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}let hA=!0,$v=(()=>{class e{}return e.__NG_ELEMENT_ID__=LU,e})();function LU(e){return function NU(e,t,n){if(Zu(e)&&!n){const r=Ti(e.index,t);return new Ug(r,r)}return 47&e.type?new Ug(t[16],t):null}(Rr(),He(),16==(16&e))}class gA{constructor(){}supports(t){return jg(t)}create(t){return new jU(t)}}const $U=(e,t)=>t;class jU{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||$U}forEachItem(t){let n;for(n=this._itHead;null!==n;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,r=this._removalsHead,i=0,a=null;for(;n||r;){const c=!r||n&&n.currentIndex<_A(r,i,a)?n:r,d=_A(c,i,a),p=c.currentIndex;if(c===r)i--,r=r._nextRemoved;else if(n=n._next,null==c.previousIndex)i++;else{a||(a=[]);const v=d-i,E=p-i;if(v!=E){for(let T=0;T<v;T++){const P=T<a.length?a[T]:a[T]=0,N=P+T;E<=N&&N<v&&(a[T]=P+1)}a[c.previousIndex]=E-v}}d!==p&&t(c,d,p)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)t(n)}diff(t){if(null==t&&(t=[]),!jg(t))throw new nt(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let i,a,c,n=this._itHead,r=!1;if(Array.isArray(t)){this.length=t.length;for(let d=0;d<this.length;d++)a=t[d],c=this._trackByFn(d,a),null!==n&&Object.is(n.trackById,c)?(r&&(n=this._verifyReinsertion(n,a,c,d)),Object.is(n.item,a)||this._addIdentityChange(n,a)):(n=this._mismatch(n,a,c,d),r=!0),n=n._next}else i=0,function gB(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[Xd()]();let r;for(;!(r=n.next()).done;)t(r.value)}}(t,d=>{c=this._trackByFn(i,d),null!==n&&Object.is(n.trackById,c)?(r&&(n=this._verifyReinsertion(n,d,c,i)),Object.is(n.item,d)||this._addIdentityChange(n,d)):(n=this._mismatch(n,d,c,i),r=!0),n=n._next,i++}),this.length=i;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,r,i){let a;return null===t?a=this._itTail:(a=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,a,i)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(r,i))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,a,i)):t=this._addAfter(new HU(n,r),a,i),t}_verifyReinsertion(t,n,r,i){let a=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==a?t=this._reinsertAfter(a,t._prev,i):t.currentIndex!=i&&(t.currentIndex=i,this._addToMoves(t,i)),t}_truncate(t){for(;null!==t;){const n=t._next;this._addToRemovals(this._unlink(t)),t=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const i=t._prevRemoved,a=t._nextRemoved;return null===i?this._removalsHead=a:i._nextRemoved=a,null===a?this._removalsTail=i:a._prevRemoved=i,this._insertAfter(t,n,r),this._addToMoves(t,r),t}_moveAfter(t,n,r){return this._unlink(t),this._insertAfter(t,n,r),this._addToMoves(t,r),t}_addAfter(t,n,r){return this._insertAfter(t,n,r),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,n,r){const i=null===n?this._itHead:n._next;return t._next=i,t._prev=n,null===i?this._itTail=t:i._prev=t,null===n?this._itHead=t:n._next=t,null===this._linkedRecords&&(this._linkedRecords=new yA),this._linkedRecords.put(t),t.currentIndex=r,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const n=t._prev,r=t._next;return null===n?this._itHead=r:n._next=r,null===r?this._itTail=n:r._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new yA),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class HU{constructor(t,n){this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class GU{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===n||n<=r.currentIndex)&&Object.is(r.trackById,t))return r;return null}remove(t){const n=t._prevDup,r=t._nextDup;return null===n?this._head=r:n._nextDup=r,null===r?this._tail=n:r._prevDup=n,null===this._head}}class yA{constructor(){this.map=new Map}put(t){const n=t.trackById;let r=this.map.get(n);r||(r=new GU,this.map.set(n,r)),r.add(t)}get(t,n){const i=this.map.get(t);return i?i.get(t,n):null}remove(t){const n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function _A(e,t,n){const r=e.previousIndex;if(null===r)return r;let i=0;return n&&r<n.length&&(i=n[r]),r+t+i}class vA{constructor(){}supports(t){return t instanceof Map||uw(t)}create(){return new qU}}class qU{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let n;for(n=this._mapHead;null!==n;n=n._next)t(n)}forEachPreviousItem(t){let n;for(n=this._previousMapHead;null!==n;n=n._nextPrevious)t(n)}forEachChangedItem(t){let n;for(n=this._changesHead;null!==n;n=n._nextChanged)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}diff(t){if(t){if(!(t instanceof Map||uw(t)))throw new nt(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let n=this._mapHead;if(this._appendAfter=null,this._forEach(t,(r,i)=>{if(n&&n.key===i)this._maybeAddToChanges(n,r),this._appendAfter=n,n=n._next;else{const a=this._getOrCreateRecordForKey(i,r);n=this._insertBeforeOrAppend(n,a)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(let r=n;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,n){if(t){const r=t._prev;return n._next=t,n._prev=r,t._prev=n,r&&(r._next=n),t===this._mapHead&&(this._mapHead=n),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=n,n._prev=this._appendAfter):this._mapHead=n,this._appendAfter=n,null}_getOrCreateRecordForKey(t,n){if(this._records.has(t)){const i=this._records.get(t);this._maybeAddToChanges(i,n);const a=i._prev,c=i._next;return a&&(a._next=c),c&&(c._prev=a),i._next=null,i._prev=null,i}const r=new ZU(t);return this._records.set(t,r),r.currentValue=n,this._addToAdditions(r),r}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,n){Object.is(n,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=n,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,n){t instanceof Map?t.forEach(n):Object.keys(t).forEach(r=>n(t[r],r))}}class ZU{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function bA(){return new Gv([new gA])}let Gv=(()=>{class e{constructor(n){this.factories=n}static create(n,r){if(null!=r){const i=r.factories.slice();n=n.concat(i)}return new e(n)}static extend(n){return{provide:e,useFactory:r=>e.create(n,r||bA()),deps:[[e,new Ir,new Fd]]}}find(n){const r=this.factories.find(i=>i.supports(n));if(null!=r)return r;throw new nt(901,!1)}}return e.\u0275prov=zt({token:e,providedIn:"root",factory:bA}),e})();function xA(){return new ry([new vA])}let ry=(()=>{class e{constructor(n){this.factories=n}static create(n,r){if(r){const i=r.factories.slice();n=n.concat(i)}return new e(n)}static extend(n){return{provide:e,useFactory:r=>e.create(n,r||xA()),deps:[[e,new Ir,new Fd]]}}find(n){const r=this.factories.find(i=>i.supports(n));if(r)return r;throw new nt(901,!1)}}return e.\u0275prov=zt({token:e,providedIn:"root",factory:xA}),e})();const YU=rA(null,"core",[]);let KU=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(St(Vv))},e.\u0275mod=li({type:e}),e.\u0275inj=Di({}),e})(),qv=null;function dc(){return qv}const ss=new Tt("DocumentToken");let eC=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:function(){return function t$(){return St(wA)}()},providedIn:"platform"}),e})();const n$=new Tt("Location Initialized");let wA=(()=>{class e extends eC{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return dc().getBaseHref(this._doc)}onPopState(n){const r=dc().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",n,!1),()=>r.removeEventListener("popstate",n)}onHashChange(n){const r=dc().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",n,!1),()=>r.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,r,i){CA()?this._history.pushState(n,r,i):this.location.hash=i}replaceState(n,r,i){CA()?this._history.replaceState(n,r,i):this.location.hash=i}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)(St(ss))},e.\u0275prov=zt({token:e,factory:function(){return function r$(){return new wA(St(ss))}()},providedIn:"platform"}),e})();function CA(){return!!window.history.pushState}function tC(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function EA(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function lu(e){return e&&"?"!==e[0]?"?"+e:e}let nf=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:function(){return Or(SA)},providedIn:"root"}),e})();const DA=new Tt("appBaseHref");let SA=(()=>{class e extends nf{constructor(n,r){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??Or(ss).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return tC(this._baseHref,n)}path(n=!1){const r=this._platformLocation.pathname+lu(this._platformLocation.search),i=this._platformLocation.hash;return i&&n?`${r}${i}`:r}pushState(n,r,i,a){const c=this.prepareExternalUrl(i+lu(a));this._platformLocation.pushState(n,r,c)}replaceState(n,r,i,a){const c=this.prepareExternalUrl(i+lu(a));this._platformLocation.replaceState(n,r,c)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(St(eC),St(DA,8))},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),i$=(()=>{class e extends nf{constructor(n,r){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(n){const r=tC(this._baseHref,n);return r.length>0?"#"+r:r}pushState(n,r,i,a){let c=this.prepareExternalUrl(i+lu(a));0==c.length&&(c=this._platformLocation.pathname),this._platformLocation.pushState(n,r,c)}replaceState(n,r,i,a){let c=this.prepareExternalUrl(i+lu(a));0==c.length&&(c=this._platformLocation.pathname),this._platformLocation.replaceState(n,r,c)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(St(eC),St(DA,8))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})(),nC=(()=>{class e{constructor(n){this._subject=new ti,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const r=this._locationStrategy.getBaseHref();this._baseHref=EA(MA(r)),this._locationStrategy.onPopState(i=>{this._subject.emit({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,r=""){return this.path()==this.normalize(n+lu(r))}normalize(n){return e.stripTrailingSlash(function s$(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,MA(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,r="",i=null){this._locationStrategy.pushState(i,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+lu(r)),i)}replaceState(n,r="",i=null){this._locationStrategy.replaceState(i,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+lu(r)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",r){this._urlChangeListeners.forEach(i=>i(n,r))}subscribe(n,r,i){return this._subject.subscribe({next:n,error:r,complete:i})}}return e.normalizeQueryParams=lu,e.joinWithSlash=tC,e.stripTrailingSlash=EA,e.\u0275fac=function(n){return new(n||e)(St(nf))},e.\u0275prov=zt({token:e,factory:function(){return function o$(){return new nC(St(nf))}()},providedIn:"root"}),e})();function MA(e){return e.replace(/\/index.html$/,"")}var di=(()=>((di=di||{})[di.Format=0]="Format",di[di.Standalone=1]="Standalone",di))(),kn=(()=>((kn=kn||{})[kn.Narrow=0]="Narrow",kn[kn.Abbreviated=1]="Abbreviated",kn[kn.Wide=2]="Wide",kn[kn.Short=3]="Short",kn))(),qr=(()=>((qr=qr||{})[qr.Short=0]="Short",qr[qr.Medium=1]="Medium",qr[qr.Long=2]="Long",qr[qr.Full=3]="Full",qr))(),Ut=(()=>((Ut=Ut||{})[Ut.Decimal=0]="Decimal",Ut[Ut.Group=1]="Group",Ut[Ut.List=2]="List",Ut[Ut.PercentSign=3]="PercentSign",Ut[Ut.PlusSign=4]="PlusSign",Ut[Ut.MinusSign=5]="MinusSign",Ut[Ut.Exponential=6]="Exponential",Ut[Ut.SuperscriptingExponent=7]="SuperscriptingExponent",Ut[Ut.PerMille=8]="PerMille",Ut[Ut.Infinity=9]="Infinity",Ut[Ut.NaN=10]="NaN",Ut[Ut.TimeSeparator=11]="TimeSeparator",Ut[Ut.CurrencyDecimal=12]="CurrencyDecimal",Ut[Ut.CurrencyGroup=13]="CurrencyGroup",Ut))();function Zv(e,t){return Ca(is(e)[vt.DateFormat],t)}function Wv(e,t){return Ca(is(e)[vt.TimeFormat],t)}function Xv(e,t){return Ca(is(e)[vt.DateTimeFormat],t)}function wa(e,t){const n=is(e),r=n[vt.NumberSymbols][t];if(typeof r>"u"){if(t===Ut.CurrencyDecimal)return n[vt.NumberSymbols][Ut.Decimal];if(t===Ut.CurrencyGroup)return n[vt.NumberSymbols][Ut.Group]}return r}function IA(e){if(!e[vt.ExtraData])throw new Error(`Missing extra locale data for the locale "${e[vt.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function Ca(e,t){for(let n=t;n>-1;n--)if(typeof e[n]<"u")return e[n];throw new Error("Locale data API: locale data undefined")}function iC(e){const[t,n]=e.split(":");return{hours:+t,minutes:+n}}const v$=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,iy={},b$=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Li=(()=>((Li=Li||{})[Li.Short=0]="Short",Li[Li.ShortGMT=1]="ShortGMT",Li[Li.Long=2]="Long",Li[Li.Extended=3]="Extended",Li))(),Gt=(()=>((Gt=Gt||{})[Gt.FullYear=0]="FullYear",Gt[Gt.Month=1]="Month",Gt[Gt.Date=2]="Date",Gt[Gt.Hours=3]="Hours",Gt[Gt.Minutes=4]="Minutes",Gt[Gt.Seconds=5]="Seconds",Gt[Gt.FractionalSeconds=6]="FractionalSeconds",Gt[Gt.Day=7]="Day",Gt))(),un=(()=>((un=un||{})[un.DayPeriods=0]="DayPeriods",un[un.Days=1]="Days",un[un.Months=2]="Months",un[un.Eras=3]="Eras",un))();function x$(e,t,n,r){let i=function A$(e){if(PA(e))return e;if("number"==typeof e&&!isNaN(e))return new Date(e);if("string"==typeof e){if(e=e.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(e)){const[i,a=1,c=1]=e.split("-").map(d=>+d);return Yv(i,a-1,c)}const n=parseFloat(e);if(!isNaN(e-n))return new Date(n);let r;if(r=e.match(v$))return function k$(e){const t=new Date(0);let n=0,r=0;const i=e[8]?t.setUTCFullYear:t.setFullYear,a=e[8]?t.setUTCHours:t.setHours;e[9]&&(n=Number(e[9]+e[10]),r=Number(e[9]+e[11])),i.call(t,Number(e[1]),Number(e[2])-1,Number(e[3]));const c=Number(e[4]||0)-n,d=Number(e[5]||0)-r,p=Number(e[6]||0),v=Math.floor(1e3*parseFloat("0."+(e[7]||0)));return a.call(t,c,d,p,v),t}(r)}const t=new Date(e);if(!PA(t))throw new Error(`Unable to convert "${e}" into a date`);return t}(e);t=cu(n,t)||t;let d,c=[];for(;t;){if(d=b$.exec(t),!d){c.push(t);break}{c=c.concat(d.slice(1));const E=c.pop();if(!E)break;t=E}}let p=i.getTimezoneOffset();r&&(p=kA(r,p),i=function I$(e,t,n){const r=n?-1:1,i=e.getTimezoneOffset();return function T$(e,t){return(e=new Date(e.getTime())).setMinutes(e.getMinutes()+t),e}(e,r*(kA(t,i)-i))}(i,r,!0));let v="";return c.forEach(E=>{const D=function M$(e){if(sC[e])return sC[e];let t;switch(e){case"G":case"GG":case"GGG":t=Tr(un.Eras,kn.Abbreviated);break;case"GGGG":t=Tr(un.Eras,kn.Wide);break;case"GGGGG":t=Tr(un.Eras,kn.Narrow);break;case"y":t=bi(Gt.FullYear,1,0,!1,!0);break;case"yy":t=bi(Gt.FullYear,2,0,!0,!0);break;case"yyy":t=bi(Gt.FullYear,3,0,!1,!0);break;case"yyyy":t=bi(Gt.FullYear,4,0,!1,!0);break;case"Y":t=e0(1);break;case"YY":t=e0(2,!0);break;case"YYY":t=e0(3);break;case"YYYY":t=e0(4);break;case"M":case"L":t=bi(Gt.Month,1,1);break;case"MM":case"LL":t=bi(Gt.Month,2,1);break;case"MMM":t=Tr(un.Months,kn.Abbreviated);break;case"MMMM":t=Tr(un.Months,kn.Wide);break;case"MMMMM":t=Tr(un.Months,kn.Narrow);break;case"LLL":t=Tr(un.Months,kn.Abbreviated,di.Standalone);break;case"LLLL":t=Tr(un.Months,kn.Wide,di.Standalone);break;case"LLLLL":t=Tr(un.Months,kn.Narrow,di.Standalone);break;case"w":t=oC(1);break;case"ww":t=oC(2);break;case"W":t=oC(1,!0);break;case"d":t=bi(Gt.Date,1);break;case"dd":t=bi(Gt.Date,2);break;case"c":case"cc":t=bi(Gt.Day,1);break;case"ccc":t=Tr(un.Days,kn.Abbreviated,di.Standalone);break;case"cccc":t=Tr(un.Days,kn.Wide,di.Standalone);break;case"ccccc":t=Tr(un.Days,kn.Narrow,di.Standalone);break;case"cccccc":t=Tr(un.Days,kn.Short,di.Standalone);break;case"E":case"EE":case"EEE":t=Tr(un.Days,kn.Abbreviated);break;case"EEEE":t=Tr(un.Days,kn.Wide);break;case"EEEEE":t=Tr(un.Days,kn.Narrow);break;case"EEEEEE":t=Tr(un.Days,kn.Short);break;case"a":case"aa":case"aaa":t=Tr(un.DayPeriods,kn.Abbreviated);break;case"aaaa":t=Tr(un.DayPeriods,kn.Wide);break;case"aaaaa":t=Tr(un.DayPeriods,kn.Narrow);break;case"b":case"bb":case"bbb":t=Tr(un.DayPeriods,kn.Abbreviated,di.Standalone,!0);break;case"bbbb":t=Tr(un.DayPeriods,kn.Wide,di.Standalone,!0);break;case"bbbbb":t=Tr(un.DayPeriods,kn.Narrow,di.Standalone,!0);break;case"B":case"BB":case"BBB":t=Tr(un.DayPeriods,kn.Abbreviated,di.Format,!0);break;case"BBBB":t=Tr(un.DayPeriods,kn.Wide,di.Format,!0);break;case"BBBBB":t=Tr(un.DayPeriods,kn.Narrow,di.Format,!0);break;case"h":t=bi(Gt.Hours,1,-12);break;case"hh":t=bi(Gt.Hours,2,-12);break;case"H":t=bi(Gt.Hours,1);break;case"HH":t=bi(Gt.Hours,2);break;case"m":t=bi(Gt.Minutes,1);break;case"mm":t=bi(Gt.Minutes,2);break;case"s":t=bi(Gt.Seconds,1);break;case"ss":t=bi(Gt.Seconds,2);break;case"S":t=bi(Gt.FractionalSeconds,1);break;case"SS":t=bi(Gt.FractionalSeconds,2);break;case"SSS":t=bi(Gt.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":t=Jv(Li.Short);break;case"ZZZZZ":t=Jv(Li.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=Jv(Li.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":t=Jv(Li.Long);break;default:return null}return sC[e]=t,t}(E);v+=D?D(i,n,p):"''"===E?"'":E.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),v}function Yv(e,t,n){const r=new Date(0);return r.setFullYear(e,t,n),r.setHours(0,0,0),r}function cu(e,t){const n=function a$(e){return is(e)[vt.LocaleId]}(e);if(iy[n]=iy[n]||{},iy[n][t])return iy[n][t];let r="";switch(t){case"shortDate":r=Zv(e,qr.Short);break;case"mediumDate":r=Zv(e,qr.Medium);break;case"longDate":r=Zv(e,qr.Long);break;case"fullDate":r=Zv(e,qr.Full);break;case"shortTime":r=Wv(e,qr.Short);break;case"mediumTime":r=Wv(e,qr.Medium);break;case"longTime":r=Wv(e,qr.Long);break;case"fullTime":r=Wv(e,qr.Full);break;case"short":const i=cu(e,"shortTime"),a=cu(e,"shortDate");r=Kv(Xv(e,qr.Short),[i,a]);break;case"medium":const c=cu(e,"mediumTime"),d=cu(e,"mediumDate");r=Kv(Xv(e,qr.Medium),[c,d]);break;case"long":const p=cu(e,"longTime"),v=cu(e,"longDate");r=Kv(Xv(e,qr.Long),[p,v]);break;case"full":const E=cu(e,"fullTime"),D=cu(e,"fullDate");r=Kv(Xv(e,qr.Full),[E,D])}return r&&(iy[n][t]=r),r}function Kv(e,t){return t&&(e=e.replace(/\{([^}]+)}/g,function(n,r){return null!=t&&r in t?t[r]:n})),e}function gl(e,t,n="-",r,i){let a="";(e<0||i&&e<=0)&&(i?e=1-e:(e=-e,a=n));let c=String(e);for(;c.length<t;)c="0"+c;return r&&(c=c.slice(c.length-t)),a+c}function bi(e,t,n=0,r=!1,i=!1){return function(a,c){let d=function C$(e,t){switch(e){case Gt.FullYear:return t.getFullYear();case Gt.Month:return t.getMonth();case Gt.Date:return t.getDate();case Gt.Hours:return t.getHours();case Gt.Minutes:return t.getMinutes();case Gt.Seconds:return t.getSeconds();case Gt.FractionalSeconds:return t.getMilliseconds();case Gt.Day:return t.getDay();default:throw new Error(`Unknown DateType value "${e}".`)}}(e,a);if((n>0||d>-n)&&(d+=n),e===Gt.Hours)0===d&&-12===n&&(d=12);else if(e===Gt.FractionalSeconds)return function w$(e,t){return gl(e,3).substring(0,t)}(d,t);const p=wa(c,Ut.MinusSign);return gl(d,t,p,r,i)}}function Tr(e,t,n=di.Format,r=!1){return function(i,a){return function E$(e,t,n,r,i,a){switch(n){case un.Months:return function u$(e,t,n){const r=is(e),a=Ca([r[vt.MonthsFormat],r[vt.MonthsStandalone]],t);return Ca(a,n)}(t,i,r)[e.getMonth()];case un.Days:return function c$(e,t,n){const r=is(e),a=Ca([r[vt.DaysFormat],r[vt.DaysStandalone]],t);return Ca(a,n)}(t,i,r)[e.getDay()];case un.DayPeriods:const c=e.getHours(),d=e.getMinutes();if(a){const v=function p$(e){const t=is(e);return IA(t),(t[vt.ExtraData][2]||[]).map(r=>"string"==typeof r?iC(r):[iC(r[0]),iC(r[1])])}(t),E=function m$(e,t,n){const r=is(e);IA(r);const a=Ca([r[vt.ExtraData][0],r[vt.ExtraData][1]],t)||[];return Ca(a,n)||[]}(t,i,r),D=v.findIndex(T=>{if(Array.isArray(T)){const[P,N]=T,G=c>=P.hours&&d>=P.minutes,U=c<N.hours||c===N.hours&&d<N.minutes;if(P.hours<N.hours){if(G&&U)return!0}else if(G||U)return!0}else if(T.hours===c&&T.minutes===d)return!0;return!1});if(-1!==D)return E[D]}return function l$(e,t,n){const r=is(e),a=Ca([r[vt.DayPeriodsFormat],r[vt.DayPeriodsStandalone]],t);return Ca(a,n)}(t,i,r)[c<12?0:1];case un.Eras:return function h$(e,t){return Ca(is(e)[vt.Eras],t)}(t,r)[e.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${n}`)}}(i,a,e,t,n,r)}}function Jv(e){return function(t,n,r){const i=-1*r,a=wa(n,Ut.MinusSign),c=i>0?Math.floor(i/60):Math.ceil(i/60);switch(e){case Li.Short:return(i>=0?"+":"")+gl(c,2,a)+gl(Math.abs(i%60),2,a);case Li.ShortGMT:return"GMT"+(i>=0?"+":"")+gl(c,1,a);case Li.Long:return"GMT"+(i>=0?"+":"")+gl(c,2,a)+":"+gl(Math.abs(i%60),2,a);case Li.Extended:return 0===r?"Z":(i>=0?"+":"")+gl(c,2,a)+":"+gl(Math.abs(i%60),2,a);default:throw new Error(`Unknown zone width "${e}"`)}}}function AA(e){return Yv(e.getFullYear(),e.getMonth(),e.getDate()+(4-e.getDay()))}function oC(e,t=!1){return function(n,r){let i;if(t){const a=new Date(n.getFullYear(),n.getMonth(),1).getDay()-1,c=n.getDate();i=1+Math.floor((c+a)/7)}else{const a=AA(n),c=function S$(e){const t=Yv(e,0,1).getDay();return Yv(e,0,1+(t<=4?4:11)-t)}(a.getFullYear()),d=a.getTime()-c.getTime();i=1+Math.round(d/6048e5)}return gl(i,e,wa(r,Ut.MinusSign))}}function e0(e,t=!1){return function(n,r){return gl(AA(n).getFullYear(),e,wa(r,Ut.MinusSign),t)}}const sC={};function kA(e,t){e=e.replace(/:/g,"");const n=Date.parse("Jan 01, 1970 00:00:00 "+e)/6e4;return isNaN(n)?t:n}function PA(e){return e instanceof Date&&!isNaN(e.valueOf())}function LA(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const r=n.indexOf("="),[i,a]=-1==r?[n,""]:[n.slice(0,r),n.slice(r+1)];if(i.trim()===t)return decodeURIComponent(a)}return null}let dC=(()=>{class e{constructor(n,r,i,a){this._iterableDiffers=n,this._keyValueDiffers=r,this._ngEl=i,this._renderer=a,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(n){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof n?n.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(n){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof n?n.split(/\s+/):n,this._rawClass&&(jg(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const n=this._iterableDiffer.diff(this._rawClass);n&&this._applyIterableChanges(n)}else if(this._keyValueDiffer){const n=this._keyValueDiffer.diff(this._rawClass);n&&this._applyKeyValueChanges(n)}}_applyKeyValueChanges(n){n.forEachAddedItem(r=>this._toggleClass(r.key,r.currentValue)),n.forEachChangedItem(r=>this._toggleClass(r.key,r.currentValue)),n.forEachRemovedItem(r=>{r.previousValue&&this._toggleClass(r.key,!1)})}_applyIterableChanges(n){n.forEachAddedItem(r=>{if("string"!=typeof r.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${Mn(r.item)}`);this._toggleClass(r.item,!0)}),n.forEachRemovedItem(r=>this._toggleClass(r.item,!1))}_applyClasses(n){n&&(Array.isArray(n)||n instanceof Set?n.forEach(r=>this._toggleClass(r,!0)):Object.keys(n).forEach(r=>this._toggleClass(r,!!n[r])))}_removeClasses(n){n&&(Array.isArray(n)||n instanceof Set?n.forEach(r=>this._toggleClass(r,!1)):Object.keys(n).forEach(r=>this._toggleClass(r,!1)))}_toggleClass(n,r){(n=n.trim())&&n.split(/\s+/g).forEach(i=>{r?this._renderer.addClass(this._ngEl.nativeElement,i):this._renderer.removeClass(this._ngEl.nativeElement,i)})}}return e.\u0275fac=function(n){return new(n||e)(qe(Gv),qe(ry),qe(qs),qe(sc))},e.\u0275dir=Ot({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),e})();class H${constructor(t,n,r,i){this.$implicit=t,this.ngForOf=n,this.index=r,this.count=i}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let n0=(()=>{class e{constructor(n,r,i){this._viewContainer=n,this._template=r,this._differs=i,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const r=this._viewContainer;n.forEachOperation((i,a,c)=>{if(null==i.previousIndex)r.createEmbeddedView(this._template,new H$(i.item,this._ngForOf,-1,-1),null===c?void 0:c);else if(null==c)r.remove(null===a?void 0:a);else if(null!==a){const d=r.get(a);r.move(d,c),BA(d,i)}});for(let i=0,a=r.length;i<a;i++){const d=r.get(i).context;d.index=i,d.count=a,d.ngForOf=this._ngForOf}n.forEachIdentityChange(i=>{BA(r.get(i.currentIndex),i)})}static ngTemplateContextGuard(n,r){return!0}}return e.\u0275fac=function(n){return new(n||e)(qe(pl),qe(iu),qe(Gv))},e.\u0275dir=Ot({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),e})();function BA(e,t){e.context.$implicit=t.item}let fC=(()=>{class e{constructor(n,r){this._viewContainer=n,this._context=new q$,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){VA("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){VA("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,r){return!0}}return e.\u0275fac=function(n){return new(n||e)(qe(pl),qe(iu))},e.\u0275dir=Ot({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),e})();class q${constructor(){this.$implicit=null,this.ngIf=null}}function VA(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${Mn(t)}'.`)}const a7=new Tt("DATE_PIPE_DEFAULT_TIMEZONE");let gC=(()=>{class e{constructor(n,r){this.locale=n,this.defaultTimezone=r}transform(n,r="mediumDate",i,a){if(null==n||""===n||n!=n)return null;try{return x$(n,r,a||this.locale,i??this.defaultTimezone??void 0)}catch(c){throw function yl(e,t){return new nt(2100,!1)}()}}}return e.\u0275fac=function(n){return new(n||e)(qe(ou,16),qe(a7,24))},e.\u0275pipe=Hi({name:"date",type:e,pure:!0,standalone:!0}),e})(),jA=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=li({type:e}),e.\u0275inj=Di({}),e})();let x7=(()=>{class e{}return e.\u0275prov=zt({token:e,providedIn:"root",factory:()=>new w7(St(ss),window)}),e})();class w7{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function C7(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let i=r.currentNode;for(;i;){const a=i.shadowRoot;if(a){const c=a.getElementById(t)||a.querySelector(`[name="${t}"]`);if(c)return c}i=r.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),r=n.left+this.window.pageXOffset,i=n.top+this.window.pageYOffset,a=this.offset();this.window.scrollTo(r-a[0],i-a[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=GA(this.window.history)||GA(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function GA(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class qA{}class xC extends class Y7 extends class e${}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function QU(e){qv||(qv=e)}(new xC)}onAndCancel(t,n,r){return t.addEventListener(n,r,!1),()=>{t.removeEventListener(n,r,!1)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function K7(){return ay=ay||document.querySelector("base"),ay?ay.getAttribute("href"):null}();return null==n?null:function J7(e){s0=s0||document.createElement("a"),s0.setAttribute("href",e);const t=s0.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){ay=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return LA(document.cookie,t)}}let s0,ay=null;const KA=new Tt("TRANSITION_ID"),e9=[{provide:Nv,useFactory:function Q7(e,t,n){return()=>{n.get(zv).donePromise.then(()=>{const r=dc(),i=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let a=0;a<i.length;a++)r.remove(i[a])})}},deps:[KA,ss,Zs],multi:!0}];let n9=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();const a0=new Tt("EventManagerPlugins");let l0=(()=>{class e{constructor(n,r){this._zone=r,this._eventNameToPlugin=new Map,n.forEach(i=>i.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,r,i){return this._findPluginFor(r).addEventListener(n,r,i)}addGlobalEventListener(n,r,i){return this._findPluginFor(r).addGlobalEventListener(n,r,i)}getZone(){return this._zone}_findPluginFor(n){const r=this._eventNameToPlugin.get(n);if(r)return r;const i=this._plugins;for(let a=0;a<i.length;a++){const c=i[a];if(c.supports(n))return this._eventNameToPlugin.set(n,c),c}throw new Error(`No event manager plugin found for event ${n}`)}}return e.\u0275fac=function(n){return new(n||e)(St(a0),St(Oi))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();class JA{constructor(t){this._doc=t}addGlobalEventListener(t,n,r){const i=dc().getGlobalEventTarget(this._doc,t);if(!i)throw new Error(`Unsupported event target ${i} for event ${n}`);return this.addEventListener(i,n,r)}}let QA=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(n){const r=new Set;n.forEach(i=>{this._stylesSet.has(i)||(this._stylesSet.add(i),r.add(i))}),this.onStylesAdded(r)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})(),ly=(()=>{class e extends QA{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,r,i){n.forEach(a=>{const c=this._doc.createElement("style");c.textContent=a,i.push(r.appendChild(c))})}addHost(n){const r=[];this._addStylesToHost(this._stylesSet,n,r),this._hostNodes.set(n,r)}removeHost(n){const r=this._hostNodes.get(n);r&&r.forEach(ek),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((r,i)=>{this._addStylesToHost(n,i,r)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(ek))}}return e.\u0275fac=function(n){return new(n||e)(St(ss))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();function ek(e){dc().remove(e)}const wC={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},CC=/%COMP%/g;function c0(e,t,n){for(let r=0;r<t.length;r++){let i=t[r];Array.isArray(i)?c0(e,i,n):(i=i.replace(CC,e),n.push(i))}return n}function rk(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let EC=(()=>{class e{constructor(n,r,i){this.eventManager=n,this.sharedStylesHost=r,this.appId=i,this.rendererByCompId=new Map,this.defaultRenderer=new DC(n)}createRenderer(n,r){if(!n||!r)return this.defaultRenderer;switch(r.encapsulation){case ms.Emulated:{let i=this.rendererByCompId.get(r.id);return i||(i=new l9(this.eventManager,this.sharedStylesHost,r,this.appId),this.rendererByCompId.set(r.id,i)),i.applyToHost(n),i}case 1:case ms.ShadowDom:return new c9(this.eventManager,this.sharedStylesHost,n,r);default:if(!this.rendererByCompId.has(r.id)){const i=c0(r.id,r.styles,[]);this.sharedStylesHost.addStyles(i),this.rendererByCompId.set(r.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(n){return new(n||e)(St(l0),St(ly),St(ny))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();class DC{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?document.createElementNS(wC[n]||n,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,n){(ok(t)?t.content:t).appendChild(n)}insertBefore(t,n,r){t&&(ok(t)?t.content:t).insertBefore(n,r)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let r="string"==typeof t?document.querySelector(t):t;if(!r)throw new Error(`The selector "${t}" did not match any elements`);return n||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,r,i){if(i){n=i+":"+n;const a=wC[i];a?t.setAttributeNS(a,n,r):t.setAttribute(n,r)}else t.setAttribute(n,r)}removeAttribute(t,n,r){if(r){const i=wC[r];i?t.removeAttributeNS(i,n):t.removeAttribute(`${r}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,r,i){i&(Yi.DashCase|Yi.Important)?t.style.setProperty(n,r,i&Yi.Important?"important":""):t.style[n]=r}removeStyle(t,n,r){r&Yi.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,r){t[n]=r}setValue(t,n){t.nodeValue=n}listen(t,n,r){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,n,rk(r)):this.eventManager.addEventListener(t,n,rk(r))}}function ok(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class l9 extends DC{constructor(t,n,r,i){super(t),this.component=r;const a=c0(i+"-"+r.id,r.styles,[]);n.addStyles(a),this.contentAttr=function o9(e){return"_ngcontent-%COMP%".replace(CC,e)}(i+"-"+r.id),this.hostAttr=function s9(e){return"_nghost-%COMP%".replace(CC,e)}(i+"-"+r.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,n){const r=super.createElement(t,n);return super.setAttribute(r,this.contentAttr,""),r}}class c9 extends DC{constructor(t,n,r,i){super(t),this.sharedStylesHost=n,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const a=c0(i.id,i.styles,[]);for(let c=0;c<a.length;c++){const d=document.createElement("style");d.textContent=a[c],this.shadowRoot.appendChild(d)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,r){return super.insertBefore(this.nodeOrShadowRoot(t),n,r)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let u9=(()=>{class e extends JA{constructor(n){super(n)}supports(n){return!0}addEventListener(n,r,i){return n.addEventListener(r,i,!1),()=>this.removeEventListener(n,r,i)}removeEventListener(n,r,i){return n.removeEventListener(r,i)}}return e.\u0275fac=function(n){return new(n||e)(St(ss))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();const sk=["alt","control","meta","shift"],h9={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},d9={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let f9=(()=>{class e extends JA{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,r,i){const a=e.parseEventName(r),c=e.eventCallback(a.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>dc().onAndCancel(n,a.domEventName,c))}static parseEventName(n){const r=n.toLowerCase().split("."),i=r.shift();if(0===r.length||"keydown"!==i&&"keyup"!==i)return null;const a=e._normalizeKey(r.pop());let c="",d=r.indexOf("code");if(d>-1&&(r.splice(d,1),c="code."),sk.forEach(v=>{const E=r.indexOf(v);E>-1&&(r.splice(E,1),c+=v+".")}),c+=a,0!=r.length||0===a.length)return null;const p={};return p.domEventName=i,p.fullKey=c,p}static matchEventFullKeyCode(n,r){let i=h9[n.key]||n.key,a="";return r.indexOf("code.")>-1&&(i=n.code,a="code."),!(null==i||!i)&&(i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),sk.forEach(c=>{c!==i&&(0,d9[c])(n)&&(a+=c+".")}),a+=i,a===r)}static eventCallback(n,r,i){return a=>{e.matchEventFullKeyCode(a,n)&&i.runGuarded(()=>r(a))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(St(ss))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();const y9=rA(YU,"browser",[{provide:Vw,useValue:"browser"},{provide:ZI,useValue:function p9(){xC.makeCurrent()},multi:!0},{provide:ss,useFactory:function g9(){return function x(e){_=e}(document),document},deps:[]}]),ck=new Tt(""),uk=[{provide:Bv,useClass:class t9{addToWindow(t){nr.getAngularTestability=(r,i=!0)=>{const a=t.findTestabilityInTree(r,i);if(null==a)throw new Error("Could not find testability for element.");return a},nr.getAllAngularTestabilities=()=>t.getAllTestabilities(),nr.getAllAngularRootElements=()=>t.getAllRootElements(),nr.frameworkStabilizers||(nr.frameworkStabilizers=[]),nr.frameworkStabilizers.push(r=>{const i=nr.getAllAngularTestabilities();let a=i.length,c=!1;const d=function(p){c=c||p,a--,0==a&&r(c)};i.forEach(function(p){p.whenStable(d)})})}findTestabilityInTree(t,n,r){return null==n?null:t.getTestability(n)??(r?dc().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null)}},deps:[]},{provide:QI,useClass:Gw,deps:[Oi,qw,Bv]},{provide:Gw,useClass:Gw,deps:[Oi,qw,Bv]}],hk=[{provide:wh,useValue:"root"},{provide:Dp,useFactory:function m9(){return new Dp},deps:[]},{provide:a0,useClass:u9,multi:!0,deps:[ss,Oi,Vw]},{provide:a0,useClass:f9,multi:!0,deps:[ss]},{provide:EC,useClass:EC,deps:[l0,ly,ny]},{provide:F2,useExisting:EC},{provide:QA,useExisting:ly},{provide:ly,useClass:ly,deps:[ss]},{provide:l0,useClass:l0,deps:[a0,Oi]},{provide:qA,useClass:n9,deps:[]},[]];let _9=(()=>{class e{constructor(n){}static withServerTransition(n){return{ngModule:e,providers:[{provide:ny,useValue:n.appId},{provide:KA,useExisting:ny},e9]}}}return e.\u0275fac=function(n){return new(n||e)(St(ck,12))},e.\u0275mod=li({type:e}),e.\u0275inj=Di({providers:[...hk,...uk],imports:[jA,KU]}),e})(),dk=(()=>{class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return e.\u0275fac=function(n){return new(n||e)(St(ss))},e.\u0275prov=zt({token:e,factory:function(n){let r=null;return r=n?new n:function b9(){return new dk(St(ss))}(),r},providedIn:"root"}),e})();function Bt(...e){return Cr(e,lr(e))}typeof window<"u"&&window;class _l extends pi{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:r}=this;if(t)throw n;return this._throwIfClosed(),r}next(t){super.next(this._value=t)}}const u0=qh(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:T9}=Array,{getPrototypeOf:I9,prototype:A9,keys:k9}=Object;const{isArray:R9}=Array;function _k(...e){const t=lr(e),n=function Zn(e){return ar(an(e))?e.pop():void 0}(e),{args:r,keys:i}=function mk(e){if(1===e.length){const t=e[0];if(T9(t))return{args:t,keys:null};if(function P9(e){return e&&"object"==typeof e&&I9(e)===A9}(t)){const n=k9(t);return{args:n.map(r=>t[r]),keys:n}}}return{args:e,keys:null}}(e);if(0===r.length)return Cr([],t);const a=new Bn(function O9(e,t,n=Wr){return r=>{vk(t,()=>{const{length:i}=e,a=new Array(i);let c=i,d=i;for(let p=0;p<i;p++)vk(t,()=>{const v=Cr(e[p],t);let E=!1;v.subscribe(tr(r,D=>{a[p]=D,E||(E=!0,d--),d||r.next(n(a.slice()))},()=>{--c||r.complete()}))},r)},r)}}(r,t,i?c=>function yk(e,t){return e.reduce((n,r,i)=>(n[r]=t[i],n),{})}(i,c):Wr));return n?a.pipe(function gk(e){return Pe(t=>function F9(e,t){return R9(t)?e(...t):e(t)}(e,t))}(n)):a}function vk(e,t,n){e?Te(n,e,t):t()}function TC(...e){return function L9(){return dt(1)}()(Cr(e,lr(e)))}function bk(e){return new Bn(t=>{te(e()).subscribe(t)})}function cy(e,t){const n=ar(e)?e:()=>e,r=i=>i.error(n());return new Bn(t?i=>t.schedule(r,0,i):r)}function IC(){return yr((e,t)=>{let n=null;e._refCount++;const r=tr(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const i=e._connection,a=n;n=null,i&&(!a||i===a)&&i.unsubscribe(),t.unsubscribe()});e.subscribe(r),r.closed||(n=e.connect())})}class xk extends Bn{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,na(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new wr;const n=this.getSubject();t.add(this.source.subscribe(tr(n,void 0,()=>{this._teardown(),n.complete()},r=>{this._teardown(),n.error(r)},()=>this._teardown()))),t.closed&&(this._connection=null,t=wr.EMPTY)}return t}refCount(){return IC()(this)}}function fc(e,t){return yr((n,r)=>{let i=null,a=0,c=!1;const d=()=>c&&!i&&r.complete();n.subscribe(tr(r,p=>{i?.unsubscribe();let v=0;const E=a++;te(e(p,E)).subscribe(i=tr(r,D=>r.next(t?t(p,D,E,v++):D),()=>{i=null,d()}))},()=>{c=!0,d()}))})}function uy(e){return e<=0?()=>xt:yr((t,n)=>{let r=0;t.subscribe(tr(n,i=>{++r<=e&&(n.next(i),e<=r&&n.complete())}))})}function uu(e,t){return yr((n,r)=>{let i=0;n.subscribe(tr(r,a=>e.call(t,a,i++)&&r.next(a)))})}function h0(e){return yr((t,n)=>{let r=!1;t.subscribe(tr(n,i=>{r=!0,n.next(i)},()=>{r||n.next(e),n.complete()}))})}function wk(e=z9){return yr((t,n)=>{let r=!1;t.subscribe(tr(n,i=>{r=!0,n.next(i)},()=>r?n.complete():n.error(e())))})}function z9(){return new u0}function Ih(e,t){const n=arguments.length>=2;return r=>r.pipe(e?uu((i,a)=>e(i,a,r)):Wr,uy(1),n?h0(t):wk(()=>new u0))}function Ah(e,t){return ar(t)?ht(e,t,1):ht(e,1)}function Uo(e,t,n){const r=ar(e)||t||n?{next:e,error:t,complete:n}:e;return r?yr((i,a)=>{var c;null===(c=r.subscribe)||void 0===c||c.call(r);let d=!0;i.subscribe(tr(a,p=>{var v;null===(v=r.next)||void 0===v||v.call(r,p),a.next(p)},()=>{var p;d=!1,null===(p=r.complete)||void 0===p||p.call(r),a.complete()},p=>{var v;d=!1,null===(v=r.error)||void 0===v||v.call(r,p),a.error(p)},()=>{var p,v;d&&(null===(p=r.unsubscribe)||void 0===p||p.call(r)),null===(v=r.finalize)||void 0===v||v.call(r)}))}):Wr}function kh(e){return yr((t,n)=>{let a,r=null,i=!1;r=t.subscribe(tr(n,void 0,void 0,c=>{a=te(e(c,kh(e)(t))),r?(r.unsubscribe(),r=null,a.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,a.subscribe(n))})}function B9(e,t,n,r,i){return(a,c)=>{let d=n,p=t,v=0;a.subscribe(tr(c,E=>{const D=v++;p=d?e(p,E,D):(d=!0,E),r&&c.next(p)},i&&(()=>{d&&c.next(p),c.complete()})))}}function Ck(e,t){return yr(B9(e,t,arguments.length>=2,!0))}function AC(e){return e<=0?()=>xt:yr((t,n)=>{let r=[];t.subscribe(tr(n,i=>{r.push(i),e<r.length&&r.shift()},()=>{for(const i of r)n.next(i);n.complete()},void 0,()=>{r=null}))})}function Ek(e,t){const n=arguments.length>=2;return r=>r.pipe(e?uu((i,a)=>e(i,a,r)):Wr,AC(1),n?h0(t):wk(()=>new u0))}function kC(e){return yr((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}const vn="primary",hy=Symbol("RouteTitle");class $9{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function qp(e){return new $9(e)}function j9(e,t,n){const r=n.path.split("/");if(r.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const i={};for(let a=0;a<r.length;a++){const c=r[a],d=e[a];if(c.startsWith(":"))i[c.substring(1)]=d;else if(c!==d.path)return null}return{consumed:e.slice(0,r.length),posParams:i}}function pc(e,t){const n=e?Object.keys(e):void 0,r=t?Object.keys(t):void 0;if(!n||!r||n.length!=r.length)return!1;let i;for(let a=0;a<n.length;a++)if(i=n[a],!Dk(e[i],t[i]))return!1;return!0}function Dk(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((i,a)=>r[a]===i)}return e===t}function Sk(e){return Array.prototype.concat.apply([],e)}function Mk(e){return e.length>0?e[e.length-1]:null}function Eo(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Ph(e){return pw(e)?e:Gg(e)?Cr(Promise.resolve(e)):Bt(e)}const q9={exact:function Ak(e,t,n){if(!sf(e.segments,t.segments)||!d0(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const r in t.children)if(!e.children[r]||!Ak(e.children[r],t.children[r],n))return!1;return!0},subset:kk},Tk={exact:function Z9(e,t){return pc(e,t)},subset:function W9(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>Dk(e[n],t[n]))},ignored:()=>!0};function Ik(e,t,n){return q9[n.paths](e.root,t.root,n.matrixParams)&&Tk[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function kk(e,t,n){return Pk(e,t,t.segments,n)}function Pk(e,t,n,r){if(e.segments.length>n.length){const i=e.segments.slice(0,n.length);return!(!sf(i,n)||t.hasChildren()||!d0(i,n,r))}if(e.segments.length===n.length){if(!sf(e.segments,n)||!d0(e.segments,n,r))return!1;for(const i in t.children)if(!e.children[i]||!kk(e.children[i],t.children[i],r))return!1;return!0}{const i=n.slice(0,e.segments.length),a=n.slice(e.segments.length);return!!(sf(e.segments,i)&&d0(e.segments,i,r)&&e.children[vn])&&Pk(e.children[vn],t,a,r)}}function d0(e,t,n){return t.every((r,i)=>Tk[n](e[i].parameters,r.parameters))}class rf{constructor(t,n,r){this.root=t,this.queryParams=n,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=qp(this.queryParams)),this._queryParamMap}toString(){return K9.serialize(this)}}class En{constructor(t,n){this.segments=t,this.children=n,this.parent=null,Eo(n,(r,i)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return f0(this)}}class dy{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=qp(this.parameters)),this._parameterMap}toString(){return Lk(this)}}function sf(e,t){return e.length===t.length&&e.every((n,r)=>n.path===t[r].path)}let Rk=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:function(){return new RC},providedIn:"root"}),e})();class RC{parse(t){const n=new sj(t);return new rf(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${fy(t.root,!0)}`,r=function ej(e){const t=Object.keys(e).map(n=>{const r=e[n];return Array.isArray(r)?r.map(i=>`${p0(n)}=${p0(i)}`).join("&"):`${p0(n)}=${p0(r)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${r}${"string"==typeof t.fragment?`#${function J9(e){return encodeURI(e)}(t.fragment)}`:""}`}}const K9=new RC;function f0(e){return e.segments.map(t=>Lk(t)).join("/")}function fy(e,t){if(!e.hasChildren())return f0(e);if(t){const n=e.children[vn]?fy(e.children[vn],!1):"",r=[];return Eo(e.children,(i,a)=>{a!==vn&&r.push(`${a}:${fy(i,!1)}`)}),r.length>0?`${n}(${r.join("//")})`:n}{const n=function Y9(e,t){let n=[];return Eo(e.children,(r,i)=>{i===vn&&(n=n.concat(t(r,i)))}),Eo(e.children,(r,i)=>{i!==vn&&(n=n.concat(t(r,i)))}),n}(e,(r,i)=>i===vn?[fy(e.children[vn],!1)]:[`${i}:${fy(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[vn]?`${f0(e)}/${n[0]}`:`${f0(e)}/(${n.join("//")})`}}function Fk(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function p0(e){return Fk(e).replace(/%3B/gi,";")}function FC(e){return Fk(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function m0(e){return decodeURIComponent(e)}function Ok(e){return m0(e.replace(/\+/g,"%20"))}function Lk(e){return`${FC(e.path)}${function Q9(e){return Object.keys(e).map(t=>`;${FC(t)}=${FC(e[t])}`).join("")}(e.parameters)}`}const tj=/^[^\/()?;=#]+/;function g0(e){const t=e.match(tj);return t?t[0]:""}const nj=/^[^=?&#]+/,ij=/^[^&#]+/;class sj{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new En([],{}):new En([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(r[vn]=new En(t,n)),r}parseSegment(){const t=g0(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new nt(4009,!1);return this.capture(t),new dy(m0(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=g0(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const i=g0(this.remaining);i&&(r=i,this.capture(r))}t[m0(n)]=m0(r)}parseQueryParam(t){const n=function rj(e){const t=e.match(nj);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const c=function oj(e){const t=e.match(ij);return t?t[0]:""}(this.remaining);c&&(r=c,this.capture(r))}const i=Ok(n),a=Ok(r);if(t.hasOwnProperty(i)){let c=t[i];Array.isArray(c)||(c=[c],t[i]=c),c.push(a)}else t[i]=a}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=g0(this.remaining),i=this.remaining[r.length];if("/"!==i&&")"!==i&&";"!==i)throw new nt(4010,!1);let a;r.indexOf(":")>-1?(a=r.slice(0,r.indexOf(":")),this.capture(a),this.capture(":")):t&&(a=vn);const c=this.parseChildren();n[a]=1===Object.keys(c).length?c[vn]:new En([],c),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new nt(4011,!1)}}function OC(e){return e.segments.length>0?new En([],{[vn]:e}):e}function y0(e){const t={};for(const r of Object.keys(e.children)){const a=y0(e.children[r]);(a.segments.length>0||a.hasChildren())&&(t[r]=a)}return function aj(e){if(1===e.numberOfChildren&&e.children[vn]){const t=e.children[vn];return new En(e.segments.concat(t.segments),t.children)}return e}(new En(e.segments,t))}function af(e){return e instanceof rf}function uj(e,t,n,r,i){if(0===n.length)return Zp(t.root,t.root,t.root,r,i);const a=function Bk(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new zk(!0,0,e);let t=0,n=!1;const r=e.reduce((i,a,c)=>{if("object"==typeof a&&null!=a){if(a.outlets){const d={};return Eo(a.outlets,(p,v)=>{d[v]="string"==typeof p?p.split("/"):p}),[...i,{outlets:d}]}if(a.segmentPath)return[...i,a.segmentPath]}return"string"!=typeof a?[...i,a]:0===c?(a.split("/").forEach((d,p)=>{0==p&&"."===d||(0==p&&""===d?n=!0:".."===d?t++:""!=d&&i.push(d))}),i):[...i,a]},[]);return new zk(n,t,r)}(n);return a.toRoot()?Zp(t.root,t.root,new En([],{}),r,i):function c(p){const v=function dj(e,t,n,r){if(e.isAbsolute)return new Wp(t.root,!0,0);if(-1===r)return new Wp(n,n===t.root,0);return function Vk(e,t,n){let r=e,i=t,a=n;for(;a>i;){if(a-=i,r=r.parent,!r)throw new nt(4005,!1);i=r.segments.length}return new Wp(r,!1,i-a)}(n,r+(py(e.commands[0])?0:1),e.numberOfDoubleDots)}(a,t,e.snapshot?._urlSegment,p),E=v.processChildren?gy(v.segmentGroup,v.index,a.commands):NC(v.segmentGroup,v.index,a.commands);return Zp(t.root,v.segmentGroup,E,r,i)}(e.snapshot?._lastPathIndex)}function py(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function my(e){return"object"==typeof e&&null!=e&&e.outlets}function Zp(e,t,n,r,i){let c,a={};r&&Eo(r,(p,v)=>{a[v]=Array.isArray(p)?p.map(E=>`${E}`):`${p}`}),c=e===t?n:Nk(e,t,n);const d=OC(y0(c));return new rf(d,a,i)}function Nk(e,t,n){const r={};return Eo(e.children,(i,a)=>{r[a]=i===t?n:Nk(i,t,n)}),new En(e.segments,r)}class zk{constructor(t,n,r){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=r,t&&r.length>0&&py(r[0]))throw new nt(4003,!1);const i=r.find(my);if(i&&i!==Mk(r))throw new nt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Wp{constructor(t,n,r){this.segmentGroup=t,this.processChildren=n,this.index=r}}function NC(e,t,n){if(e||(e=new En([],{})),0===e.segments.length&&e.hasChildren())return gy(e,t,n);const r=function pj(e,t,n){let r=0,i=t;const a={match:!1,pathIndex:0,commandIndex:0};for(;i<e.segments.length;){if(r>=n.length)return a;const c=e.segments[i],d=n[r];if(my(d))break;const p=`${d}`,v=r<n.length-1?n[r+1]:null;if(i>0&&void 0===p)break;if(p&&v&&"object"==typeof v&&void 0===v.outlets){if(!$k(p,v,c))return a;r+=2}else{if(!$k(p,{},c))return a;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(e,t,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const a=new En(e.segments.slice(0,r.pathIndex),{});return a.children[vn]=new En(e.segments.slice(r.pathIndex),e.children),gy(a,0,i)}return r.match&&0===i.length?new En(e.segments,{}):r.match&&!e.hasChildren()?zC(e,t,n):r.match?gy(e,0,i):zC(e,t,n)}function gy(e,t,n){if(0===n.length)return new En(e.segments,{});{const r=function fj(e){return my(e[0])?e[0].outlets:{[vn]:e}}(n),i={};return Eo(r,(a,c)=>{"string"==typeof a&&(a=[a]),null!==a&&(i[c]=NC(e.children[c],t,a))}),Eo(e.children,(a,c)=>{void 0===r[c]&&(i[c]=a)}),new En(e.segments,i)}}function zC(e,t,n){const r=e.segments.slice(0,t);let i=0;for(;i<n.length;){const a=n[i];if(my(a)){const p=mj(a.outlets);return new En(r,p)}if(0===i&&py(n[0])){r.push(new dy(e.segments[t].path,Uk(n[0]))),i++;continue}const c=my(a)?a.outlets[vn]:`${a}`,d=i<n.length-1?n[i+1]:null;c&&d&&py(d)?(r.push(new dy(c,Uk(d))),i+=2):(r.push(new dy(c,{})),i++)}return new En(r,{})}function mj(e){const t={};return Eo(e,(n,r)=>{"string"==typeof n&&(n=[n]),null!==n&&(t[r]=zC(new En([],{}),0,n))}),t}function Uk(e){const t={};return Eo(e,(n,r)=>t[r]=`${n}`),t}function $k(e,t,n){return e==n.path&&pc(t,n.parameters)}class hu{constructor(t,n){this.id=t,this.url=n}}class BC extends hu{constructor(t,n,r="imperative",i=null){super(t,n),this.type=0,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class lf extends hu{constructor(t,n,r){super(t,n),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class _0 extends hu{constructor(t,n,r,i){super(t,n),this.reason=r,this.code=i,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class jk extends hu{constructor(t,n,r,i){super(t,n),this.error=r,this.target=i,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class gj extends hu{constructor(t,n,r,i){super(t,n),this.urlAfterRedirects=r,this.state=i,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class yj extends hu{constructor(t,n,r,i){super(t,n),this.urlAfterRedirects=r,this.state=i,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _j extends hu{constructor(t,n,r,i,a){super(t,n),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=a,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class vj extends hu{constructor(t,n,r,i){super(t,n),this.urlAfterRedirects=r,this.state=i,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class bj extends hu{constructor(t,n,r,i){super(t,n),this.urlAfterRedirects=r,this.state=i,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class xj{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class wj{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Cj{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ej{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Dj{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Sj{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Hk{constructor(t,n,r){this.routerEvent=t,this.position=n,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Gk{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=VC(t,this._root);return n?n.children.map(r=>r.value):[]}firstChild(t){const n=VC(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=UC(t,this._root);return n.length<2?[]:n[n.length-2].children.map(i=>i.value).filter(i=>i!==t)}pathFromRoot(t){return UC(t,this._root).map(n=>n.value)}}function VC(e,t){if(e===t.value)return t;for(const n of t.children){const r=VC(e,n);if(r)return r}return null}function UC(e,t){if(e===t.value)return[t];for(const n of t.children){const r=UC(e,n);if(r.length)return r.unshift(t),r}return[]}class du{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function Xp(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class qk extends Gk{constructor(t,n){super(t),this.snapshot=n,$C(this,t)}toString(){return this.snapshot.toString()}}function Zk(e,t){const n=function Tj(e,t){const c=new v0([],{},{},"",{},vn,t,null,e.root,-1,{});return new Xk("",new du(c,[]))}(e,t),r=new _l([new dy("",{})]),i=new _l({}),a=new _l({}),c=new _l({}),d=new _l(""),p=new cf(r,i,c,d,a,vn,t,n.root);return p.snapshot=n.root,new qk(new du(p,[]),n)}class cf{constructor(t,n,r,i,a,c,d,p){this.url=t,this.params=n,this.queryParams=r,this.fragment=i,this.data=a,this.outlet=c,this.component=d,this.title=this.data?.pipe(Pe(v=>v[hy]))??Bt(void 0),this._futureSnapshot=p}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Pe(t=>qp(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Pe(t=>qp(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Wk(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const i=n[r],a=n[r-1];if(i.routeConfig&&""===i.routeConfig.path)r--;else{if(a.component)break;r--}}return function Ij(e){return e.reduce((t,n)=>({params:{...t.params,...n.params},data:{...t.data,...n.data},resolve:{...n.data,...t.resolve,...n.routeConfig?.data,...n._resolvedData}}),{params:{},data:{},resolve:{}})}(n.slice(r))}class v0{constructor(t,n,r,i,a,c,d,p,v,E,D,T){this.url=t,this.params=n,this.queryParams=r,this.fragment=i,this.data=a,this.outlet=c,this.component=d,this.title=this.data?.[hy],this.routeConfig=p,this._urlSegment=v,this._lastPathIndex=E,this._correctedLastPathIndex=T??E,this._resolve=D}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=qp(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=qp(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Xk extends Gk{constructor(t,n){super(n),this.url=t,$C(this,n)}toString(){return Yk(this._root)}}function $C(e,t){t.value._routerState=e,t.children.forEach(n=>$C(e,n))}function Yk(e){const t=e.children.length>0?` { ${e.children.map(Yk).join(", ")} } `:"";return`${e.value}${t}`}function jC(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,pc(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),pc(t.params,n.params)||e.params.next(n.params),function H9(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!pc(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),pc(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function HC(e,t){const n=pc(e.params,t.params)&&function X9(e,t){return sf(e,t)&&e.every((n,r)=>pc(n.parameters,t[r].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||HC(e.parent,t.parent))}function yy(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=t.value;const i=function kj(e,t,n){return t.children.map(r=>{for(const i of n.children)if(e.shouldReuseRoute(r.value,i.value.snapshot))return yy(e,r,i);return yy(e,r)})}(e,t,n);return new du(r,i)}{if(e.shouldAttach(t.value)){const a=e.retrieve(t.value);if(null!==a){const c=a.route;return c.value._futureSnapshot=t.value,c.children=t.children.map(d=>yy(e,d)),c}}const r=function Pj(e){return new cf(new _l(e.url),new _l(e.params),new _l(e.queryParams),new _l(e.fragment),new _l(e.data),e.outlet,e.component,e)}(t.value),i=t.children.map(a=>yy(e,a));return new du(r,i)}}const GC="ngNavigationCancelingError";function Kk(e,t){const{redirectTo:n,navigationBehaviorOptions:r}=af(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,i=Jk(!1,0,t);return i.url=n,i.navigationBehaviorOptions=r,i}function Jk(e,t,n){const r=new Error("NavigationCancelingError: "+(e||""));return r[GC]=!0,r.cancellationCode=t,n&&(r.url=n),r}function Qk(e){return eP(e)&&af(e.url)}function eP(e){return e&&e[GC]}class Rj{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new _y,this.attachRef=null}}let _y=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(n,r){const i=this.getOrCreateContext(n);i.outlet=r,this.contexts.set(n,i)}onChildOutletDestroyed(n){const r=this.getContext(n);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let r=this.getContext(n);return r||(r=new Rj,this.contexts.set(n,r)),r}getContext(n){return this.contexts.get(n)||null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const b0=!1;let tP=(()=>{class e{constructor(n,r,i,a,c){this.parentContexts=n,this.location=r,this.changeDetector=a,this.environmentInjector=c,this.activated=null,this._activatedRoute=null,this.activateEvents=new ti,this.deactivateEvents=new ti,this.attachEvents=new ti,this.detachEvents=new ti,this.name=i||vn,n.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.getContext(this.name)?.outlet===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const n=this.parentContexts.getContext(this.name);n&&n.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new nt(4012,b0);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new nt(4012,b0);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new nt(4012,b0);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,r){this.activated=n,this._activatedRoute=r,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,r){if(this.isActivated)throw new nt(4013,b0);this._activatedRoute=n;const i=this.location,c=n._futureSnapshot.component,d=this.parentContexts.getOrCreateContext(this.name).children,p=new Fj(n,d,i.injector);if(r&&function Oj(e){return!!e.resolveComponentFactory}(r)){const v=r.resolveComponentFactory(c);this.activated=i.createComponent(v,i.length,p)}else this.activated=i.createComponent(c,{index:i.length,injector:p,environmentInjector:r??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)(qe(_y),qe(pl),function Dd(e){return function qm(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const r=n.length;let i=0;for(;i<r;){const a=n[i];if(rr(a))break;if(0===a)i+=2;else if("number"==typeof a)for(i++;i<r&&"string"==typeof n[i];)i++;else{if(a===t)return n[i+1];i+=2}}}return null}(Rr(),e)}("name"),qe($v),qe(Ms))},e.\u0275dir=Ot({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0}),e})();class Fj{constructor(t,n,r){this.route=t,this.childContexts=n,this.parent=r}get(t,n){return t===cf?this.route:t===_y?this.childContexts:this.parent.get(t,n)}}let qC=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zs({type:e,selectors:[["ng-component"]],standalone:!0,features:[lI],decls:1,vars:0,template:function(n,r){1&n&&xa(0,"router-outlet")},dependencies:[tP],encapsulation:2}),e})();function nP(e,t){return e.providers&&!e._injector&&(e._injector=Av(e.providers,t,`Route: ${e.path}`)),e._injector??t}function WC(e){const t=e.children&&e.children.map(WC),n=t?{...e,children:t}:{...e};return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==vn&&(n.component=qC),n}function Ea(e){return e.outlet||vn}function rP(e,t){const n=e.filter(r=>Ea(r)===t);return n.push(...e.filter(r=>Ea(r)!==t)),n}function vy(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class Vj{constructor(t,n,r,i){this.routeReuseStrategy=t,this.futureState=n,this.currState=r,this.forwardEvent=i}activate(t){const n=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,r,t),jC(this.futureState.root),this.activateChildRoutes(n,r,t)}deactivateChildRoutes(t,n,r){const i=Xp(n);t.children.forEach(a=>{const c=a.value.outlet;this.deactivateRoutes(a,i[c],r),delete i[c]}),Eo(i,(a,c)=>{this.deactivateRouteAndItsChildren(a,r)})}deactivateRoutes(t,n,r){const i=t.value,a=n?n.value:null;if(i===a)if(i.component){const c=r.getContext(i.outlet);c&&this.deactivateChildRoutes(t,n,c.children)}else this.deactivateChildRoutes(t,n,r);else a&&this.deactivateRouteAndItsChildren(n,r)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const r=n.getContext(t.value.outlet),i=r&&t.value.component?r.children:n,a=Xp(t);for(const c of Object.keys(a))this.deactivateRouteAndItsChildren(a[c],i);if(r&&r.outlet){const c=r.outlet.detach(),d=r.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:c,route:t,contexts:d})}}deactivateRouteAndOutlet(t,n){const r=n.getContext(t.value.outlet),i=r&&t.value.component?r.children:n,a=Xp(t);for(const c of Object.keys(a))this.deactivateRouteAndItsChildren(a[c],i);r&&r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated(),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(t,n,r){const i=Xp(n);t.children.forEach(a=>{this.activateRoutes(a,i[a.value.outlet],r),this.forwardEvent(new Sj(a.value.snapshot))}),t.children.length&&this.forwardEvent(new Ej(t.value.snapshot))}activateRoutes(t,n,r){const i=t.value,a=n?n.value:null;if(jC(i),i===a)if(i.component){const c=r.getOrCreateContext(i.outlet);this.activateChildRoutes(t,n,c.children)}else this.activateChildRoutes(t,n,r);else if(i.component){const c=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const d=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),c.children.onOutletReAttached(d.contexts),c.attachRef=d.componentRef,c.route=d.route.value,c.outlet&&c.outlet.attach(d.componentRef,d.route.value),jC(d.route.value),this.activateChildRoutes(t,null,c.children)}else{const d=vy(i.snapshot),p=d?.get(Bg)??null;c.attachRef=null,c.route=i,c.resolver=p,c.injector=d,c.outlet&&c.outlet.activateWith(i,c.injector),this.activateChildRoutes(t,null,c.children)}}else this.activateChildRoutes(t,null,r)}}class iP{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class x0{constructor(t,n){this.component=t,this.route=n}}function Uj(e,t,n){const r=e._root;return by(r,t?t._root:null,n,[r.value])}function Yp(e,t){const n=Symbol(),r=t.get(e,n);return r===n?"function"!=typeof e||function ed(e){return null!==Uu(e)}(e)?t.get(e):e:r}function by(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const a=Xp(t);return e.children.forEach(c=>{(function jj(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const a=e.value,c=t?t.value:null,d=n?n.getContext(e.value.outlet):null;if(c&&a.routeConfig===c.routeConfig){const p=function Hj(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!sf(e.url,t.url);case"pathParamsOrQueryParamsChange":return!sf(e.url,t.url)||!pc(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!HC(e,t)||!pc(e.queryParams,t.queryParams);default:return!HC(e,t)}}(c,a,a.routeConfig.runGuardsAndResolvers);p?i.canActivateChecks.push(new iP(r)):(a.data=c.data,a._resolvedData=c._resolvedData),by(e,t,a.component?d?d.children:null:n,r,i),p&&d&&d.outlet&&d.outlet.isActivated&&i.canDeactivateChecks.push(new x0(d.outlet.component,c))}else c&&xy(t,d,i),i.canActivateChecks.push(new iP(r)),by(e,null,a.component?d?d.children:null:n,r,i)})(c,a[c.value.outlet],n,r.concat([c.value]),i),delete a[c.value.outlet]}),Eo(a,(c,d)=>xy(c,n.getContext(d),i)),i}function xy(e,t,n){const r=Xp(e),i=e.value;Eo(r,(a,c)=>{xy(a,i.component?t?t.children.getContext(c):null:t,n)}),n.canDeactivateChecks.push(new x0(i.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,i))}function wy(e){return"function"==typeof e}function XC(e){return e instanceof u0||"EmptyError"===e?.name}const w0=Symbol("INITIAL_VALUE");function Kp(){return fc(e=>_k(e.map(t=>t.pipe(uy(1),function N9(...e){const t=lr(e);return yr((n,r)=>{(t?TC(e,n,t):TC(e,n)).subscribe(r)})}(w0)))).pipe(Pe(t=>{for(const n of t)if(!0!==n){if(n===w0)return w0;if(!1===n||n instanceof rf)return n}return!0}),uu(t=>t!==w0),uy(1)))}function oP(e){return function Fa(...e){return Os(e)}(Uo(t=>{if(af(t))throw Kk(0,t)}),Pe(t=>!0===t))}const YC={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function sP(e,t,n,r,i){const a=KC(e,t,n);return a.matched?function aH(e,t,n,r){const i=t.canMatch;return i&&0!==i.length?Bt(i.map(c=>{const d=Yp(c,e);return Ph(function Yj(e){return e&&wy(e.canMatch)}(d)?d.canMatch(t,n):e.runInContext(()=>d(t,n)))})).pipe(Kp(),oP()):Bt(!0)}(r=nP(t,r),t,n).pipe(Pe(c=>!0===c?a:{...YC})):Bt(a)}function KC(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...YC}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const i=(t.matcher||j9)(n,e,t);if(!i)return{...YC};const a={};Eo(i.posParams,(d,p)=>{a[p]=d.path});const c=i.consumed.length>0?{...a,...i.consumed[i.consumed.length-1].parameters}:a;return{matched:!0,consumedSegments:i.consumed,remainingSegments:n.slice(i.consumed.length),parameters:c,positionalParamSegments:i.posParams??{}}}function C0(e,t,n,r,i="corrected"){if(n.length>0&&function uH(e,t,n){return n.some(r=>E0(e,t,r)&&Ea(r)!==vn)}(e,n,r)){const c=new En(t,function cH(e,t,n,r){const i={};i[vn]=r,r._sourceSegment=e,r._segmentIndexShift=t.length;for(const a of n)if(""===a.path&&Ea(a)!==vn){const c=new En([],{});c._sourceSegment=e,c._segmentIndexShift=t.length,i[Ea(a)]=c}return i}(e,t,r,new En(n,e.children)));return c._sourceSegment=e,c._segmentIndexShift=t.length,{segmentGroup:c,slicedSegments:[]}}if(0===n.length&&function hH(e,t,n){return n.some(r=>E0(e,t,r))}(e,n,r)){const c=new En(e.segments,function lH(e,t,n,r,i,a){const c={};for(const d of r)if(E0(e,n,d)&&!i[Ea(d)]){const p=new En([],{});p._sourceSegment=e,p._segmentIndexShift="legacy"===a?e.segments.length:t.length,c[Ea(d)]=p}return{...i,...c}}(e,t,n,r,e.children,i));return c._sourceSegment=e,c._segmentIndexShift=t.length,{segmentGroup:c,slicedSegments:n}}const a=new En(e.segments,e.children);return a._sourceSegment=e,a._segmentIndexShift=t.length,{segmentGroup:a,slicedSegments:n}}function E0(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function aP(e,t,n,r){return!!(Ea(e)===r||r!==vn&&E0(t,n,e))&&("**"===e.path||KC(t,e,n).matched)}function lP(e,t,n){return 0===t.length&&!e.children[n]}const D0=!1;class S0{constructor(t){this.segmentGroup=t||null}}class cP{constructor(t){this.urlTree=t}}function Cy(e){return cy(new S0(e))}function uP(e){return cy(new cP(e))}class mH{constructor(t,n,r,i,a){this.injector=t,this.configLoader=n,this.urlSerializer=r,this.urlTree=i,this.config=a,this.allowRedirects=!0}apply(){const t=C0(this.urlTree.root,[],[],this.config).segmentGroup,n=new En(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,n,vn).pipe(Pe(a=>this.createUrlTree(y0(a),this.urlTree.queryParams,this.urlTree.fragment))).pipe(kh(a=>{if(a instanceof cP)return this.allowRedirects=!1,this.match(a.urlTree);throw a instanceof S0?this.noMatchError(a):a}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,vn).pipe(Pe(i=>this.createUrlTree(y0(i),t.queryParams,t.fragment))).pipe(kh(i=>{throw i instanceof S0?this.noMatchError(i):i}))}noMatchError(t){return new nt(4002,D0)}createUrlTree(t,n,r){const i=OC(t);return new rf(i,n,r)}expandSegmentGroup(t,n,r,i){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(t,n,r).pipe(Pe(a=>new En([],a))):this.expandSegment(t,r,n,r.segments,i,!0)}expandChildren(t,n,r){const i=[];for(const a of Object.keys(r.children))"primary"===a?i.unshift(a):i.push(a);return Cr(i).pipe(Ah(a=>{const c=r.children[a],d=rP(n,a);return this.expandSegmentGroup(t,d,c,a).pipe(Pe(p=>({segment:p,outlet:a})))}),Ck((a,c)=>(a[c.outlet]=c.segment,a),{}),Ek())}expandSegment(t,n,r,i,a,c){return Cr(r).pipe(Ah(d=>this.expandSegmentAgainstRoute(t,n,r,d,i,a,c).pipe(kh(v=>{if(v instanceof S0)return Bt(null);throw v}))),Ih(d=>!!d),kh((d,p)=>{if(XC(d))return lP(n,i,a)?Bt(new En([],{})):Cy(n);throw d}))}expandSegmentAgainstRoute(t,n,r,i,a,c,d){return aP(i,n,a,c)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(t,n,i,a,c):d&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,n,r,i,a,c):Cy(n):Cy(n)}expandSegmentAgainstRouteUsingRedirect(t,n,r,i,a,c){return"**"===i.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,r,i,c):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,r,i,a,c)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,i){const a=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?uP(a):this.lineralizeSegments(r,a).pipe(ht(c=>{const d=new En(c,{});return this.expandSegment(t,d,n,c,i,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,r,i,a,c){const{matched:d,consumedSegments:p,remainingSegments:v,positionalParamSegments:E}=KC(n,i,a);if(!d)return Cy(n);const D=this.applyRedirectCommands(p,i.redirectTo,E);return i.redirectTo.startsWith("/")?uP(D):this.lineralizeSegments(i,D).pipe(ht(T=>this.expandSegment(t,n,r,T.concat(v),c,!1)))}matchSegmentAgainstRoute(t,n,r,i,a){return"**"===r.path?(t=nP(r,t),r.loadChildren?(r._loadedRoutes?Bt({routes:r._loadedRoutes,injector:r._loadedInjector}):this.configLoader.loadChildren(t,r)).pipe(Pe(d=>(r._loadedRoutes=d.routes,r._loadedInjector=d.injector,new En(i,{})))):Bt(new En(i,{}))):sP(n,r,i,t).pipe(fc(({matched:c,consumedSegments:d,remainingSegments:p})=>c?this.getChildConfig(t=r._injector??t,r,i).pipe(ht(E=>{const D=E.injector??t,T=E.routes,{segmentGroup:P,slicedSegments:N}=C0(n,d,p,T),G=new En(P.segments,P.children);if(0===N.length&&G.hasChildren())return this.expandChildren(D,T,G).pipe(Pe(X=>new En(d,X)));if(0===T.length&&0===N.length)return Bt(new En(d,{}));const U=Ea(r)===a;return this.expandSegment(D,G,T,N,U?vn:a,!0).pipe(Pe(ne=>new En(d.concat(ne.segments),ne.children)))})):Cy(n)))}getChildConfig(t,n,r){return n.children?Bt({routes:n.children,injector:t}):n.loadChildren?void 0!==n._loadedRoutes?Bt({routes:n._loadedRoutes,injector:n._loadedInjector}):function sH(e,t,n,r){const i=t.canLoad;return void 0===i||0===i.length?Bt(!0):Bt(i.map(c=>{const d=Yp(c,e);return Ph(function qj(e){return e&&wy(e.canLoad)}(d)?d.canLoad(t,n):e.runInContext(()=>d(t,n)))})).pipe(Kp(),oP())}(t,n,r).pipe(ht(i=>i?this.configLoader.loadChildren(t,n).pipe(Uo(a=>{n._loadedRoutes=a.routes,n._loadedInjector=a.injector})):function fH(e){return cy(Jk(D0,3))}())):Bt({routes:[],injector:t})}lineralizeSegments(t,n){let r=[],i=n.root;for(;;){if(r=r.concat(i.segments),0===i.numberOfChildren)return Bt(r);if(i.numberOfChildren>1||!i.children[vn])return cy(new nt(4e3,D0));i=i.children[vn]}}applyRedirectCommands(t,n,r){return this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),t,r)}applyRedirectCreateUrlTree(t,n,r,i){const a=this.createSegmentGroup(t,n.root,r,i);return new rf(a,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const r={};return Eo(t,(i,a)=>{if("string"==typeof i&&i.startsWith(":")){const d=i.substring(1);r[a]=n[d]}else r[a]=i}),r}createSegmentGroup(t,n,r,i){const a=this.createSegments(t,n.segments,r,i);let c={};return Eo(n.children,(d,p)=>{c[p]=this.createSegmentGroup(t,d,r,i)}),new En(a,c)}createSegments(t,n,r,i){return n.map(a=>a.path.startsWith(":")?this.findPosParam(t,a,i):this.findOrReturn(a,r))}findPosParam(t,n,r){const i=r[n.path.substring(1)];if(!i)throw new nt(4001,D0);return i}findOrReturn(t,n){let r=0;for(const i of n){if(i.path===t.path)return n.splice(r),i;r++}return t}}class yH{}class bH{constructor(t,n,r,i,a,c,d,p){this.injector=t,this.rootComponentType=n,this.config=r,this.urlTree=i,this.url=a,this.paramsInheritanceStrategy=c,this.relativeLinkResolution=d,this.urlSerializer=p}recognize(){const t=C0(this.urlTree.root,[],[],this.config.filter(n=>void 0===n.redirectTo),this.relativeLinkResolution).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,vn).pipe(Pe(n=>{if(null===n)return null;const r=new v0([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},vn,this.rootComponentType,null,this.urlTree.root,-1,{}),i=new du(r,n),a=new Xk(this.url,i);return this.inheritParamsAndData(a._root),a}))}inheritParamsAndData(t){const n=t.value,r=Wk(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),t.children.forEach(i=>this.inheritParamsAndData(i))}processSegmentGroup(t,n,r,i){return 0===r.segments.length&&r.hasChildren()?this.processChildren(t,n,r):this.processSegment(t,n,r,r.segments,i)}processChildren(t,n,r){return Cr(Object.keys(r.children)).pipe(Ah(i=>{const a=r.children[i],c=rP(n,i);return this.processSegmentGroup(t,c,a,i)}),Ck((i,a)=>i&&a?(i.push(...a),i):null),function V9(e,t=!1){return yr((n,r)=>{let i=0;n.subscribe(tr(r,a=>{const c=e(a,i++);(c||t)&&r.next(a),!c&&r.complete()}))})}(i=>null!==i),h0(null),Ek(),Pe(i=>{if(null===i)return null;const a=hP(i);return function xH(e){e.sort((t,n)=>t.value.outlet===vn?-1:n.value.outlet===vn?1:t.value.outlet.localeCompare(n.value.outlet))}(a),a}))}processSegment(t,n,r,i,a){return Cr(n).pipe(Ah(c=>this.processSegmentAgainstRoute(c._injector??t,c,r,i,a)),Ih(c=>!!c),kh(c=>{if(XC(c))return lP(r,i,a)?Bt([]):Bt(null);throw c}))}processSegmentAgainstRoute(t,n,r,i,a){if(n.redirectTo||!aP(n,r,i,a))return Bt(null);let c;if("**"===n.path){const d=i.length>0?Mk(i).parameters:{},p=fP(r)+i.length;c=Bt({snapshot:new v0(i,d,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,mP(n),Ea(n),n.component??n._loadedComponent??null,n,dP(r),p,gP(n),p),consumedSegments:[],remainingSegments:[]})}else c=sP(r,n,i,t).pipe(Pe(({matched:d,consumedSegments:p,remainingSegments:v,parameters:E})=>{if(!d)return null;const D=fP(r)+p.length;return{snapshot:new v0(p,E,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,mP(n),Ea(n),n.component??n._loadedComponent??null,n,dP(r),D,gP(n),D),consumedSegments:p,remainingSegments:v}}));return c.pipe(fc(d=>{if(null===d)return Bt(null);const{snapshot:p,consumedSegments:v,remainingSegments:E}=d;t=n._injector??t;const D=n._loadedInjector??t,T=function wH(e){return e.children?e.children:e.loadChildren?e._loadedRoutes:[]}(n),{segmentGroup:P,slicedSegments:N}=C0(r,v,E,T.filter(U=>void 0===U.redirectTo),this.relativeLinkResolution);if(0===N.length&&P.hasChildren())return this.processChildren(D,T,P).pipe(Pe(U=>null===U?null:[new du(p,U)]));if(0===T.length&&0===N.length)return Bt([new du(p,[])]);const G=Ea(n)===a;return this.processSegment(D,T,P,N,G?vn:a).pipe(Pe(U=>null===U?null:[new du(p,U)]))}))}}function CH(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function hP(e){const t=[],n=new Set;for(const r of e){if(!CH(r)){t.push(r);continue}const i=t.find(a=>r.value.routeConfig===a.value.routeConfig);void 0!==i?(i.children.push(...r.children),n.add(i)):t.push(r)}for(const r of n){const i=hP(r.children);t.push(new du(r.value,i))}return t.filter(r=>!n.has(r))}function dP(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function fP(e){let t=e,n=t._segmentIndexShift??0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift??0;return n-1}function mP(e){return e.data||{}}function gP(e){return e.resolve||{}}function yP(e){return"string"==typeof e.title||null===e.title}function JC(e){return fc(t=>{const n=e(t);return n?Cr(n).pipe(Pe(()=>t)):Bt(t)})}let _P=(()=>{class e{buildTitle(n){let r,i=n.root;for(;void 0!==i;)r=this.getResolvedTitleForRoute(i)??r,i=i.children.find(a=>a.outlet===vn);return r}getResolvedTitleForRoute(n){return n.data[hy]}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:function(){return Or(vP)},providedIn:"root"}),e})(),vP=(()=>{class e extends _P{constructor(n){super(),this.title=n}updateTitle(n){const r=this.buildTitle(n);void 0!==r&&this.title.setTitle(r)}}return e.\u0275fac=function(n){return new(n||e)(St(dk))},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class kH{}class RH extends class PH{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}{}const T0=new Tt("",{providedIn:"root",factory:()=>({})}),QC=new Tt("ROUTES");let eE=(()=>{class e{constructor(n,r){this.injector=n,this.compiler=r,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Bt(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const r=Ph(n.loadComponent()).pipe(Uo(a=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=a}),kC(()=>{this.componentLoaders.delete(n)})),i=new xk(r,()=>new pi).pipe(IC());return this.componentLoaders.set(n,i),i}loadChildren(n,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Bt({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const a=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe(Pe(d=>{this.onLoadEndListener&&this.onLoadEndListener(r);let p,v,E=!1;Array.isArray(d)?v=d:(p=d.create(n).injector,v=Sk(p.get(QC,[],Rt.Self|Rt.Optional)));return{routes:v.map(WC),injector:p}}),kC(()=>{this.childrenLoaders.delete(r)})),c=new xk(a,()=>new pi).pipe(IC());return this.childrenLoaders.set(r,c),c}loadModuleFactoryOrRoutes(n){return Ph(n()).pipe(ht(r=>r instanceof sI||Array.isArray(r)?Bt(r):Cr(this.compiler.compileModuleAsync(r))))}}return e.\u0275fac=function(n){return new(n||e)(St(Zs),St(Uw))},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class OH{}class LH{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,n){return t}}function NH(e){throw e}function zH(e,t,n){return t.parse("/")}const BH={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},VH={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function xP(){const e=Or(Rk),t=Or(_y),n=Or(nC),r=Or(Zs),i=Or(Uw),a=Or(QC,{optional:!0})??[],c=Or(T0,{optional:!0})??{},d=Or(vP),p=Or(_P,{optional:!0}),v=Or(OH,{optional:!0}),E=Or(kH,{optional:!0}),D=new Do(null,e,t,n,r,i,Sk(a));return v&&(D.urlHandlingStrategy=v),E&&(D.routeReuseStrategy=E),D.titleStrategy=p??d,function UH(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy),e.canceledNavigationResolution&&(t.canceledNavigationResolution=e.canceledNavigationResolution)}(c,D),D}let Do=(()=>{class e{constructor(n,r,i,a,c,d,p){this.rootComponentType=n,this.urlSerializer=r,this.rootContexts=i,this.location=a,this.config=p,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new pi,this.errorHandler=NH,this.malformedUriErrorHandler=zH,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>Bt(void 0),this.urlHandlingStrategy=new LH,this.routeReuseStrategy=new RH,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=c.get(eE),this.configLoader.onLoadEndListener=T=>this.triggerEvent(new wj(T)),this.configLoader.onLoadStartListener=T=>this.triggerEvent(new xj(T)),this.ngModule=c.get(Qd),this.console=c.get(gU);const D=c.get(Oi);this.isNgZoneEnabled=D instanceof Oi&&Oi.isInAngularZone(),this.resetConfig(p),this.currentUrlTree=function G9(){return new rf(new En([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=Zk(this.currentUrlTree,this.rootComponentType),this.transitions=new _l({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(n){const r=this.events;return n.pipe(uu(i=>0!==i.id),Pe(i=>({...i,extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),fc(i=>{let a=!1,c=!1;return Bt(i).pipe(Uo(d=>{this.currentNavigation={id:d.id,initialUrl:d.rawUrl,extractedUrl:d.extractedUrl,trigger:d.source,extras:d.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),fc(d=>{const p=this.browserUrlTree.toString(),v=!this.navigated||d.extractedUrl.toString()!==p||p!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||v)&&this.urlHandlingStrategy.shouldProcessUrl(d.rawUrl))return wP(d.source)&&(this.browserUrlTree=d.extractedUrl),Bt(d).pipe(fc(D=>{const T=this.transitions.getValue();return r.next(new BC(D.id,this.serializeUrl(D.extractedUrl),D.source,D.restoredState)),T!==this.transitions.getValue()?xt:Promise.resolve(D)}),function gH(e,t,n,r){return fc(i=>function pH(e,t,n,r,i){return new mH(e,t,n,r,i).apply()}(e,t,n,i.extractedUrl,r).pipe(Pe(a=>({...i,urlAfterRedirects:a}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Uo(D=>{this.currentNavigation={...this.currentNavigation,finalUrl:D.urlAfterRedirects},i.urlAfterRedirects=D.urlAfterRedirects}),function DH(e,t,n,r,i,a){return ht(c=>function vH(e,t,n,r,i,a,c="emptyOnly",d="legacy"){return new bH(e,t,n,r,i,c,d,a).recognize().pipe(fc(p=>null===p?function _H(e){return new Bn(t=>t.error(e))}(new yH):Bt(p)))}(e,t,n,c.urlAfterRedirects,r.serialize(c.urlAfterRedirects),r,i,a).pipe(Pe(d=>({...c,targetSnapshot:d}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy,this.relativeLinkResolution),Uo(D=>{if(i.targetSnapshot=D.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!D.extras.skipLocationChange){const P=this.urlHandlingStrategy.merge(D.urlAfterRedirects,D.rawUrl);this.setBrowserUrl(P,D)}this.browserUrlTree=D.urlAfterRedirects}const T=new gj(D.id,this.serializeUrl(D.extractedUrl),this.serializeUrl(D.urlAfterRedirects),D.targetSnapshot);r.next(T)}));if(v&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:T,extractedUrl:P,source:N,restoredState:G,extras:U}=d,Z=new BC(T,this.serializeUrl(P),N,G);r.next(Z);const ne=Zk(P,this.rootComponentType).snapshot;return Bt(i={...d,targetSnapshot:ne,urlAfterRedirects:P,extras:{...U,skipLocationChange:!1,replaceUrl:!1}})}return this.rawUrlTree=d.rawUrl,d.resolve(null),xt}),Uo(d=>{const p=new yj(d.id,this.serializeUrl(d.extractedUrl),this.serializeUrl(d.urlAfterRedirects),d.targetSnapshot);this.triggerEvent(p)}),Pe(d=>i={...d,guards:Uj(d.targetSnapshot,d.currentSnapshot,this.rootContexts)}),function Jj(e,t){return ht(n=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:a,canDeactivateChecks:c}}=n;return 0===c.length&&0===a.length?Bt({...n,guardsResult:!0}):function Qj(e,t,n,r){return Cr(e).pipe(ht(i=>function oH(e,t,n,r,i){const a=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return a&&0!==a.length?Bt(a.map(d=>{const p=vy(t)??i,v=Yp(d,p);return Ph(function Xj(e){return e&&wy(e.canDeactivate)}(v)?v.canDeactivate(e,t,n,r):p.runInContext(()=>v(e,t,n,r))).pipe(Ih())})).pipe(Kp()):Bt(!0)}(i.component,i.route,n,t,r)),Ih(i=>!0!==i,!0))}(c,r,i,e).pipe(ht(d=>d&&function Gj(e){return"boolean"==typeof e}(d)?function eH(e,t,n,r){return Cr(t).pipe(Ah(i=>TC(function nH(e,t){return null!==e&&t&&t(new Cj(e)),Bt(!0)}(i.route.parent,r),function tH(e,t){return null!==e&&t&&t(new Dj(e)),Bt(!0)}(i.route,r),function iH(e,t,n){const r=t[t.length-1],a=t.slice(0,t.length-1).reverse().map(c=>function $j(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(c)).filter(c=>null!==c).map(c=>bk(()=>Bt(c.guards.map(p=>{const v=vy(c.node)??n,E=Yp(p,v);return Ph(function Wj(e){return e&&wy(e.canActivateChild)}(E)?E.canActivateChild(r,e):v.runInContext(()=>E(r,e))).pipe(Ih())})).pipe(Kp())));return Bt(a).pipe(Kp())}(e,i.path,n),function rH(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;if(!r||0===r.length)return Bt(!0);const i=r.map(a=>bk(()=>{const c=vy(t)??n,d=Yp(a,c);return Ph(function Zj(e){return e&&wy(e.canActivate)}(d)?d.canActivate(t,e):c.runInContext(()=>d(t,e))).pipe(Ih())}));return Bt(i).pipe(Kp())}(e,i.route,n))),Ih(i=>!0!==i,!0))}(r,a,e,t):Bt(d)),Pe(d=>({...n,guardsResult:d})))})}(this.ngModule.injector,d=>this.triggerEvent(d)),Uo(d=>{if(i.guardsResult=d.guardsResult,af(d.guardsResult))throw Kk(0,d.guardsResult);const p=new _j(d.id,this.serializeUrl(d.extractedUrl),this.serializeUrl(d.urlAfterRedirects),d.targetSnapshot,!!d.guardsResult);this.triggerEvent(p)}),uu(d=>!!d.guardsResult||(this.restoreHistory(d),this.cancelNavigationTransition(d,"",3),!1)),JC(d=>{if(d.guards.canActivateChecks.length)return Bt(d).pipe(Uo(p=>{const v=new vj(p.id,this.serializeUrl(p.extractedUrl),this.serializeUrl(p.urlAfterRedirects),p.targetSnapshot);this.triggerEvent(v)}),fc(p=>{let v=!1;return Bt(p).pipe(function SH(e,t){return ht(n=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=n;if(!i.length)return Bt(n);let a=0;return Cr(i).pipe(Ah(c=>function MH(e,t,n,r){const i=e.routeConfig,a=e._resolve;return void 0!==i?.title&&!yP(i)&&(a[hy]=i.title),function TH(e,t,n,r){const i=function IH(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===i.length)return Bt({});const a={};return Cr(i).pipe(ht(c=>function AH(e,t,n,r){const i=vy(t)??r,a=Yp(e,i);return Ph(a.resolve?a.resolve(t,n):i.runInContext(()=>a(t,n)))}(e[c],t,n,r).pipe(Ih(),Uo(d=>{a[c]=d}))),AC(1),function U9(e){return Pe(()=>e)}(a),kh(c=>XC(c)?xt:cy(c)))}(a,e,t,r).pipe(Pe(c=>(e._resolvedData=c,e.data=Wk(e,n).resolve,i&&yP(i)&&(e.data[hy]=i.title),null)))}(c.route,r,e,t)),Uo(()=>a++),AC(1),ht(c=>a===i.length?Bt(n):xt))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Uo({next:()=>v=!0,complete:()=>{v||(this.restoreHistory(p),this.cancelNavigationTransition(p,"",2))}}))}),Uo(p=>{const v=new bj(p.id,this.serializeUrl(p.extractedUrl),this.serializeUrl(p.urlAfterRedirects),p.targetSnapshot);this.triggerEvent(v)}))}),JC(d=>{const p=v=>{const E=[];v.routeConfig?.loadComponent&&!v.routeConfig._loadedComponent&&E.push(this.configLoader.loadComponent(v.routeConfig).pipe(Uo(D=>{v.component=D}),Pe(()=>{})));for(const D of v.children)E.push(...p(D));return E};return _k(p(d.targetSnapshot.root)).pipe(h0(),uy(1))}),JC(()=>this.afterPreactivation()),Pe(d=>{const p=function Aj(e,t,n){const r=yy(e,t._root,n?n._root:void 0);return new qk(r,t)}(this.routeReuseStrategy,d.targetSnapshot,d.currentRouterState);return i={...d,targetRouterState:p}}),Uo(d=>{this.currentUrlTree=d.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(d.urlAfterRedirects,d.rawUrl),this.routerState=d.targetRouterState,"deferred"===this.urlUpdateStrategy&&(d.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,d),this.browserUrlTree=d.urlAfterRedirects)}),((e,t,n)=>Pe(r=>(new Vj(t,r.targetRouterState,r.currentRouterState,n).activate(e),r)))(this.rootContexts,this.routeReuseStrategy,d=>this.triggerEvent(d)),Uo({next(){a=!0},complete(){a=!0}}),kC(()=>{a||c||this.cancelNavigationTransition(i,"",1),this.currentNavigation?.id===i.id&&(this.currentNavigation=null)}),kh(d=>{if(c=!0,eP(d)){Qk(d)||(this.navigated=!0,this.restoreHistory(i,!0));const p=new _0(i.id,this.serializeUrl(i.extractedUrl),d.message,d.cancellationCode);if(r.next(p),Qk(d)){const v=this.urlHandlingStrategy.merge(d.url,this.rawUrlTree),E={skipLocationChange:i.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||wP(i.source)};this.scheduleNavigation(v,"imperative",null,E,{resolve:i.resolve,reject:i.reject,promise:i.promise})}else i.resolve(!1)}else{this.restoreHistory(i,!0);const p=new jk(i.id,this.serializeUrl(i.extractedUrl),d,i.targetSnapshot??void 0);r.next(p);try{i.resolve(this.errorHandler(d))}catch(v){i.reject(v)}}return xt}))}))}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}setTransition(n){this.transitions.next({...this.transitions.value,...n})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const r="popstate"===n.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{const i={replaceUrl:!0},a=n.state?.navigationId?n.state:null;if(a){const d={...a};delete d.navigationId,delete d.\u0275routerPageId,0!==Object.keys(d).length&&(i.state=d)}const c=this.parseUrl(n.url);this.scheduleNavigation(c,r,a,i)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(n){this.events.next(n)}resetConfig(n){this.config=n.map(WC),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,r={}){const{relativeTo:i,queryParams:a,fragment:c,queryParamsHandling:d,preserveFragment:p}=r,v=i||this.routerState.root,E=p?this.currentUrlTree.fragment:c;let D=null;switch(d){case"merge":D={...this.currentUrlTree.queryParams,...a};break;case"preserve":D=this.currentUrlTree.queryParams;break;default:D=a||null}return null!==D&&(D=this.removeEmptyProps(D)),uj(v,this.currentUrlTree,n,D,E??null)}navigateByUrl(n,r={skipLocationChange:!1}){const i=af(n)?n:this.parseUrl(n),a=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(a,"imperative",null,r)}navigate(n,r={skipLocationChange:!1}){return function $H(e){for(let t=0;t<e.length;t++){if(null==e[t])throw new nt(4008,false)}}(n),this.navigateByUrl(this.createUrlTree(n,r),r)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let r;try{r=this.urlSerializer.parse(n)}catch(i){r=this.malformedUriErrorHandler(i,this.urlSerializer,n)}return r}isActive(n,r){let i;if(i=!0===r?{...BH}:!1===r?{...VH}:r,af(n))return Ik(this.currentUrlTree,n,i);const a=this.parseUrl(n);return Ik(this.currentUrlTree,a,i)}removeEmptyProps(n){return Object.keys(n).reduce((r,i)=>{const a=n[i];return null!=a&&(r[i]=a),r},{})}processNavigations(){this.navigations.subscribe(n=>{this.navigated=!0,this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId,this.events.next(new lf(n.id,this.serializeUrl(n.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.titleStrategy?.updateTitle(this.routerState.snapshot),n.resolve(!0)},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}scheduleNavigation(n,r,i,a,c){if(this.disposed)return Promise.resolve(!1);let d,p,v;c?(d=c.resolve,p=c.reject,v=c.promise):v=new Promise((T,P)=>{d=T,p=P});const E=++this.navigationId;let D;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(i=this.location.getState()),D=i&&i.\u0275routerPageId?i.\u0275routerPageId:a.replaceUrl||a.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):D=0,this.setTransition({id:E,targetPageId:D,source:r,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:n,extras:a,resolve:d,reject:p,promise:v,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),v.catch(T=>Promise.reject(T))}setBrowserUrl(n,r){const i=this.urlSerializer.serialize(n),a={...r.extras.state,...this.generateNgRouterState(r.id,r.targetPageId)};this.location.isCurrentPathEqualTo(i)||r.extras.replaceUrl?this.location.replaceState(i,"",a):this.location.go(i,"",a)}restoreHistory(n,r=!1){if("computed"===this.canceledNavigationResolution){const i=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===i?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===i&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(i)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(n,r,i){const a=new _0(n.id,this.serializeUrl(n.extractedUrl),r,i);this.triggerEvent(a),n.resolve(!1)}generateNgRouterState(n,r){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:r}:{navigationId:n}}}return e.\u0275fac=function(n){V1()},e.\u0275prov=zt({token:e,factory:function(){return xP()},providedIn:"root"}),e})();function wP(e){return"imperative"!==e}class CP{}let GH=(()=>{class e{constructor(n,r,i,a,c){this.router=n,this.injector=i,this.preloadingStrategy=a,this.loader=c}setUpPreloading(){this.subscription=this.router.events.pipe(uu(n=>n instanceof lf),Ah(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,r){const i=[];for(const a of r){a.providers&&!a._injector&&(a._injector=Av(a.providers,n,`Route: ${a.path}`));const c=a._injector??n,d=a._loadedInjector??c;a.loadChildren&&!a._loadedRoutes&&void 0===a.canLoad||a.loadComponent&&!a._loadedComponent?i.push(this.preloadConfig(c,a)):(a.children||a._loadedRoutes)&&i.push(this.processRoutes(d,a.children??a._loadedRoutes))}return Cr(i).pipe(dt())}preloadConfig(n,r){return this.preloadingStrategy.preload(r,()=>{let i;i=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(n,r):Bt(null);const a=i.pipe(ht(c=>null===c?Bt(void 0):(r._loadedRoutes=c.routes,r._loadedInjector=c.injector,this.processRoutes(c.injector??n,c.routes))));return r.loadComponent&&!r._loadedComponent?Cr([a,this.loader.loadComponent(r)]).pipe(dt()):a})}}return e.\u0275fac=function(n){return new(n||e)(St(Do),St(Uw),St(Ms),St(CP),St(eE))},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const rE=new Tt("");let EP=(()=>{class e{constructor(n,r,i={}){this.router=n,this.viewportScroller=r,this.options=i,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},i.scrollPositionRestoration=i.scrollPositionRestoration||"disabled",i.anchorScrolling=i.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(n=>{n instanceof BC?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof lf&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.router.parseUrl(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(n=>{n instanceof Hk&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,r){this.router.triggerEvent(new Hk(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(n){V1()},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();function Jp(e,t){return{\u0275kind:e,\u0275providers:t}}function iE(e){return[{provide:QC,multi:!0,useValue:e}]}function SP(){const e=Or(Zs);return t=>{const n=e.get(Vv);if(t!==n.components[0])return;const r=e.get(Do),i=e.get(MP);1===e.get(oE)&&r.initialNavigation(),e.get(TP,null,Rt.Optional)?.setUpPreloading(),e.get(rE,null,Rt.Optional)?.init(),r.resetRootComponentType(n.componentTypes[0]),i.closed||(i.next(),i.unsubscribe())}}const MP=new Tt("",{factory:()=>new pi}),oE=new Tt("",{providedIn:"root",factory:()=>1});const TP=new Tt("");function XH(e){return Jp(0,[{provide:TP,useExisting:GH},{provide:CP,useExisting:e}])}const IP=new Tt("ROUTER_FORROOT_GUARD"),YH=[nC,{provide:Rk,useClass:RC},{provide:Do,useFactory:xP},_y,{provide:cf,useFactory:function DP(e){return e.routerState.root},deps:[Do]},eE];function KH(){return new tA("Router",Do)}let AP=(()=>{class e{constructor(n){}static forRoot(n,r){return{ngModule:e,providers:[YH,[],iE(n),{provide:IP,useFactory:tG,deps:[[Do,new Fd,new Ir]]},{provide:T0,useValue:r||{}},r?.useHash?{provide:nf,useClass:i$}:{provide:nf,useClass:SA},{provide:rE,useFactory:()=>{const e=Or(Do),t=Or(x7),n=Or(T0);return n.scrollOffset&&t.setOffset(n.scrollOffset),new EP(e,t,n)}},r?.preloadingStrategy?XH(r.preloadingStrategy).\u0275providers:[],{provide:tA,multi:!0,useFactory:KH},r?.initialNavigation?nG(r):[],[{provide:kP,useFactory:SP},{provide:WI,multi:!0,useExisting:kP}]]}}static forChild(n){return{ngModule:e,providers:[iE(n)]}}}return e.\u0275fac=function(n){return new(n||e)(St(IP,8))},e.\u0275mod=li({type:e}),e.\u0275inj=Di({imports:[qC]}),e})();function tG(e){return"guarded"}function nG(e){return["disabled"===e.initialNavigation?Jp(3,[{provide:Nv,multi:!0,useFactory:()=>{const t=Or(Do);return()=>{t.setUpLocationChangeListener()}}},{provide:oE,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Jp(2,[{provide:oE,useValue:0},{provide:Nv,multi:!0,deps:[Zs],useFactory:t=>{const n=t.get(n$,Promise.resolve());let r=!1;return()=>n.then(()=>new Promise(a=>{const c=t.get(Do),d=t.get(MP);(function i(a){t.get(Do).events.pipe(uu(d=>d instanceof lf||d instanceof _0||d instanceof jk),Pe(d=>d instanceof lf||d instanceof _0&&(0===d.code||1===d.code)&&null),uu(d=>null!==d),uy(1)).subscribe(()=>{a()})})(()=>{a(!0),r=!0}),c.afterPreactivation=()=>(a(!0),r||d.closed?Bt(void 0):d),c.initialNavigation()}))}}]).\u0275providers:[]]}const kP=new Tt(""),iG=[];let oG=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=li({type:e}),e.\u0275inj=Di({imports:[AP.forRoot(iG),AP]}),e})();class PP{}class RP{}class mc{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(n=>{const r=n.indexOf(":");if(r>0){const i=n.slice(0,r),a=i.toLowerCase(),c=n.slice(r+1).trim();this.maybeSetNormalizedName(i,a),this.headers.has(a)?this.headers.get(a).push(c):this.headers.set(a,[c])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(n=>{let r=t[n];const i=n.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(i,r),this.maybeSetNormalizedName(n,i))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const n=this.headers.get(t.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,n){return this.clone({name:t,value:n,op:"a"})}set(t,n){return this.clone({name:t,value:n,op:"s"})}delete(t,n){return this.clone({name:t,value:n,op:"d"})}maybeSetNormalizedName(t,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,t)}init(){this.lazyInit&&(this.lazyInit instanceof mc?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(n=>{this.headers.set(n,t.headers.get(n)),this.normalizedNames.set(n,t.normalizedNames.get(n))})}clone(t){const n=new mc;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof mc?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([t]),n}applyUpdate(t){const n=t.name.toLowerCase();switch(t.op){case"a":case"s":let r=t.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(t.name,n);const i=("a"===t.op?this.headers.get(n):void 0)||[];i.push(...r),this.headers.set(n,i);break;case"d":const a=t.value;if(a){let c=this.headers.get(n);if(!c)return;c=c.filter(d=>-1===a.indexOf(d)),0===c.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,c)}else this.headers.delete(n),this.normalizedNames.delete(n)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>t(this.normalizedNames.get(n),this.headers.get(n)))}}class sG{encodeKey(t){return FP(t)}encodeValue(t){return FP(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const lG=/%(\d[a-f0-9])/gi,cG={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function FP(e){return encodeURIComponent(e).replace(lG,(t,n)=>cG[n]??t)}function P0(e){return`${e}`}class fu{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new sG,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function aG(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(i=>{const a=i.indexOf("="),[c,d]=-1==a?[t.decodeKey(i),""]:[t.decodeKey(i.slice(0,a)),t.decodeValue(i.slice(a+1))],p=n.get(c)||[];p.push(d),n.set(c,p)}),n}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(n=>{const r=t.fromObject[n],i=Array.isArray(r)?r.map(P0):[P0(r)];this.map.set(n,i)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const n=this.map.get(t);return n?n[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,n){return this.clone({param:t,value:n,op:"a"})}appendAll(t){const n=[];return Object.keys(t).forEach(r=>{const i=t[r];Array.isArray(i)?i.forEach(a=>{n.push({param:r,value:a,op:"a"})}):n.push({param:r,value:i,op:"a"})}),this.clone(n)}set(t,n){return this.clone({param:t,value:n,op:"s"})}delete(t,n){return this.clone({param:t,value:n,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const n=this.encoder.encodeKey(t);return this.map.get(t).map(r=>n+"="+this.encoder.encodeValue(r)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const n=new fu({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(t),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const n=("a"===t.op?this.map.get(t.param):void 0)||[];n.push(P0(t.value)),this.map.set(t.param,n);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let r=this.map.get(t.param)||[];const i=r.indexOf(P0(t.value));-1!==i&&r.splice(i,1),r.length>0?this.map.set(t.param,r):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class R0{constructor(){this.map=new Map}set(t,n){return this.map.set(t,n),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function OP(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function LP(e){return typeof Blob<"u"&&e instanceof Blob}function NP(e){return typeof FormData<"u"&&e instanceof FormData}class Ey{constructor(t,n,r,i){let a;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function uG(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||i?(this.body=void 0!==r?r:null,a=i):a=r,a&&(this.reportProgress=!!a.reportProgress,this.withCredentials=!!a.withCredentials,a.responseType&&(this.responseType=a.responseType),a.headers&&(this.headers=a.headers),a.context&&(this.context=a.context),a.params&&(this.params=a.params)),this.headers||(this.headers=new mc),this.context||(this.context=new R0),this.params){const c=this.params.toString();if(0===c.length)this.urlWithParams=n;else{const d=n.indexOf("?");this.urlWithParams=n+(-1===d?"?":d<n.length-1?"&":"")+c}}else this.params=new fu,this.urlWithParams=n}serializeBody(){return null===this.body?null:OP(this.body)||LP(this.body)||NP(this.body)||function hG(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof fu?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||NP(this.body)?null:LP(this.body)?this.body.type||null:OP(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof fu?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){const n=t.method||this.method,r=t.url||this.url,i=t.responseType||this.responseType,a=void 0!==t.body?t.body:this.body,c=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,d=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let p=t.headers||this.headers,v=t.params||this.params;const E=t.context??this.context;return void 0!==t.setHeaders&&(p=Object.keys(t.setHeaders).reduce((D,T)=>D.set(T,t.setHeaders[T]),p)),t.setParams&&(v=Object.keys(t.setParams).reduce((D,T)=>D.set(T,t.setParams[T]),v)),new Ey(n,r,a,{params:v,headers:p,context:E,reportProgress:d,responseType:i,withCredentials:c})}}var xi=(()=>((xi=xi||{})[xi.Sent=0]="Sent",xi[xi.UploadProgress=1]="UploadProgress",xi[xi.ResponseHeader=2]="ResponseHeader",xi[xi.DownloadProgress=3]="DownloadProgress",xi[xi.Response=4]="Response",xi[xi.User=5]="User",xi))();class aE{constructor(t,n=200,r="OK"){this.headers=t.headers||new mc,this.status=void 0!==t.status?t.status:n,this.statusText=t.statusText||r,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class lE extends aE{constructor(t={}){super(t),this.type=xi.ResponseHeader}clone(t={}){return new lE({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class F0 extends aE{constructor(t={}){super(t),this.type=xi.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new F0({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class zP extends aE{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function cE(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let BP=(()=>{class e{constructor(n){this.handler=n}request(n,r,i={}){let a;if(n instanceof Ey)a=n;else{let p,v;p=i.headers instanceof mc?i.headers:new mc(i.headers),i.params&&(v=i.params instanceof fu?i.params:new fu({fromObject:i.params})),a=new Ey(n,r,void 0!==i.body?i.body:null,{headers:p,context:i.context,params:v,reportProgress:i.reportProgress,responseType:i.responseType||"json",withCredentials:i.withCredentials})}const c=Bt(a).pipe(Ah(p=>this.handler.handle(p)));if(n instanceof Ey||"events"===i.observe)return c;const d=c.pipe(uu(p=>p instanceof F0));switch(i.observe||"body"){case"body":switch(a.responseType){case"arraybuffer":return d.pipe(Pe(p=>{if(null!==p.body&&!(p.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return p.body}));case"blob":return d.pipe(Pe(p=>{if(null!==p.body&&!(p.body instanceof Blob))throw new Error("Response is not a Blob.");return p.body}));case"text":return d.pipe(Pe(p=>{if(null!==p.body&&"string"!=typeof p.body)throw new Error("Response is not a string.");return p.body}));default:return d.pipe(Pe(p=>p.body))}case"response":return d;default:throw new Error(`Unreachable: unhandled observe type ${i.observe}}`)}}delete(n,r={}){return this.request("DELETE",n,r)}get(n,r={}){return this.request("GET",n,r)}head(n,r={}){return this.request("HEAD",n,r)}jsonp(n,r){return this.request("JSONP",n,{params:(new fu).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,r={}){return this.request("OPTIONS",n,r)}patch(n,r,i={}){return this.request("PATCH",n,cE(i,r))}post(n,r,i={}){return this.request("POST",n,cE(i,r))}put(n,r,i={}){return this.request("PUT",n,cE(i,r))}}return e.\u0275fac=function(n){return new(n||e)(St(PP))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();class VP{constructor(t,n){this.next=t,this.interceptor=n}handle(t){return this.interceptor.intercept(t,this.next)}}const UP=new Tt("HTTP_INTERCEPTORS");let dG=(()=>{class e{intercept(n,r){return r.handle(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();const fG=/^\)\]\}',?\n/;let $P=(()=>{class e{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Bn(r=>{const i=this.xhrFactory.build();if(i.open(n.method,n.urlWithParams),n.withCredentials&&(i.withCredentials=!0),n.headers.forEach((P,N)=>i.setRequestHeader(P,N.join(","))),n.headers.has("Accept")||i.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const P=n.detectContentTypeHeader();null!==P&&i.setRequestHeader("Content-Type",P)}if(n.responseType){const P=n.responseType.toLowerCase();i.responseType="json"!==P?P:"text"}const a=n.serializeBody();let c=null;const d=()=>{if(null!==c)return c;const P=i.statusText||"OK",N=new mc(i.getAllResponseHeaders()),G=function pG(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(i)||n.url;return c=new lE({headers:N,status:i.status,statusText:P,url:G}),c},p=()=>{let{headers:P,status:N,statusText:G,url:U}=d(),Z=null;204!==N&&(Z=typeof i.response>"u"?i.responseText:i.response),0===N&&(N=Z?200:0);let ne=N>=200&&N<300;if("json"===n.responseType&&"string"==typeof Z){const X=Z;Z=Z.replace(fG,"");try{Z=""!==Z?JSON.parse(Z):null}catch(re){Z=X,ne&&(ne=!1,Z={error:re,text:Z})}}ne?(r.next(new F0({body:Z,headers:P,status:N,statusText:G,url:U||void 0})),r.complete()):r.error(new zP({error:Z,headers:P,status:N,statusText:G,url:U||void 0}))},v=P=>{const{url:N}=d(),G=new zP({error:P,status:i.status||0,statusText:i.statusText||"Unknown Error",url:N||void 0});r.error(G)};let E=!1;const D=P=>{E||(r.next(d()),E=!0);let N={type:xi.DownloadProgress,loaded:P.loaded};P.lengthComputable&&(N.total=P.total),"text"===n.responseType&&!!i.responseText&&(N.partialText=i.responseText),r.next(N)},T=P=>{let N={type:xi.UploadProgress,loaded:P.loaded};P.lengthComputable&&(N.total=P.total),r.next(N)};return i.addEventListener("load",p),i.addEventListener("error",v),i.addEventListener("timeout",v),i.addEventListener("abort",v),n.reportProgress&&(i.addEventListener("progress",D),null!==a&&i.upload&&i.upload.addEventListener("progress",T)),i.send(a),r.next({type:xi.Sent}),()=>{i.removeEventListener("error",v),i.removeEventListener("abort",v),i.removeEventListener("load",p),i.removeEventListener("timeout",v),n.reportProgress&&(i.removeEventListener("progress",D),null!==a&&i.upload&&i.upload.removeEventListener("progress",T)),i.readyState!==i.DONE&&i.abort()}})}}return e.\u0275fac=function(n){return new(n||e)(St(qA))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})();const uE=new Tt("XSRF_COOKIE_NAME"),hE=new Tt("XSRF_HEADER_NAME");class jP{}let mG=(()=>{class e{constructor(n,r,i){this.doc=n,this.platform=r,this.cookieName=i,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=LA(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return e.\u0275fac=function(n){return new(n||e)(St(ss),St(Vw),St(uE))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})(),dE=(()=>{class e{constructor(n,r){this.tokenService=n,this.headerName=r}intercept(n,r){const i=n.url.toLowerCase();if("GET"===n.method||"HEAD"===n.method||i.startsWith("http://")||i.startsWith("https://"))return r.handle(n);const a=this.tokenService.getToken();return null!==a&&!n.headers.has(this.headerName)&&(n=n.clone({headers:n.headers.set(this.headerName,a)})),r.handle(n)}}return e.\u0275fac=function(n){return new(n||e)(St(jP),St(hE))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})(),gG=(()=>{class e{constructor(n,r){this.backend=n,this.injector=r,this.chain=null}handle(n){if(null===this.chain){const r=this.injector.get(UP,[]);this.chain=r.reduceRight((i,a)=>new VP(i,a),this.backend)}return this.chain.handle(n)}}return e.\u0275fac=function(n){return new(n||e)(St(RP),St(Zs))},e.\u0275prov=zt({token:e,factory:e.\u0275fac}),e})(),yG=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:dE,useClass:dG}]}}static withOptions(n={}){return{ngModule:e,providers:[n.cookieName?{provide:uE,useValue:n.cookieName}:[],n.headerName?{provide:hE,useValue:n.headerName}:[]]}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=li({type:e}),e.\u0275inj=Di({providers:[dE,{provide:UP,useExisting:dE,multi:!0},{provide:jP,useClass:mG},{provide:uE,useValue:"XSRF-TOKEN"},{provide:hE,useValue:"X-XSRF-TOKEN"}]}),e})(),_G=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=li({type:e}),e.\u0275inj=Di({providers:[BP,{provide:PP,useClass:gG},$P,{provide:RP,useExisting:$P}],imports:[yG.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),e})();class vG{encodeKey(t){return encodeURIComponent(t)}encodeValue(t){return encodeURIComponent(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const bG=new Tt("basePath");class HP{constructor(t={}){this.apiKeys=t.apiKeys,this.username=t.username,this.password=t.password,this.accessToken=t.accessToken,this.basePath=t.basePath,this.withCredentials=t.withCredentials,this.encoder=t.encoder,this.encodeParam=t.encodeParam?t.encodeParam:n=>this.defaultEncodeParam(n),this.credentials=t.credentials?t.credentials:{}}selectHeaderContentType(t){if(0===t.length)return;const n=t.find(r=>this.isJsonMime(r));return void 0===n?t[0]:n}selectHeaderAccept(t){if(0===t.length)return;const n=t.find(r=>this.isJsonMime(r));return void 0===n?t[0]:n}isJsonMime(t){const n=new RegExp("^(application/json|[^;/ \t]+/[^;/ \t]+[+]json)[ \t]*(;.*)?$","i");return null!==t&&(n.test(t)||"application/json-patch+json"===t.toLowerCase())}lookupCredential(t){const n=this.credentials[t];return"function"==typeof n?n():n}defaultEncodeParam(t){const n="date-time"===t.dataFormat?t.value.toISOString():t.value;return encodeURIComponent(String(n))}}let Dy=(()=>{class e{constructor(n,r,i){this.httpClient=n,this.basePath="http://localhost",this.defaultHeaders=new mc,this.configuration=new HP,i&&(this.configuration=i),"string"!=typeof this.configuration.basePath&&(Array.isArray(r)&&r.length>0&&(r=r[0]),"string"!=typeof r&&(r=this.basePath),this.configuration.basePath=r),this.encoder=this.configuration.encoder||new vG}addToHttpParams(n,r,i){return"object"!=typeof r||r instanceof Date?this.addToHttpParamsRecursive(n,r,i):this.addToHttpParamsRecursive(n,r)}addToHttpParamsRecursive(n,r,i){if(null==r)return n;if("object"==typeof r)if(Array.isArray(r))r.forEach(a=>n=this.addToHttpParamsRecursive(n,a,i));else if(r instanceof Date){if(null==i)throw Error("key may not be null if value is Date");n=n.append(i,r.toISOString().substr(0,10))}else Object.keys(r).forEach(a=>n=this.addToHttpParamsRecursive(n,r[a],null!=i?`${i}.${a}`:a));else{if(null==i)throw Error("key may not be null if value is not object or array");n=n.append(i,r)}return n}paxServiceGetDevice(n,r="body",i=!1,a){if(null==n)throw new Error("Required parameter id was null or undefined when calling paxServiceGetDevice.");let c=this.defaultHeaders,d=a&&a.httpHeaderAccept;void 0===d&&(d=this.configuration.selectHeaderAccept(["application/json"])),void 0!==d&&(c=c.set("Accept",d));let p=a&&a.context;void 0===p&&(p=new R0);let v="json";d&&(v=d.startsWith("text")?"text":this.configuration.isJsonMime(d)?"json":"blob");let E=`/api/v1/devices/${this.configuration.encodeParam({name:"id",value:n,in:"path",style:"simple",explode:!1,dataType:"string",dataFormat:void 0})}`;return this.httpClient.request("get",`${this.configuration.basePath}${E}`,{context:p,responseType:v,withCredentials:this.configuration.withCredentials,headers:c,observe:r,reportProgress:i})}paxServiceListData(n,r,i,a="body",c=!1,d){let p=new fu({encoder:this.encoder});null!=n&&(p=this.addToHttpParams(p,n,"since")),null!=r&&(p=this.addToHttpParams(p,r,"until")),null!=i&&(p=this.addToHttpParams(p,i,"limit"));let v=this.defaultHeaders,E=d&&d.httpHeaderAccept;void 0===E&&(E=this.configuration.selectHeaderAccept(["application/json"])),void 0!==E&&(v=v.set("Accept",E));let D=d&&d.context;void 0===D&&(D=new R0);let T="json";return E&&(T=E.startsWith("text")?"text":this.configuration.isJsonMime(E)?"json":"blob"),this.httpClient.request("get",`${this.configuration.basePath}/api/v1/data`,{context:D,params:p,responseType:T,withCredentials:this.configuration.withCredentials,headers:v,observe:a,reportProgress:c})}paxServiceListDevices(n="body",r=!1,i){let a=this.defaultHeaders,c=i&&i.httpHeaderAccept;void 0===c&&(c=this.configuration.selectHeaderAccept(["application/json"])),void 0!==c&&(a=a.set("Accept",c));let d=i&&i.context;void 0===d&&(d=new R0);let p="json";return c&&(p=c.startsWith("text")?"text":this.configuration.isJsonMime(c)?"json":"blob"),this.httpClient.request("get",`${this.configuration.basePath}/api/v1/devices`,{context:d,responseType:p,withCredentials:this.configuration.withCredentials,headers:a,observe:n,reportProgress:r})}}return e.\u0275fac=function(n){return new(n||e)(St(BP),St(bG,8),St(HP,8))},e.\u0275prov=zt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const xG=["chart"];function wG(e,t){if(1&e&&(jn(0,"div",7),zr(1),Wn()),2&e){const n=qg();kr(1),Kd(" Error retrieving data: ",n.errorMessage,"\n")}}function CG(e,t){if(1&e&&(jn(0,"tr")(1,"td"),zr(2),Wn(),jn(3,"td"),zr(4),kv(5,"date"),Wn(),jn(6,"td"),zr(7),Wn(),jn(8,"td"),zr(9),Wn()()),2&e){const n=t.$implicit;kr(2),Sh(n.deviceId),kr(2),Sh(Pv(5,4,n.timestamp,"YYYY-MM-dd HH:mm")),kr(3),Sh(n.bluetoothCount),kr(2),Sh(n.wifiCount)}}function EG(e,t){if(1&e&&(jn(0,"div")(1,"table")(2,"tr")(3,"th"),zr(4,"Device"),Wn(),xa(5,"th"),jn(6,"th"),zr(7,"Timestamp"),Wn(),jn(8,"th"),zr(9,"Bluetooth"),Wn(),jn(10,"th"),zr(11,"WiFi"),Wn()(),Dh(12,CG,10,7,"tr",6),Wn()()),2&e){const n=t.$implicit;kr(12),Co("ngForOf",n.samples)}}const O0=function(e){return{button:!0,activeButton:e}};let DG=(()=>{class e{constructor(n){this.paxService=n,this.dataPoints=[],this.errorMessage="",this.lastPoll=new Date,this.visibleInterval=24}hasError(){return""!=this.errorMessage}ngOnInit(){}ngAfterViewInit(){this.loadData()}showInterval(n){this.visibleInterval=n,this.loadData()}loadData(){let n=""+((new Date).getTime()-3600*this.visibleInterval*1e3),r=""+(new Date).getTime();this.paxService.paxServiceListData(n,r,19e6).subscribe({next:i=>{i.data&&(this.dataPoints=i.data)},error:i=>{this.errorMessage=i.message},complete:()=>{this.lastPoll=new Date}})}}return e.\u0275fac=function(n){return new(n||e)(qe(Dy))},e.\u0275cmp=zs({type:e,selectors:[["app-main-chart"]],viewQuery:function(n,r){if(1&n&&Fv(xG,5),2&n){let i;$p(i=jp())&&(r.chartRef=i.first)}},decls:19,vars:19,consts:[["class","error",4,"ngIf"],[1,"chart-container"],[1,"chart"],["chart",""],[1,"stats"],[3,"ngClass","click"],[4,"ngFor","ngForOf"],[1,"error"]],template:function(n,r){1&n&&(jn(0,"h1"),zr(1,"PAX Counters"),Wn(),Dh(2,wG,2,1,"div",0),jn(3,"div",1),xa(4,"canvas",2,3),Wn(),jn(6,"div",4),zr(7),kv(8,"date"),Wn(),jn(9,"div")(10,"button",5),Ri("click",function(){return r.showInterval(168)}),zr(11,"1w"),Wn(),jn(12,"button",5),Ri("click",function(){return r.showInterval(24)}),zr(13,"1d"),Wn(),jn(14,"button",5),Ri("click",function(){return r.showInterval(12)}),zr(15,"12h"),Wn(),jn(16,"button",5),Ri("click",function(){return r.showInterval(1)}),zr(17,"Last hour"),Wn()(),Dh(18,EG,13,1,"div",6)),2&n&&(kr(2),Co("ngIf",r.hasError()),kr(5),yw(" Last update ",Pv(8,8,r.lastPoll,"yyyy-MM-dd HH:mm")," (",r.dataPoints.length," sets)\n"),kr(3),Co("ngClass",ef(11,O0,168==r.visibleInterval)),kr(2),Co("ngClass",ef(13,O0,24==r.visibleInterval)),kr(2),Co("ngClass",ef(15,O0,12==r.visibleInterval)),kr(2),Co("ngClass",ef(17,O0,1==r.visibleInterval)),kr(2),Co("ngForOf",r.dataPoints))},dependencies:[dC,n0,fC,gC],styles:["h1[_ngcontent-%COMP%]{font-size:24px;text-align:center}.error[_ngcontent-%COMP%]{border:solid 1px darkred;background:pink;color:maroon;border-radius:.5em;padding:1em;font-weight:400}.chart-container[_ngcontent-%COMP%]{padding:1em;display:grid;justify-items:center}.chart[_ngcontent-%COMP%]{margin:1em;width:100%;border-radius:.25em;border:solid 1px darkgray}.stats[_ngcontent-%COMP%]{font-size:10pt;font-weight:100;text-align:right;padding:1em}.button[_ngcontent-%COMP%]{height:2em;width:8em;margin:.25em;font-size:14pt;border:solid 1px blue;border-radius:.25em}"]}),e})();function vl(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function MG(e){return 0|e.length}function TG(e){return!(e>0)}function IG(e){return"object"!=typeof e||"length"in e?e:Array.from(e)}function Sy(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function fE(e,t){let r,n=0,i=0,a=0;if(void 0===t)for(let c of e)null!=c&&(c=+c)>=c&&(r=c-i,i+=r/++n,a+=r*(c-i));else{let c=-1;for(let d of e)null!=(d=t(d,++c,e))&&(d=+d)>=d&&(r=d-i,i+=r/++n,a+=r*(d-i))}if(n>1)return a/(n-1)}function GP(e,t){const n=fE(e,t);return n&&Math.sqrt(n)}function Qp(e,t){let n,r;if(void 0===t)for(const i of e)null!=i&&(void 0===n?i>=i&&(n=r=i):(n>i&&(n=i),r<i&&(r=i)));else{let i=-1;for(let a of e)null!=(a=t(a,++i,e))&&(void 0===n?a>=a&&(n=r=a):(n>a&&(n=a),r<a&&(r=a)))}return[n,r]}class L0 extends Map{constructor(t,n=WP){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),null!=t)for(const[r,i]of t)this.set(r,i)}get(t){return super.get(mE(this,t))}has(t){return super.has(mE(this,t))}set(t,n){return super.set(qP(this,t),n)}delete(t){return super.delete(ZP(this,t))}}class pE extends Set{constructor(t,n=WP){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),null!=t)for(const r of t)this.add(r)}has(t){return super.has(mE(this,t))}add(t){return super.add(qP(this,t))}delete(t){return super.delete(ZP(this,t))}}function mE({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):n}function qP({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):(e.set(r,n),n)}function ZP({_intern:e,_key:t},n){const r=t(n);return e.has(r)&&(n=e.get(r),e.delete(r)),n}function WP(e){return null!==e&&"object"==typeof e?e.valueOf():e}function gE(e){return e}function XP(e,...t){return em(e,gE,gE,t)}function My(e,t,...n){return em(e,gE,t,n)}function em(e,t,n,r){return function i(a,c){if(c>=r.length)return n(a);const d=new L0,p=r[c++];let v=-1;for(const E of a){const D=p(E,++v,a),T=d.get(D);T?T.push(E):d.set(D,[E])}for(const[E,D]of d)d.set(E,i(D,c));return t(d)}(e,0)}function Xs(e,t){let n;if(void 0===t)for(const r of e)null!=r&&(n<r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function FG(e,t){let n,r=-1,i=-1;if(void 0===t)for(const a of e)++i,null!=a&&(n<a||void 0===n&&a>=a)&&(n=a,r=i);else for(let a of e)null!=(a=t(a,++i,e))&&(n<a||void 0===n&&a>=a)&&(n=a,r=i);return r}function OG(e,t){let n=0,r=0;if(void 0===t)for(let i of e)null!=i&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let a of e)null!=(a=t(a,++i,e))&&(a=+a)>=a&&(++n,r+=a)}if(n)return r/n}function uf(e,t){let n;if(void 0===t)for(const r of e)null!=r&&(n>r||void 0===n&&r>=r)&&(n=r);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function yE(e,...t){if("function"!=typeof e[Symbol.iterator])throw new TypeError("values is not iterable");e=Array.from(e);let[n]=t;if(n&&2!==n.length||t.length>1){const r=Uint32Array.from(e,(i,a)=>a);return t.length>1?(t=t.map(i=>e.map(i)),r.sort((i,a)=>{for(const c of t){const d=Ty(c[i],c[a]);if(d)return d}})):(n=e.map(n),r.sort((i,a)=>Ty(n[i],n[a]))),function LG(e,t){return Array.from(t,n=>e[n])}(e,r)}return e.sort(_E(n))}function _E(e=vl){if(e===vl)return Ty;if("function"!=typeof e)throw new TypeError("compare is not a function");return(t,n)=>{const r=e(t,n);return r||0===r?r:(0===e(n,n))-(0===e(t,t))}}function Ty(e,t){return(null==e||!(e>=e))-(null==t||!(t>=t))||(e<t?-1:e>t?1:0)}function JP(e,t,n=0,r=1/0,i){if(t=Math.floor(t),n=Math.floor(Math.max(0,n)),r=Math.floor(Math.min(e.length-1,r)),!(n<=t&&t<=r))return e;for(i=void 0===i?Ty:_E(i);r>n;){if(r-n>600){const p=r-n+1,v=t-n+1,E=Math.log(p),D=.5*Math.exp(2*E/3),T=.5*Math.sqrt(E*D*(p-D)/p)*(v-p/2<0?-1:1);JP(e,t,Math.max(n,Math.floor(t-v*D/p+T)),Math.min(r,Math.floor(t+(p-v)*D/p+T)),i)}const a=e[t];let c=n,d=r;for(Iy(e,n,t),i(e[r],a)>0&&Iy(e,n,r);c<d;){for(Iy(e,c,d),++c,--d;i(e[c],a)<0;)++c;for(;i(e[d],a)>0;)--d}0===i(e[n],a)?Iy(e,n,d):(++d,Iy(e,d,r)),d<=t&&(n=d+1),t<=d&&(r=d-1)}return e}function Iy(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function QP(e){return null===e?NaN:+e}function N0(e,t,n){if(e=Float64Array.from(function*NG(e,t){if(void 0===t)for(let n of e)null!=n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(r=+r)>=r&&(yield r)}}(e,n)),(r=e.length)&&!isNaN(t=+t)){if(t<=0||r<2)return uf(e);if(t>=1)return Xs(e);var r,i=(r-1)*t,a=Math.floor(i),c=Xs(JP(e,a).subarray(0,a+1));return c+(uf(e.subarray(a+1))-c)*(i-a)}}function zG(e,t,n=QP){if((r=e.length)&&!isNaN(t=+t)){if(t<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),c=+n(e[a],a,e);return c+(+n(e[a+1],a+1,e)-c)*(i-a)}}function z0(e,t){return N0(e,.5,t)}function BG(e,t){let n,r=-1,i=-1;if(void 0===t)for(const a of e)++i,null!=a&&(n>a||void 0===n&&a>=a)&&(n=a,r=i);else for(let a of e)null!=(a=t(a,++i,e))&&(n>a||void 0===n&&a>=a)&&(n=a,r=i);return r}function eR(e,t){const n=new L0;if(void 0===t)for(let a of e)null!=a&&a>=a&&n.set(a,(n.get(a)||0)+1);else{let a=-1;for(let c of e)null!=(c=t(c,++a,e))&&c>=c&&n.set(c,(n.get(c)||0)+1)}let r,i=0;for(const[a,c]of n)c>i&&(i=c,r=a);return r}function tR(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),a=new Array(i);++r<i;)a[r]=e+r*n;return a}function nR(e,t=vl){if("function"!=typeof e[Symbol.iterator])throw new TypeError("values is not iterable");let n=Array.from(e);const r=new Float64Array(n.length);2!==t.length&&(n=n.map(t),t=vl);const i=(d,p)=>t(n[d],n[p]);let a,c;return(e=Uint32Array.from(n,(d,p)=>p)).sort(t===vl?(d,p)=>Ty(n[d],n[p]):_E(i)),e.forEach((d,p)=>{const v=i(d,void 0===a?d:a);v>=0?((void 0===a||v>0)&&(a=d,c=p),r[d]=c):r[d]=NaN}),r}function B0(e,t){let n=0;if(void 0===t)for(let r of e)(r=+r)&&(n+=r);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}const VG=Math.sqrt(50),UG=Math.sqrt(10),$G=Math.sqrt(2);function V0(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),a=r/Math.pow(10,i),c=a>=VG?10:a>=UG?5:a>=$G?2:1;let d,p,v;return i<0?(v=Math.pow(10,-i)/c,d=Math.round(e*v),p=Math.round(t*v),d/v<e&&++d,p/v>t&&--p,v=-v):(v=Math.pow(10,i)*c,d=Math.round(e/v),p=Math.round(t/v),d*v<e&&++d,p*v>t&&--p),p<d&&.5<=n&&n<2?V0(e,t,2*n):[d,p,v]}function U0(e,t,n){if(!((n=+n)>0))return[];if((e=+e)==(t=+t))return[e];const r=t<e,[i,a,c]=r?V0(t,e,n):V0(e,t,n);if(!(a>=i))return[];const d=a-i+1,p=new Array(d);if(r)if(c<0)for(let v=0;v<d;++v)p[v]=(a-v)/-c;else for(let v=0;v<d;++v)p[v]=(a-v)*c;else if(c<0)for(let v=0;v<d;++v)p[v]=(i+v)/-c;else for(let v=0;v<d;++v)p[v]=(i+v)*c;return p}function vE(e,t,n){return V0(e=+e,t=+t,n=+n)[2]}function bE(e,t,n){n=+n;const r=(t=+t)<(e=+e),i=r?vE(t,e,n):vE(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}function $0(e){if("function"!=typeof e[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(e).reverse()}function jG(e){return e}function HG(e){return"translate("+e+",0)"}function GG(e){return"translate(0,"+e+")"}function qG(e){return t=>+e(t)}function ZG(e,t){return t=Math.max(0,e.bandwidth()-2*t)/2,e.round()&&(t=Math.round(t)),n=>+e(n)+t}function WG(){return!this.__axis}function G0(e,t){var n=[],r=null,i=null,a=6,c=6,d=3,p=typeof window<"u"&&window.devicePixelRatio>1?0:.5,v=1===e||4===e?-1:1,E=4===e||2===e?"x":"y",D=1===e||3===e?HG:GG;function T(P){var N=r??(t.ticks?t.ticks.apply(t,n):t.domain()),G=i??(t.tickFormat?t.tickFormat.apply(t,n):jG),U=Math.max(a,0)+d,Z=t.range(),ne=+Z[0]+p,X=+Z[Z.length-1]+p,re=(t.bandwidth?ZG:qG)(t.copy(),p),fe=P.selection?P.selection():P,ve=fe.selectAll(".domain").data([null]),Re=fe.selectAll(".tick").data(N,t).order(),We=Re.exit(),Ke=Re.enter().append("g").attr("class","tick"),lt=Re.select("line"),Ue=Re.select("text");ve=ve.merge(ve.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),Re=Re.merge(Ke),lt=lt.merge(Ke.append("line").attr("stroke","currentColor").attr(E+"2",v*a)),Ue=Ue.merge(Ke.append("text").attr("fill","currentColor").attr(E,v*U).attr("dy",1===e?"0em":3===e?"0.71em":"0.32em")),P!==fe&&(ve=ve.transition(P),Re=Re.transition(P),lt=lt.transition(P),Ue=Ue.transition(P),We=We.transition(P).attr("opacity",1e-6).attr("transform",function(st){return isFinite(st=re(st))?D(st+p):this.getAttribute("transform")}),Ke.attr("opacity",1e-6).attr("transform",function(st){var Fe=this.parentNode.__axis;return D((Fe&&isFinite(Fe=Fe(st))?Fe:re(st))+p)})),We.remove(),ve.attr("d",4===e||2===e?c?"M"+v*c+","+ne+"H"+p+"V"+X+"H"+v*c:"M"+p+","+ne+"V"+X:c?"M"+ne+","+v*c+"V"+p+"H"+X+"V"+v*c:"M"+ne+","+p+"H"+X),Re.attr("opacity",1).attr("transform",function(st){return D(re(st)+p)}),lt.attr(E+"2",v*a),Ue.attr(E,v*U).text(G),fe.filter(WG).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===e?"start":4===e?"end":"middle"),fe.each(function(){this.__axis=re})}return T.scale=function(P){return arguments.length?(t=P,T):t},T.ticks=function(){return n=Array.from(arguments),T},T.tickArguments=function(P){return arguments.length?(n=null==P?[]:Array.from(P),T):n.slice()},T.tickValues=function(P){return arguments.length?(r=null==P?null:Array.from(P),T):r&&r.slice()},T.tickFormat=function(P){return arguments.length?(i=P,T):i},T.tickSize=function(P){return arguments.length?(a=c=+P,T):a},T.tickSizeInner=function(P){return arguments.length?(a=+P,T):a},T.tickSizeOuter=function(P){return arguments.length?(c=+P,T):c},T.tickPadding=function(P){return arguments.length?(d=+P,T):d},T.offset=function(P){return arguments.length?(p=+P,T):p},T}function YG(){}function wE(e){return null==e?YG:function(){return this.querySelector(e)}}function JG(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}function QG(){return[]}function iR(e){return null==e?QG:function(){return this.querySelectorAll(e)}}function oR(e){return function(){return this.matches(e)}}function sR(e){return function(t){return t.matches(e)}}var nq=Array.prototype.find;function iq(){return this.firstElementChild}var sq=Array.prototype.filter;function aq(){return Array.from(this.children)}function aR(e){return new Array(e.length)}function q0(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function dq(e){return function(){return e}}function fq(e,t,n,r,i,a){for(var d,c=0,p=t.length,v=a.length;c<v;++c)(d=t[c])?(d.__data__=a[c],r[c]=d):n[c]=new q0(e,a[c]);for(;c<p;++c)(d=t[c])&&(i[c]=d)}function pq(e,t,n,r,i,a,c){var d,p,P,v=new Map,E=t.length,D=a.length,T=new Array(E);for(d=0;d<E;++d)(p=t[d])&&(T[d]=P=c.call(p,p.__data__,d,t)+"",v.has(P)?i[d]=p:v.set(P,p));for(d=0;d<D;++d)P=c.call(e,a[d],d,a)+"",(p=v.get(P))?(r[d]=p,p.__data__=a[d],v.delete(P)):n[d]=new q0(e,a[d]);for(d=0;d<E;++d)(p=t[d])&&v.get(T[d])===p&&(i[d]=p)}function mq(e){return e.__data__}function yq(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function Cq(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}q0.prototype={constructor:q0,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var CE="http://www.w3.org/1999/xhtml";const tm={svg:"http://www.w3.org/2000/svg",xhtml:CE,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Z0(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),tm.hasOwnProperty(t)?{space:tm[t],local:e}:e}function Aq(e){return function(){this.removeAttribute(e)}}function kq(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Pq(e,t){return function(){this.setAttribute(e,t)}}function Rq(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Fq(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function Oq(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function lR(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Nq(e){return function(){this.style.removeProperty(e)}}function zq(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Bq(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function nm(e,t){return e.style.getPropertyValue(t)||lR(e).getComputedStyle(e,null).getPropertyValue(t)}function Uq(e){return function(){delete this[e]}}function $q(e,t){return function(){this[e]=t}}function jq(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function cR(e){return e.trim().split(/^|\s+/)}function EE(e){return e.classList||new uR(e)}function uR(e){this._node=e,this._names=cR(e.getAttribute("class")||"")}function hR(e,t){for(var n=EE(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function dR(e,t){for(var n=EE(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function Gq(e){return function(){hR(this,e)}}function qq(e){return function(){dR(this,e)}}function Zq(e,t){return function(){(t.apply(this,arguments)?hR:dR)(this,e)}}function Xq(){this.textContent=""}function Yq(e){return function(){this.textContent=e}}function Kq(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Qq(){this.innerHTML=""}function eZ(e){return function(){this.innerHTML=e}}function tZ(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function rZ(){this.nextSibling&&this.parentNode.appendChild(this)}function oZ(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function aZ(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===CE&&t.documentElement.namespaceURI===CE?t.createElement(e):t.createElementNS(n,e)}}function lZ(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function DE(e){var t=Z0(e);return(t.local?lZ:aZ)(t)}function uZ(){return null}function dZ(){var e=this.parentNode;e&&e.removeChild(this)}function pZ(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function mZ(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function vZ(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function bZ(e){return function(){var t=this.__on;if(t){for(var a,n=0,r=-1,i=t.length;n<i;++n)a=t[n],e.type&&a.type!==e.type||a.name!==e.name?t[++r]=a:this.removeEventListener(a.type,a.listener,a.options);++r?t.length=r:delete this.__on}}}function xZ(e,t,n){return function(){var i,r=this.__on,a=function _Z(e){return function(t){e.call(this,t,this.__data__)}}(t);if(r)for(var c=0,d=r.length;c<d;++c)if((i=r[c]).type===e.type&&i.name===e.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=n),void(i.value=t);this.addEventListener(e.type,a,n),i={type:e.type,name:e.name,value:t,listener:a,options:n},r?r.push(i):this.__on=[i]}}function fR(e,t,n){var r=lR(e),i=r.CustomEvent;"function"==typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function CZ(e,t){return function(){return fR(this,e,t)}}function EZ(e,t){return function(){return fR(this,e,t.apply(this,arguments))}}uR.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var pR=[null];function Ys(e,t){this._groups=e,this._parents=t}function mR(){return new Ys([[document.documentElement]],pR)}Ys.prototype=mR.prototype={constructor:Ys,select:function KG(e){"function"!=typeof e&&(e=wE(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var p,v,a=t[i],c=a.length,d=r[i]=new Array(c),E=0;E<c;++E)(p=a[E])&&(v=e.call(p,p.__data__,E,a))&&("__data__"in p&&(v.__data__=p.__data__),d[E]=v);return new Ys(r,this._parents)},selectAll:function tq(e){e="function"==typeof e?function eq(e){return function(){return JG(e.apply(this,arguments))}}(e):iR(e);for(var t=this._groups,n=t.length,r=[],i=[],a=0;a<n;++a)for(var p,c=t[a],d=c.length,v=0;v<d;++v)(p=c[v])&&(r.push(e.call(p,p.__data__,v,c)),i.push(p));return new Ys(r,i)},selectChild:function oq(e){return this.select(null==e?iq:function rq(e){return function(){return nq.call(this.children,e)}}("function"==typeof e?e:sR(e)))},selectChildren:function cq(e){return this.selectAll(null==e?aq:function lq(e){return function(){return sq.call(this.children,e)}}("function"==typeof e?e:sR(e)))},filter:function uq(e){"function"!=typeof e&&(e=oR(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var p,a=t[i],c=a.length,d=r[i]=[],v=0;v<c;++v)(p=a[v])&&e.call(p,p.__data__,v,a)&&d.push(p);return new Ys(r,this._parents)},data:function gq(e,t){if(!arguments.length)return Array.from(this,mq);var n=t?pq:fq,r=this._parents,i=this._groups;"function"!=typeof e&&(e=dq(e));for(var a=i.length,c=new Array(a),d=new Array(a),p=new Array(a),v=0;v<a;++v){var E=r[v],D=i[v],T=D.length,P=yq(e.call(E,E&&E.__data__,v,r)),N=P.length,G=d[v]=new Array(N),U=c[v]=new Array(N),Z=p[v]=new Array(T);n(E,D,G,U,Z,P,t);for(var re,fe,ne=0,X=0;ne<N;++ne)if(re=G[ne]){for(ne>=X&&(X=ne+1);!(fe=U[X])&&++X<N;);re._next=fe||null}}return(c=new Ys(c,r))._enter=d,c._exit=p,c},enter:function hq(){return new Ys(this._enter||this._groups.map(aR),this._parents)},exit:function _q(){return new Ys(this._exit||this._groups.map(aR),this._parents)},join:function vq(e,t,n){var r=this.enter(),i=this,a=this.exit();return"function"==typeof e?(r=e(r))&&(r=r.selection()):r=r.append(e+""),null!=t&&(i=t(i))&&(i=i.selection()),null==n?a.remove():n(a),r&&i?r.merge(i).order():i},merge:function bq(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,c=Math.min(i,r.length),d=new Array(i),p=0;p<c;++p)for(var P,v=n[p],E=r[p],D=v.length,T=d[p]=new Array(D),N=0;N<D;++N)(P=v[N]||E[N])&&(T[N]=P);for(;p<i;++p)d[p]=n[p];return new Ys(d,this._parents)},selection:function MZ(){return this},order:function xq(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var c,r=e[t],i=r.length-1,a=r[i];--i>=0;)(c=r[i])&&(a&&4^c.compareDocumentPosition(a)&&a.parentNode.insertBefore(c,a),a=c);return this},sort:function wq(e){function t(D,T){return D&&T?e(D.__data__,T.__data__):!D-!T}e||(e=Cq);for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var v,c=n[a],d=c.length,p=i[a]=new Array(d),E=0;E<d;++E)(v=c[E])&&(p[E]=v);p.sort(t)}return new Ys(i,this._parents).order()},call:function Eq(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function Dq(){return Array.from(this)},node:function Sq(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,a=r.length;i<a;++i){var c=r[i];if(c)return c}return null},size:function Mq(){let e=0;for(const t of this)++e;return e},empty:function Tq(){return!this.node()},each:function Iq(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var d,i=t[n],a=0,c=i.length;a<c;++a)(d=i[a])&&e.call(d,d.__data__,a,i);return this},attr:function Lq(e,t){var n=Z0(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?kq:Aq:"function"==typeof t?n.local?Oq:Fq:n.local?Rq:Pq)(n,t))},style:function Vq(e,t,n){return arguments.length>1?this.each((null==t?Nq:"function"==typeof t?Bq:zq)(e,t,n??"")):nm(this.node(),e)},property:function Hq(e,t){return arguments.length>1?this.each((null==t?Uq:"function"==typeof t?jq:$q)(e,t)):this.node()[e]},classed:function Wq(e,t){var n=cR(e+"");if(arguments.length<2){for(var r=EE(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?Zq:t?Gq:qq)(n,t))},text:function Jq(e){return arguments.length?this.each(null==e?Xq:("function"==typeof e?Kq:Yq)(e)):this.node().textContent},html:function nZ(e){return arguments.length?this.each(null==e?Qq:("function"==typeof e?tZ:eZ)(e)):this.node().innerHTML},raise:function iZ(){return this.each(rZ)},lower:function sZ(){return this.each(oZ)},append:function cZ(e){var t="function"==typeof e?e:DE(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function hZ(e,t){var n="function"==typeof e?e:DE(e),r=null==t?uZ:"function"==typeof t?t:wE(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function fZ(){return this.each(dZ)},clone:function gZ(e){return this.select(e?mZ:pZ)},datum:function yZ(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function wZ(e,t,n){var i,c,r=vZ(e+""),a=r.length;if(!(arguments.length<2)){for(d=t?xZ:bZ,i=0;i<a;++i)this.each(d(r[i],t,n));return this}var d=this.node().__on;if(d)for(var E,p=0,v=d.length;p<v;++p)for(i=0,E=d[p];i<a;++i)if((c=r[i]).type===E.type&&c.name===E.name)return E.value},dispatch:function DZ(e,t){return this.each(("function"==typeof t?EZ:CZ)(e,t))},[Symbol.iterator]:function*SZ(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var c,r=e[t],i=0,a=r.length;i<a;++i)(c=r[i])&&(yield c)}};const ky=mR;var TZ={value:()=>{}};function gR(){for(var r,e=0,t=arguments.length,n={};e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new W0(n)}function W0(e){this._=e}function IZ(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}function AZ(e,t){for(var i,n=0,r=e.length;n<r;++n)if((i=e[n]).name===t)return i.value}function yR(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=TZ,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}W0.prototype=gR.prototype={constructor:W0,on:function(e,t){var i,n=this._,r=IZ(e+"",n),a=-1,c=r.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<c;)if(i=(e=r[a]).type)n[i]=yR(n[i],e.name,t);else if(null==t)for(i in n)n[i]=yR(n[i],e.name,null);return this}for(;++a<c;)if((i=(e=r[a]).type)&&(i=AZ(n[i],e.name)))return i},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new W0(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var i,a,n=new Array(i),r=0;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(r=0,i=(a=this._[e]).length;r<i;++r)a[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};const kZ=gR;var X0,Fy,rm=0,Py=0,Ry=0,Y0=0,hf=0,K0=0,Oy="object"==typeof performance&&performance.now?performance:Date,vR="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function SE(){return hf||(vR(PZ),hf=Oy.now()+K0)}function PZ(){hf=0}function J0(){this._call=this._time=this._next=null}function bR(e,t,n){var r=new J0;return r.restart(e,t,n),r}function xR(){hf=(Y0=Oy.now())+K0,rm=Py=0;try{!function RZ(){SE(),++rm;for(var t,e=X0;e;)(t=hf-e._time)>=0&&e._call.call(void 0,t),e=e._next;--rm}()}finally{rm=0,function OZ(){for(var e,n,t=X0,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:X0=n);Fy=e,ME(r)}(),hf=0}}function FZ(){var e=Oy.now(),t=e-Y0;t>1e3&&(K0-=t,Y0=e)}function ME(e){rm||(Py&&(Py=clearTimeout(Py)),e-hf>24?(e<1/0&&(Py=setTimeout(xR,e-Oy.now()-K0)),Ry&&(Ry=clearInterval(Ry))):(Ry||(Y0=Oy.now(),Ry=setInterval(FZ,1e3)),rm=1,vR(xR)))}function wR(e,t,n){var r=new J0;return r.restart(i=>{r.stop(),e(i+t)},t=null==t?0:+t,n),r}J0.prototype=bR.prototype={constructor:J0,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?SE():+n)+(null==t?0:+t),!this._next&&Fy!==this&&(Fy?Fy._next=this:X0=this,Fy=this),this._call=e,this._time=n,ME()},stop:function(){this._call&&(this._call=null,this._time=1/0,ME())}};var LZ=kZ("start","end","cancel","interrupt"),NZ=[];function tb(e,t,n,r,i,a){var c=e.__transition;if(c){if(n in c)return}else e.__transition={};!function zZ(e,t,n){var i,r=e.__transition;function c(v){var E,D,T,P;if(1!==n.state)return p();for(E in r)if((P=r[E]).name===n.name){if(3===P.state)return wR(c);4===P.state?(P.state=6,P.timer.stop(),P.on.call("interrupt",e,e.__data__,P.index,P.group),delete r[E]):+E<t&&(P.state=6,P.timer.stop(),P.on.call("cancel",e,e.__data__,P.index,P.group),delete r[E])}if(wR(function(){3===n.state&&(n.state=4,n.timer.restart(d,n.delay,n.time),d(v))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(T=n.tween.length),E=0,D=-1;E<T;++E)(P=n.tween[E].value.call(e,e.__data__,n.index,n.group))&&(i[++D]=P);i.length=D+1}}function d(v){for(var E=v<n.duration?n.ease.call(null,v/n.duration):(n.timer.restart(p),n.state=5,1),D=-1,T=i.length;++D<T;)i[D].call(e,E);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),p())}function p(){for(var v in n.state=6,n.timer.stop(),delete r[t],r)return;delete e.__transition}r[t]=n,n.timer=bR(function a(v){n.state=1,n.timer.restart(c,n.delay,n.time),n.delay<=v&&c(v-n.delay)},0,n.time)}(e,n,{name:t,index:r,group:i,on:LZ,tween:NZ,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:0})}function AE(e,t){var n=bl(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function gc(e,t){var n=bl(e,t);if(n.state>3)throw new Error("too late; already running");return n}function bl(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function $o(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var nb,SR=180/Math.PI,kE={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function MR(e,t,n,r,i,a){var c,d,p;return(c=Math.sqrt(e*e+t*t))&&(e/=c,t/=c),(p=e*n+t*r)&&(n-=e*p,r-=t*p),(d=Math.sqrt(n*n+r*r))&&(n/=d,r/=d,p/=d),e*r<t*n&&(e=-e,t=-t,p=-p,c=-c),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*SR,skewX:Math.atan(p)*SR,scaleX:c,scaleY:d}}function TR(e,t,n,r){function i(v){return v.length?v.pop()+" ":""}return function(v,E){var D=[],T=[];return v=e(v),E=e(E),function a(v,E,D,T,P,N){if(v!==D||E!==T){var G=P.push("translate(",null,t,null,n);N.push({i:G-4,x:$o(v,D)},{i:G-2,x:$o(E,T)})}else(D||T)&&P.push("translate("+D+t+T+n)}(v.translateX,v.translateY,E.translateX,E.translateY,D,T),function c(v,E,D,T){v!==E?(v-E>180?E+=360:E-v>180&&(v+=360),T.push({i:D.push(i(D)+"rotate(",null,r)-2,x:$o(v,E)})):E&&D.push(i(D)+"rotate("+E+r)}(v.rotate,E.rotate,D,T),function d(v,E,D,T){v!==E?T.push({i:D.push(i(D)+"skewX(",null,r)-2,x:$o(v,E)}):E&&D.push(i(D)+"skewX("+E+r)}(v.skewX,E.skewX,D,T),function p(v,E,D,T,P,N){if(v!==D||E!==T){var G=P.push(i(P)+"scale(",null,",",null,")");N.push({i:G-4,x:$o(v,D)},{i:G-2,x:$o(E,T)})}else(1!==D||1!==T)&&P.push(i(P)+"scale("+D+","+T+")")}(v.scaleX,v.scaleY,E.scaleX,E.scaleY,D,T),v=E=null,function(P){for(var U,N=-1,G=T.length;++N<G;)D[(U=T[N]).i]=U.x(P);return D.join("")}}}var jZ=TR(function UZ(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?kE:MR(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),HZ=TR(function $Z(e){return null!=e&&(nb||(nb=document.createElementNS("http://www.w3.org/2000/svg","g")),nb.setAttribute("transform",e),e=nb.transform.baseVal.consolidate())?MR((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):kE},", ",")",")");function GZ(e,t){var n,r;return function(){var i=gc(this,e),a=i.tween;if(a!==n)for(var c=0,d=(r=n=a).length;c<d;++c)if(r[c].name===t){(r=r.slice()).splice(c,1);break}i.tween=r}}function qZ(e,t,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var a=gc(this,e),c=a.tween;if(c!==r){i=(r=c).slice();for(var d={name:t,value:n},p=0,v=i.length;p<v;++p)if(i[p].name===t){i[p]=d;break}p===v&&i.push(d)}a.tween=i}}function PE(e,t,n){var r=e._id;return e.each(function(){var i=gc(this,r);(i.value||(i.value={}))[t]=n.apply(this,arguments)}),function(i){return bl(i,r).value[t]}}function im(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Ly(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Rh(){}var om=1/.7,sm="\\s*([+-]?\\d+)\\s*",Ny="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",yc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",WZ=/^#([0-9a-f]{3,8})$/,XZ=new RegExp(`^rgb\\(${sm},${sm},${sm}\\)$`),YZ=new RegExp(`^rgb\\(${yc},${yc},${yc}\\)$`),KZ=new RegExp(`^rgba\\(${sm},${sm},${sm},${Ny}\\)$`),JZ=new RegExp(`^rgba\\(${yc},${yc},${yc},${Ny}\\)$`),QZ=new RegExp(`^hsl\\(${Ny},${yc},${yc}\\)$`),eW=new RegExp(`^hsla\\(${Ny},${yc},${yc},${Ny}\\)$`),IR={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function AR(){return this.rgb().formatHex()}function kR(){return this.rgb().formatRgb()}function Fh(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=WZ.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?PR(t):3===n?new eo(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?rb(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?rb(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=XZ.exec(e))?new eo(t[1],t[2],t[3],1):(t=YZ.exec(e))?new eo(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=KZ.exec(e))?rb(t[1],t[2],t[3],t[4]):(t=JZ.exec(e))?rb(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=QZ.exec(e))?OR(t[1],t[2]/100,t[3]/100,1):(t=eW.exec(e))?OR(t[1],t[2]/100,t[3]/100,t[4]):IR.hasOwnProperty(e)?PR(IR[e]):"transparent"===e?new eo(NaN,NaN,NaN,0):null}function PR(e){return new eo(e>>16&255,e>>8&255,255&e,1)}function rb(e,t,n,r){return r<=0&&(e=t=n=NaN),new eo(e,t,n,r)}function RE(e){return e instanceof Rh||(e=Fh(e)),e?new eo((e=e.rgb()).r,e.g,e.b,e.opacity):new eo}function Oh(e,t,n,r){return 1===arguments.length?RE(e):new eo(e,t,n,r??1)}function eo(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function RR(){return`#${pf(this.r)}${pf(this.g)}${pf(this.b)}`}function FR(){const e=ib(this.opacity);return`${1===e?"rgb(":"rgba("}${ff(this.r)}, ${ff(this.g)}, ${ff(this.b)}${1===e?")":`, ${e})`}`}function ib(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function ff(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function pf(e){return((e=ff(e))<16?"0":"")+e.toString(16)}function OR(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new xl(e,t,n,r)}function LR(e){if(e instanceof xl)return new xl(e.h,e.s,e.l,e.opacity);if(e instanceof Rh||(e=Fh(e)),!e)return new xl;if(e instanceof xl)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),c=NaN,d=a-i,p=(a+i)/2;return d?(c=t===a?(n-r)/d+6*(n<r):n===a?(r-t)/d+2:(t-n)/d+4,d/=p<.5?a+i:2-a-i,c*=60):d=p>0&&p<1?0:c,new xl(c,d,p,e.opacity)}function FE(e,t,n,r){return 1===arguments.length?LR(e):new xl(e,t,n,r??1)}function xl(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function NR(e){return(e=(e||0)%360)<0?e+360:e}function ob(e){return Math.max(0,Math.min(1,e||0))}function OE(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function zR(e,t,n,r,i){var a=e*e,c=a*e;return((1-3*e+3*a-c)*t+(4-6*a+3*c)*n+(1+3*e+3*a-3*c)*r+c*i)/6}im(Rh,Fh,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:AR,formatHex:AR,formatHex8:function tW(){return this.rgb().formatHex8()},formatHsl:function nW(){return LR(this).formatHsl()},formatRgb:kR,toString:kR}),im(eo,Oh,Ly(Rh,{brighter(e){return e=null==e?om:Math.pow(om,e),new eo(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new eo(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new eo(ff(this.r),ff(this.g),ff(this.b),ib(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:RR,formatHex:RR,formatHex8:function rW(){return`#${pf(this.r)}${pf(this.g)}${pf(this.b)}${pf(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:FR,toString:FR})),im(xl,FE,Ly(Rh,{brighter(e){return e=null==e?om:Math.pow(om,e),new xl(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new xl(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new eo(OE(e>=240?e-240:e+120,i,r),OE(e,i,r),OE(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new xl(NR(this.h),ob(this.s),ob(this.l),ib(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=ib(this.opacity);return`${1===e?"hsl(":"hsla("}${NR(this.h)}, ${100*ob(this.s)}%, ${100*ob(this.l)}%${1===e?")":`, ${e})`}`}}));const sb=e=>()=>e;function BR(e,t){return function(n){return e+n*t}}function LE(e,t){var n=t-e;return n?BR(e,n>180||n<-180?n-360*Math.round(n/360):n):sb(isNaN(e)?t:e)}function to(e,t){var n=t-e;return n?BR(e,n):sb(isNaN(e)?t:e)}const mf=function e(t){var n=function aW(e){return 1==(e=+e)?to:function(t,n){return n-t?function sW(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):sb(isNaN(t)?n:t)}}(t);function r(i,a){var c=n((i=Oh(i)).r,(a=Oh(a)).r),d=n(i.g,a.g),p=n(i.b,a.b),v=to(i.opacity,a.opacity);return function(E){return i.r=c(E),i.g=d(E),i.b=p(E),i.opacity=v(E),i+""}}return r.gamma=e,r}(1);function VR(e){return function(t){var c,d,n=t.length,r=new Array(n),i=new Array(n),a=new Array(n);for(c=0;c<n;++c)d=Oh(t[c]),r[c]=d.r||0,i[c]=d.g||0,a[c]=d.b||0;return r=e(r),i=e(i),a=e(a),d.opacity=1,function(p){return d.r=r(p),d.g=i(p),d.b=a(p),d+""}}}var lW=VR(function iW(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1];return zR((n-r/t)*t,r>0?e[r-1]:2*i-a,i,a,r<t-1?e[r+2]:2*a-i)}}),NE=(VR(function oW(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t);return zR((n-r/t)*t,e[(r+t-1)%t],e[r%t],e[(r+1)%t],e[(r+2)%t])}}),/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g),zE=new RegExp(NE.source,"g");function UR(e,t){var r,i,a,n=NE.lastIndex=zE.lastIndex=0,c=-1,d=[],p=[];for(e+="",t+="";(r=NE.exec(e))&&(i=zE.exec(t));)(a=i.index)>n&&(a=t.slice(n,a),d[c]?d[c]+=a:d[++c]=a),(r=r[0])===(i=i[0])?d[c]?d[c]+=i:d[++c]=i:(d[++c]=null,p.push({i:c,x:$o(r,i)})),n=zE.lastIndex;return n<t.length&&(a=t.slice(n),d[c]?d[c]+=a:d[++c]=a),d.length<2?p[0]?function uW(e){return function(t){return e(t)+""}}(p[0].x):function cW(e){return function(){return e}}(t):(t=p.length,function(v){for(var D,E=0;E<t;++E)d[(D=p[E]).i]=D.x(v);return d.join("")})}function $R(e,t){var n;return("number"==typeof t?$o:t instanceof Fh?mf:(n=Fh(t))?(t=n,mf):UR)(e,t)}function hW(e){return function(){this.removeAttribute(e)}}function dW(e){return function(){this.removeAttributeNS(e.space,e.local)}}function fW(e,t,n){var r,a,i=n+"";return function(){var c=this.getAttribute(e);return c===i?null:c===r?a:a=t(r=c,n)}}function pW(e,t,n){var r,a,i=n+"";return function(){var c=this.getAttributeNS(e.space,e.local);return c===i?null:c===r?a:a=t(r=c,n)}}function mW(e,t,n){var r,i,a;return function(){var c,p,d=n(this);return null==d?void this.removeAttribute(e):(c=this.getAttribute(e))===(p=d+"")?null:c===r&&p===i?a:(i=p,a=t(r=c,d))}}function gW(e,t,n){var r,i,a;return function(){var c,p,d=n(this);return null==d?void this.removeAttributeNS(e.space,e.local):(c=this.getAttributeNS(e.space,e.local))===(p=d+"")?null:c===r&&p===i?a:(i=p,a=t(r=c,d))}}function _W(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function vW(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function bW(e,t){var n,r;function i(){var a=t.apply(this,arguments);return a!==r&&(n=(r=a)&&vW(e,a)),n}return i._value=t,i}function xW(e,t){var n,r;function i(){var a=t.apply(this,arguments);return a!==r&&(n=(r=a)&&_W(e,a)),n}return i._value=t,i}function CW(e,t){return function(){AE(this,e).delay=+t.apply(this,arguments)}}function EW(e,t){return t=+t,function(){AE(this,e).delay=t}}function SW(e,t){return function(){gc(this,e).duration=+t.apply(this,arguments)}}function MW(e,t){return t=+t,function(){gc(this,e).duration=t}}function IW(e,t){if("function"!=typeof t)throw new Error;return function(){gc(this,e).ease=t}}function LW(e,t,n){var r,i,a=function OW(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||"start"===t})}(t)?AE:gc;return function(){var c=a(this,e),d=c.on;d!==r&&(i=(r=d).copy()).on(t,n),c.on=i}}var $W=ky.prototype.constructor;function jR(e){return function(){this.style.removeProperty(e)}}function XW(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function YW(e,t,n){var r,i;function a(){var c=t.apply(this,arguments);return c!==i&&(r=(i=c)&&XW(e,c,n)),r}return a._value=t,a}function tX(e){return function(t){this.textContent=e.call(this,t)}}function nX(e){var t,n;function r(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&tX(i)),t}return r._value=e,r}var sX=0;function pu(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function HR(){return++sX}var mu=ky.prototype;pu.prototype=function aX(e){return ky().transition(e)}.prototype={constructor:pu,select:function VW(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=wE(e));for(var r=this._groups,i=r.length,a=new Array(i),c=0;c<i;++c)for(var E,D,d=r[c],p=d.length,v=a[c]=new Array(p),T=0;T<p;++T)(E=d[T])&&(D=e.call(E,E.__data__,T,d))&&("__data__"in E&&(D.__data__=E.__data__),v[T]=D,tb(v[T],t,n,T,v,bl(E,n)));return new pu(a,this._parents,t,n)},selectAll:function UW(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=iR(e));for(var r=this._groups,i=r.length,a=[],c=[],d=0;d<i;++d)for(var E,p=r[d],v=p.length,D=0;D<v;++D)if(E=p[D]){for(var P,T=e.call(E,E.__data__,D,p),N=bl(E,n),G=0,U=T.length;G<U;++G)(P=T[G])&&tb(P,t,n,G,T,N);a.push(T),c.push(E)}return new pu(a,c,t,n)},selectChild:mu.selectChild,selectChildren:mu.selectChildren,filter:function RW(e){"function"!=typeof e&&(e=oR(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var p,a=t[i],c=a.length,d=r[i]=[],v=0;v<c;++v)(p=a[v])&&e.call(p,p.__data__,v,a)&&d.push(p);return new pu(r,this._parents,this._name,this._id)},merge:function FW(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,a=Math.min(r,n.length),c=new Array(r),d=0;d<a;++d)for(var T,p=t[d],v=n[d],E=p.length,D=c[d]=new Array(E),P=0;P<E;++P)(T=p[P]||v[P])&&(D[P]=T);for(;d<r;++d)c[d]=t[d];return new pu(c,this._parents,this._name,this._id)},selection:function jW(){return new $W(this._groups,this._parents)},transition:function iX(){for(var e=this._name,t=this._id,n=HR(),r=this._groups,i=r.length,a=0;a<i;++a)for(var p,c=r[a],d=c.length,v=0;v<d;++v)if(p=c[v]){var E=bl(p,t);tb(p,e,n,v,c,{time:E.time+E.delay+E.duration,delay:0,duration:E.duration,ease:E.ease})}return new pu(r,this._parents,e,n)},call:mu.call,nodes:mu.nodes,node:mu.node,size:mu.size,empty:mu.empty,each:mu.each,on:function NW(e,t){var n=this._id;return arguments.length<2?bl(this.node(),n).on.on(e):this.each(LW(n,e,t))},attr:function yW(e,t){var n=Z0(e),r="transform"===n?HZ:$R;return this.attrTween(e,"function"==typeof t?(n.local?gW:mW)(n,r,PE(this,"attr."+e,t)):null==t?(n.local?dW:hW)(n):(n.local?pW:fW)(n,r,t))},attrTween:function wW(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var r=Z0(e);return this.tween(n,(r.local?bW:xW)(r,t))},style:function WW(e,t,n){var r="transform"==(e+="")?jZ:$R;return null==t?this.styleTween(e,function HW(e,t){var n,r,i;return function(){var a=nm(this,e),c=(this.style.removeProperty(e),nm(this,e));return a===c?null:a===n&&c===r?i:i=t(n=a,r=c)}}(e,r)).on("end.style."+e,jR(e)):"function"==typeof t?this.styleTween(e,function qW(e,t,n){var r,i,a;return function(){var c=nm(this,e),d=n(this),p=d+"";return null==d&&(this.style.removeProperty(e),p=d=nm(this,e)),c===p?null:c===r&&p===i?a:(i=p,a=t(r=c,d))}}(e,r,PE(this,"style."+e,t))).each(function ZW(e,t){var n,r,i,d,a="style."+t,c="end."+a;return function(){var p=gc(this,e),v=p.on,E=null==p.value[a]?d||(d=jR(t)):void 0;(v!==n||i!==E)&&(r=(n=v).copy()).on(c,i=E),p.on=r}}(this._id,e)):this.styleTween(e,function GW(e,t,n){var r,a,i=n+"";return function(){var c=nm(this,e);return c===i?null:c===r?a:a=t(r=c,n)}}(e,r,t),n).on("end.style."+e,null)},styleTween:function KW(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw new Error;return this.tween(r,YW(e,t,n??""))},text:function eX(e){return this.tween("text","function"==typeof e?function QW(e){return function(){var t=e(this);this.textContent=t??""}}(PE(this,"text",e)):function JW(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function rX(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,nX(e))},remove:function BW(){return this.on("end.remove",function zW(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function ZZ(e,t){var n=this._id;if(e+="",arguments.length<2){for(var c,r=bl(this.node(),n).tween,i=0,a=r.length;i<a;++i)if((c=r[i]).name===e)return c.value;return null}return this.each((null==t?GZ:qZ)(n,e,t))},delay:function DW(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?CW:EW)(t,e)):bl(this.node(),t).delay},duration:function TW(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?SW:MW)(t,e)):bl(this.node(),t).duration},ease:function AW(e){var t=this._id;return arguments.length?this.each(IW(t,e)):bl(this.node(),t).ease},easeVarying:function PW(e){if("function"!=typeof e)throw new Error;return this.each(function kW(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;gc(this,e).ease=n}}(this._id,e))},end:function oX(){var e,t,n=this,r=n._id,i=n.size();return new Promise(function(a,c){var d={value:c},p={value:function(){0==--i&&a()}};n.each(function(){var v=gc(this,r),E=v.on;E!==e&&((t=(e=E).copy())._.cancel.push(d),t._.interrupt.push(d),t._.end.push(p)),v.on=t}),0===i&&a()})},[Symbol.iterator]:mu[Symbol.iterator]};var cX={time:null,delay:0,duration:250,ease:function lX(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function uX(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}ky.prototype.interrupt=function VZ(e){return this.each(function(){!function BZ(e,t){var r,i,c,n=e.__transition,a=!0;if(n){for(c in t=null==t?null:t+"",n)(r=n[c]).name===t?(i=r.state>2&&r.state<5,r.state=6,r.timer.stop(),r.on.call(i?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[c]):a=!1;a&&delete e.__transition}}(this,e)})},ky.prototype.transition=function hX(e){var t,n;e instanceof pu?(t=e._id,e=e._name):(t=HR(),(n=cX).time=SE(),e=null==e?null:e+"");for(var r=this._groups,i=r.length,a=0;a<i;++a)for(var p,c=r[a],d=c.length,v=0;v<d;++v)(p=c[v])&&tb(p,e,t,v,c,n||uX(p,t));return new pu(r,this._parents,e,t)};Math;function zy(e){return{type:e}}function cb(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function cm(e){return(e=cb(Math.abs(e)))?e[1]:NaN}["w","e"].map(zy),["n","s"].map(zy),["n","w","e","s","nw","ne","sw","se"].map(zy);var YR,wX=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function By(e){if(!(t=wX.exec(e)))throw new Error("invalid format: "+e);var t;return new jE({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function jE(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function KR(e,t){var n=cb(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}By.prototype=jE.prototype,jE.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const JR={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function vX(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>KR(100*e,t),r:KR,s:function EX(e,t){var n=cb(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(YR=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,c=r.length;return a===c?r:a>c?r+new Array(a-c+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+cb(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function QR(e){return e}var ub,um,nF,eF=Array.prototype.map,tF=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];!function SX(e){ub=function DX(e){var t=void 0===e.grouping||void 0===e.thousands?QR:function bX(e,t){return function(n,r){for(var i=n.length,a=[],c=0,d=e[0],p=0;i>0&&d>0&&(p+d+1>r&&(d=Math.max(1,r-p)),a.push(n.substring(i-=d,i+d)),!((p+=d+1)>r));)d=e[c=(c+1)%e.length];return a.reverse().join(t)}}(eF.call(e.grouping,Number),e.thousands+""),n=void 0===e.currency?"":e.currency[0]+"",r=void 0===e.currency?"":e.currency[1]+"",i=void 0===e.decimal?".":e.decimal+"",a=void 0===e.numerals?QR:function xX(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}(eF.call(e.numerals,String)),c=void 0===e.percent?"%":e.percent+"",d=void 0===e.minus?"\u2212":e.minus+"",p=void 0===e.nan?"NaN":e.nan+"";function v(D){var T=(D=By(D)).fill,P=D.align,N=D.sign,G=D.symbol,U=D.zero,Z=D.width,ne=D.comma,X=D.precision,re=D.trim,fe=D.type;"n"===fe?(ne=!0,fe="g"):JR[fe]||(void 0===X&&(X=12),re=!0,fe="g"),(U||"0"===T&&"="===P)&&(U=!0,T="0",P="=");var ve="$"===G?n:"#"===G&&/[boxX]/.test(fe)?"0"+fe.toLowerCase():"",Re="$"===G?r:/[%p]/.test(fe)?c:"",We=JR[fe],Ke=/[defgprs%]/.test(fe);function lt(Ue){var le,de,pe,st=ve,Fe=Re;if("c"===fe)Fe=We(Ue)+Fe,Ue="";else{var Oe=(Ue=+Ue)<0||1/Ue<0;if(Ue=isNaN(Ue)?p:We(Math.abs(Ue),X),re&&(Ue=function CX(e){e:for(var i,t=e.length,n=1,r=-1;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":0===r&&(r=n),i=n;break;default:if(!+e[n])break e;r>0&&(r=0)}return r>0?e.slice(0,r)+e.slice(i+1):e}(Ue)),Oe&&0==+Ue&&"+"!==N&&(Oe=!1),st=(Oe?"("===N?N:d:"-"===N||"("===N?"":N)+st,Fe=("s"===fe?tF[8+YR/3]:"")+Fe+(Oe&&"("===N?")":""),Ke)for(le=-1,de=Ue.length;++le<de;)if(48>(pe=Ue.charCodeAt(le))||pe>57){Fe=(46===pe?i+Ue.slice(le+1):Ue.slice(le))+Fe,Ue=Ue.slice(0,le);break}}ne&&!U&&(Ue=t(Ue,1/0));var Ye=st.length+Ue.length+Fe.length,Ze=Ye<Z?new Array(Z-Ye+1).join(T):"";switch(ne&&U&&(Ue=t(Ze+Ue,Ze.length?Z-Fe.length:1/0),Ze=""),P){case"<":Ue=st+Ue+Fe+Ze;break;case"=":Ue=st+Ze+Ue+Fe;break;case"^":Ue=Ze.slice(0,Ye=Ze.length>>1)+st+Ue+Fe+Ze.slice(Ye);break;default:Ue=Ze+st+Ue+Fe}return a(Ue)}return X=void 0===X?6:/[gprs]/.test(fe)?Math.max(1,Math.min(21,X)):Math.max(0,Math.min(20,X)),lt.toString=function(){return D+""},lt}return{format:v,formatPrefix:function E(D,T){var P=v(((D=By(D)).type="f",D)),N=3*Math.max(-8,Math.min(8,Math.floor(cm(T)/3))),G=Math.pow(10,-N),U=tF[8+N/3];return function(Z){return P(G*Z)+U}}}}(e),um=ub.format,nF=ub.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]});var hn=1e-6,Dn=Math.PI,ni=Dn/2,iF=Dn/4,Ks=2*Dn,as=180/Dn,ri=Dn/180,mr=Math.abs,hm=Math.atan,yu=Math.atan2,bn=Math.cos,oF=(Math,Math.exp),hb=(Math,Math,Math.log),HE=Math.pow,on=Math.sin,Da=Math.sign||function(e){return e>0?1:e<0?-1:0},Is=Math.sqrt,GE=Math.tan;function sF(e){return e>1?0:e<-1?Dn:Math.acos(e)}function Sa(e){return e>1?ni:e<-1?-ni:Math.asin(e)}function Ma(){}function aF(){var t,e=[];return{point:function(n,r,i){t.push([n,r,i])},lineStart:function(){e.push(t=[])},lineEnd:Ma,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function db(e,t){return mr(e[0]-t[0])<hn&&mr(e[1]-t[1])<hn}function fb(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function lF(e,t,n,r,i){var d,p,a=[],c=[];if(e.forEach(function(N){if(!((G=N.length-1)<=0)){var G,ne,U=N[0],Z=N[G];if(db(U,Z)){if(!U[2]&&!Z[2]){for(i.lineStart(),d=0;d<G;++d)i.point((U=N[d])[0],U[1]);return void i.lineEnd()}Z[0]+=2*hn}a.push(ne=new fb(U,N,null,!0)),c.push(ne.o=new fb(U,null,ne,!1)),a.push(ne=new fb(Z,N,null,!1)),c.push(ne.o=new fb(Z,null,ne,!0))}}),a.length){for(c.sort(t),cF(a),cF(c),d=0,p=c.length;d<p;++d)c[d].e=n=!n;for(var E,D,v=a[0];;){for(var T=v,P=!0;T.v;)if((T=T.n)===v)return;E=T.z,i.lineStart();do{if(T.v=T.o.v=!0,T.e){if(P)for(d=0,p=E.length;d<p;++d)i.point((D=E[d])[0],D[1]);else r(T.x,T.n.x,1,i);T=T.n}else{if(P)for(d=(E=T.p.z).length-1;d>=0;--d)i.point((D=E[d])[0],D[1]);else r(T.x,T.p.x,-1,i);T=T.p}E=(T=T.o).z,P=!P}while(!T.v);i.lineEnd()}}}function cF(e){if(t=e.length){for(var t,i,n=0,r=e[0];++n<t;)r.n=i=e[n],i.p=r,r=i;r.n=i=e[0],i.p=r}}function uF(e){return Array.from(function*TX(e){for(const t of e)yield*t}(e))}var Vy=1e9,pb=-Vy;function hF(e,t,n,r){function i(v,E){return e<=v&&v<=n&&t<=E&&E<=r}function a(v,E,D,T){var P=0,N=0;if(null==v||(P=c(v,D))!==(N=c(E,D))||p(v,E)<0^D>0)do{T.point(0===P||3===P?e:n,P>1?r:t)}while((P=(P+D+4)%4)!==N);else T.point(E[0],E[1])}function c(v,E){return mr(v[0]-e)<hn?E>0?0:3:mr(v[0]-n)<hn?E>0?2:1:mr(v[1]-t)<hn?E>0?1:0:E>0?3:2}function d(v,E){return p(v.x,E.x)}function p(v,E){var D=c(v,1),T=c(E,1);return D!==T?D-T:0===D?E[1]-v[1]:1===D?v[0]-E[0]:2===D?v[1]-E[1]:E[0]-v[0]}return function(v){var T,P,N,G,U,Z,ne,X,re,fe,ve,E=v,D=aF(),Re={point:We,lineStart:function st(){Re.point=le,P&&P.push(N=[]),fe=!0,re=!1,ne=X=NaN},lineEnd:function Fe(){T&&(le(G,U),Z&&re&&D.rejoin(),T.push(D.result())),Re.point=We,re&&E.lineEnd()},polygonStart:function lt(){E=D,T=[],P=[],ve=!0},polygonEnd:function Ue(){var de=function Ke(){for(var de=0,pe=0,Oe=P.length;pe<Oe;++pe)for(var Ft,sr,Ye=P[pe],Ze=1,et=Ye.length,_t=Ye[0],Hn=_t[0],gr=_t[1];Ze<et;++Ze)Ft=Hn,sr=gr,Hn=(_t=Ye[Ze])[0],gr=_t[1],sr<=r?gr>r&&(Hn-Ft)*(r-sr)>(gr-sr)*(e-Ft)&&++de:gr<=r&&(Hn-Ft)*(r-sr)<(gr-sr)*(e-Ft)&&--de;return de}(),pe=ve&&de,Oe=(T=uF(T)).length;(pe||Oe)&&(v.polygonStart(),pe&&(v.lineStart(),a(null,null,1,v),v.lineEnd()),Oe&&lF(T,d,de,a,v),v.polygonEnd()),E=v,T=P=N=null}};function We(de,pe){i(de,pe)&&E.point(de,pe)}function le(de,pe){var Oe=i(de,pe);if(P&&N.push([de,pe]),fe)G=de,U=pe,Z=Oe,fe=!1,Oe&&(E.lineStart(),E.point(de,pe));else if(Oe&&re)E.point(de,pe);else{var Ye=[ne=Math.max(pb,Math.min(Vy,ne)),X=Math.max(pb,Math.min(Vy,X))],Ze=[de=Math.max(pb,Math.min(Vy,de)),pe=Math.max(pb,Math.min(Vy,pe))];!function MX(e,t,n,r,i,a){var N,c=e[0],d=e[1],E=0,D=1,T=t[0]-c,P=t[1]-d;if(N=n-c,T||!(N>0)){if(N/=T,T<0){if(N<E)return;N<D&&(D=N)}else if(T>0){if(N>D)return;N>E&&(E=N)}if(N=i-c,T||!(N<0)){if(N/=T,T<0){if(N>D)return;N>E&&(E=N)}else if(T>0){if(N<E)return;N<D&&(D=N)}if(N=r-d,P||!(N>0)){if(N/=P,P<0){if(N<E)return;N<D&&(D=N)}else if(P>0){if(N>D)return;N>E&&(E=N)}if(N=a-d,P||!(N<0)){if(N/=P,P<0){if(N>D)return;N>E&&(E=N)}else if(P>0){if(N<E)return;N<D&&(D=N)}return E>0&&(e[0]=c+E*T,e[1]=d+E*P),D<1&&(t[0]=c+D*T,t[1]=d+D*P),!0}}}}}(Ye,Ze,e,t,n,r)?Oe&&(E.lineStart(),E.point(de,pe),ve=!1):(re||(E.lineStart(),E.point(Ye[0],Ye[1])),E.point(Ze[0],Ze[1]),Oe||E.lineEnd(),ve=!1)}ne=de,X=pe,re=Oe}return Re}}const qE=e=>e;function mb(e,t){e&&fF.hasOwnProperty(e.type)&&fF[e.type](e,t)}var dF={Feature:function(e,t){mb(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)mb(n[r].geometry,t)}},fF={Sphere:function(e,t){t.sphere()},Point:function(e,t){t.point((e=e.coordinates)[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)t.point((e=n[r])[0],e[1],e[2])},LineString:function(e,t){ZE(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)ZE(n[r],t,0)},Polygon:function(e,t){pF(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)pF(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)mb(n[r],t)}};function ZE(e,t,n){var a,r=-1,i=e.length-n;for(t.lineStart();++r<i;)t.point((a=e[r])[0],a[1],a[2]);t.lineEnd()}function pF(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)ZE(e[n],t,1);t.polygonEnd()}function dm(e,t){e&&dF.hasOwnProperty(e.type)?dF[e.type](e,t):mb(e,t)}class _u{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const a=n[i],c=t+a,d=Math.abs(t)<Math.abs(a)?t-(c-a):a-(c-t);d&&(n[r++]=d),t=c}return n[r]=t,this._n=r+1,this}valueOf(){const t=this._partials;let r,i,a,n=this._n,c=0;if(n>0){for(c=t[--n];n>0&&(r=c,i=t[--n],c=r+i,a=i-(c-r),!a););n>0&&(a<0&&t[n-1]<0||a>0&&t[n-1]>0)&&(i=2*a,r=c+i,i==r-c&&(c=r))}return c}}var mF,gF,YE,KE,WE=new _u,XE=new _u,Lh={point:Ma,lineStart:Ma,lineEnd:Ma,polygonStart:function(){Lh.lineStart=IX,Lh.lineEnd=kX},polygonEnd:function(){Lh.lineStart=Lh.lineEnd=Lh.point=Ma,WE.add(mr(XE)),XE=new _u},result:function(){var e=WE/2;return WE=new _u,e}};function IX(){Lh.point=AX}function AX(e,t){Lh.point=yF,mF=YE=e,gF=KE=t}function yF(e,t){XE.add(KE*e-YE*t),YE=e,KE=t}function kX(){yF(mF,gF)}const _F=Lh;var fm=1/0,gb=fm,Uy=-fm,yb=Uy;const _b={point:function RX(e,t){e<fm&&(fm=e),e>Uy&&(Uy=e),t<gb&&(gb=t),t>yb&&(yb=t)},lineStart:Ma,lineEnd:Ma,polygonStart:Ma,polygonEnd:Ma,result:function(){var e=[[fm,gb],[Uy,yb]];return Uy=yb=-(gb=fm=1/0),e}};var vF,bF,_c,vc,JE=0,QE=0,$y=0,vb=0,bb=0,pm=0,eD=0,tD=0,jy=0,wl={point:gf,lineStart:xF,lineEnd:wF,polygonStart:function(){wl.lineStart=LX,wl.lineEnd=NX},polygonEnd:function(){wl.point=gf,wl.lineStart=xF,wl.lineEnd=wF},result:function(){var e=jy?[eD/jy,tD/jy]:pm?[vb/pm,bb/pm]:$y?[JE/$y,QE/$y]:[NaN,NaN];return JE=QE=$y=vb=bb=pm=eD=tD=jy=0,e}};function gf(e,t){JE+=e,QE+=t,++$y}function xF(){wl.point=FX}function FX(e,t){wl.point=OX,gf(_c=e,vc=t)}function OX(e,t){var n=e-_c,r=t-vc,i=Is(n*n+r*r);vb+=i*(_c+e)/2,bb+=i*(vc+t)/2,pm+=i,gf(_c=e,vc=t)}function wF(){wl.point=gf}function LX(){wl.point=zX}function NX(){CF(vF,bF)}function zX(e,t){wl.point=CF,gf(vF=_c=e,bF=vc=t)}function CF(e,t){var n=e-_c,r=t-vc,i=Is(n*n+r*r);vb+=i*(_c+e)/2,bb+=i*(vc+t)/2,pm+=i,eD+=(i=vc*e-_c*t)*(_c+e),tD+=i*(vc+t),jy+=3*i,gf(_c=e,vc=t)}const EF=wl;function DF(e){this._context=e}DF.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Ks)}},result:Ma};var rD,SF,MF,Hy,Gy,nD=new _u,xb={point:Ma,lineStart:function(){xb.point=BX},lineEnd:function(){rD&&TF(SF,MF),xb.point=Ma},polygonStart:function(){rD=!0},polygonEnd:function(){rD=null},result:function(){var e=+nD;return nD=new _u,e}};function BX(e,t){xb.point=TF,SF=Hy=e,MF=Gy=t}function TF(e,t){nD.add(Is((Hy-=e)*Hy+(Gy-=t)*Gy)),Hy=e,Gy=t}const IF=xb;let AF,wb,kF,PF;class RF{constructor(t){this._append=null==t?FF:function VX(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return FF;if(t!==AF){const n=10**t;AF=t,wb=function(i){let a=1;this._+=i[0];for(const c=i.length;a<c;++a)this._+=Math.round(arguments[a]*n)/n+i[a]}}return wb}(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){0===this._line&&(this._+="Z"),this._point=NaN}point(t,n){switch(this._point){case 0:this._append`M${t},${n}`,this._point=1;break;case 1:this._append`L${t},${n}`;break;default:if(this._append`M${t},${n}`,this._radius!==kF||this._append!==wb){const r=this._radius,i=this._;this._="",this._append`m0,${r}a${r},${r} 0 1,1 0,${-2*r}a${r},${r} 0 1,1 0,${2*r}z`,kF=r,wb=this._append,PF=this._,this._=i}this._+=PF}}result(){const t=this._;return this._="",t.length?t:null}}function FF(e){let t=1;this._+=e[0];for(const n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function iD(e,t){let i,a,n=3,r=4.5;function c(d){return d&&("function"==typeof r&&a.pointRadius(+r.apply(this,arguments)),dm(d,i(a))),a.result()}return c.area=function(d){return dm(d,i(_F)),_F.result()},c.measure=function(d){return dm(d,i(IF)),IF.result()},c.bounds=function(d){return dm(d,i(_b)),_b.result()},c.centroid=function(d){return dm(d,i(EF)),EF.result()},c.projection=function(d){return arguments.length?(i=null==d?(e=null,qE):(e=d).stream,c):e},c.context=function(d){return arguments.length?(a=null==d?(t=null,new RF(n)):new DF(t=d),"function"!=typeof r&&a.pointRadius(r),c):t},c.pointRadius=function(d){return arguments.length?(r="function"==typeof d?d:(a.pointRadius(+d),+d),c):r},c.digits=function(d){if(!arguments.length)return n;if(null==d)n=null;else{const p=Math.floor(d);if(!(p>=0))throw new RangeError(`invalid digits: ${d}`);n=p}return null===t&&(a=new RF(n)),c},c.projection(e).digits(n).context(t)}function oD(e){return[yu(e[1],e[0]),Sa(e[2])]}function mm(e){var t=e[0],n=e[1],r=bn(n);return[r*bn(t),r*on(t),on(n)]}function Cb(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Eb(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function sD(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Db(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function aD(e){var t=Is(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function lD(e){return mr(e[0])<=Dn?e[0]:Da(e[0])*((mr(e[0])+Dn)%Ks-Dn)}function OF(e,t,n,r){return function(i){var v,E,D,a=t(i),c=aF(),d=t(c),p=!1,T={point:P,lineStart:G,lineEnd:U,polygonStart:function(){T.point=Z,T.lineStart=ne,T.lineEnd=X,E=[],v=[]},polygonEnd:function(){T.point=P,T.lineStart=G,T.lineEnd=U,E=uF(E);var re=function UX(e,t){var n=lD(t),r=t[1],i=on(r),a=[on(n),-bn(n),0],c=0,d=0,p=new _u;1===i?r=ni+hn:-1===i&&(r=-ni-hn);for(var v=0,E=e.length;v<E;++v)if(T=(D=e[v]).length)for(var D,T,P=D[T-1],N=lD(P),G=P[1]/2+iF,U=on(G),Z=bn(G),ne=0;ne<T;++ne,N=re,U=ve,Z=Re,P=X){var X=D[ne],re=lD(X),fe=X[1]/2+iF,ve=on(fe),Re=bn(fe),We=re-N,Ke=We>=0?1:-1,lt=Ke*We,Ue=lt>Dn,st=U*ve;if(p.add(yu(st*Ke*on(lt),Z*Re+st*bn(lt))),c+=Ue?We+Ke*Ks:We,Ue^N>=n^re>=n){var Fe=Eb(mm(P),mm(X));aD(Fe);var le=Eb(a,Fe);aD(le);var de=(Ue^We>=0?-1:1)*Sa(le[2]);(r>de||r===de&&(Fe[0]||Fe[1]))&&(d+=Ue^We>=0?1:-1)}}return(c<-hn||c<hn&&p<-1e-12)^1&d}(v,r);E.length?(p||(i.polygonStart(),p=!0),lF(E,jX,re,n,i)):re&&(p||(i.polygonStart(),p=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),p&&(i.polygonEnd(),p=!1),E=v=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function P(re,fe){e(re,fe)&&i.point(re,fe)}function N(re,fe){a.point(re,fe)}function G(){T.point=N,a.lineStart()}function U(){T.point=P,a.lineEnd()}function Z(re,fe){D.push([re,fe]),d.point(re,fe)}function ne(){d.lineStart(),D=[]}function X(){Z(D[0][0],D[0][1]),d.lineEnd();var ve,We,Ke,lt,re=d.clean(),fe=c.result(),Re=fe.length;if(D.pop(),v.push(D),D=null,Re){if(1&re){if((We=(Ke=fe[0]).length-1)>0){for(p||(i.polygonStart(),p=!0),i.lineStart(),ve=0;ve<We;++ve)i.point((lt=Ke[ve])[0],lt[1]);i.lineEnd()}return}Re>1&&2&re&&fe.push(fe.pop().concat(fe.shift())),E.push(fe.filter($X))}}return T}}function $X(e){return e.length>1}function jX(e,t){return((e=e.x)[0]<0?e[1]-ni-hn:ni-e[1])-((t=t.x)[0]<0?t[1]-ni-hn:ni-t[1])}const LF=OF(function(){return!0},function HX(e){var i,t=NaN,n=NaN,r=NaN;return{lineStart:function(){e.lineStart(),i=1},point:function(a,c){var d=a>0?Dn:-Dn,p=mr(a-t);mr(p-Dn)<hn?(e.point(t,n=(n+c)/2>0?ni:-ni),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(d,n),e.point(a,n),i=0):r!==d&&p>=Dn&&(mr(t-r)<hn&&(t-=r*hn),mr(a-d)<hn&&(a-=d*hn),n=function GX(e,t,n,r){var i,a,c=on(e-n);return mr(c)>hn?hm((on(t)*(a=bn(r))*on(n)-on(r)*(i=bn(t))*on(e))/(i*a*c)):(t+r)/2}(t,n,a,c),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(d,n),i=0),e.point(t=a,n=c),r=d},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-i}}},function qX(e,t,n,r){var i;if(null==e)r.point(-Dn,i=n*ni),r.point(0,i),r.point(Dn,i),r.point(Dn,0),r.point(Dn,-i),r.point(0,-i),r.point(-Dn,-i),r.point(-Dn,0),r.point(-Dn,i);else if(mr(e[0]-t[0])>hn){var a=e[0]<t[0]?Dn:-Dn;r.point(-a,i=n*a/2),r.point(0,i),r.point(a,i)}else r.point(t[0],t[1])},[-Dn,-ni]);function zF(e,t){(t=mm(t))[0]-=e,aD(t);var n=sF(-t[1]);return((-t[2]<0?-n:n)+Ks-hn)%Ks}function ZX(e){var t=bn(e),n=6*ri,r=t>0,i=mr(t)>hn;function c(E,D){return bn(E)*bn(D)>t}function p(E,D,T){var G=[1,0,0],U=Eb(mm(E),mm(D)),Z=Cb(U,U),ne=U[0],X=Z-ne*ne;if(!X)return!T&&E;var re=t*Z/X,fe=-t*ne/X,ve=Eb(G,U),Re=Db(G,re);sD(Re,Db(U,fe));var Ke=ve,lt=Cb(Re,Ke),Ue=Cb(Ke,Ke),st=lt*lt-Ue*(Cb(Re,Re)-1);if(!(st<0)){var Fe=Is(st),le=Db(Ke,(-lt-Fe)/Ue);if(sD(le,Re),le=oD(le),!T)return le;var Ze,de=E[0],pe=D[0],Oe=E[1],Ye=D[1];pe<de&&(Ze=de,de=pe,pe=Ze);var et=pe-de,_t=mr(et-Dn)<hn;if(!_t&&Ye<Oe&&(Ze=Oe,Oe=Ye,Ye=Ze),_t||et<hn?_t?Oe+Ye>0^le[1]<(mr(le[0]-de)<hn?Oe:Ye):Oe<=le[1]&&le[1]<=Ye:et>Dn^(de<=le[0]&&le[0]<=pe)){var sr=Db(Ke,(-lt+Fe)/Ue);return sD(sr,Re),[le,oD(sr)]}}}function v(E,D){var T=r?e:Dn-e,P=0;return E<-T?P|=1:E>T&&(P|=2),D<-T?P|=4:D>T&&(P|=8),P}return OF(c,function d(E){var D,T,P,N,G;return{lineStart:function(){N=P=!1,G=1},point:function(U,Z){var X,ne=[U,Z],re=c(U,Z),fe=r?re?0:v(U,Z):re?v(U+(U<0?Dn:-Dn),Z):0;if(!D&&(N=P=re)&&E.lineStart(),re!==P&&(!(X=p(D,ne))||db(D,X)||db(ne,X))&&(ne[2]=1),re!==P)G=0,re?(E.lineStart(),X=p(ne,D),E.point(X[0],X[1])):(X=p(D,ne),E.point(X[0],X[1],2),E.lineEnd()),D=X;else if(i&&D&&r^re){var ve;!(fe&T)&&(ve=p(ne,D,!0))&&(G=0,r?(E.lineStart(),E.point(ve[0][0],ve[0][1]),E.point(ve[1][0],ve[1][1]),E.lineEnd()):(E.point(ve[1][0],ve[1][1]),E.lineEnd(),E.lineStart(),E.point(ve[0][0],ve[0][1],3)))}re&&(!D||!db(D,ne))&&E.point(ne[0],ne[1]),D=ne,P=re,T=fe},lineEnd:function(){P&&E.lineEnd(),D=null},clean:function(){return G|(N&&P)<<1}}},function a(E,D,T,P){!function NF(e,t,n,r,i,a){if(n){var c=bn(t),d=on(t),p=r*n;null==i?(i=t+r*Ks,a=t-p/2):(i=zF(c,i),a=zF(c,a),(r>0?i<a:i>a)&&(i+=r*Ks));for(var v,E=i;r>0?E>a:E<a;E-=p)v=oD([c,-d*bn(E),-d*on(E)]),e.point(v[0],v[1])}}(P,e,n,T,E,D)},r?[0,-e]:[-Dn,e-Dn])}function cD(e,t){function n(r,i){return r=e(r,i),t(r[0],r[1])}return e.invert&&t.invert&&(n.invert=function(r,i){return(r=t.invert(r,i))&&e.invert(r[0],r[1])}),n}function uD(e,t){return mr(e)>Dn&&(e-=Math.round(e/Ks)*Ks),[e,t]}function BF(e,t,n){return(e%=Ks)?t||n?cD(UF(e),$F(t,n)):UF(e):t||n?$F(t,n):uD}function VF(e){return function(t,n){return mr(t+=e)>Dn&&(t-=Math.round(t/Ks)*Ks),[t,n]}}function UF(e){var t=VF(e);return t.invert=VF(-e),t}function $F(e,t){var n=bn(e),r=on(e),i=bn(t),a=on(t);function c(d,p){var v=bn(p),E=bn(d)*v,D=on(d)*v,T=on(p),P=T*n+E*r;return[yu(D*i-P*a,E*n-T*r),Sa(P*i+D*a)]}return c.invert=function(d,p){var v=bn(p),E=bn(d)*v,D=on(d)*v,T=on(p),P=T*i-D*a;return[yu(D*i+T*a,E*n+P*r),Sa(P*n-E*r)]},c}function hD(e){return{stream:Sb(e)}}function Sb(e){return function(t){var n=new dD;for(var r in e)n[r]=e[r];return n.stream=t,n}}function dD(){}function fD(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=r&&e.clipExtent(null),dm(n,e.stream(_b)),t(_b.result()),null!=r&&e.clipExtent(r),e}function pD(e,t,n){return fD(e,function(r){var i=t[1][0]-t[0][0],a=t[1][1]-t[0][1],c=Math.min(i/(r[1][0]-r[0][0]),a/(r[1][1]-r[0][1])),d=+t[0][0]+(i-c*(r[1][0]+r[0][0]))/2,p=+t[0][1]+(a-c*(r[1][1]+r[0][1]))/2;e.scale(150*c).translate([d,p])},n)}function jF(e,t,n){return pD(e,[[0,0],t],n)}function HF(e,t,n){return fD(e,function(r){var i=+t,a=i/(r[1][0]-r[0][0]),c=(i-a*(r[1][0]+r[0][0]))/2,d=-a*r[0][1];e.scale(150*a).translate([c,d])},n)}function GF(e,t,n){return fD(e,function(r){var i=+t,a=i/(r[1][1]-r[0][1]),c=-a*r[0][0],d=(i-a*(r[1][1]+r[0][1]))/2;e.scale(150*a).translate([c,d])},n)}uD.invert=uD,dD.prototype={constructor:dD,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var XX=bn(30*ri);function ZF(e,t){return+t?function KX(e,t){function n(r,i,a,c,d,p,v,E,D,T,P,N,G,U){var Z=v-r,ne=E-i,X=Z*Z+ne*ne;if(X>4*t&&G--){var re=c+T,fe=d+P,ve=p+N,Re=Is(re*re+fe*fe+ve*ve),We=Sa(ve/=Re),Ke=mr(mr(ve)-1)<hn||mr(a-D)<hn?(a+D)/2:yu(fe,re),lt=e(Ke,We),Ue=lt[0],st=lt[1],Fe=Ue-r,le=st-i,de=ne*Fe-Z*le;(de*de/X>t||mr((Z*Fe+ne*le)/X-.5)>.3||c*T+d*P+p*N<XX)&&(n(r,i,a,c,d,p,Ue,st,Ke,re/=Re,fe/=Re,ve,G,U),U.point(Ue,st),n(Ue,st,Ke,re,fe,ve,v,E,D,T,P,N,G,U))}}return function(r){var i,a,c,d,p,v,E,D,T,P,N,G,U={point:Z,lineStart:ne,lineEnd:re,polygonStart:function(){r.polygonStart(),U.lineStart=fe},polygonEnd:function(){r.polygonEnd(),U.lineStart=ne}};function Z(We,Ke){We=e(We,Ke),r.point(We[0],We[1])}function ne(){D=NaN,U.point=X,r.lineStart()}function X(We,Ke){var lt=mm([We,Ke]),Ue=e(We,Ke);n(D,T,E,P,N,G,D=Ue[0],T=Ue[1],E=We,P=lt[0],N=lt[1],G=lt[2],16,r),r.point(D,T)}function re(){U.point=Z,r.lineEnd()}function fe(){ne(),U.point=ve,U.lineEnd=Re}function ve(We,Ke){X(i=We,Ke),a=D,c=T,d=P,p=N,v=G,U.point=X}function Re(){n(D,T,E,P,N,G,a,c,i,d,p,v,16,r),U.lineEnd=re,re()}return U}}(e,t):function YX(e){return Sb({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var JX=Sb({point:function(e,t){this.stream.point(e*ri,t*ri)}});function WF(e,t,n,r,i,a){if(!a)return function eY(e,t,n,r,i){function a(c,d){return[t+e*(c*=r),n-e*(d*=i)]}return a.invert=function(c,d){return[(c-t)/e*r,(n-d)/e*i]},a}(e,t,n,r,i);var c=bn(a),d=on(a),p=c*e,v=d*e,E=c/e,D=d/e,T=(d*n-c*t)/e,P=(d*t+c*n)/e;function N(G,U){return[p*(G*=r)-v*(U*=i)+t,n-v*G-p*U]}return N.invert=function(G,U){return[r*(E*G-D*U+T),i*(P-D*G-E*U)]},N}function Nh(e){return XF(function(){return e})()}function XF(e){var t,E,Z,ne,X,ve,Re,We,Ke,lt,n=150,r=480,i=250,a=0,c=0,d=0,p=0,v=0,D=0,T=1,P=1,N=null,G=LF,U=null,re=qE,fe=.5;function Ue(de){return We(de[0]*ri,de[1]*ri)}function st(de){return(de=We.invert(de[0],de[1]))&&[de[0]*as,de[1]*as]}function Fe(){var de=WF(n,0,0,T,P,D).apply(null,t(a,c)),pe=WF(n,r-de[0],i-de[1],T,P,D);return E=BF(d,p,v),Re=cD(t,pe),We=cD(E,Re),ve=ZF(Re,fe),le()}function le(){return Ke=lt=null,Ue}return Ue.stream=function(de){return Ke&&lt===de?Ke:Ke=JX(function QX(e){return Sb({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}(E)(G(ve(re(lt=de)))))},Ue.preclip=function(de){return arguments.length?(G=de,N=void 0,le()):G},Ue.postclip=function(de){return arguments.length?(re=de,U=Z=ne=X=null,le()):re},Ue.clipAngle=function(de){return arguments.length?(G=+de?ZX(N=de*ri):(N=null,LF),le()):N*as},Ue.clipExtent=function(de){return arguments.length?(re=null==de?(U=Z=ne=X=null,qE):hF(U=+de[0][0],Z=+de[0][1],ne=+de[1][0],X=+de[1][1]),le()):null==U?null:[[U,Z],[ne,X]]},Ue.scale=function(de){return arguments.length?(n=+de,Fe()):n},Ue.translate=function(de){return arguments.length?(r=+de[0],i=+de[1],Fe()):[r,i]},Ue.center=function(de){return arguments.length?(a=de[0]%360*ri,c=de[1]%360*ri,Fe()):[a*as,c*as]},Ue.rotate=function(de){return arguments.length?(d=de[0]%360*ri,p=de[1]%360*ri,v=de.length>2?de[2]%360*ri:0,Fe()):[d*as,p*as,v*as]},Ue.angle=function(de){return arguments.length?(D=de%360*ri,Fe()):D*as},Ue.reflectX=function(de){return arguments.length?(T=de?-1:1,Fe()):T<0},Ue.reflectY=function(de){return arguments.length?(P=de?-1:1,Fe()):P<0},Ue.precision=function(de){return arguments.length?(ve=ZF(Re,fe=de*de),le()):Is(fe)},Ue.fitExtent=function(de,pe){return pD(Ue,de,pe)},Ue.fitSize=function(de,pe){return jF(Ue,de,pe)},Ue.fitWidth=function(de,pe){return HF(Ue,de,pe)},Ue.fitHeight=function(de,pe){return GF(Ue,de,pe)},function(){return t=e.apply(this,arguments),Ue.invert=t.invert&&st,Fe()}}function mD(e){var t=0,n=Dn/3,r=XF(e),i=r(t,n);return i.parallels=function(a){return arguments.length?r(t=a[0]*ri,n=a[1]*ri):[t*as,n*as]},i}function nY(e,t){var n=on(e),r=(n+on(t))/2;if(mr(r)<hn)return function tY(e){var t=bn(e);function n(r,i){return[r*t,on(i)/t]}return n.invert=function(r,i){return[r/t,Sa(i*t)]},n}(e);var i=1+n*(2*r-n),a=Is(i)/r;function c(d,p){var v=Is(i-2*r*on(p))/r;return[v*on(d*=r),a-v*bn(d)]}return c.invert=function(d,p){var v=a-p,E=yu(d,mr(v))*Da(v);return v*r<0&&(E-=Dn*Da(d)*Da(v)),[E/r,Sa((i-(d*d+v*v)*r*r)/(2*r))]},c}function Mb(){return mD(nY).scale(155.424).center([0,33.6442])}function YF(){return Mb().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function iY(){var e,t,r,a,d,p,n=YF(),i=Mb().rotate([154,0]).center([-2,58.5]).parallels([55,65]),c=Mb().rotate([157,0]).center([-3,19.9]).parallels([8,18]),v={point:function(T,P){p=[T,P]}};function E(T){var P=T[0],N=T[1];return p=null,r.point(P,N),p||(a.point(P,N),p)||(d.point(P,N),p)}function D(){return e=t=null,E}return E.invert=function(T){var P=n.scale(),N=n.translate(),G=(T[0]-N[0])/P,U=(T[1]-N[1])/P;return(U>=.12&&U<.234&&G>=-.425&&G<-.214?i:U>=.166&&U<.234&&G>=-.214&&G<-.115?c:n).invert(T)},E.stream=function(T){return e&&t===T?e:e=function rY(e){var t=e.length;return{point:function(n,r){for(var i=-1;++i<t;)e[i].point(n,r)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}([n.stream(t=T),i.stream(T),c.stream(T)])},E.precision=function(T){return arguments.length?(n.precision(T),i.precision(T),c.precision(T),D()):n.precision()},E.scale=function(T){return arguments.length?(n.scale(T),i.scale(.35*T),c.scale(T),E.translate(n.translate())):n.scale()},E.translate=function(T){if(!arguments.length)return n.translate();var P=n.scale(),N=+T[0],G=+T[1];return r=n.translate(T).clipExtent([[N-.455*P,G-.238*P],[N+.455*P,G+.238*P]]).stream(v),a=i.translate([N-.307*P,G+.201*P]).clipExtent([[N-.425*P+hn,G+.12*P+hn],[N-.214*P-hn,G+.234*P-hn]]).stream(v),d=c.translate([N-.205*P,G+.212*P]).clipExtent([[N-.214*P+hn,G+.166*P+hn],[N-.115*P-hn,G+.234*P-hn]]).stream(v),D()},E.fitExtent=function(T,P){return pD(E,T,P)},E.fitSize=function(T,P){return jF(E,T,P)},E.fitWidth=function(T,P){return HF(E,T,P)},E.fitHeight=function(T,P){return GF(E,T,P)},E.scale(1070)}function KF(e){return function(t,n){var r=bn(t),i=bn(n),a=e(r*i);return a===1/0?[2,0]:[a*i*on(t),a*on(n)]}}function qy(e){return function(t,n){var r=Is(t*t+n*n),i=e(r),a=on(i),c=bn(i);return[yu(t*a,r*c),Sa(r&&n*a/r)]}}var JF=KF(function(e){return Is(2/(1+e))});function oY(){return Nh(JF).scale(124.75).clipAngle(179.999)}JF.invert=qy(function(e){return 2*Sa(e/2)});var QF=KF(function(e){return(e=sF(e))&&e/on(e)});function sY(){return Nh(QF).scale(79.4188).clipAngle(179.999)}function Tb(e,t){return[e,hb(GE((ni+t)/2))]}function aY(){return eO(Tb).scale(961/Ks)}function eO(e){var d,p,v,t=Nh(e),n=t.center,r=t.scale,i=t.translate,a=t.clipExtent,c=null;function E(){var D=Dn*r(),T=t(function WX(e){function t(n){return(n=e(n[0]*ri,n[1]*ri))[0]*=as,n[1]*=as,n}return e=BF(e[0]*ri,e[1]*ri,e.length>2?e[2]*ri:0),t.invert=function(n){return(n=e.invert(n[0]*ri,n[1]*ri))[0]*=as,n[1]*=as,n},t}(t.rotate()).invert([0,0]));return a(null==c?[[T[0]-D,T[1]-D],[T[0]+D,T[1]+D]]:e===Tb?[[Math.max(T[0]-D,c),d],[Math.min(T[0]+D,p),v]]:[[c,Math.max(T[1]-D,d)],[p,Math.min(T[1]+D,v)]])}return t.scale=function(D){return arguments.length?(r(D),E()):r()},t.translate=function(D){return arguments.length?(i(D),E()):i()},t.center=function(D){return arguments.length?(n(D),E()):n()},t.clipExtent=function(D){return arguments.length?(null==D?c=d=p=v=null:(c=+D[0][0],d=+D[0][1],p=+D[1][0],v=+D[1][1]),E()):null==c?null:[[c,d],[p,v]]},E()}function Ib(e){return GE((ni+e)/2)}function lY(e,t){var n=bn(e),r=e===t?on(e):hb(n/bn(t))/hb(Ib(t)/Ib(e)),i=n*HE(Ib(e),r)/r;if(!r)return Tb;function a(c,d){i>0?d<-ni+hn&&(d=-ni+hn):d>ni-hn&&(d=ni-hn);var p=i/HE(Ib(d),r);return[p*on(r*c),i-p*bn(r*c)]}return a.invert=function(c,d){var p=i-d,v=Da(r)*Is(c*c+p*p),E=yu(c,mr(p))*Da(p);return p*r<0&&(E-=Dn*Da(c)*Da(p)),[E/r,2*hm(HE(i/v,1/r))-ni]},a}function cY(){return mD(lY).scale(109.5).parallels([30,30])}function Ab(e,t){return[e,t]}function uY(){return Nh(Ab).scale(152.63)}function hY(e,t){var n=bn(e),r=e===t?on(e):(n-bn(t))/(t-e),i=n/r+e;if(mr(r)<hn)return Ab;function a(c,d){var p=i-d,v=r*c;return[p*on(v),i-p*bn(v)]}return a.invert=function(c,d){var p=i-d,v=yu(c,mr(p))*Da(p);return p*r<0&&(v-=Dn*Da(c)*Da(p)),[v/r,i-Da(r)*Is(c*c+p*p)]},a}function dY(){return mD(hY).scale(131.154).center([0,13.9389])}QF.invert=qy(function(e){return e}),Tb.invert=function(e,t){return[e,2*hm(oF(t))-ni]},Ab.invert=Ab;var Zy=1.340264,Wy=-.081106,Xy=893e-6,Yy=.003796,kb=Is(3)/2;function tO(e,t){var n=Sa(kb*on(t)),r=n*n,i=r*r*r;return[e*bn(n)/(kb*(Zy+3*Wy*r+i*(7*Xy+9*Yy*r))),n*(Zy+Wy*r+i*(Xy+Yy*r))]}function pY(){return Nh(tO).scale(177.158)}function nO(e,t){var n=bn(t),r=bn(e)*n;return[n*on(e)/r,on(t)/r]}function mY(){return Nh(nO).scale(144.049).clipAngle(60)}function rO(e,t){return[bn(t)*on(e),on(t)]}function gY(){return Nh(rO).scale(249.5).clipAngle(90+hn)}function iO(e,t){var n=bn(t),r=1+bn(e)*n;return[n*on(e)/r,on(t)/r]}function yY(){return Nh(iO).scale(250).clipAngle(142)}function oO(e,t){return[hb(GE((ni+t)/2)),-e]}function _Y(){var e=eO(oO),t=e.center,n=e.rotate;return e.center=function(r){return arguments.length?t([-r[1],r[0]]):[(r=t())[1],-r[0]]},e.rotate=function(r){return arguments.length?n([r[0],r[1],r.length>2?r[2]+90:90]):[(r=n())[0],r[1],r[2]-90]},n([0,0,90]).scale(159.155)}function gD(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function sO(e){return function(t,n){var r=e((t=FE(t)).h,(n=FE(n)).h),i=to(t.s,n.s),a=to(t.l,n.l),c=to(t.opacity,n.opacity);return function(d){return t.h=r(d),t.s=i(d),t.l=a(d),t.opacity=c(d),t+""}}}tO.invert=function(e,t){for(var c,n=t,r=n*n,i=r*r*r,a=0;a<12&&(i=(r=(n-=c=(n*(Zy+Wy*r+i*(Xy+Yy*r))-t)/(Zy+3*Wy*r+i*(7*Xy+9*Yy*r)))*n)*r*r,!(mr(c)<1e-12));++a);return[kb*e*(Zy+3*Wy*r+i*(7*Xy+9*Yy*r))/bn(n),Sa(on(n)/kb)]},nO.invert=qy(hm),rO.invert=qy(Sa),iO.invert=qy(function(e){return 2*hm(e)}),oO.invert=function(e,t){return[-t,2*hm(oF(e))-ni]};const vY=sO(LE);sO(to);const aO=Math.PI/180,lO=180/Math.PI,dO=4/29,gm=6/29,fO=3*gm*gm;function pO(e){if(e instanceof Cl)return new Cl(e.l,e.a,e.b,e.opacity);if(e instanceof bc)return gO(e);e instanceof eo||(e=RE(e));var a,c,t=xD(e.r),n=xD(e.g),r=xD(e.b),i=_D((.2225045*t+.7168786*n+.0606169*r)/1);return t===n&&n===r?a=c=i:(a=_D((.4360747*t+.3850649*n+.1430804*r)/.96422),c=_D((.0139322*t+.0971045*n+.7141733*r)/.82521)),new Cl(116*i-16,500*(a-i),200*(i-c),e.opacity)}function yD(e,t,n,r){return 1===arguments.length?pO(e):new Cl(e,t,n,r??1)}function Cl(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function _D(e){return e>.008856451679035631?Math.pow(e,1/3):e/fO+dO}function vD(e){return e>gm?e*e*e:fO*(e-dO)}function bD(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function xD(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function mO(e){if(e instanceof bc)return new bc(e.h,e.c,e.l,e.opacity);if(e instanceof Cl||(e=pO(e)),0===e.a&&0===e.b)return new bc(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*lO;return new bc(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function wD(e,t,n,r){return 1===arguments.length?mO(e):new bc(e,t,n,r??1)}function bc(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function gO(e){if(isNaN(e.h))return new Cl(e.l,0,0,e.opacity);var t=e.h*aO;return new Cl(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}function yO(e){return function(t,n){var r=e((t=wD(t)).h,(n=wD(n)).h),i=to(t.c,n.c),a=to(t.l,n.l),c=to(t.opacity,n.opacity);return function(d){return t.h=r(d),t.c=i(d),t.l=a(d),t.opacity=c(d),t+""}}}im(Cl,yD,Ly(Rh,{brighter(e){return new Cl(this.l+18*(e??1),this.a,this.b,this.opacity)},darker(e){return new Cl(this.l-18*(e??1),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new eo(bD(3.1338561*(t=.96422*vD(t))-1.6168667*(e=1*vD(e))-.4906146*(n=.82521*vD(n))),bD(-.9787684*t+1.9161415*e+.033454*n),bD(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),im(bc,wD,Ly(Rh,{brighter(e){return new bc(this.h,this.c,this.l+18*(e??1),this.opacity)},darker(e){return new bc(this.h,this.c,this.l-18*(e??1),this.opacity)},rgb(){return gO(this).rgb()}}));const wY=yO(LE);function _O(e,t){var c,n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),a=new Array(n);for(c=0;c<r;++c)i[c]=Ky(e[c],t[c]);for(;c<n;++c)a[c]=t[c];return function(d){for(c=0;c<r;++c)a[c]=i[c](d);return a}}function CY(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function EY(e,t){var i,n={},r={};for(i in(null===e||"object"!=typeof e)&&(e={}),(null===t||"object"!=typeof t)&&(t={}),t)i in e?n[i]=Ky(e[i],t[i]):r[i]=t[i];return function(a){for(i in n)r[i]=n[i](a);return r}}function DY(e,t){t||(t=[]);var i,n=e?Math.min(t.length,e.length):0,r=t.slice();return function(a){for(i=0;i<n;++i)r[i]=e[i]*(1-a)+t[i]*a;return r}}function Ky(e,t){var r,n=typeof t;return null==t||"boolean"===n?sb(t):("number"===n?$o:"string"===n?(r=Fh(t))?(t=r,mf):UR:t instanceof Fh?mf:t instanceof Date?CY:function SY(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?DY:Array.isArray(t)?_O:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?EY:$o)(e,t)}function CD(e,t){void 0===t&&(t=e,e=Ky);for(var n=0,r=t.length-1,i=t[0],a=new Array(r<0?0:r);n<r;)a[n]=e(i,i=t[++n]);return function(c){var d=Math.max(0,Math.min(r-1,Math.floor(c*=r)));return a[d](c-d)}}function El(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}yO(to);const ED=Math.PI,DD=2*ED,yf=1e-6,MY=DD-yf;function vO(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}class Rb{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?vO:function TY(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return vO;const n=10**t;return function(r){this._+=r[0];for(let i=1,a=r.length;i<a;++i)this._+=Math.round(arguments[i]*n)/n+r[i]}}(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,r,i){this._append`Q${+t},${+n},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(t,n,r,i,a,c){this._append`C${+t},${+n},${+r},${+i},${this._x1=+a},${this._y1=+c}`}arcTo(t,n,r,i,a){if(t=+t,n=+n,r=+r,i=+i,(a=+a)<0)throw new Error(`negative radius: ${a}`);let c=this._x1,d=this._y1,p=r-t,v=i-n,E=c-t,D=d-n,T=E*E+D*D;if(null===this._x1)this._append`M${this._x1=t},${this._y1=n}`;else if(T>yf)if(Math.abs(D*p-v*E)>yf&&a){let P=r-c,N=i-d,G=p*p+v*v,U=P*P+N*N,Z=Math.sqrt(G),ne=Math.sqrt(T),X=a*Math.tan((ED-Math.acos((G+T-U)/(2*Z*ne)))/2),re=X/ne,fe=X/Z;Math.abs(re-1)>yf&&this._append`L${t+re*E},${n+re*D}`,this._append`A${a},${a},0,0,${+(D*P>E*N)},${this._x1=t+fe*p},${this._y1=n+fe*v}`}else this._append`L${this._x1=t},${this._y1=n}`}arc(t,n,r,i,a,c){if(t=+t,n=+n,c=!!c,(r=+r)<0)throw new Error(`negative radius: ${r}`);let d=r*Math.cos(i),p=r*Math.sin(i),v=t+d,E=n+p,D=1^c,T=c?i-a:a-i;null===this._x1?this._append`M${v},${E}`:(Math.abs(this._x1-v)>yf||Math.abs(this._y1-E)>yf)&&this._append`L${v},${E}`,r&&(T<0&&(T=T%DD+DD),T>MY?this._append`A${r},${r},0,1,${D},${t-d},${n-p}A${r},${r},0,1,${D},${this._x1=v},${this._y1=E}`:T>yf&&this._append`A${r},${r},0,${+(T>=ED)},${D},${this._x1=t+r*Math.cos(a)},${this._y1=n+r*Math.sin(a)}`)}rect(t,n,r,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}}function _f(e=3){return new Rb(+e)}function xc(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Fb(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}const SD=Symbol("implicit");function MD(){var e=new L0,t=[],n=[],r=SD;function i(a){let c=e.get(a);if(void 0===c){if(r!==SD)return r;e.set(a,c=t.push(a)-1)}return n[c%n.length]}return i.domain=function(a){if(!arguments.length)return t.slice();t=[],e=new L0;for(const c of a)e.has(c)||e.set(c,t.push(c)-1);return i},i.range=function(a){return arguments.length?(n=Array.from(a),i):n.slice()},i.unknown=function(a){return arguments.length?(r=a,i):r},i.copy=function(){return MD(t,n).unknown(r)},xc.apply(i,arguments),i}function Ob(){var a,c,e=MD().unknown(void 0),t=e.domain,n=e.range,r=0,i=1,d=!1,p=0,v=0,E=.5;function D(){var T=t().length,P=i<r,N=P?i:r,G=P?r:i;a=(G-N)/Math.max(1,T-p+2*v),d&&(a=Math.floor(a)),N+=(G-N-a*(T-p))*E,c=a*(1-p),d&&(N=Math.round(N),c=Math.round(c));var U=tR(T).map(function(Z){return N+a*Z});return n(P?U.reverse():U)}return delete e.unknown,e.domain=function(T){return arguments.length?(t(T),D()):t()},e.range=function(T){return arguments.length?([r,i]=T,r=+r,i=+i,D()):[r,i]},e.rangeRound=function(T){return[r,i]=T,r=+r,i=+i,d=!0,D()},e.bandwidth=function(){return c},e.step=function(){return a},e.round=function(T){return arguments.length?(d=!!T,D()):d},e.padding=function(T){return arguments.length?(p=Math.min(1,v=+T),D()):p},e.paddingInner=function(T){return arguments.length?(p=Math.min(1,T),D()):p},e.paddingOuter=function(T){return arguments.length?(v=+T,D()):v},e.align=function(T){return arguments.length?(E=Math.max(0,Math.min(1,T)),D()):E},e.copy=function(){return Ob(t(),[r,i]).round(d).paddingInner(p).paddingOuter(v).align(E)},xc.apply(D(),arguments)}function bO(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return bO(t())},e}function TD(e){let t,n,r;function i(d,p,v=0,E=d.length){if(v<E){if(0!==t(p,p))return E;do{const D=v+E>>>1;n(d[D],p)<0?v=D+1:E=D}while(v<E)}return v}return 2!==e.length?(t=vl,n=(d,p)=>vl(e(d),p),r=(d,p)=>e(d)-p):(t=e===vl||e===Sy?e:kY,n=e,r=e),{left:i,center:function c(d,p,v=0,E=d.length){const D=i(d,p,v,E-1);return D>v&&r(d[D-1],p)>-r(d[D],p)?D-1:D},right:function a(d,p,v=0,E=d.length){if(v<E){if(0!==t(p,p))return E;do{const D=v+E>>>1;n(d[D],p)<=0?v=D+1:E=D}while(v<E)}return v}}}function kY(){return 0}const PY=TD(vl).right,ID=(TD(QP),PY);function AD(e){return+e}var wO=[0,1];function Ta(e){return e}function kD(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function RY(e){return function(){return e}}(isNaN(t)?NaN:.5)}function OY(e,t,n){var r=e[0],i=e[1],a=t[0],c=t[1];return i<r?(r=kD(i,r),a=n(c,a)):(r=kD(r,i),a=n(a,c)),function(d){return a(r(d))}}function LY(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),c=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++c<r;)i[c]=kD(e[c],e[c+1]),a[c]=n(t[c],t[c+1]);return function(d){var p=ID(e,d,1,r)-1;return a[p](i[p](d))}}function Jy(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Lb(){var r,i,a,d,p,v,e=wO,t=wO,n=Ky,c=Ta;function E(){var T=Math.min(e.length,t.length);return c!==Ta&&(c=function FY(e,t){var n;return e>t&&(n=e,e=t,t=n),function(r){return Math.max(e,Math.min(t,r))}}(e[0],e[T-1])),d=T>2?LY:OY,p=v=null,D}function D(T){return null==T||isNaN(T=+T)?a:(p||(p=d(e.map(r),t,n)))(r(c(T)))}return D.invert=function(T){return c(i((v||(v=d(t,e.map(r),$o)))(T)))},D.domain=function(T){return arguments.length?(e=Array.from(T,AD),E()):e.slice()},D.range=function(T){return arguments.length?(t=Array.from(T),E()):t.slice()},D.rangeRound=function(T){return t=Array.from(T),n=gD,E()},D.clamp=function(T){return arguments.length?(c=!!T||Ta,E()):c!==Ta},D.interpolate=function(T){return arguments.length?(n=T,E()):n},D.unknown=function(T){return arguments.length?(a=T,D):a},function(T,P){return r=T,i=P,E()}}function CO(){return Lb()(Ta,Ta)}function Qy(e){var t=e.domain;return e.ticks=function(n){var r=t();return U0(r[0],r[r.length-1],n??10)},e.tickFormat=function(n,r){var i=t();return function VY(e,t,n,r){var a,i=bE(e,t,n);switch((r=By(r??",f")).type){case"s":var c=Math.max(Math.abs(e),Math.abs(t));return null==r.precision&&!isNaN(a=function NY(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(cm(t)/3)))-cm(Math.abs(e)))}(i,c))&&(r.precision=a),nF(r,c);case"":case"e":case"g":case"p":case"r":null==r.precision&&!isNaN(a=function zY(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,cm(t)-cm(e))+1}(i,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=a-("e"===r.type));break;case"f":case"%":null==r.precision&&!isNaN(a=function BY(e){return Math.max(0,-cm(Math.abs(e)))}(i))&&(r.precision=a-2*("%"===r.type))}return um(r)}(i[0],i[i.length-1],n??10,r)},e.nice=function(n){null==n&&(n=10);var p,v,r=t(),i=0,a=r.length-1,c=r[i],d=r[a],E=10;for(d<c&&(v=c,c=d,d=v,v=i,i=a,a=v);E-- >0;){if((v=vE(c,d,n))===p)return r[i]=c,r[a]=d,t(r);if(v>0)c=Math.floor(c/v)*v,d=Math.ceil(d/v)*v;else{if(!(v<0))break;c=Math.ceil(c*v)/v,d=Math.floor(d*v)/v}p=v}return e},e}function PD(){var e=CO();return e.copy=function(){return Jy(e,PD())},xc.apply(e,arguments),Qy(e)}function EO(e){var t;function n(r){return null==r||isNaN(r=+r)?t:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(e=Array.from(r,AD),n):e.slice()},n.unknown=function(r){return arguments.length?(t=r,n):t},n.copy=function(){return EO(e).unknown(t)},e=arguments.length?Array.from(e,AD):[0,1],Qy(n)}function DO(e,t){var c,n=0,r=(e=e.slice()).length-1,i=e[n],a=e[r];return a<i&&(c=n,n=r,r=c,c=i,i=a,a=c),e[n]=t.floor(i),e[r]=t.ceil(a),e}function SO(e){return Math.log(e)}function MO(e){return Math.exp(e)}function UY(e){return-Math.log(-e)}function $Y(e){return-Math.exp(-e)}function jY(e){return isFinite(e)?+("1e"+e):e<0?0:e}function TO(e){return(t,n)=>-e(-t,n)}function IO(e){const t=e(SO,MO),n=t.domain;let i,a,r=10;function c(){return i=function GY(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}(r),a=function HY(e){return 10===e?jY:e===Math.E?Math.exp:t=>Math.pow(e,t)}(r),n()[0]<0?(i=TO(i),a=TO(a),e(UY,$Y)):e(SO,MO),t}return t.base=function(d){return arguments.length?(r=+d,c()):r},t.domain=function(d){return arguments.length?(n(d),c()):n()},t.ticks=d=>{const p=n();let v=p[0],E=p[p.length-1];const D=E<v;D&&([v,E]=[E,v]);let N,G,T=i(v),P=i(E);const U=null==d?10:+d;let Z=[];if(!(r%1)&&P-T<U){if(T=Math.floor(T),P=Math.ceil(P),v>0){for(;T<=P;++T)for(N=1;N<r;++N)if(G=T<0?N/a(-T):N*a(T),!(G<v)){if(G>E)break;Z.push(G)}}else for(;T<=P;++T)for(N=r-1;N>=1;--N)if(G=T>0?N/a(-T):N*a(T),!(G<v)){if(G>E)break;Z.push(G)}2*Z.length<U&&(Z=U0(v,E,U))}else Z=U0(T,P,Math.min(P-T,U)).map(a);return D?Z.reverse():Z},t.tickFormat=(d,p)=>{if(null==d&&(d=10),null==p&&(p=10===r?"s":","),"function"!=typeof p&&(!(r%1)&&null==(p=By(p)).precision&&(p.trim=!0),p=um(p)),d===1/0)return p;const v=Math.max(1,r*d/t.ticks().length);return E=>{let D=E/a(Math.round(i(E)));return D*r<r-.5&&(D*=r),D<=v?p(E):""}},t.nice=()=>n(DO(n(),{floor:d=>a(Math.floor(i(d))),ceil:d=>a(Math.ceil(i(d)))})),t}function AO(){const e=IO(Lb()).domain([1,10]);return e.copy=()=>Jy(e,AO()).base(e.base()),xc.apply(e,arguments),e}function kO(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function PO(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function RO(e){var t=1,n=e(kO(t),PO(t));return n.constant=function(r){return arguments.length?e(kO(t=+r),PO(t)):t},Qy(n)}function FO(){var e=RO(Lb());return e.copy=function(){return Jy(e,FO()).constant(e.constant())},xc.apply(e,arguments)}function OO(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function qY(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function ZY(e){return e<0?-e*e:e*e}function LO(e){var t=e(Ta,Ta),n=1;function r(){return 1===n?e(Ta,Ta):.5===n?e(qY,ZY):e(OO(n),OO(1/n))}return t.exponent=function(i){return arguments.length?(n=+i,r()):n},Qy(t)}function RD(){var e=LO(Lb());return e.copy=function(){return Jy(e,RD()).exponent(e.exponent())},xc.apply(e,arguments),e}function NO(){var r,e=[],t=[],n=[];function i(){var c=0,d=Math.max(1,t.length);for(n=new Array(d-1);++c<d;)n[c-1]=zG(e,c/d);return a}function a(c){return null==c||isNaN(c=+c)?r:t[ID(n,c)]}return a.invertExtent=function(c){var d=t.indexOf(c);return d<0?[NaN,NaN]:[d>0?n[d-1]:e[0],d<n.length?n[d]:e[e.length-1]]},a.domain=function(c){if(!arguments.length)return e.slice();e=[];for(let d of c)null!=d&&!isNaN(d=+d)&&e.push(d);return e.sort(vl),i()},a.range=function(c){return arguments.length?(t=Array.from(c),i()):t.slice()},a.unknown=function(c){return arguments.length?(r=c,a):r},a.quantiles=function(){return n.slice()},a.copy=function(){return NO().domain(e).range(t).unknown(r)},xc.apply(a,arguments)}function zO(){var n,e=[.5],t=[0,1],r=1;function i(a){return null!=a&&a<=a?t[ID(e,a,0,r)]:n}return i.domain=function(a){return arguments.length?(e=Array.from(a),r=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(a){return arguments.length?(t=Array.from(a),r=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(a){var c=t.indexOf(a);return[e[c-1],e[c]]},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return zO().domain(e).range(t).unknown(n)},xc.apply(i,arguments)}const vu=1e3,Ia=6e4,bu=60*Ia,xu=24*bu,FD=7*xu,BO=30*xu,OD=365*xu,LD=new Date,ND=new Date;function Ni(e,t,n,r){function i(a){return e(a=0===arguments.length?new Date:new Date(+a)),a}return i.floor=a=>(e(a=new Date(+a)),a),i.ceil=a=>(e(a=new Date(a-1)),t(a,1),e(a),a),i.round=a=>{const c=i(a),d=i.ceil(a);return a-c<d-a?c:d},i.offset=(a,c)=>(t(a=new Date(+a),null==c?1:Math.floor(c)),a),i.range=(a,c,d)=>{const p=[];if(a=i.ceil(a),d=null==d?1:Math.floor(d),!(a<c&&d>0))return p;let v;do{p.push(v=new Date(+a)),t(a,d),e(a)}while(v<a&&a<c);return p},i.filter=a=>Ni(c=>{if(c>=c)for(;e(c),!a(c);)c.setTime(c-1)},(c,d)=>{if(c>=c)if(d<0)for(;++d<=0;)for(;t(c,-1),!a(c););else for(;--d>=0;)for(;t(c,1),!a(c););}),n&&(i.count=(a,c)=>(LD.setTime(+a),ND.setTime(+c),e(LD),e(ND),Math.floor(n(LD,ND))),i.every=a=>(a=Math.floor(a),isFinite(a)&&a>0?a>1?i.filter(r?c=>r(c)%a==0:c=>i.count(0,c)%a==0):i:null)),i}const Nb=Ni(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);Nb.every=e=>(e=Math.floor(e),isFinite(e)&&e>0?e>1?Ni(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):Nb:null);const wu=Ni(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*vu)},(e,t)=>(t-e)/vu,e=>e.getUTCSeconds()),zb=Ni(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*vu)},(e,t)=>{e.setTime(+e+t*Ia)},(e,t)=>(t-e)/Ia,e=>e.getMinutes()),Bb=Ni(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Ia)},(e,t)=>(t-e)/Ia,e=>e.getUTCMinutes()),Vb=Ni(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*vu-e.getMinutes()*Ia)},(e,t)=>{e.setTime(+e+t*bu)},(e,t)=>(t-e)/bu,e=>e.getHours()),Ub=Ni(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*bu)},(e,t)=>(t-e)/bu,e=>e.getUTCHours()),ym=Ni(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Ia)/xu,e=>e.getDate()-1),e_=Ni(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/xu,e=>e.getUTCDate()-1),VO=Ni(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/xu,e=>Math.floor(e/xu));function vf(e){return Ni(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+7*n)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*Ia)/FD)}const _m=vf(0),t_=vf(1),UO=vf(2),$O=vf(3),bf=vf(4),jO=vf(5),HO=vf(6);function xf(e){return Ni(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+7*n)},(t,n)=>(n-t)/FD)}const vm=xf(0),n_=xf(1),GO=xf(2),qO=xf(3),wf=xf(4),ZO=xf(5),WO=xf(6),bm=Ni(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear()),e=>e.getMonth()),xm=Ni(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear()),e=>e.getUTCMonth()),wc=Ni(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());wc.every=e=>isFinite(e=Math.floor(e))&&e>0?Ni(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)}):null;const Cc=Ni(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());function XO(e,t,n,r,i,a){const c=[[wu,1,vu],[wu,5,5e3],[wu,15,15e3],[wu,30,3e4],[a,1,Ia],[a,5,5*Ia],[a,15,15*Ia],[a,30,30*Ia],[i,1,bu],[i,3,3*bu],[i,6,6*bu],[i,12,12*bu],[r,1,xu],[r,2,2*xu],[n,1,FD],[t,1,BO],[t,3,3*BO],[e,1,OD]];function p(v,E,D){const T=Math.abs(E-v)/D,P=TD(([,,U])=>U).right(c,T);if(P===c.length)return e.every(bE(v/OD,E/OD,D));if(0===P)return Nb.every(Math.max(bE(v,E,D),1));const[N,G]=c[T/c[P-1][2]<c[P][2]/T?P-1:P];return N.every(G)}return[function d(v,E,D){const T=E<v;T&&([v,E]=[E,v]);const P=D&&"function"==typeof D.range?D:p(v,E,D),N=P?P.range(v,+E+1):[];return T?N.reverse():N},p]}Cc.every=e=>isFinite(e=Math.floor(e))&&e>0?Ni(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)}):null;const[WY,XY]=XO(Cc,xm,vm,VO,Ub,Bb),[YY,KY]=XO(wc,bm,_m,ym,Vb,zb);function zD(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function BD(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function r_(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}var wm,uL,s_,YO={"-":"",_:" ",0:"0"},no=/^\s*\d+/,QY=/^%/,eK=/[\\^$*+?|[\]().{}]/g;function Xn(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function tK(e){return e.replace(eK,"\\$&")}function i_(e){return new RegExp("^(?:"+e.map(tK).join("|")+")","i")}function o_(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function nK(e,t,n){var r=no.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function rK(e,t,n){var r=no.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function iK(e,t,n){var r=no.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function oK(e,t,n){var r=no.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function sK(e,t,n){var r=no.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function KO(e,t,n){var r=no.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function JO(e,t,n){var r=no.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function aK(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function lK(e,t,n){var r=no.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function cK(e,t,n){var r=no.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function QO(e,t,n){var r=no.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function uK(e,t,n){var r=no.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function eL(e,t,n){var r=no.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function hK(e,t,n){var r=no.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function dK(e,t,n){var r=no.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function fK(e,t,n){var r=no.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function pK(e,t,n){var r=no.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function mK(e,t,n){var r=QY.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function gK(e,t,n){var r=no.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function yK(e,t,n){var r=no.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function tL(e,t){return Xn(e.getDate(),t,2)}function _K(e,t){return Xn(e.getHours(),t,2)}function vK(e,t){return Xn(e.getHours()%12||12,t,2)}function bK(e,t){return Xn(1+ym.count(wc(e),e),t,3)}function nL(e,t){return Xn(e.getMilliseconds(),t,3)}function xK(e,t){return nL(e,t)+"000"}function wK(e,t){return Xn(e.getMonth()+1,t,2)}function CK(e,t){return Xn(e.getMinutes(),t,2)}function EK(e,t){return Xn(e.getSeconds(),t,2)}function DK(e){var t=e.getDay();return 0===t?7:t}function SK(e,t){return Xn(_m.count(wc(e)-1,e),t,2)}function rL(e){var t=e.getDay();return t>=4||0===t?bf(e):bf.ceil(e)}function MK(e,t){return e=rL(e),Xn(bf.count(wc(e),e)+(4===wc(e).getDay()),t,2)}function TK(e){return e.getDay()}function IK(e,t){return Xn(t_.count(wc(e)-1,e),t,2)}function AK(e,t){return Xn(e.getFullYear()%100,t,2)}function kK(e,t){return Xn((e=rL(e)).getFullYear()%100,t,2)}function PK(e,t){return Xn(e.getFullYear()%1e4,t,4)}function RK(e,t){var n=e.getDay();return Xn((e=n>=4||0===n?bf(e):bf.ceil(e)).getFullYear()%1e4,t,4)}function FK(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Xn(t/60|0,"0",2)+Xn(t%60,"0",2)}function iL(e,t){return Xn(e.getUTCDate(),t,2)}function OK(e,t){return Xn(e.getUTCHours(),t,2)}function LK(e,t){return Xn(e.getUTCHours()%12||12,t,2)}function NK(e,t){return Xn(1+e_.count(Cc(e),e),t,3)}function oL(e,t){return Xn(e.getUTCMilliseconds(),t,3)}function zK(e,t){return oL(e,t)+"000"}function BK(e,t){return Xn(e.getUTCMonth()+1,t,2)}function VK(e,t){return Xn(e.getUTCMinutes(),t,2)}function UK(e,t){return Xn(e.getUTCSeconds(),t,2)}function $K(e){var t=e.getUTCDay();return 0===t?7:t}function jK(e,t){return Xn(vm.count(Cc(e)-1,e),t,2)}function sL(e){var t=e.getUTCDay();return t>=4||0===t?wf(e):wf.ceil(e)}function HK(e,t){return e=sL(e),Xn(wf.count(Cc(e),e)+(4===Cc(e).getUTCDay()),t,2)}function GK(e){return e.getUTCDay()}function qK(e,t){return Xn(n_.count(Cc(e)-1,e),t,2)}function ZK(e,t){return Xn(e.getUTCFullYear()%100,t,2)}function WK(e,t){return Xn((e=sL(e)).getUTCFullYear()%100,t,2)}function XK(e,t){return Xn(e.getUTCFullYear()%1e4,t,4)}function YK(e,t){var n=e.getUTCDay();return Xn((e=n>=4||0===n?wf(e):wf.ceil(e)).getUTCFullYear()%1e4,t,4)}function KK(){return"+0000"}function aL(){return"%"}function lL(e){return+e}function cL(e){return Math.floor(+e/1e3)}function tJ(e){return new Date(e)}function nJ(e){return e instanceof Date?+e:+new Date(+e)}function VD(e,t,n,r,i,a,c,d,p,v){var E=CO(),D=E.invert,T=E.domain,P=v(".%L"),N=v(":%S"),G=v("%I:%M"),U=v("%I %p"),Z=v("%a %d"),ne=v("%b %d"),X=v("%B"),re=v("%Y");function fe(ve){return(p(ve)<ve?P:d(ve)<ve?N:c(ve)<ve?G:a(ve)<ve?U:r(ve)<ve?i(ve)<ve?Z:ne:n(ve)<ve?X:re)(ve)}return E.invert=function(ve){return new Date(D(ve))},E.domain=function(ve){return arguments.length?T(Array.from(ve,nJ)):T().map(tJ)},E.ticks=function(ve){var Re=T();return e(Re[0],Re[Re.length-1],ve??10)},E.tickFormat=function(ve,Re){return null==Re?fe:v(Re)},E.nice=function(ve){var Re=T();return(!ve||"function"!=typeof ve.range)&&(ve=t(Re[0],Re[Re.length-1],ve??10)),ve?T(DO(Re,ve)):E},E.copy=function(){return Jy(E,VD(e,t,n,r,i,a,c,d,p,v))},E}function zh(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function jb(){var i,a,c,d,p,E,T,e=0,t=.5,n=1,r=1,v=Ta,D=!1;function P(G){return isNaN(G=+G)?T:(G=.5+((G=+E(G))-a)*(r*G<r*a?d:p),v(D?Math.max(0,Math.min(1,G)):G))}function N(G){return function(U){var Z,ne,X;return arguments.length?([Z,ne,X]=U,v=CD(G,[Z,ne,X]),P):[v(0),v(.5),v(1)]}}return P.domain=function(G){return arguments.length?([e,t,n]=G,i=E(e=+e),a=E(t=+t),c=E(n=+n),d=i===a?0:.5/(a-i),p=a===c?0:.5/(c-a),r=a<i?-1:1,P):[e,t,n]},P.clamp=function(G){return arguments.length?(D=!!G,P):D},P.interpolator=function(G){return arguments.length?(v=G,P):v},P.range=N(Ky),P.rangeRound=N(gD),P.unknown=function(G){return arguments.length?(T=G,P):T},function(G){return E=G,i=G(e),a=G(t),c=G(n),d=i===a?0:.5/(a-i),p=a===c?0:.5/(c-a),r=a<i?-1:1,P}}function dL(){var e=Qy(jb()(Ta));return e.copy=function(){return zh(e,dL())},Fb.apply(e,arguments)}function fL(){var e=IO(jb()).domain([.1,1,10]);return e.copy=function(){return zh(e,fL()).base(e.base())},Fb.apply(e,arguments)}function pL(){var e=RO(jb());return e.copy=function(){return zh(e,pL()).constant(e.constant())},Fb.apply(e,arguments)}function UD(){var e=LO(jb());return e.copy=function(){return zh(e,UD()).exponent(e.exponent())},Fb.apply(e,arguments)}function dn(e){for(var t=e.length/6|0,n=new Array(t),r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}!function eJ(e){wm=function JY(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,c=e.shortDays,d=e.months,p=e.shortMonths,v=i_(i),E=o_(i),D=i_(a),T=o_(a),P=i_(c),N=o_(c),G=i_(d),U=o_(d),Z=i_(p),ne=o_(p),X={a:function Oe(bt){return c[bt.getDay()]},A:function Ye(bt){return a[bt.getDay()]},b:function Ze(bt){return p[bt.getMonth()]},B:function et(bt){return d[bt.getMonth()]},c:null,d:tL,e:tL,f:xK,g:kK,G:RK,H:_K,I:vK,j:bK,L:nL,m:wK,M:CK,p:function _t(bt){return i[+(bt.getHours()>=12)]},q:function Ft(bt){return 1+~~(bt.getMonth()/3)},Q:lL,s:cL,S:EK,u:DK,U:SK,V:MK,w:TK,W:IK,x:null,X:null,y:AK,Y:PK,Z:FK,"%":aL},re={a:function sr(bt){return c[bt.getUTCDay()]},A:function Hn(bt){return a[bt.getUTCDay()]},b:function gr(bt){return p[bt.getUTCMonth()]},B:function wi(bt){return d[bt.getUTCMonth()]},c:null,d:iL,e:iL,f:zK,g:WK,G:YK,H:OK,I:LK,j:NK,L:oL,m:BK,M:VK,p:function Yn(bt){return i[+(bt.getUTCHours()>=12)]},q:function Vr(bt){return 1+~~(bt.getUTCMonth()/3)},Q:lL,s:cL,S:UK,u:$K,U:jK,V:HK,w:GK,W:qK,x:null,X:null,y:ZK,Y:XK,Z:KK,"%":aL},fe={a:function lt(bt,Kt,Pn){var Je=P.exec(Kt.slice(Pn));return Je?(bt.w=N.get(Je[0].toLowerCase()),Pn+Je[0].length):-1},A:function Ue(bt,Kt,Pn){var Je=D.exec(Kt.slice(Pn));return Je?(bt.w=T.get(Je[0].toLowerCase()),Pn+Je[0].length):-1},b:function st(bt,Kt,Pn){var Je=Z.exec(Kt.slice(Pn));return Je?(bt.m=ne.get(Je[0].toLowerCase()),Pn+Je[0].length):-1},B:function Fe(bt,Kt,Pn){var Je=G.exec(Kt.slice(Pn));return Je?(bt.m=U.get(Je[0].toLowerCase()),Pn+Je[0].length):-1},c:function le(bt,Kt,Pn){return We(bt,t,Kt,Pn)},d:QO,e:QO,f:pK,g:JO,G:KO,H:eL,I:eL,j:uK,L:fK,m:cK,M:hK,p:function Ke(bt,Kt,Pn){var Je=v.exec(Kt.slice(Pn));return Je?(bt.p=E.get(Je[0].toLowerCase()),Pn+Je[0].length):-1},q:lK,Q:gK,s:yK,S:dK,u:rK,U:iK,V:oK,w:nK,W:sK,x:function de(bt,Kt,Pn){return We(bt,n,Kt,Pn)},X:function pe(bt,Kt,Pn){return We(bt,r,Kt,Pn)},y:JO,Y:KO,Z:aK,"%":mK};function ve(bt,Kt){return function(Pn){var Mo,qt,oi,Je=[],Ur=-1,er=0,Zr=bt.length;for(Pn instanceof Date||(Pn=new Date(+Pn));++Ur<Zr;)37===bt.charCodeAt(Ur)&&(Je.push(bt.slice(er,Ur)),null!=(qt=YO[Mo=bt.charAt(++Ur)])?Mo=bt.charAt(++Ur):qt="e"===Mo?" ":"0",(oi=Kt[Mo])&&(Mo=oi(Pn,qt)),Je.push(Mo),er=Ur+1);return Je.push(bt.slice(er,Ur)),Je.join("")}}function Re(bt,Kt){return function(Pn){var er,Zr,Je=r_(1900,void 0,1);if(We(Je,bt,Pn+="",0)!=Pn.length)return null;if("Q"in Je)return new Date(Je.Q);if("s"in Je)return new Date(1e3*Je.s+("L"in Je?Je.L:0));if(Kt&&!("Z"in Je)&&(Je.Z=0),"p"in Je&&(Je.H=Je.H%12+12*Je.p),void 0===Je.m&&(Je.m="q"in Je?Je.q:0),"V"in Je){if(Je.V<1||Je.V>53)return null;"w"in Je||(Je.w=1),"Z"in Je?(Zr=(er=BD(r_(Je.y,0,1))).getUTCDay(),er=Zr>4||0===Zr?n_.ceil(er):n_(er),er=e_.offset(er,7*(Je.V-1)),Je.y=er.getUTCFullYear(),Je.m=er.getUTCMonth(),Je.d=er.getUTCDate()+(Je.w+6)%7):(Zr=(er=zD(r_(Je.y,0,1))).getDay(),er=Zr>4||0===Zr?t_.ceil(er):t_(er),er=ym.offset(er,7*(Je.V-1)),Je.y=er.getFullYear(),Je.m=er.getMonth(),Je.d=er.getDate()+(Je.w+6)%7)}else("W"in Je||"U"in Je)&&("w"in Je||(Je.w="u"in Je?Je.u%7:"W"in Je?1:0),Zr="Z"in Je?BD(r_(Je.y,0,1)).getUTCDay():zD(r_(Je.y,0,1)).getDay(),Je.m=0,Je.d="W"in Je?(Je.w+6)%7+7*Je.W-(Zr+5)%7:Je.w+7*Je.U-(Zr+6)%7);return"Z"in Je?(Je.H+=Je.Z/100|0,Je.M+=Je.Z%100,BD(Je)):zD(Je)}}function We(bt,Kt,Pn,Je){for(var Mo,qt,Ur=0,er=Kt.length,Zr=Pn.length;Ur<er;){if(Je>=Zr)return-1;if(37===(Mo=Kt.charCodeAt(Ur++))){if(Mo=Kt.charAt(Ur++),!(qt=fe[Mo in YO?Kt.charAt(Ur++):Mo])||(Je=qt(bt,Pn,Je))<0)return-1}else if(Mo!=Pn.charCodeAt(Je++))return-1}return Je}return X.x=ve(n,X),X.X=ve(r,X),X.c=ve(t,X),re.x=ve(n,re),re.X=ve(r,re),re.c=ve(t,re),{format:function(bt){var Kt=ve(bt+="",X);return Kt.toString=function(){return bt},Kt},parse:function(bt){var Kt=Re(bt+="",!1);return Kt.toString=function(){return bt},Kt},utcFormat:function(bt){var Kt=ve(bt+="",re);return Kt.toString=function(){return bt},Kt},utcParse:function(bt){var Kt=Re(bt+="",!0);return Kt.toString=function(){return bt},Kt}}}(e),uL=wm.format,s_=wm.utcFormat}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});const lJ=dn("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),cJ=dn("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),uJ=dn("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),hJ=dn("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),dJ=dn("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),fJ=dn("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),pJ=dn("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),mJ=dn("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),gJ=dn("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"),yJ=dn("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),xr=e=>lW(e[e.length-1]);var mL=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(dn);const gL=xr(mL);var yL=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(dn);const _L=xr(yL);var vL=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(dn);const bL=xr(vL);var xL=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(dn);const wL=xr(xL);var $D=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(dn);const Hb=xr($D);var CL=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(dn);const EL=xr(CL);var jD=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(dn);const Gb=xr(jD);var DL=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(dn);const SL=xr(DL);var ML=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(dn);const TL=xr(ML);var IL=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(dn);const AL=xr(IL);var kL=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(dn);const PL=xr(kL);var RL=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(dn);const FL=xr(RL);var OL=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(dn);const LL=xr(OL);var NL=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(dn);const zL=xr(NL);var BL=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(dn);const VL=xr(BL);var UL=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(dn);const $L=xr(UL);var jL=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(dn);const HL=xr(jL);var GL=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(dn);const qL=xr(GL);var ZL=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(dn);const WL=xr(ZL);var XL=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(dn);const YL=xr(XL);var KL=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(dn);const JL=xr(KL);var QL=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(dn);const eN=xr(QL);var tN=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(dn);const nN=xr(tN);var rN=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(dn);const iN=xr(rN);var oN=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(dn);const sN=xr(oN);var aN=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(dn);const lN=xr(aN);var cN=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(dn);const uN=xr(cN);function hN(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-e*(35.34-e*(2381.73-e*(6402.7-e*(7024.72-2710.57*e)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+e*(170.73+e*(52.82-e*(131.46-e*(176.58-67.37*e)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+e*(442.36-e*(2482.43-e*(6167.24-e*(6614.94-2475.67*e)))))))+")"}var HD=1.78277,GD=-.29227,qb=-.90649,a_=1.97294,fN=a_*qb,pN=a_*HD,mN=HD*GD- -.14861*qb;function _J(e){if(e instanceof Cf)return new Cf(e.h,e.s,e.l,e.opacity);e instanceof eo||(e=RE(e));var n=e.g/255,r=e.b/255,i=(mN*r+fN*(e.r/255)-pN*n)/(mN+fN-pN),a=r-i,c=(a_*(n-i)-GD*a)/qb,d=Math.sqrt(c*c+a*a)/(a_*i*(1-i)),p=d?Math.atan2(c,a)*lO-120:NaN;return new Cf(p<0?p+360:p,d,i,e.opacity)}function Ec(e,t,n,r){return 1===arguments.length?_J(e):new Cf(e,t,n,r??1)}function Cf(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function gN(e){return function t(n){function r(i,a){var c=e((i=Ec(i)).h,(a=Ec(a)).h),d=to(i.s,a.s),p=to(i.l,a.l),v=to(i.opacity,a.opacity);return function(E){return i.h=c(E),i.s=d(E),i.l=p(Math.pow(E,n)),i.opacity=v(E),i+""}}return n=+n,r.gamma=t,r}(1)}im(Cf,Ec,Ly(Rh,{brighter(e){return e=null==e?om:Math.pow(om,e),new Cf(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new Cf(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*aO,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new eo(255*(t+n*(-.14861*r+HD*i)),255*(t+n*(GD*r+qb*i)),255*(t+n*(a_*r)),this.opacity)}})),gN(LE);var qD=gN(to);const yN=qD(Ec(300,.5,0),Ec(-240,.5,1));var _N=qD(Ec(-100,.75,.35),Ec(80,1.5,.8)),vN=qD(Ec(260,.75,.35),Ec(80,1.5,.8)),Zb=Ec();function bN(e){(e<0||e>1)&&(e-=Math.floor(e));var t=Math.abs(e-.5);return Zb.h=360*e-100,Zb.s=1.5-1.5*t,Zb.l=.8-.9*t,Zb+""}var Wb=Oh(),vJ=Math.PI/3,bJ=2*Math.PI/3;function xN(e){var t;return e=(.5-e)*Math.PI,Wb.r=255*(t=Math.sin(e))*t,Wb.g=255*(t=Math.sin(e+vJ))*t,Wb.b=255*(t=Math.sin(e+bJ))*t,Wb+""}function wN(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+e*(1172.33-e*(10793.56-e*(33300.12-e*(38394.49-14825.05*e)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+e*(557.33+e*(1225.33-e*(3574.96-e*(1073.77+707.56*e)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+e*(3211.1-e*(15327.97-e*(27814-e*(22569.18-6838.66*e)))))))+")"}function Xb(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}const CN=Xb(dn("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var EN=Xb(dn("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),DN=Xb(dn("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),SN=Xb(dn("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function ZD(e){return"string"==typeof e?new Ys([[document.querySelector(e)]],[document.documentElement]):new Ys([[e]],pR)}function Cm(e){return function(){return e}}function MN(e){this._context=e}function Yb(e){return new MN(e)}function CJ(e){return e[0]}function EJ(e){return e[1]}MN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}},Math,Math;const TN=Math.cos,WD=(Math,Math.min),Kb=Math.sin,zi=Math.sqrt,Em=Math.PI,Jb=2*Em,SJ=zi(3),kN={draw(e,t){const n=.59436*zi(t+WD(t/28,.75)),r=n/2,i=r*SJ;e.moveTo(0,n),e.lineTo(0,-n),e.moveTo(-i,-r),e.lineTo(i,r),e.moveTo(-i,r),e.lineTo(i,-r)}},l_={draw(e,t){const n=zi(t/Em);e.moveTo(n,0),e.arc(0,0,n,0,Jb)}},PN={draw(e,t){const n=zi(t/5)/2;e.moveTo(-3*n,-n),e.lineTo(-n,-n),e.lineTo(-n,-3*n),e.lineTo(n,-3*n),e.lineTo(n,-n),e.lineTo(3*n,-n),e.lineTo(3*n,n),e.lineTo(n,n),e.lineTo(n,3*n),e.lineTo(-n,3*n),e.lineTo(-n,n),e.lineTo(-3*n,n),e.closePath()}},RN=zi(1/3),MJ=2*RN,FN={draw(e,t){const n=zi(t/MJ),r=n*RN;e.moveTo(0,-n),e.lineTo(r,0),e.lineTo(0,n),e.lineTo(-r,0),e.closePath()}},ON={draw(e,t){const n=.62625*zi(t);e.moveTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.lineTo(-n,0),e.closePath()}},LN={draw(e,t){const n=.87559*zi(t-WD(t/7,2));e.moveTo(-n,0),e.lineTo(n,0),e.moveTo(0,n),e.lineTo(0,-n)}},NN={draw(e,t){const n=zi(t),r=-n/2;e.rect(r,r,n,n)}},zN={draw(e,t){const n=.4431*zi(t);e.moveTo(n,n),e.lineTo(n,-n),e.lineTo(-n,-n),e.lineTo(-n,n),e.closePath()}},BN=Kb(Em/10)/Kb(7*Em/10),IJ=Kb(Jb/10)*BN,AJ=-TN(Jb/10)*BN,VN={draw(e,t){const n=zi(.8908130915292852*t),r=IJ*n,i=AJ*n;e.moveTo(0,-n),e.lineTo(r,i);for(let a=1;a<5;++a){const c=Jb*a/5,d=TN(c),p=Kb(c);e.lineTo(p*n,-d*n),e.lineTo(d*r-p*i,p*r+d*i)}e.closePath()}},XD=zi(3),UN={draw(e,t){const n=-zi(t/(3*XD));e.moveTo(0,2*n),e.lineTo(-XD*n,-n),e.lineTo(XD*n,-n),e.closePath()}},kJ=zi(3),$N={draw(e,t){const n=.6824*zi(t),r=n/2,i=n*kJ/2;e.moveTo(0,-n),e.lineTo(i,r),e.lineTo(-i,r),e.closePath()}},Aa=-.5,ka=zi(3)/2,YD=1/zi(12),PJ=3*(YD/2+1),jN={draw(e,t){const n=zi(t/PJ),r=n/2,i=n*YD,a=r,c=n*YD+n,d=-a,p=c;e.moveTo(r,i),e.lineTo(a,c),e.lineTo(d,p),e.lineTo(Aa*r-ka*i,ka*r+Aa*i),e.lineTo(Aa*a-ka*c,ka*a+Aa*c),e.lineTo(Aa*d-ka*p,ka*d+Aa*p),e.lineTo(Aa*r+ka*i,Aa*i-ka*r),e.lineTo(Aa*a+ka*c,Aa*c-ka*a),e.lineTo(Aa*d+ka*p,Aa*p-ka*d),e.closePath()}},HN={draw(e,t){const n=.6189*zi(t-WD(t/6,1.7));e.moveTo(-n,-n),e.lineTo(n,n),e.moveTo(-n,n),e.lineTo(n,-n)}},RJ=[l_,PN,FN,NN,VN,UN,jN],FJ=[l_,LN,HN,$N,kN,zN,ON];function Bh(){}function Qb(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function ex(e){this._context=e}function GN(e){this._context=e}function qN(e){this._context=e}ex.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Qb(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Qb(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},GN.prototype={areaStart:Bh,areaEnd:Bh,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:Qb(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},qN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:Qb(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};class ZN{constructor(t,n){this._context=t,this._x=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line}point(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,n,t,n):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+n)/2,t,this._y0,t,n)}this._x0=t,this._y0=n}}function WN(e,t){this._basis=new ex(e),this._beta=t}WN.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var p,r=e[0],i=t[0],a=e[n]-r,c=t[n]-i,d=-1;++d<=n;)this._basis.point(this._beta*e[d]+(1-this._beta)*(r+(p=d/n)*a),this._beta*t[d]+(1-this._beta)*(i+p*c));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const UJ=function e(t){function n(r){return 1===t?new ex(r):new WN(r,t)}return n.beta=function(r){return e(+r)},n}(.85);function tx(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function KD(e,t){this._context=e,this._k=(1-t)/6}KD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:tx(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:tx(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const $J=function e(t){function n(r){return new KD(r,t)}return n.tension=function(r){return e(+r)},n}(0);function JD(e,t){this._context=e,this._k=(1-t)/6}JD.prototype={areaStart:Bh,areaEnd:Bh,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:tx(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const jJ=function e(t){function n(r){return new JD(r,t)}return n.tension=function(r){return e(+r)},n}(0);function QD(e,t){this._context=e,this._k=(1-t)/6}QD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:tx(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const HJ=function e(t){function n(r){return new QD(r,t)}return n.tension=function(r){return e(+r)},n}(0);function eS(e,t,n){var r=e._x1,i=e._y1,a=e._x2,c=e._y2;if(e._l01_a>1e-12){var d=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,p=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*d-e._x0*e._l12_2a+e._x2*e._l01_2a)/p,i=(i*d-e._y0*e._l12_2a+e._y2*e._l01_2a)/p}if(e._l23_a>1e-12){var v=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,E=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*v+e._x1*e._l23_2a-t*e._l12_2a)/E,c=(c*v+e._y1*e._l23_2a-n*e._l12_2a)/E}e._context.bezierCurveTo(r,i,a,c,e._x2,e._y2)}function XN(e,t){this._context=e,this._alpha=t}XN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:eS(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const GJ=function e(t){function n(r){return t?new XN(r,t):new KD(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function YN(e,t){this._context=e,this._alpha=t}YN.prototype={areaStart:Bh,areaEnd:Bh,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:eS(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const qJ=function e(t){function n(r){return t?new YN(r,t):new JD(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function KN(e,t){this._context=e,this._alpha=t}KN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:eS(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const ZJ=function e(t){function n(r){return t?new KN(r,t):new QD(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function JN(e){this._context=e}function QN(e){return e<0?-1:1}function e3(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),c=(n-e._y1)/(i||r<0&&-0),d=(a*i+c*r)/(r+i);return(QN(a)+QN(c))*Math.min(Math.abs(a),Math.abs(c),.5*Math.abs(d))||0}function t3(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function tS(e,t,n){var r=e._x0,a=e._x1,c=e._y1,d=(a-r)/3;e._context.bezierCurveTo(r+d,e._y0+d*t,a-d,c-d*n,a,c)}function nx(e){this._context=e}function n3(e){this._context=new r3(e)}function r3(e){this._context=e}function i3(e){this._context=e}function o3(e){var t,r,n=e.length-1,i=new Array(n),a=new Array(n),c=new Array(n);for(i[0]=0,a[0]=2,c[0]=e[0]+2*e[1],t=1;t<n-1;++t)i[t]=1,a[t]=4,c[t]=4*e[t]+2*e[t+1];for(i[n-1]=2,a[n-1]=7,c[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)a[t]-=r=i[t]/a[t-1],c[t]-=r*c[t-1];for(i[n-1]=c[n-1]/a[n-1],t=n-2;t>=0;--t)i[t]=(c[t]-i[t+1])/a[t];for(a[n-1]=(e[n]+i[n-1])/2,t=0;t<n-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function rx(e,t){this._context=e,this._t=t}function Dm(e,t,n){this.k=e,this.x=t,this.y=n}function Dl(e){return null!=e&&!Number.isNaN(e)}function Sm(e,t){return+Dl(t)-+Dl(e)||vl(e,t)}function a3(e,t){return+Dl(t)-+Dl(e)||Sy(e,t)}function nS(e){return null!=e&&""!=`${e}`}function l3(e){return isFinite(e)?e:NaN}function ix(e){return e>0&&isFinite(e)?e:NaN}function rS(e){return e<0&&isFinite(e)?e:NaN}JN.prototype={areaStart:Bh,areaEnd:Bh,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}},nx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:tS(this,this._t0,t3(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,tS(this,t3(this,n=e3(this,e,t)),n);break;default:tS(this,this._t0,n=e3(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(n3.prototype=Object.create(nx.prototype)).point=function(e,t){nx.prototype.point.call(this,t,e)},r3.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}},i3.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===n)this._context.lineTo(e[1],t[1]);else for(var r=o3(e),i=o3(t),a=0,c=1;c<n;++a,++c)this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],e[c],t[c]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},rx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}},Dm.prototype={constructor:Dm,scale:function(e){return 1===e?this:new Dm(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new Dm(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new Dm(1,0,0);const lQ=/^(?:[-+]\d{2})?\d{4}(?:-\d{2}(?:-\d{2})?)?(?:T\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?(?:Z|[-+]\d{2}:?\d{2})?)?$/;function c3(e,t){return lQ.test(e+="")?new Date(e):"function"==typeof t?t(e):t}const cQ=new Map([["second",wu],["minute",zb],["hour",Vb],["day",ym],["week",_m],["month",bm],["quarter",bm.every(3)],["half",bm.every(6)],["year",wc],["monday",t_],["tuesday",UO],["wednesday",$O],["thursday",bf],["friday",jO],["saturday",HO],["sunday",_m]]),uQ=new Map([["second",wu],["minute",Bb],["hour",Ub],["day",e_],["week",vm],["month",xm],["quarter",xm.every(3)],["half",xm.every(6)],["year",Cc],["monday",n_],["tuesday",GO],["wednesday",qO],["thursday",wf],["friday",ZO],["saturday",WO],["sunday",vm]]);function hQ(e){const t=cQ.get(`${e}`.toLowerCase());if(!t)throw new Error(`unknown interval: ${e}`);return t}function dQ(e){const t=uQ.get(`${e}`.toLowerCase());if(!t)throw new Error(`unknown interval: ${e}`);return t}const c_=Object.getPrototypeOf(Uint8Array),fQ=Object.prototype.toString;function Dc(e,t,n){const r=typeof t;return"string"===r?u3(e,mQ(t),n):"function"===r?u3(e,t,n):"number"===r||t instanceof Date||"boolean"===r?Go(e,Mm(t),n):function h3(e,t){return void 0===t?Sc(e):e instanceof t?e:t.prototype instanceof c_&&!(e instanceof c_)?t.from(e,oS):t.from(e)}("function"==typeof t?.transform?t.transform(e):t,n)}function u3(e,t,n){return Go(e,n?.prototype instanceof c_?function pQ(e){return(t,n)=>oS(e(t,n))}(t):t,n)}const mQ=e=>t=>t[e],gQ=(e,t)=>t,Cu={transform:e=>e},yQ=()=>!0,Sl=e=>null==e?e:`${e}`,So=e=>null==e?e:+e,d3=e=>e?e[0]:void 0,iS=e=>e?e[1]:void 0,Mm=e=>()=>e;function f3(e){const t=+`${e}`.slice(1)/100;return(n,r)=>N0(n,t,r)}function ox(e){return e instanceof c_?e:Go(e,oS,Float64Array)}function oS(e){return null==e?NaN:Number(e)}function _Q(e){return Go(e,vQ)}function vQ(e){return e instanceof Date&&!isNaN(e)?e:"string"==typeof e?c3(e):null==e||isNaN(e=+e)?void 0:new Date(e)}function Tm(e,t){return void 0===e&&(e=t),null===e?[void 0,"none"]:ax(e)?[void 0,e]:[e,void 0]}function As(e,t){return void 0===e&&(e=t),null===e||"number"==typeof e?[void 0,e]:[e,void 0]}function p3(e,t,n){if(null!=e)return Eu(e,t,n)}function Eu(e,t,n){const r=`${e}`.toLowerCase();if(!n.includes(r))throw new Error(`invalid ${t}: ${e}`);return r}function Sc(e){return null==e||e instanceof Array||e instanceof c_?e:Array.from(e)}function Go(e,t,n=Array){return null==e?e:e instanceof n?e.map(t):n.from(e,t)}function sS(e,t=Array){return e instanceof t?e.slice():t.from(e)}function Im(e){return e?.toString===fQ}function aS(e){return Im(e)&&(void 0!==e.type||void 0!==e.domain)}function sx(e){return Im(e)&&"function"!=typeof e.transform}function Am(e){return sx(e)&&void 0===e.value&&void 0===e.channel}function lS(e,t){return void 0===e&&void 0===t?[d3,iS]:[e,t]}function m3({z:e,fill:t,stroke:n}={}){return void 0===e&&([e]=Tm(t)),void 0===e&&([e]=Tm(n)),e}function u_(e){const t=e.length,n=new Uint32Array(t);for(let r=0;r<t;++r)n[r]=r;return n}function km(e,t){return Go(t,n=>e[n])}function cS(e){return null!==e&&"object"==typeof e?e.valueOf():e}function h_(e,t){return"string"==typeof e?e:e&&void 0!==e.label?e.label:t}function uS(e,t){if(null!=e){if("number"==typeof e){const n=e;return{floor:r=>n*Math.floor(r/n),offset:r=>r+n,range:(r,i)=>tR(Math.ceil(r/n),i/n).map(a=>n*a)}}if("string"==typeof e)return("time"===t?hQ:dQ)(e);if("function"!=typeof e.floor)throw new Error("invalid interval; missing floor method");if("function"!=typeof e.offset)throw new Error("invalid interval; missing offset method");return e}}function d_(e,t){if((e=uS(e,t))&&"function"!=typeof e.range)throw new Error("invalid interval: missing range method");return e}function hS(e){return void 0===e||sx(e)?e:{value:e}}function Vh(e){return e&&"function"==typeof e[Symbol.iterator]}function CQ(e){for(const t of e)if(null!=t)return"object"!=typeof t||t instanceof Date}function y3(e){for(const t of e){if(null==t)continue;const n=typeof t;return"string"===n||"boolean"===n}}function Ml(e){for(const t of e)if(null!=t)return t instanceof Date}function EQ(e){for(const t of e)if(null!=t)return"string"==typeof t&&isNaN(t)&&c3(t)}function DQ(e){for(const t of e)if(null!=t){if("string"!=typeof t)return!1;if(t.trim())return!isNaN(t)}}function dS(e,t){let n;for(const r of e)if(null!=r){if(!t(r))return!1;n=!0}return n}function ax(e){return"string"==typeof e&&("none"===(e=e.toLowerCase().trim())||"currentcolor"===e||e.startsWith("url(")&&e.endsWith(")")||e.startsWith("var(")&&e.endsWith(")")||null!==Fh(e))}function MQ(e){return"number"==typeof e&&(0<=e&&e<=1||isNaN(e))}function Js(e){return null==e||f_(e)}function f_(e){return/^\s*none\s*$/i.test(e)}function fS(e="middle"){return Eu(e,"frameAnchor",["middle","top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"])}function p_(e){if(null!=e)return Sy(e[0],e[e.length-1])}function _3(e){return Vh(e)?function AQ(e){console.warn("named iterables are deprecated; please use an object instead");const t=new Set;return Object.fromEntries(Array.from(e,n=>{const{name:r}=n;if(null==r)throw new Error("missing name");const i=`${r}`;if("__proto__"===i)throw new Error(`illegal name: ${i}`);if(t.has(i))throw new Error(`duplicate name: ${i}`);return t.add(i),[r,n]}))}(e):e}const Mc=Symbol("position"),Tc=Symbol("color"),lx=Symbol("radius"),cx=Symbol("length"),ux=Symbol("opacity"),hx=Symbol("symbol"),ii=new Map([["x",Mc],["y",Mc],["fx",Mc],["fy",Mc],["r",lx],["color",Tc],["opacity",ux],["symbol",hx],["length",cx]]),PQ=2/Math.sqrt(3),pS=new Map([["asterisk",kN],["circle",l_],["cross",PN],["diamond",FN],["diamond2",ON],["hexagon",{draw(e,t){const n=Math.sqrt(t/Math.PI),r=n*PQ,i=r/2;e.moveTo(0,r),e.lineTo(n,i),e.lineTo(n,-i),e.lineTo(0,-r),e.lineTo(-n,-i),e.lineTo(-n,i),e.closePath()}}],["plus",LN],["square",NN],["square2",zN],["star",VN],["times",HN],["triangle",UN],["triangle2",$N],["wye",jN]]);function mS(e){return e&&"function"==typeof e.draw}function FQ(e){return!!mS(e)||"string"==typeof e&&pS.has(e.toLowerCase())}function gS(e){if(null==e||mS(e))return e;const t=pS.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid symbol: ${e}`)}function _S(e,t,n=zQ){if(null==e)return n(e);if("function"==typeof e.reduceIndex)return e;if("function"==typeof e.reduce&&Im(e))return function UQ(e){return console.warn("deprecated reduce interface; implement reduceIndex instead."),{...e,reduceIndex:e.reduce.bind(e)}}(e);if("function"==typeof e)return function $Q(e){return{reduceIndex:(t,n,r)=>e(km(n,t),r)}}(e);if(/^p\d{2}$/i.test(e))return Du(f3(e));switch(`${e}`.toLowerCase()){case"first":return E3;case"last":return HQ;case"identity":return C3;case"count":return vS;case"distinct":return GQ;case"sum":return null==t?vS:qQ;case"proportion":return D3(t,"data");case"proportion-facet":return D3(t,"facet");case"deviation":return Du(GP);case"min":return Du(uf);case"min-index":return Du(BG);case"max":return Du(Xs);case"max-index":return Du(FG);case"mean":return w3(OG);case"median":return w3(z0);case"variance":return Du(fE);case"mode":return Du(eR)}return n(e)}function zQ(e){throw new Error(`invalid reduce: ${e}`)}function Du(e){return{reduceIndex:(t,n)=>e(t,r=>n[r])}}function w3(e){return{reduceIndex(t,n){const r=e(t,i=>n[i]);return Ml(n)?new Date(r):r}}}const C3={reduceIndex:(e,t)=>km(t,e)},E3={reduceIndex:(e,t)=>t[e[0]]},HQ={reduceIndex:(e,t)=>t[e[e.length-1]]},vS={label:"Frequency",reduceIndex:e=>e.length},GQ={label:"Distinct",reduceIndex(e,t){const n=new pE;for(const r of e)n.add(t[r]);return n.size}},qQ=Du(B0);function D3(e,t){return null==e?{scope:t,label:"Frequency",reduceIndex:(n,r,i=1)=>n.length/i}:{scope:t,reduceIndex:(n,r,i=1)=>B0(n,a=>r[a])/i}}function m_(e,{scale:t,type:n,value:r,filter:i,hint:a},c){return S3(c,{scale:t,type:n,value:Dc(e,r),label:h_(r),filter:i,hint:a})}function S3(e,t){const{scale:n,value:r}=t;if(!0===n||"auto"===n)switch(e){case"fill":case"stroke":case"color":t.scale=!0!==n&&dS(r,ax)?null:"color";break;case"fillOpacity":case"strokeOpacity":t.scale=!0!==n&&dS(r,MQ)?null:"opacity";break;case"symbol":!0!==n&&dS(r,FQ)?(t.scale=null,t.value=Go(r,gS)):t.scale="symbol";break;default:t.scale=ii.has(e)?e:null}else if(!1===n)t.scale=null;else if(null!=n&&!ii.has(n))throw new Error(`unknown scale: ${n}`);return t}function YQ(e,t){for(const n in e){const r=e[n];if(r.scale===t)return r}}function KQ(e,t){const n=e.original;if(n===e)return t;const r=t.value,i=t.value=[];for(let a=0;a<n.length;++a){const c=r[n[a][0]];for(const d of e[a])i[d]=c}return t}function M3(e,t,n){const r=bS(e,t);return Go(bS(e,n),(a,c)=>Math.abs(a-r[c]),Float64Array)}function bS(e,t,n){let r=e[t];if(!r&&void 0!==n&&(r=e[n]),r)return r.value;throw new Error(`missing channel: ${t}`)}function JQ([e,t],[n,r]){return Sm(t,r)||Sm(e,n)}function QQ([e,t],[n,r]){return a3(t,r)||Sm(e,n)}let xS=0;function Ef(e){console.warn(e),++xS}const T3=Math.PI,Su=2*T3;function tee({projection:e,inset:t=0,insetTop:n=t,insetRight:r=t,insetBottom:i=t,insetLeft:a=t}={},c){if(null==e)return;if("function"==typeof e.stream)return e;let d,p,v="frame";if(Im(e)){let fe;if(({type:e,domain:p,inset:fe,insetTop:n=(void 0!==fe?fe:n),insetRight:r=(void 0!==fe?fe:r),insetBottom:i=(void 0!==fe?fe:i),insetLeft:a=(void 0!==fe?fe:a),clip:v=v,...d}=e),null==e)return}"function"!=typeof e&&({type:e}=I3(e));const{width:E,height:D,marginLeft:T,marginRight:P,marginTop:N,marginBottom:G}=c,U=E-T-P-a-r,Z=D-N-G-n-i;if(e=e?.({width:U,height:Z,clip:v,...d}),null==e)return;v=function nee(e,t,n,r,i){if(!1===e||null==e||"number"==typeof e)return a=>a;if("frame"===(!0===e&&(e="frame"),`${e}`.toLowerCase()))return hF(t,n,r,i);throw new Error(`unknown projection clip type: ${e}`)}(v,T,N,E-P,D-G);let re,ne=T+a,X=N+n;if(null!=p){const[[fe,ve],[Re,We]]=iD(e).bounds(p),Ke=Math.min(U/(Re-fe),Z/(We-ve));Ke>0?(ne-=(Ke*(fe+Re)-U)/2,X-=(Ke*(ve+We)-Z)/2,re=hD({point(lt,Ue){this.stream.point(lt*Ke+ne,Ue*Ke+X)}})):Ef("Warning: the projection could not be fit to the specified domain; using the default scale.")}return re??(re=0===ne&&0===X?A3():hD({point(fe,ve){this.stream.point(fe+ne,ve+X)}})),{stream:fe=>e.stream(re.stream(v(fe)))}}function I3(e){switch(`${e}`.toLowerCase()){case"albers-usa":return Tl(iY,.7463,.4673);case"albers":return fx(YF,.7463,.4673);case"azimuthal-equal-area":return Tl(oY,4,4);case"azimuthal-equidistant":return Tl(sY,Su,Su);case"conic-conformal":return fx(cY,Su,Su);case"conic-equal-area":return fx(Mb,6.1702,2.9781);case"conic-equidistant":return fx(dY,7.312,3.6282);case"equal-earth":return Tl(pY,5.4133,2.6347);case"equirectangular":return Tl(uY,Su,T3);case"gnomonic":return Tl(mY,3.4641,3.4641);case"identity":return{type:A3};case"reflect-y":return{type:ree};case"mercator":return Tl(aY,Su,Su);case"orthographic":return Tl(gY,2,2);case"stereographic":return Tl(yY,2,2);case"transverse-mercator":return Tl(_Y,Su,Su);default:throw new Error(`unknown projection type: ${e}`)}}function Tl(e,t,n){return{type:({width:r,height:i,rotate:a,precision:c=.15,clip:d})=>{const p=e();return null!=c&&p.precision?.(c),null!=a&&p.rotate?.(a),"number"==typeof d&&p.clipAngle?.(d),p.scale(Math.min(r/t,i/n)),p.translate([r/2,i/2]),p},aspectRatio:n/t}}function fx(e,t,n){const{type:r,aspectRatio:i}=Tl(e,t,n);return{type:a=>{const{parallels:c,domain:d,width:p,height:v}=a,E=r(a);return null!=c&&(E.parallels(c),void 0===d&&E.fitSize([p,v],{type:"Sphere"})),E},aspectRatio:i}}const A3=Mm({stream:e=>e}),ree=Mm(hD({point(e,t){this.stream.point(e,-t)}}));function px(e,t,n,r,i){const a=n[e]&&"x"===n[e].scale,c=n[t]&&"y"===n[t].scale;if(a&&c)!function iee(e,t,n,r){const i=n[e],a=n[t],c=i.length,d=n[e]=new Float64Array(c).fill(NaN),p=n[t]=new Float64Array(c).fill(NaN);let v;const E=r.stream({point(D,T){d[v]=D,p[v]=T}});for(v=0;v<c;++v)E.point(i[v],a[v])}(e,t,r,i.projection);else{if(a)throw new Error(`projection requires paired x and y channels; ${e} is missing ${t}`);if(c)throw new Error(`projection requires paired x and y channels; ${t} is missing ${e}`)}}function CS(e={},t){const{document:n=(typeof window<"u"?window.document:void 0)}=e;return{document:n,projection:tee(e,t)}}function ls(e,{document:t}){return ZD(DE(e).call(t.documentElement))}const k3=new Map([["accent",cJ],["category10",lJ],["dark2",uJ],["paired",hJ],["pastel1",dJ],["pastel2",fJ],["set1",pJ],["set2",mJ],["set3",gJ],["tableau10",yJ],["brbg",Mu(mL,gL)],["prgn",Mu(yL,_L)],["piyg",Mu(vL,bL)],["puor",Mu(xL,wL)],["rdbu",Mu($D,Hb)],["rdgy",Mu(CL,EL)],["rdylbu",Mu(jD,Gb)],["rdylgn",Mu(DL,SL)],["spectral",Mu(ML,TL)],["burd",P3($D,Hb)],["buylrd",P3(jD,Gb)],["blues",ro(QL,eN)],["greens",ro(tN,nN)],["greys",ro(rN,iN)],["oranges",ro(cN,uN)],["purples",ro(oN,sN)],["reds",ro(aN,lN)],["turbo",Tu(wN)],["viridis",Tu(CN)],["magma",Tu(EN)],["inferno",Tu(DN)],["plasma",Tu(SN)],["cividis",Tu(hN)],["cubehelix",Tu(yN)],["warm",Tu(_N)],["cool",Tu(vN)],["bugn",ro(IL,AL)],["bupu",ro(kL,PL)],["gnbu",ro(RL,FL)],["orrd",ro(OL,LL)],["pubu",ro(BL,VL)],["pubugn",ro(NL,zL)],["purd",ro(UL,$L)],["rdpu",ro(jL,HL)],["ylgn",ro(ZL,WL)],["ylgnbu",ro(GL,qL)],["ylorbr",ro(XL,YL)],["ylorrd",ro(KL,JL)],["rainbow",R3(bN)],["sinebow",R3(xN)]]);function ro(e,t){return({length:n})=>1===n?[e[3][1]]:2===n?[e[3][1],e[3][2]]:(n=Math.max(3,Math.floor(n)))>9?El(t,n):e[n]}function Mu(e,t){return({length:n})=>2===n?[e[3][0],e[3][2]]:(n=Math.max(3,Math.floor(n)))>11?El(t,n):e[n]}function P3(e,t){return({length:n})=>2===n?[e[3][2],e[3][0]]:(n=Math.max(3,Math.floor(n)))>11?El(r=>t(1-r),n):e[n].slice().reverse()}function Tu(e){return({length:t})=>El(e,Math.max(2,Math.floor(t)))}function R3(e){return({length:t})=>El(e,Math.floor(t)+1).slice(0,-1)}function F3(e){const t=`${e}`.toLowerCase();if(!k3.has(t))throw new Error(`unknown ordinal scheme: ${t}`);return k3.get(t)}function mx(e,t){const n=F3(e),r="function"==typeof n?n({length:t}):n;return r.length!==t?r.slice(0,t):r}const O3=new Map([["brbg",gL],["prgn",_L],["piyg",bL],["puor",wL],["rdbu",Hb],["rdgy",EL],["rdylbu",Gb],["rdylgn",SL],["spectral",TL],["burd",e=>Hb(1-e)],["buylrd",e=>Gb(1-e)],["blues",eN],["greens",nN],["greys",iN],["purples",sN],["reds",lN],["oranges",uN],["turbo",wN],["viridis",CN],["magma",EN],["inferno",DN],["plasma",SN],["cividis",hN],["cubehelix",yN],["warm",_N],["cool",vN],["bugn",AL],["bupu",PL],["gnbu",FL],["orrd",LL],["pubugn",zL],["pubu",VL],["purd",$L],["rdpu",HL],["ylgnbu",qL],["ylgn",WL],["ylorbr",YL],["ylorrd",JL],["rainbow",bN],["sinebow",xN]]);function ES(e){const t=`${e}`.toLowerCase();if(!O3.has(t))throw new Error(`unknown quantitative scheme: ${t}`);return O3.get(t)}const lee=new Set(["brbg","prgn","piyg","puor","rdbu","rdgy","rdylbu","rdylgn","spectral","burd","buylrd"]);function L3(e){return null!=e&&lee.has(`${e}`.toLowerCase())}const N3=e=>t=>e(1-t),DS=[0,1],z3=new Map([["number",$o],["rgb",mf],["hsl",vY],["hcl",wY],["lab",function xY(e,t){var n=to((e=yD(e)).l,(t=yD(t)).l),r=to(e.a,t.a),i=to(e.b,t.b),a=to(e.opacity,t.opacity);return function(c){return e.l=n(c),e.a=r(c),e.b=i(c),e.opacity=a(c),e+""}}]]);function B3(e){const t=`${e}`.toLowerCase();if(!z3.has(t))throw new Error(`unknown interpolator: ${t}`);return z3.get(t)}function g_(e,t,n,{type:r,nice:i,clamp:a,zero:c,domain:d=U3(e,n),unknown:p,round:v,scheme:E,interval:D,range:T=(ii.get(e)===lx?vee(n,d):ii.get(e)===cx?bee(n,d):ii.get(e)===ux?DS:void 0),interpolate:P=(ii.get(e)===Tc?null==E&&void 0!==T?mf:ES(void 0!==E?E:"cyclical"===r?"rainbow":"turbo"):v?gD:$o),reverse:N}){if(D=d_(D,r),("cyclical"===r||"sequential"===r)&&(r="linear"),N=!!N,"function"!=typeof P&&(P=B3(P)),1===P.length?(N&&(P=N3(P),N=!1),void 0===T&&2===(T=Float64Array.from(d,(G,U)=>U/(d.length-1))).length&&(T=DS),t.interpolate((T===DS?Mm:MS)(P))):t.interpolate(P),c){const[G,U]=Qp(d);(G>0||U<0)&&(p_(d=sS(d))!==Math.sign(G)?d[d.length-1]=0:d[0]=0)}return N&&(d=$0(d)),t.domain(d).unknown(p),i&&(t.nice(function cee(e,t){return!0===e?void 0:"number"==typeof e?e:function xQ(e,t){if((e=d_(e,t))&&"function"!=typeof e.ceil)throw new Error("invalid interval: missing ceil method");return e}(e,t)}(i,r)),d=t.domain()),void 0!==T&&t.range(T),a&&t.clamp(a),{type:r,domain:d,range:T,scale:t,interpolate:P,interval:D}}function V3(e,t,{exponent:n=1,...r}){return g_(e,RD().exponent(n),t,{...r,type:"pow"})}function dee(e,t,{base:n=10,domain:r=xee(t),...i}){return g_(e,AO().base(n),t,{...i,domain:r})}function fee(e,t,{constant:n=1,...r}){return g_(e,FO().constant(n),t,r)}function pee(e,t,{range:n,quantiles:r=(void 0===n?5:(n=[...n]).length),n:i=r,scheme:a="rdylbu",domain:c=wee(t),unknown:d,interpolate:p,reverse:v}){return void 0===n&&(n=void 0!==p?El(p,i):ii.get(e)===Tc?mx(a,i):void 0),c.length>0&&(c=NO(c,void 0===n?{length:i}:n).quantiles()),SS(e,0,{domain:c,range:n,reverse:v,unknown:d})}function SS(e,t,{domain:n=[0],unknown:r,scheme:i="rdylbu",interpolate:a,range:c=(void 0!==a?El(a,n.length+1):ii.get(e)===Tc?mx(i,n.length+1):void 0),reverse:d}){const p=p_(n=Sc(n));if(!isNaN(p)&&!function gee(e,t){for(let n=1,r=e.length,i=e[0];n<r;++n){const a=Sy(i,i=e[n]);if(0!==a&&a!==t)return!1}return!0}(n,p))throw new Error(`the ${e} scale has a non-monotonic domain`);return d&&(c=$0(c)),{type:"threshold",scale:zO(p<0?$0(n):n,void 0===c?[]:c).unknown(r),domain:n,range:c}}function y_(e,t=l3){return e.length?[uf(e,({value:n})=>void 0===n?n:uf(n,t)),Xs(e,({value:n})=>void 0===n?n:Xs(n,t))]:[0,1]}function U3(e,t){const n=ii.get(e);return(n===lx||n===ux||n===cx?_ee:y_)(t)}function _ee(e){return[0,e.length?Xs(e,({value:t})=>void 0===t?t:Xs(t,l3)):1]}function vee(e,t){const n=e.find(({radius:c})=>void 0!==c);if(void 0!==n)return[0,n.radius];const r=N0(e,.5,({value:c})=>void 0===c?NaN:N0(c,.25,ix)),i=t.map(c=>3*Math.sqrt(c/r)),a=30/Xs(i);return a<1?i.map(c=>c*a):i}function bee(e,t){const n=z0(e,({value:a})=>void 0===a?NaN:z0(a,Math.abs)),r=t.map(a=>12*a/n),i=60/Xs(r);return i<1?r.map(a=>a*i):r}function xee(e){for(const{value:t}of e)if(void 0!==t)for(let n of t){if(n>0)return y_(e,ix);if(n<0)return y_(e,rS)}return[1,10]}function wee(e){const t=[];for(const{value:n}of e)if(void 0!==n)for(const r of n)t.push(r);return t}function MS(e){return(t,n)=>r=>e(t+r*(n-t))}function gx(e,t,n,r,{type:i,nice:a,clamp:c,domain:d=y_(r),unknown:p,pivot:v=0,scheme:E,range:D,symmetric:T=!0,interpolate:P=(ii.get(e)===Tc?null==E&&void 0!==D?mf:ES(void 0!==E?E:"rdbu"):$o),reverse:N}){v=+v;let[G,U]=d;if(Sy(G,U)<0&&([G,U]=[U,G],N=!N),G=Math.min(G,v),U=Math.max(U,v),"function"!=typeof P&&(P=B3(P)),void 0!==D&&(P=1===P.length?MS(P)(...D):CD(P,D)),N&&(P=N3(P)),T){const Z=n.apply(v),ne=Z-n.apply(G),X=n.apply(U)-Z;ne<X?G=n.invert(Z-X):ne>X&&(U=n.invert(Z+ne))}return t.domain([G,v,U]).unknown(p).interpolator(P),c&&t.clamp(c),a&&t.nice(a),{type:i,domain:[G,U],pivot:v,interpolate:P,scale:t}}function Cee(e,t,n){return gx(e,dL(),Mee,t,n)}function $3(e,t,{exponent:n=1,...r}){return gx(e,UD().exponent(n=+n),function Aee(e){return.5===e?Iee:{apply:t=>Math.sign(t)*Math.pow(Math.abs(t),e),invert:t=>Math.sign(t)*Math.pow(Math.abs(t),1/e)}}(n),t,{...r,type:"diverging-pow"})}function Dee(e,t,{base:n=10,pivot:r=1,domain:i=y_(t,r<0?rS:ix),...a}){return gx(e,fL().base(n=+n),Tee,t,{domain:i,pivot:r,...a})}function See(e,t,{constant:n=1,...r}){return gx(e,pL().constant(n=+n),function kee(e){return{apply:t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),invert:t=>Math.sign(t)*Math.expm1(Math.abs(t))*e}}(n),t,r)}const Mee={apply:e=>e,invert:e=>e},Tee={apply:Math.log,invert:Math.exp},Iee={apply:e=>Math.sign(e)*Math.sqrt(Math.abs(e)),invert:e=>Math.sign(e)*(e*e)};function j3(e,t,n,r){return g_(e,t,n,r)}const __=Symbol("ordinal");function H3(e,t,n,{type:r,interval:i,domain:a,range:c,reverse:d,hint:p}){return i=d_(i,r),void 0===a&&(a=q3(n,i,e)),("categorical"===r||r===__)&&(r="ordinal"),d&&(a=$0(a)),t.domain(a),void 0!==c&&("function"==typeof c&&(c=c(a)),t.range(c)),{type:r,domain:a,range:c,scale:t,hint:p,interval:i}}function G3(e,t,n,r){let{round:i}=n;return void 0!==i&&e.round(i=!!i),(e=H3(r,e,t,n)).round=i,e}function q3(e,t,n){const r=new pE;for(const{value:i,domain:a}of e){if(void 0!==a)return a();if(void 0!==i)for(const c of i)r.add(c)}if(void 0!==t){const[i,a]=Qp(r).map(t.floor,t);return t.range(i,t.offset(a))}if(r.size>1e4&&ii.get(n)===Mc)throw new Error(`implicit ordinal domain of ${n} scale has more than 10,000 values`);return yE(r,Sm)}function Z3(e,t){let n;for(const{hint:r}of e){const i=r?.[t];if(void 0!==i)if(void 0===n)n=i;else if(n!==i)return}return n}function TS(e,{label:t,inset:n=0,insetTop:r=n,insetRight:i=n,insetBottom:a=n,insetLeft:c=n,round:d,nice:p,clamp:v,zero:E,align:D,padding:T,projection:P,facet:{label:N=t}={},...G}={}){const U={};for(const[Z,ne]of e){const X=G[Z],re=e5(Z,ne,{round:ii.get(Z)===Mc?d:void 0,nice:p,clamp:v,zero:E,align:D,padding:T,projection:P,...X});if(re){let{label:fe=("fx"===Z||"fy"===Z?N:t),percent:ve,transform:Re,inset:We,insetTop:Ke=(void 0!==We?We:"y"===Z?r:0),insetRight:lt=(void 0!==We?We:"x"===Z?i:0),insetBottom:Ue=(void 0!==We?We:"y"===Z?a:0),insetLeft:st=(void 0!==We?We:"x"===Z?c:0)}=X||{};if(null==Re)Re=void 0;else if("function"!=typeof Re)throw new Error("invalid scale transform; not a function");re.percent=!!ve,re.label=void 0===fe?Vee(ne,re):fe,re.transform=Re,"x"===Z||"fx"===Z?(re.insetLeft=+st,re.insetRight=+lt):("y"===Z||"fy"===Z)&&(re.insetTop=+Ke,re.insetBottom=+Ue),U[Z]=re}}return U}function W3(e){return Object.fromEntries(Object.entries(e).filter(([,{scale:t}])=>t).map(([t,{scale:n,type:r,interval:i,label:a}])=>(n.type=r,null!=i&&(n.interval=i),null!=a&&(n.label=a),[t,n])))}function Vee(e=[],t){let n;for(const{label:r}of e)if(void 0!==r)if(void 0===n)n=r;else if(n!==r)return;if(!(void 0===n||n5(t)&&/^(date|time|year)$/i.test(n)))return!Df(t)&&t.percent&&(n=`${n} (%)`),{inferred:!0,toString:()=>n}}function IS(e){const{marginTop:t,marginRight:n,marginBottom:r,marginLeft:i,width:a,height:c,facet:{marginTop:d,marginRight:p,marginBottom:v,marginLeft:E}}=e;return{marginTop:Math.max(t,d),marginRight:Math.max(n,p),marginBottom:Math.max(r,v),marginLeft:Math.max(i,E),width:a,height:c}}function X3({fx:e,fy:t},n){const{marginTop:r,marginRight:i,marginBottom:a,marginLeft:c,width:d,height:p}=IS(n);return{marginTop:r,marginRight:i,marginBottom:a,marginLeft:c,width:e?e.scale.bandwidth()+c+i:d,height:t?t.scale.bandwidth()+r+a:p}}function Y3(e,t){if(void 0===e.range){const{insetLeft:n,insetRight:r}=e,{width:i,marginLeft:a=0,marginRight:c=0}=t,d=a+n;e.range=[d,Math.max(d,i-c-r)],Df(e)||(e.range=Q3(e)),e.scale.range(e.range)}J3(e)}function K3(e,t){if(void 0===e.range){const{insetTop:n,insetBottom:r}=e,{height:i,marginTop:a=0,marginBottom:c=0}=t,d=a+n;e.range=[Math.max(d,i-c-r),d],Df(e)?e.range.reverse():e.range=Q3(e),e.scale.range(e.range)}J3(e)}function J3(e){void 0===e.round&&function Hee({type:e}){return"point"===e||"band"===e}(e)&&function Uee({scale:e}){const t=e.domain().length,[n,r]=e.range(),i=e.paddingInner?e.paddingInner():1,a=e.paddingOuter?e.paddingOuter():e.padding(),c=t-i,d=Math.abs(r-n)/Math.max(1,c+2*a);return(d-Math.floor(d))*c}(e)<=30&&e.scale.round(!0)}function Q3(e){const t=e.scale.domain().length+r5(e);if(!(t>2))return e.range;const[n,r]=e.range;return Array.from({length:t},(i,a)=>n+a/(t-1)*(r-n))}function e5(e,t=[],n={}){const r=function jee(e,t,{type:n,domain:r,range:i,scheme:a,pivot:c,projection:d}){if("fx"===e||"fy"===e)return"band";("x"===e||"y"===e)&&null!=d&&(n=t5);for(const{type:E}of t)if(void 0!==E)if(void 0===n)n=E;else if(n!==E)throw new Error(`scale incompatible with channel: ${n} !== ${E}`);if(n===t5)return;if(void 0!==n)return n;if(void 0===r&&!t.some(({value:E})=>void 0!==E))return;const p=ii.get(e);if(p===lx)return"sqrt";if(p===ux||p===cx)return"linear";if(p===hx)return"ordinal";if((r||i||[]).length>2)return AS(p);if(void 0!==r)return y3(r)?AS(p):Ml(r)?"utc":p!==Tc||null==c&&!L3(a)?"linear":"diverging";const v=t.map(({value:E})=>E).filter(E=>void 0!==E);return v.some(y3)?AS(p):v.some(Ml)?"utc":p!==Tc||null==c&&!L3(a)?"linear":"diverging"}(e,t,n);if(void 0===n.type&&void 0===n.domain&&void 0===n.range&&null==n.interval&&"fx"!==e&&"fy"!==e&&Df({type:r})){const i=t.map(({value:a})=>a).filter(a=>void 0!==a);i.some(Ml)?Ef(`Warning: some data associated with the ${e} scale are dates. Dates are typically associated with a "utc" or "time" scale rather than a "${Pm(r)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., d3.utcDay), or you can suppress this warning by setting the type of the ${e} scale to "${Pm(r)}".`):i.some(EQ)?Ef(`Warning: some data associated with the ${e} scale are strings that appear to be dates (e.g., YYYY-MM-DD). If these strings represent dates, you should parse them to Date objects. Dates are typically associated with a "utc" or "time" scale rather than a "${Pm(r)}" scale. If you are using a bar mark, you probably want a rect mark with the interval option instead; if you are using a group transform, you probably want a bin transform instead. If you want to treat this data as ordinal, you can suppress this warning by setting the type of the ${e} scale to "${Pm(r)}".`):i.some(DQ)&&Ef(`Warning: some data associated with the ${e} scale are strings that appear to be numbers. If these strings represent numbers, you should parse or coerce them to numbers. Numbers are typically associated with a "linear" scale rather than a "${Pm(r)}" scale. If you want to treat this data as ordinal, you can specify the interval of the ${e} scale (e.g., 1 for integers), or you can suppress this warning by setting the type of the ${e} scale to "${Pm(r)}".`)}switch(n.type=r,r){case"diverging":case"diverging-sqrt":case"diverging-pow":case"diverging-log":case"diverging-symlog":case"cyclical":case"sequential":case"linear":case"sqrt":case"threshold":case"quantile":case"pow":case"log":case"symlog":n=_x(t,n,ox);break;case"identity":switch(ii.get(e)){case Mc:n=_x(t,n,ox);break;case hx:n=_x(t,n,Gee)}break;case"utc":case"time":n=_x(t,n,_Q)}switch(r){case"diverging":return Cee(e,t,n);case"diverging-sqrt":return function Eee(e,t,n){return $3(e,t,{...n,exponent:.5})}(e,t,n);case"diverging-pow":return $3(e,t,n);case"diverging-log":return Dee(e,t,n);case"diverging-symlog":return See(e,t,n);case"categorical":case"ordinal":case __:return function Fee(e,t,{type:n,interval:r,domain:i,range:a,scheme:c,unknown:d,...p}){let v;if(r=d_(r,n),void 0===i&&(i=q3(t,r,e)),ii.get(e)===hx)v=function Nee(e){return{fill:Z3(e,"fill"),stroke:Z3(e,"stroke")}}(t),a=void 0===a?function zee(e){return Js(e.fill)?FJ:RJ}(v):Go(a,gS);else if(ii.get(e)===Tc&&(void 0===a&&("ordinal"===n||n===__)&&(a=function aee(e,t="greys"){const n=new Set,[r,i]=mx(t,2);for(const a of e)if(null!=a)if(!0===a)n.add(i);else{if(!1!==a)return;n.add(r)}return[...n]}(i,c),void 0!==a&&(c=void 0)),void 0===c&&void 0===a&&(c="ordinal"===n?"turbo":"tableau10"),void 0!==c))if(void 0!==a){const E=ES(c),D=a[0],T=a[1]-a[0];a=({length:P})=>El(N=>E(D+T*N),P)}else a=F3(c);if(d===SD)throw new Error(`implicit unknown on ${e} scale is not supported`);return H3(e,MD().unknown(d),t,{...p,type:n,domain:i,range:a,hint:v})}(e,t,n);case"cyclical":case"sequential":case"linear":return function uee(e,t,n){return g_(e,PD(),t,n)}(e,t,n);case"sqrt":return function hee(e,t,n){return V3(e,t,{...n,exponent:.5})}(e,t,n);case"threshold":return SS(e,0,n);case"quantile":return pee(e,t,n);case"quantize":return function mee(e,t,{range:n,n:r=(void 0===n?5:(n=[...n]).length),scheme:i="rdylbu",domain:a=U3(e,t),unknown:c,interpolate:d,reverse:p}){const[v,E]=Qp(a);let D;return void 0===n?(D=U0(v,E,r),D[0]<=v&&D.splice(0,1),D[D.length-1]>=E&&D.pop(),r=D.length+1,n=void 0!==d?El(d,r):ii.get(e)===Tc?mx(i,r):void 0):(D=El($o(v,E),r+1).slice(1,-1),v instanceof Date&&(D=D.map(T=>new Date(T)))),p_(Sc(a))<0&&D.reverse(),SS(e,0,{domain:D,range:n,reverse:p,unknown:c})}(e,t,n);case"pow":return V3(e,t,n);case"log":return dee(e,t,n);case"symlog":return fee(e,t,n);case"utc":return function Ree(e,t,n){return j3(e,function iJ(){return xc.apply(VD(WY,XY,Cc,xm,vm,e_,Ub,Bb,wu,s_).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}(),t,n)}(e,t,n);case"time":return function Pee(e,t,n){return j3(e,function rJ(){return xc.apply(VD(YY,KY,wc,bm,_m,ym,Vb,zb,wu,uL).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}(),t,n)}(e,t,n);case"point":return function Oee(e,t,{align:n=.5,padding:r=.5,...i}){return G3(function AY(){return bO(Ob.apply(null,arguments).paddingInner(1))}().align(n).padding(r),t,i,e)}(e,t,n);case"band":return function Lee(e,t,{align:n=.5,padding:r=.1,paddingInner:i=r,paddingOuter:a=("fx"===e||"fy"===e?0:r),...c}){return G3(Ob().align(n).paddingInner(i).paddingOuter(a),t,c,e)}(e,t,n);case"identity":return ii.get(e)===Mc?function yee(){return{type:"identity",scale:EO()}}():{type:"identity"};case void 0:return;default:throw new Error(`unknown scale type: ${r}`)}}function Pm(e){return"symbol"==typeof e?e.description:e}const t5={toString:()=>"projection"};function AS(e){switch(e){case Mc:return"point";case Tc:return __;default:return"ordinal"}}function n5({type:e}){return"time"===e||"utc"===e}function Df({type:e}){return"ordinal"===e||"point"===e||"band"===e||e===__}function r5({type:e}){return"threshold"===e}function yx(e){if(void 0===e)return!0;const t=e.domain(),n=e(t[0]);for(let r=1,i=t.length;r<i;++r)if(e(t[r])-n)return!1;return!0}function _x(e,{domain:t,...n},r){for(const i of e)void 0!==i.value&&(i.value=r(i.value));return{domain:void 0===t?t:r(t),...n}}function Gee(e){return Go(e,gS)}function Iu(e,t){return`${e}`.padStart(t,"0")}function kS(e){let t,n;return(...r)=>((n?.length!==r.length||n.some((i,a)=>i!==r[a]))&&(n=r,t=e(...r)),t)}const Xee=kS(e=>new Intl.NumberFormat(e));function o5(e){return function Zee(e,t){if(e instanceof Date||(e=new Date(+e)),isNaN(e))return"function"==typeof t?t(e):t;const n=e.getUTCHours(),r=e.getUTCMinutes(),i=e.getUTCSeconds(),a=e.getUTCMilliseconds();return`${function Wee(e){return e<0?`-${Iu(-e,6)}`:e>9999?`+${Iu(e,6)}`:Iu(e,4)}(e.getUTCFullYear())}-${Iu(e.getUTCMonth()+1,2)}-${Iu(e.getUTCDate(),2)}${n||r||i||a?`T${Iu(n,2)}:${Iu(r,2)}${i||a?`:${Iu(i,2)}${a?`.${Iu(a,3)}`:""}`:""}Z`:""}`}(e,"Invalid Date")}kS((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{month:t}})),kS((e,t)=>new Intl.DateTimeFormat(e,{timeZone:"UTC",...t&&{weekday:t}}));const vx=function Qee(e="en-US"){const t=function Jee(e="en-US"){const t=Xee(e);return n=>null==n||isNaN(n)?void 0:t.format(n)}(e);return n=>(n instanceof Date?o5:"number"==typeof n?t:Sl)(n)}(),Qs=typeof window<"u"&&window.devicePixelRatio>1?0:.5;let ete=0;function s5(){return"plot-clip-"+ ++ete}function tte(e,{title:t,href:n,ariaLabel:r,ariaDescription:i,ariaHidden:a,target:c,fill:d,fillOpacity:p,stroke:v,strokeWidth:E,strokeOpacity:D,strokeLinejoin:T,strokeLinecap:P,strokeMiterlimit:N,strokeDasharray:G,strokeDashoffset:U,opacity:Z,mixBlendMode:ne,paintOrder:X,pointerEvents:re,shapeRendering:fe},{ariaLabel:ve,fill:Re="currentColor",fillOpacity:We,stroke:Ke="none",strokeOpacity:lt,strokeWidth:Ue,strokeLinecap:st,strokeLinejoin:Fe,strokeMiterlimit:le,paintOrder:de}){null===Re&&(d=null,p=null),null===Ke&&(v=null,D=null),Js(Re)?!Js(Ke)&&!Js(d)&&(Ke="none"):Js(Ke)&&!Js(v)&&(Re="none");const[pe,Oe]=Tm(d,Re),[Ye,Ze]=As(p,We),[et,_t]=Tm(v,Ke),[Ft,sr]=As(D,lt),[Hn,gr]=As(Z);f_(_t)||(void 0===E&&(E=Ue),void 0===P&&(P=st),void 0===T&&(T=Fe),void 0===N&&!function TQ(e){return/^\s*round\s*$/i.test(e)}(T)&&(N=le),!f_(Oe)&&void 0===X&&(X=de));const[wi,Yn]=As(E);return null!==Re&&(e.fill=ea(Oe,"currentColor"),e.fillOpacity=b_(Ze,1)),null!==Ke&&(e.stroke=ea(_t,"none"),e.strokeWidth=b_(Yn,1),e.strokeOpacity=b_(sr,1),e.strokeLinejoin=ea(T,"miter"),e.strokeLinecap=ea(P,"butt"),e.strokeMiterlimit=b_(N,4),e.strokeDasharray=ea(G,"none"),e.strokeDashoffset=ea(U,"0")),e.target=Sl(c),e.ariaLabel=Sl(ve),e.ariaDescription=Sl(i),e.ariaHidden=Sl(a),e.opacity=b_(gr,1),e.mixBlendMode=ea(ne,"normal"),e.paintOrder=ea(X,"normal"),e.pointerEvents=ea(re,"auto"),e.shapeRendering=ea(fe,"auto"),{title:{value:t,optional:!0},href:{value:n,optional:!0},ariaLabel:{value:r,optional:!0},fill:{value:pe,scale:"auto",optional:!0},fillOpacity:{value:Ye,scale:"auto",optional:!0},stroke:{value:et,scale:"auto",optional:!0},strokeOpacity:{value:Ft,scale:"auto",optional:!0},strokeWidth:{value:wi,optional:!0},opacity:{value:Hn,scale:"auto",optional:!0}}}function ite(e,t){t&&e.text(n=>vx(t[n]))}function ote(e,t){t&&e.text(([n])=>vx(t[n]))}function v_(e,{target:t},{ariaLabel:n,title:r,fill:i,fillOpacity:a,stroke:c,strokeOpacity:d,strokeWidth:p,opacity:v,href:E}){n&&xn(e,"aria-label",D=>n[D]),i&&xn(e,"fill",D=>i[D]),a&&xn(e,"fill-opacity",D=>a[D]),c&&xn(e,"stroke",D=>c[D]),d&&xn(e,"stroke-opacity",D=>d[D]),p&&xn(e,"stroke-width",D=>p[D]),v&&xn(e,"opacity",D=>v[D]),E&&a5(e,D=>E[D],t),function nte(e,t){t&&e.filter(n=>nS(t[n])).append("title").call(ite,t)}(e,r)}function ste(e,{target:t},{ariaLabel:n,title:r,fill:i,fillOpacity:a,stroke:c,strokeOpacity:d,strokeWidth:p,opacity:v,href:E}){n&&xn(e,"aria-label",([D])=>n[D]),i&&xn(e,"fill",([D])=>i[D]),a&&xn(e,"fill-opacity",([D])=>a[D]),c&&xn(e,"stroke",([D])=>c[D]),d&&xn(e,"stroke-opacity",([D])=>d[D]),p&&xn(e,"stroke-width",([D])=>p[D]),v&&xn(e,"opacity",([D])=>v[D]),E&&a5(e,([D])=>E[D],t),function rte(e,t){t&&e.filter(([n])=>nS(t[n])).append("title").call(ote,t)}(e,r)}function Sf(e,t,n,r){(function hte(e,t,n,r){let i;switch(t.clip){case"frame":{const{width:a,height:c,marginLeft:d,marginRight:p,marginTop:v,marginBottom:E}=n,D=s5();i=`url(#${D})`,e=ls("svg:g",r).call(T=>T.append("svg:clipPath").attr("id",D).append("rect").attr("x",d).attr("y",v).attr("width",a-p-d).attr("height",c-v-E)).each(function(){this.appendChild(e.node()),e.node=()=>this});break}case"sphere":{const{projection:a}=r;if(!a)throw new Error('the "sphere" clip option requires a projection');const c=s5();i=`url(#${c})`,e.append("clipPath").attr("id",c).append("path").attr("d",iD(a)({type:"Sphere"}));break}}xn(e,"aria-label",t.ariaLabel),xn(e,"aria-description",t.ariaDescription),xn(e,"aria-hidden",t.ariaHidden),xn(e,"clip-path",i)})(e,t,n,r),xn(e,"fill",t.fill),xn(e,"fill-opacity",t.fillOpacity),xn(e,"stroke",t.stroke),xn(e,"stroke-width",t.strokeWidth),xn(e,"stroke-opacity",t.strokeOpacity),xn(e,"stroke-linejoin",t.strokeLinejoin),xn(e,"stroke-linecap",t.strokeLinecap),xn(e,"stroke-miterlimit",t.strokeMiterlimit),xn(e,"stroke-dasharray",t.strokeDasharray),xn(e,"stroke-dashoffset",t.strokeDashoffset),xn(e,"shape-rendering",t.shapeRendering),xn(e,"paint-order",t.paintOrder),xn(e,"pointer-events",t.pointerEvents)}function Mf(e,t){(function dte(e,t,n){null!=n&&e.style(t,n)})(e,"mix-blend-mode",t.mixBlendMode),xn(e,"opacity",t.opacity)}function a5(e,t,n){e.each(function(r){const i=t(r);if(null!=i){const a=this.ownerDocument.createElementNS(tm.svg,"a");a.setAttribute("fill","inherit"),a.setAttributeNS(tm.xlink,"href",i),null!=n&&a.setAttribute("target",n),this.parentNode.insertBefore(a,this).appendChild(this)}})}function xn(e,t,n){null!=n&&e.attr(t,n)}function Tf(e,t,{x:n,y:r},i=Qs,a=Qs){i+=t.dx,a+=t.dy,n?.bandwidth&&(i+=n.bandwidth()/2),r?.bandwidth&&(a+=r.bandwidth()/2),(i||a)&&e.attr("transform",`translate(${i},${a})`)}function ea(e,t){if((e=Sl(e))!==t)return e}function b_(e,t){if((e=So(e))!==t)return e}const fte=/^-?([_a-z]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])([_a-z0-9-]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])*$/i;function PS(e){if(void 0===e)return`plot-${Math.random().toString(16).slice(2)}`;if(!fte.test(e=`${e}`))throw new Error(`invalid class name: ${e}`);return e}function RS(e,t){if("string"==typeof t)e.property("style",t);else if(null!=t)for(const n of e)Object.assign(n.style,t)}function FS({frameAnchor:e},{width:t,height:n,marginTop:r,marginRight:i,marginBottom:a,marginLeft:c}){return[/left$/.test(e)?c:/right$/.test(e)?t-i:(c+t-i)/2,/^top/.test(e)?r:/^bottom/.test(e)?n-a:(r+n-a)/2]}function mte({x:e,y:t,fy:n,fx:r},i,{projection:a,aspectRatio:c},{width:d,marginTopDefault:p,marginRightDefault:v,marginBottomDefault:E,marginLeftDefault:D}){const T=n?n.scale.domain().length:1,P=function oee(e,t){if("function"==typeof e?.stream)return.618;if(Im(e)&&(e=e.type),null==e)return function see(e){for(const t of e)if(t.channels.geometry)return!0;return!1}(t)?.618:void 0;if("function"!=typeof e){const{aspectRatio:n}=I3(e);if(n)return n}return.618}(a,i);if(P){const G=r?r.scale.domain().length:1,Z=Math.max(.1,Math.min(10,(1.1*T-.1)/(1.1*G-.1)*P));return Math.round((d-D-v)*Z+p+E)}const N=t?Df(t)?t.scale.domain().length:Math.max(7,17/T):1;if(null!=c){if(c=+c,!(isFinite(c)&&c>0))throw new Error(`invalid aspectRatio: ${c}`);const G=l5("y",t)/(l5("x",e)*c),U=r?r.scale.bandwidth():1,Z=n?n.scale.bandwidth():1;return(G*(U*(d-D-v)-e.insetLeft-e.insetRight)+t.insetTop+t.insetBottom)/Z+p+E}return!(!t&&!n)*Math.max(1,Math.min(60,N*T))*20+30*!!r+60}function l5(e,t){if(!t)throw new Error(`aspectRatio requires ${e} scale`);const{type:n,domain:r}=t;let i;switch(n){case"linear":case"utc":case"time":i=Number;break;case"pow":{const d=t.scale.exponent();i=p=>Math.pow(p,d);break}case"log":i=Math.log;break;case"point":case"band":return r.length;default:throw new Error(`unsupported ${e} scale for aspectRatio: ${n}`)}const[a,c]=Qp(r);return Math.abs(i(c)-i(a))}function OS(e,{fx:t,fy:n}){const r=u_(e),i=t?.value,a=n?.value;return t&&n?My(r,c=>(c.fx=i[c[0]],c.fy=a[c[0]],c),c=>i[c],c=>a[c]):t?My(r,c=>(c.fx=i[c[0]],c),c=>i[c]):My(r,c=>(c.fy=a[c[0]],c),c=>a[c])}function vte(e){const t=[],n=new Uint32Array(B0(e,r=>r.length));for(const r of e){let i=0;for(const a of e)r!==a&&(n.set(a,i),i+=a.length);t.push(n.slice(0,i))}return t}const bte=new Map([["top",LS],["right",BS],["bottom",NS],["left",zS],["top-left",bx(LS,zS)],["top-right",bx(LS,BS)],["bottom-left",bx(NS,zS)],["bottom-right",bx(NS,BS)],["top-empty",function wte(e,{y:t},{x:n,y:r,empty:i}){if(i)return!1;const a=t?.indexOf(r);if(a>0){const c=t[a-1];return e.find(d=>d.x===n&&d.y===c)?.empty}}],["right-empty",function Dte(e,{x:t},{x:n,y:r,empty:i}){if(i)return!1;const a=t?.indexOf(n);if(a<t?.length-1){const c=t[a+1];return e.find(d=>d.x===c&&d.y===r)?.empty}}],["bottom-empty",function Cte(e,{y:t},{x:n,y:r,empty:i}){if(i)return!1;const a=t?.indexOf(r);if(a<t?.length-1){const c=t[a+1];return e.find(d=>d.x===n&&d.y===c)?.empty}}],["left-empty",function Ete(e,{x:t},{x:n,y:r,empty:i}){if(i)return!1;const a=t?.indexOf(n);if(a>0){const c=t[a-1];return e.find(d=>d.x===c&&d.y===r)?.empty}}],["empty",function Ste(e,t,{empty:n}){return n}]]);function LS(e,{y:t},{y:n}){return!t||0===t.indexOf(n)}function NS(e,{y:t},{y:n}){return!t||t.indexOf(n)===t.length-1}function zS(e,{x:t},{x:n}){return!t||0===t.indexOf(n)}function BS(e,{x:t},{x:n}){return!t||t.indexOf(n)===t.length-1}function bx(e,t){return function(){return e.apply(null,arguments)&&t.apply(null,arguments)}}function VS(e,{channels:{fx:t,fy:n},groups:r}){return e.map(t&&n?({x:i,y:a})=>r.get(i)?.get(a)??[]:t?({x:i})=>r.get(i)??[]:({y:i})=>r.get(i)??[])}function c5(e){return Df(e)&&void 0===e.interval?void 0:"tabular-nums"}function u5(e,t){if(null==t)return t;const n=e(t);if(!n)throw new Error(`scale not found: ${t}`);return n}function h5(e,t={},n,r){let{columns:i,tickFormat:a,fontVariant:c=c5(e),swatchSize:d=15,swatchWidth:p=d,swatchHeight:v=d,marginLeft:E=0,className:D,style:T,width:P}=t;const N=CS(t);D=PS(D),a=function Mte(e,t){return void 0===e?Ml(t)?o5:Sl:"function"==typeof e?e:("string"==typeof e?Ml(t)?s_:um:Mm)(e)}(a,e.domain);const G=ls("div",N).attr("class",D).attr("style",`\n        --swatchWidth: ${+p}px;\n        --swatchHeight: ${+v}px;\n      `);let U;return null!=i?(U=`\n      .${D}-swatch {\n        display: flex;\n        align-items: center;\n        break-inside: avoid;\n        padding-bottom: 1px;\n      }\n      .${D}-swatch::before {\n        flex-shrink: 0;\n      }\n      .${D}-label {\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n    `,G.style("columns",i).selectAll().data(e.domain).enter().append("div").attr("class",`${D}-swatch`).call(n,e).call(Z=>Z.append("div").attr("class",`${D}-label`).attr("title",a).text(a))):(U=`\n      .${D} {\n        display: flex;\n        align-items: center;\n        min-height: 33px;\n        flex-wrap: wrap;\n      }\n      .${D}-swatch {\n        display: inline-flex;\n        align-items: center;\n        margin-right: 1em;\n      }\n    `,G.selectAll().data(e.domain).enter().append("span").attr("class",`${D}-swatch`).call(n,e).append(function(){return this.ownerDocument.createTextNode(a.apply(this,arguments))})),G.call(Z=>Z.insert("style","*").text(`\n        .${D} {\n          font-family: system-ui, sans-serif;\n          font-size: 10px;\n          margin-bottom: 0.5em;${void 0===E?"":`\n          margin-left: ${+E}px;`}${void 0===P?"":`\n          width: ${P}px;`}\n        }\n        ${r(D)}\n        ${U}\n      `)).style("font-variant",ea(c,"normal")).call(RS,T).node()}const xx=new Map([["symbol",function Ate(e,{fill:t=(void 0!==e.hint?.fill?e.hint.fill:"none"),fillOpacity:n=1,stroke:r=(void 0!==e.hint?.stroke?e.hint.stroke:Js(t)?"currentColor":"none"),strokeOpacity:i=1,strokeWidth:a=1.5,r:c=4.5,...d}={},p){const[v,E]=Tm(t),[D,T]=Tm(r),P=u5(p,v),N=u5(p,D),G=c*c*Math.PI;return n=As(n)[1],i=As(i)[1],a=As(a)[1],h5(e,d,U=>U.append("svg").attr("viewBox","-8 -8 16 16").attr("fill","color"===v?Z=>P.scale(Z):null).attr("stroke","color"===D?Z=>N.scale(Z):null).append("path").attr("d",Z=>{const ne=_f();return e.scale(Z).draw(ne,G),ne}),U=>`.${U}-swatch > svg {\n        width: var(--swatchWidth);\n        height: var(--swatchHeight);\n        margin-right: 0.5em;\n        overflow: visible;\n        fill: ${E};\n        fill-opacity: ${n};\n        stroke: ${T};\n        stroke-width: ${a}px;\n        stroke-opacity: ${i};\n      }`)}],["color",d5],["opacity",function Pte({type:e,interpolate:t,...n},{legend:r=!0,color:i=Oh(0,0,0),...a}){if(!t)throw new Error(`${e} opacity scales are not supported`);if(!0===r&&(r="ramp"),"ramp"!==`${r}`.toLowerCase())throw new Error(`${r} opacity legends are not supported`);return d5({type:e,...n,interpolate:Rte(i)},{legend:r,...a})}]]);function US(e,{label:t,ticks:n,tickFormat:r}={},i){return function IQ(e={},...t){let n=e;for(const r of t)for(const i in r)if(void 0===n[i]){const a=r[i];n===e?n={...n,[i]:a}:n[i]=a}return n}(i,e,{label:t,ticks:n,tickFormat:r})}function d5(e,{legend:t=!0,...n}){if(!0===t&&(t="ordinal"===e.type?"swatches":"ramp"),void 0!==e.domain)switch(`${t}`.toLowerCase()){case"swatches":return function Ite(e,{opacity:t,...n}={}){if(!Df(e)&&!r5(e))throw new Error(`swatches legend requires ordinal or threshold color scale (not ${e.type})`);return h5(e,n,(r,i)=>r.append("svg").attr("fill",i.scale).attr("fill-opacity",As(t)[1]).append("rect").attr("width","100%").attr("height","100%"),r=>`.${r}-swatch svg {\n        width: var(--swatchWidth);\n        height: var(--swatchHeight);\n        margin-right: 0.5em;\n      }`)}(e,n);case"ramp":return function Tte(e,t){let{label:n=e.label,tickSize:r=6,width:i=240,height:a=44+r,marginTop:c=18,marginRight:d=0,marginBottom:p=16+r,marginLeft:v=0,style:E,ticks:D=(i-v-d)/64,tickFormat:T,fontVariant:P=c5(e),round:N=!0,opacity:G,className:U}=t;const Z=CS(t);U=PS(U),G=As(G)[1],null===T&&(T=()=>null);const ne=ls("svg",Z).attr("class",U).attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("width",i).attr("height",a).attr("viewBox",`0 0 ${i} ${a}`).call(st=>st.append("style").text(`\n        .${U} {\n          display: block;\n          background: white;\n          height: auto;\n          height: intrinsic;\n          max-width: 100%;\n          overflow: visible;\n        }\n        .${U} text {\n          white-space: pre;\n        }\n      `)).call(RS,E);let re,X=st=>st.selectAll(".tick line").attr("y1",c+p-a);const fe=N?(st,Fe)=>st.rangeRound(Fe):(st,Fe)=>st.range(Fe),{type:ve,domain:Re,range:We,interpolate:Ke,scale:lt,pivot:Ue}=e;if(Ke){const st=void 0===We?Ke:CD(1===Ke.length?MS(Ke):Ke,We);re=fe(lt.copy(),El($o(v,i-d),Math.min(Re.length+(void 0!==Ue),void 0===We?1/0:We.length)));const Fe=256,le=Z.document.createElement("canvas");le.width=Fe,le.height=1;const de=le.getContext("2d");for(let pe=0,Oe=Fe-1;pe<Fe;++pe)de.fillStyle=st(pe/Oe),de.fillRect(pe,0,1,1);ne.append("image").attr("opacity",G).attr("x",v).attr("y",c).attr("width",i-v-d).attr("height",a-c-p).attr("preserveAspectRatio","none").attr("xlink:href",le.toDataURL())}else if("threshold"===ve){const st=Re,Fe=void 0===T?le=>le:"string"==typeof T?um(T):T;re=fe(PD().domain([-1,We.length-1]),[v,i-d]),ne.append("g").attr("fill-opacity",G).selectAll().data(We).enter().append("rect").attr("x",(le,de)=>re(de-1)).attr("y",c).attr("width",(le,de)=>re(de)-re(de-1)).attr("height",a-c-p).attr("fill",le=>le),D=Go(st,(le,de)=>de),T=le=>Fe(st[le],le)}else re=fe(Ob().domain(Re),[v,i-d]),ne.append("g").attr("fill-opacity",G).selectAll().data(Re).enter().append("rect").attr("x",re).attr("y",c).attr("width",Math.max(0,re.bandwidth()-1)).attr("height",a-c-p).attr("fill",lt),X=()=>{};return ne.append("g").attr("transform",`translate(0,${a-p})`).call(function XG(e){return G0(3,e)}(re).ticks(Array.isArray(D)?null:D,"string"==typeof T?T:void 0).tickFormat("function"==typeof T?T:void 0).tickSize(r).tickValues(Array.isArray(D)?D:null)).attr("font-size",null).attr("font-family",null).attr("font-variant",ea(P,"normal")).call(X).call(st=>st.select(".domain").remove()),void 0!==n&&ne.append("text").attr("x",v).attr("y",c-6).attr("fill","currentColor").attr("font-weight","bold").text(n),ne.node()}(e,n);default:throw new Error(`unknown legend type: ${t}`)}}function Rte(e){const{r:t,g:n,b:r}=Oh(e)||Oh(0,0,0);return i=>`rgba(${t},${n},${r},${i})`}function $S({filter:e,sort:t,reverse:n,transform:r,initializer:i,...a}={},c){if(void 0===r&&(null!=e&&(r=GS(e)),null!=t&&!Am(t)&&(r=jS(r,ZS(t))),n&&(r=jS(r,qS))),null!=c&&null!=i)throw new Error("transforms cannot be applied after initializers");return{...a,...(null===t||Am(t))&&{sort:t},transform:jS(r,c)}}function wx({filter:e,sort:t,reverse:n,initializer:r,...i}={},a){return void 0===r&&(null!=e&&(r=GS(e)),null!=t&&!Am(t)&&(r=HS(r,ZS(t))),n&&(r=HS(r,qS))),{...i,...(null===t||Am(t))&&{sort:t},initializer:HS(r,a)}}function jS(e,t){return null==e?null===t?void 0:t:null==t?null===e?void 0:e:function(n,r){return({data:n,facets:r}=e.call(this,n,r)),t.call(this,Sc(n),r)}}function HS(e,t){return null==e?null===t?void 0:t:null==t?null===e?void 0:e:function(n,r,i,...a){let c,d,p,v,E,D;return({data:d=n,facets:p=r,channels:c}=e.call(this,n,r,i,...a)),({data:E=d,facets:D=p,channels:v}=t.call(this,d,p,{...i,...c},...a)),{data:E,facets:D,channels:{...c,...v}}}}function Cx(e,t){return(null!=e.initializer?wx:$S)(e,t)}function GS(e){return(t,n)=>{const r=Dc(t,e);return{data:t,facets:n.map(i=>i.filter(a=>r[a]))}}}function qS(e,t){return{data:e,facets:t.map(n=>n.slice().reverse())}}function ZS(e){return("function"==typeof e&&1!==e.length?Lte:f5)(e)}function Lte(e){return(t,n)=>{const r=(i,a)=>e(t[i],t[a]);return{data:t,facets:n.map(i=>i.slice().sort(r))}}}function f5(e){let t,n;if(({channel:t,value:e,order:n=Sm}={...hS(e)}),"function"!=typeof n)switch(`${n}`.toLowerCase()){case"ascending":n=Sm;break;case"descending":n=a3;break;default:throw new Error(`invalid order: ${n}`)}return(r,i,a)=>{let c;if(void 0===t)c=Dc(r,e);else{if(void 0===a)throw new Error("channel sort requires an initializer");if(c=a[t],!c)return{};c=c.value}const d=(p,v)=>n(c[p],c[v]);return{data:r,facets:i.map(p=>p.slice().sort(d))}}}class Ic{constructor(t,n={},r={},i){const{facet:a="auto",facetAnchor:c,fx:d,fy:p,sort:v,dx:E=0,dy:D=0,margin:T=0,marginTop:P=T,marginRight:N=T,marginBottom:G=T,marginLeft:U=T,clip:Z,channels:ne}=r;if(this.data=t,this.sort=Am(v)?v:null,this.initializer=wx(r).initializer,this.transform=this.initializer?r.transform:$S(r).transform,null===a||!1===a?this.facet=null:(this.facet=Eu(!0===a?"include":a,"facet",["auto","include","exclude","super"]),this.fx=d,this.fy=p),this.facetAnchor=function xte(e){if(null==e)return null;const t=bte.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid facet anchor: ${e}`)}(c),n=_3(n),void 0!==ne&&(n={..._3(ne),...n}),void 0!==i&&(n={...tte(this,r,i),...n}),this.channels=Object.fromEntries(Object.entries(n).map(([X,re])=>{const{value:fe}=re;return sx(fe)&&(re={...re,value:fe.value},void 0!==fe.scale&&(re.scale=fe.scale)),[X,re]}).filter(([X,{value:re,optional:fe}])=>{if(null!=re)return!0;if(fe)return!1;throw new Error(`missing channel value: ${X}`)})),this.dx=+E,this.dy=+D,this.marginTop=+P,this.marginRight=+N,this.marginBottom=+G,this.marginLeft=+U,this.clip=function ute(e){return!0===e?e="frame":!1===e&&(e=null),p3(e,"clip",["frame","sphere"])}(Z),"super"===this.facet){if(d||p)throw new Error("super-faceting cannot use fx or fy");for(const X in this.channels){const{scale:re}=n[X];if("x"===re||"y"===re)throw new Error("super-faceting cannot use x or y")}}}initialize(t,n){let r=Sc(this.data);void 0===t&&null!=r&&(t=[u_(r)]);const i=t;null!=this.transform&&(({facets:t,data:r}=this.transform(r,t)),r=Sc(r)),void 0!==t&&(t.original=i);const a=function ZQ(e,t){return Object.fromEntries(Object.entries(e).map(([n,r])=>[n,m_(t,r,n)]))}(this.channels,r);return null!=this.sort&&function XQ(e,t,n,r,i){const{reverse:a,reduce:c=!0,limit:d}=i;for(const p in i){if(!ii.has(p))continue;let{value:v,reverse:E=a,reduce:D=c,limit:T=d}=hS(i[p]);if(void 0===E&&(E="width"===v||"height"===v),null==D||!1===D)continue;const P="fx"===p||"fy"===p?KQ(t,r[p]):YQ(n,p);if(!P)throw new Error(`missing channel for scale: ${p}`);const N=P.value,[G=0,U=1/0]=Vh(T)?T:T<0?[T]:[0,T];if(null==v)P.domain=()=>{let Z=Array.from(new pE(N));return E&&(Z=Z.reverse()),(0!==G||U!==1/0)&&(Z=Z.slice(G,U)),Z};else{const Z="data"===v?e:"height"===v?M3(n,"y1","y2"):"width"===v?M3(n,"x1","x2"):bS(n,v,"y"===v?"y2":"x"===v?"x2":void 0),ne=_S(!0===D?"max":D,Z);P.domain=()=>{let X=My(u_(N),re=>ne.reduceIndex(re,Z),re=>N[re]);return X=yE(X,E?QQ:JQ),(0!==G||U!==1/0)&&(X=X.slice(G,U)),X.map(d3)}}}}(r,t,a,n,this.sort),{data:r,facets:t,channels:a}}filter(t,n,r){for(const i in n){const{filter:a=Dl}=n[i];if(null!==a){const c=r[i];t=t.filter(d=>a(c[d]))}}return t}project(t,n,r){px("x","y",t,n,r),px("x1","y1",t,n,r),px("x2","y2",t,n,r)}scale(t,n,r){const i=function WQ(e,t){const n=Object.fromEntries(Object.entries(e).map(([r,{scale:i,value:a}])=>{const c=null==i?null:t[i];return[r,null==c?a:Go(a,c)]}));return n.channels=e,n}(t,n);return r.projection&&this.project(t,i,r),i}}function p5(...e){return e.plot=Ic.prototype.plot,e}const m5=Math.PI/180;function g5({inset:e,insetLeft:t,insetRight:n,...r}={}){return[t,n]=_5(e,t,n),{inset:e,insetLeft:t,insetRight:n,...r}}function y5({inset:e,insetTop:t,insetBottom:n,...r}={}){return[t,n]=_5(e,t,n),{inset:e,insetTop:t,insetBottom:n,...r}}function _5(e,t,n){return void 0===e&&void 0===t&&void 0===n?Qs?[1,0]:[.5,.5]:[t,n]}function v5(e,{interval:t}){return(e={...hS(e)}).interval=uS(void 0===e.interval?t:e.interval),e}function Ex(e,t,n,r){const{[e]:i,[`${e}1`]:a,[`${e}2`]:c}=n,{value:d,interval:p}=v5(i,n);if(null==d||null==p&&!r)return n;const v=h_(i);if(null==p){let P;const N={transform:G=>P||(P=Dc(G,d)),label:v};return{...n,[e]:void 0,[`${e}1`]:void 0===a?N:a,[`${e}2`]:void 0===c?N:c}}let E,D;function T(P){return void 0!==D&&P===E?D:D=Go(Dc(E=P,d),N=>p.floor(N))}return t({...n,[e]:void 0,[`${e}1`]:void 0===a?{transform:T,label:v}:a,[`${e}2`]:void 0===c?{transform:P=>T(P).map(N=>p.offset(N)),label:v}:c})}function b5(e,t,n){const{[e]:r}=n,{value:i,interval:a}=v5(r,n);return null==i||null==a?n:t({...n,[e]:{label:h_(r),transform:c=>{const d=Go(Dc(c,i),v=>a.floor(v)),p=d.map(v=>a.offset(v));return d.map(Ml(d)?(v,E)=>null==v||isNaN(v=+v)||null==(E=p[E])||isNaN(E=+E)?void 0:new Date((v+E)/2):(v,E)=>null==v||null==(E=p[E])?NaN:(+v+ +E)/2)}}})}const x5={ariaLabel:"rule",fill:null,stroke:"currentColor"};class Ute extends Ic{constructor(t,n={}){const{x:r,y1:i,y2:a,inset:c=0,insetTop:d=c,insetBottom:p=c}=n;super(t,{x:{value:r,scale:"x",optional:!0},y1:{value:i,scale:"y",optional:!0},y2:{value:a,scale:"y",optional:!0}},n,x5),this.insetTop=So(d),this.insetBottom=So(p)}render(t,n,r,i,a){const{x:c,y:d}=n,{x:p,y1:v,y2:E}=r,{width:D,height:T,marginTop:P,marginRight:N,marginLeft:G,marginBottom:U}=i,{insetTop:Z,insetBottom:ne}=this;return ls("svg:g",a).call(Sf,this,i).call(Tf,this,{x:p&&c},Qs,0).call(X=>X.selectAll().data(t).enter().append("line").call(Mf,this).attr("x1",p?re=>p[re]:(G+D-N)/2).attr("x2",p?re=>p[re]:(G+D-N)/2).attr("y1",v&&!yx(d)?re=>v[re]+Z:P+Z).attr("y2",E&&!yx(d)?d.bandwidth?re=>E[re]+d.bandwidth()-ne:re=>E[re]-ne:T-U-ne).call(v_,this,r)).node()}}class $te extends Ic{constructor(t,n={}){const{x1:r,x2:i,y:a,inset:c=0,insetRight:d=c,insetLeft:p=c}=n;super(t,{y:{value:a,scale:"y",optional:!0},x1:{value:r,scale:"x",optional:!0},x2:{value:i,scale:"x",optional:!0}},n,x5),this.insetRight=So(d),this.insetLeft=So(p)}render(t,n,r,i,a){const{x:c,y:d}=n,{y:p,x1:v,x2:E}=r,{width:D,height:T,marginTop:P,marginRight:N,marginLeft:G,marginBottom:U}=i,{insetLeft:Z,insetRight:ne}=this;return ls("svg:g",a).call(Sf,this,i,a).call(Tf,this,{y:p&&d},0,Qs).call(X=>X.selectAll().data(t).enter().append("line").call(Mf,this).attr("x1",v&&!yx(c)?re=>v[re]+Z:G+Z).attr("x2",E&&!yx(c)?c.bandwidth?re=>E[re]+c.bandwidth()-ne:re=>E[re]-ne:D-N-ne).attr("y1",p?re=>p[re]:(P+T-U)/2).attr("y2",p?re=>p[re]:(P+T-U)/2).call(v_,this,r)).node()}}function jte(e,t){let{x:n=Cu,y:r,y1:i,y2:a,...c}=function zte(e={}){return Ex("y",y5,e)}(t);return[i,a]=w5(r,i,a),new Ute(e,{...c,x:n,y1:i,y2:a})}function Hte(e,t){let{y:n=Cu,x:r,x1:i,x2:a,...c}=function Nte(e={}){return Ex("x",g5,e)}(t);return[i,a]=w5(r,i,a),new $te(e,{...c,y:n,x1:i,x2:a})}function w5(e,t,n){if(void 0===e){if(void 0===t){if(void 0!==n)return[0,n]}else if(void 0===n)return[0,t]}else{if(void 0===t)return void 0===n?[0,e]:[e,n];if(void 0===n)return[e,t]}return[t,n]}function WS(e,...t){let n=t.length;for(let r=0,i=!0;r<n;++r)"function"!=typeof t[r]&&(i&&(e=e.slice(),i=!1),e.splice(r,2,e[r]+t[r]+e[r+1]),t.splice(r,1),--r,--n);return r=>{let i=e[0];for(let a=0;a<n;++a)i+=t[a](r)+e[a+1];return i}}const Gte={ariaLabel:"text",strokeLinejoin:"round",strokeWidth:3,paintOrder:"stroke"};class XS extends Ic{constructor(t,n={}){const{x:r,y:i,text:a=(Vh(t)&&CQ(t)?Cu:gQ),frameAnchor:c,textAnchor:d=(/right$/i.test(c)?"end":/left$/i.test(c)?"start":"middle"),lineAnchor:p=(/^top/i.test(c)?"top":/^bottom/i.test(c)?"bottom":"middle"),lineHeight:v=1,lineWidth:E=1/0,textOverflow:D,monospace:T,fontFamily:P=(T?"ui-monospace, monospace":void 0),fontSize:N,fontStyle:G,fontVariant:U,fontWeight:Z,rotate:ne}=n,[X,re]=As(ne,0),[fe,ve]=function Qte(e){return null==e||"number"==typeof e?[void 0,e]:"string"!=typeof e?[e,void 0]:(e=e.trim().toLowerCase(),Jte.has(e)||/^[+-]?\d*\.?\d+(e[+-]?\d+)?(\w*|%)$/.test(e)?[void 0,e]:[e,void 0])}(N);if(super(t,{x:{value:r,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},fontSize:{value:fe,optional:!0},rotate:{value:(e=X,null==e?null:{transform:t=>Dc(t,e,Float64Array),label:h_(e)}),optional:!0},text:{value:a,filter:nS,optional:!0}},n,Gte),this.rotate=re,this.textAnchor=ea(d,"middle"),this.lineAnchor=Eu(p,"lineAnchor",["top","middle","bottom"]),this.lineHeight=+v,this.lineWidth=+E,this.textOverflow=function qte(e){return null==e?null:Eu(e,"textOverflow",["clip","ellipsis","clip-start","clip-end","ellipsis-start","ellipsis-middle","ellipsis-end"]).replace(/^(clip|ellipsis)$/,"$1-end")}(D),this.monospace=!!T,this.fontFamily=Sl(P),this.fontSize=ve,this.fontStyle=Sl(G),this.fontVariant=Sl(U),this.fontWeight=Sl(Z),this.frameAnchor=fS(c),!(this.lineWidth>=0))throw new Error(`invalid lineWidth: ${E}`);var e;this.splitLines=function nne({monospace:e,lineWidth:t,textOverflow:n}){if(null!=n||t==1/0)return a=>a.split(/\r\n?|\n/g);const r=e?M5:S5,i=100*t;return a=>function ene(e,t,n){const r=[];let i,a=0;for(const[c,d,p]of function*tne(e){let t=0,n=0;const r=e.length;for(;n<r;){let i=1;switch(e[n]){case"\xad":case"-":++n,yield[t,n,!1],t=n;break;case" ":for(yield[t,n,!1];" "===e[++n];);t=n;break;case"\r":"\n"===e[n+1]&&++i;case"\n":yield[t,n,!0],n+=i,t=n;break;default:++n}}yield[t,n,!0]}(e))void 0===i&&(i=c),a>i&&n(e,i,d)>t&&(r.push(e.slice(i,a)+("\xad"===e[a-1]?"-":"")),i=c),p?(r.push(e.slice(i,d)),i=void 0):a=d;return r}(a,i,r)}(this),this.clipLine=function rne({monospace:e,lineWidth:t,textOverflow:n}){if(null==n||t==1/0)return a=>a;const r=e?M5:S5,i=100*t;switch(n){case"clip-start":return a=>I5(a,i,r,"");case"clip-end":return a=>T5(a,i,r,"");case"ellipsis-start":return a=>I5(a,i,r,"\u2026");case"ellipsis-middle":return a=>function ine(e,t,n,r){const i=n(e=e.trim());if(i<=t)return e;const a=n(r)/2,[c,d]=Dx(e,t/2,n,a),[p]=Dx(e,i-t/2-d+a,n,-a);return p<0?r:e.slice(0,c).trimEnd()+r+e.slice(Rm(e,p)).trimStart()}(a,i,r,"\u2026");case"ellipsis-end":return a=>T5(a,i,r,"\u2026")}}(this)}render(t,n,r,i,a){const{x:c,y:d}=n,{x:p,y:v,rotate:E,text:D,title:T,fontSize:P}=r,{rotate:N}=this,[G,U]=FS(this,i);return ls("svg:g",a).call(Sf,this,i,a).call(Yte,this,D,i).call(Tf,this,{x:p&&c,y:v&&d}).call(Z=>Z.selectAll().data(t).enter().append("text").call(Mf,this).call(Zte,this,D,T).attr("transform",WS`translate(${p?ne=>p[ne]:G},${v?ne=>v[ne]:U})${E?ne=>` rotate(${E[ne]})`:N?` rotate(${N})`:""}`).call(xn,"font-size",P&&(ne=>P[ne])).call(v_,this,r)).node()}}function Zte(e,t,n,r){if(!n)return;const{lineAnchor:i,lineHeight:a,textOverflow:c,splitLines:d,clipLine:p}=t;e.each(function(v){const E=d(vx(n[v])??"").map(p),D=E.length,T="top"===i?.71:"bottom"===i?1-D:(164-100*D)/200;if(D>1)for(let P=0;P<D;++P){if(!E[P])continue;const N=this.ownerDocument.createElementNS(tm.svg,"tspan");N.setAttribute("x",0),N.setAttribute("y",(T+P)*a+"em"),N.textContent=E[P],this.appendChild(N)}else T&&this.setAttribute("y",T*a+"em"),this.textContent=E[0];if(c&&!r&&E[0]!==n[v]){const P=this.ownerDocument.createElementNS(tm.svg,"title");P.textContent=n[v],this.appendChild(P)}})}function E5(e,t={}){let{x:n,y:r,...i}=t;return void 0===t.frameAnchor&&([n,r]=lS(n,r)),new XS(e,{...i,x:n,y:r})}function Wte(e,t={}){const{x:n=Cu,...r}=t;return new XS(e,function Vte(e={}){return b5("y",y5,e)}({...r,x:n}))}function Xte(e,t={}){const{y:n=Cu,...r}=t;return new XS(e,function Bte(e={}){return b5("x",g5,e)}({...r,y:n}))}function Yte(e,t,n){xn(e,"text-anchor",t.textAnchor),xn(e,"font-family",t.fontFamily),xn(e,"font-size",t.fontSize),xn(e,"font-style",t.fontStyle),xn(e,"font-variant",void 0===t.fontVariant?function Kte(e){return function SQ(e){for(const t of e)if(null!=t)return"number"==typeof t}(e)||Ml(e)?"tabular-nums":void 0}(n):t.fontVariant),xn(e,"font-weight",t.fontWeight)}const Jte=new Set(["inherit","initial","revert","unset","xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large","larger","smaller"]),D5={a:56,b:63,c:57,d:63,e:58,f:37,g:62,h:60,i:26,j:26,k:55,l:26,m:88,n:60,o:60,p:62,q:62,r:39,s:54,t:38,u:60,v:55,w:79,x:54,y:55,z:55,A:69,B:67,C:73,D:74,E:61,F:58,G:76,H:75,I:28,J:55,K:67,L:58,M:89,N:75,O:78,P:65,Q:78,R:67,S:65,T:65,U:75,V:69,W:98,X:69,Y:67,Z:67,0:64,1:48,2:62,3:64,4:66,5:63,6:65,7:58,8:65,9:65," ":29,"!":32,'"':49,"'":31,"(":39,")":39,",":31,"-":48,".":31,"/":32,":":31,";":31,"?":52,"\u2018":31,"\u2019":31,"\u201c":47,"\u201d":47,"\u2026":82};function S5(e,t=0,n=e.length){let r=0;for(let i=t;i<n;i=Rm(e,i))r+=D5[e[i]]??(P5(e,i)?120:D5.e);return r}function M5(e,t=0,n=e.length){let r=0;for(let i=t;i<n;i=Rm(e,i))r+=P5(e,i)?200:100;return r}function Dx(e,t,n,r){const i=[];let a=0;for(let c=0,d=0,p=e.length;c<p;c=d){d=Rm(e,c);const v=n(e,c,d);if(a+v>t){for(a+=r;a>t&&c>0;)d=c,c=i.pop(),a-=n(e,c,d);return[c,t-a]}a+=v,i.push(c)}return[-1,0]}function T5(e,t,n,r){e=e.trim();const i=n(r),[a]=Dx(e,t,n,i);return a<0?e:e.slice(0,a).trimEnd()+r}function I5(e,t,n,r){const i=n(e=e.trim());if(i<=t)return e;const a=n(r),[c]=Dx(e,i-t+a,n,-a);return c<0?r:r+e.slice(Rm(e,c)).trimStart()}const YS=/[\p{Combining_Mark}\p{Emoji_Modifier}]+/uy,A5=/\p{Extended_Pictographic}/uy;function Rm(e,t){return t+=function one(e,t){const n=e.charCodeAt(t);if(n>=55296&&n<56320){const r=e.charCodeAt(t+1);return r>=56320&&r<57344}return!1}(e,t)?2:1,function ane(e,t){return!k5(e,t)&&(YS.lastIndex=t,YS.test(e))}(e,t)&&(t=YS.lastIndex),function sne(e,t){return 8205===e.charCodeAt(t)}(e,t)?Rm(e,t+1):t}function k5(e,t){return e.charCodeAt(t)<128}function P5(e,t){return!k5(e,t)&&(A5.lastIndex=t,A5.test(e))}const R5={ariaLabel:"vector",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinejoin:"round",strokeLinecap:"round"},F5=3.5,lne=5*F5,O5={draw(e,t,n){const r=t*n/lne;e.moveTo(0,0),e.lineTo(0,-t),e.moveTo(-r,r-t),e.lineTo(0,-t),e.lineTo(r,r-t)}},cne=new Map([["arrow",O5],["spike",{draw(e,t,n){e.moveTo(-n,0),e.lineTo(0,-t),e.lineTo(n,0)}}]]);class KS extends Ic{constructor(t,n={}){const{x:r,y:i,r:a=F5,length:c,rotate:d,shape:p=O5,anchor:v="middle",frameAnchor:E}=n,[D,T]=As(c,12),[P,N]=As(d,0);super(t,{x:{value:r,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},length:{value:D,scale:"length",optional:!0},rotate:{value:P,optional:!0}},n,R5),this.r=+a,this.length=T,this.rotate=N,this.shape=function hne(e){if(function une(e){return e&&"function"==typeof e.draw}(e))return e;const t=cne.get(`${e}`.toLowerCase());if(t)return t;throw new Error(`invalid shape: ${e}`)}(p),this.anchor=Eu(v,"anchor",["start","middle","end"]),this.frameAnchor=fS(E)}render(t,n,r,i,a){const{x:c,y:d}=n,{x:p,y:v,length:E,rotate:D}=r,{length:T,rotate:P,anchor:N,shape:G,r:U}=this,[Z,ne]=FS(this,i);return ls("svg:g",a).call(Sf,this,i,a).call(Tf,this,{x:p&&c,y:v&&d}).call(X=>X.selectAll().data(t).enter().append("path").call(Mf,this).attr("transform",WS`translate(${p?re=>p[re]:Z},${v?re=>v[re]:ne})${D?re=>` rotate(${D[re]})`:P?` rotate(${P})`:""}${"start"===N?"":"end"===N?E?re=>` translate(0,${E[re]})`:` translate(0,${T})`:E?re=>` translate(0,${E[re]/2})`:` translate(0,${T/2})`}`).attr("d",E?re=>{const fe=_f();return G.draw(fe,E[re],U),fe}:(()=>{const re=_f();return G.draw(re,T,U),re})()).call(v_,this,r)).node()}}function fne(e,t={}){const{x:n=Cu,...r}=t;return new KS(e,{...r,x:n})}function pne(e,t={}){const{y:n=Cu,...r}=t;return new KS(e,{...r,y:n})}function Uh(e,t){return arguments.length<2&&!Vh(e)&&(t=e,e=null),void 0===t&&(t={}),[e,t]}function Sx({anchor:e}={},t){return void 0===e?t[0]:Eu(e,"anchor",t)}function N5(e){return Sx(e,["left","right"])}function z5(e){return Sx(e,["right","left"])}function B5(e){return Sx(e,["bottom","top"])}function V5(e){return Sx(e,["top","bottom"])}function U5(){const[e,t]=Uh(...arguments);return j5("y",N5(t),e,t)}function mne(){const[e,t]=Uh(...arguments);return j5("fy",z5(t),e,t)}function $5(){const[e,t]=Uh(...arguments);return H5("x",B5(t),e,t)}function gne(){const[e,t]=Uh(...arguments);return H5("fx",V5(t),e,t)}function j5(e,t,n,{color:r="currentColor",opacity:i=1,stroke:a=r,strokeOpacity:c=i,strokeWidth:d=1,fill:p=r,fillOpacity:v=i,textAnchor:E,textStroke:D,textStrokeOpacity:T,textStrokeWidth:P,tickSize:N=("y"===e?6:0),tickPadding:G,tickRotate:U,x:Z,marginTop:ne=20,marginRight:X=("right"===t?40:0),marginBottom:re=20,marginLeft:fe=("left"===t?40:0),label:ve,labelOffset:Re,labelAnchor:We,...Ke}){return N=So(N),G=So(G),U=So(U),void 0!==We&&(We=Eu(We,"labelAnchor",["center","top","bottom"])),p5(N&&!Js(a)?function yne(e,t,n,{strokeWidth:r=1,strokeLinecap:i=null,strokeLinejoin:a=null,facetAnchor:c=t+("y"===e?"-empty":""),frameAnchor:d=t,tickSize:p,inset:v=0,insetLeft:E=v,insetRight:D=v,dx:T=0,y:P=("y"===e?void 0:null),...N}){return Fm(pne,e,`${e}-axis tick`,n,{strokeWidth:r,strokeLinecap:i,strokeLinejoin:a,facetAnchor:c,frameAnchor:d,y:P,...N,dx:"left"===t?+T-Qs+ +E:+T+Qs-D,anchor:"start",length:p,shape:"left"===t?Tne:Ine})}(e,t,n,{stroke:a,strokeOpacity:c,strokeWidth:d,tickSize:N,tickPadding:G,tickRotate:U,x:Z,...Ke}):null,Js(p)?null:function vne(e,t,n,{facetAnchor:r=t+("y"===e?"-empty":""),frameAnchor:i=t,tickSize:a,tickRotate:c=0,tickPadding:d=Math.max(3,9-a)+(Math.abs(c)>60?4*Math.cos(c*m5):0),tickFormat:p,text:v=("function"==typeof p?p:void 0),textAnchor:E=(Math.abs(c)>60?"middle":"left"===t?"end":"start"),lineAnchor:D=(c>60?"top":c<-60?"bottom":"middle"),fontVariant:T,inset:P=0,insetLeft:N=P,insetRight:G=P,dx:U=0,y:Z=("y"===e?void 0:null),...ne}){return Fm(Xte,e,`${e}-axis tick label`,n,{facetAnchor:r,frameAnchor:i,text:void 0===v?null:v,textAnchor:E,lineAnchor:D,fontVariant:T,rotate:c,y:Z,...ne,dx:"left"===t?+U-a-d+ +N:+U+ +a+ +d-G},function(X,re,fe){void 0===T&&(this.fontVariant=X5(X)),void 0===v&&(fe.text=W5(X,re,p))})}(e,t,n,{fill:p,fillOpacity:v,stroke:D,strokeOpacity:T,strokeWidth:P,textAnchor:E,tickSize:N,tickPadding:G,tickRotate:U,x:Z,marginTop:ne,marginRight:X,marginBottom:re,marginLeft:fe,...Ke}),Js(p)||null===ve?null:E5([],{fill:p,fillOpacity:v,...Ke,lineWidth:void 0,textOverflow:void 0,facet:"super",x:null,y:null,initializer:function(lt,Ue,st,Fe,le){const de=Fe[e],{marginTop:pe,marginRight:Oe,marginBottom:Ye,marginLeft:Ze}="y"===e&&le.inset||le,et=We??(de.bandwidth?"center":"top"),_t=Re??("right"===t?Oe:Ze)-3;return"center"===et?(this.textAnchor=void 0,this.lineAnchor="right"===t?"bottom":"top",this.frameAnchor=t,this.rotate=-90):(this.textAnchor="right"===t?"end":"start",this.lineAnchor=et,this.frameAnchor=`${et}-${t}`,this.rotate=0),this.dy="top"===et?3-pe:"bottom"===et?Ye-3:0,this.dx="right"===t?_t:-_t,this.ariaLabel=`${e}-axis label`,{facets:[[0]],channels:{text:{value:[void 0===ve?Y5(e,de,et):ve]}}}}}))}function H5(e,t,n,{color:r="currentColor",opacity:i=1,stroke:a=r,strokeOpacity:c=i,strokeWidth:d=1,fill:p=r,fillOpacity:v=i,textAnchor:E,textStroke:D,textStrokeOpacity:T,textStrokeWidth:P,tickSize:N=("x"===e?6:0),tickPadding:G,tickRotate:U,y:Z,marginTop:ne=("top"===t?30:0),marginRight:X=20,marginBottom:re=("bottom"===t?30:0),marginLeft:fe=20,label:ve,labelAnchor:Re,labelOffset:We,...Ke}){return N=So(N),G=So(G),U=So(U),void 0!==Re&&(Re=Eu(Re,"labelAnchor",["center","left","right"])),p5(N&&!Js(a)?function _ne(e,t,n,{strokeWidth:r=1,strokeLinecap:i=null,strokeLinejoin:a=null,facetAnchor:c=t+("x"===e?"-empty":""),frameAnchor:d=t,tickSize:p,inset:v=0,insetTop:E=v,insetBottom:D=v,dy:T=0,x:P=("x"===e?void 0:null),...N}){return Fm(fne,e,`${e}-axis tick`,n,{strokeWidth:r,strokeLinejoin:a,strokeLinecap:i,facetAnchor:c,frameAnchor:d,x:P,...N,dy:"bottom"===t?+T-Qs-D:+T+Qs+ +E,anchor:"start",length:p,shape:"bottom"===t?Sne:Mne})}(e,t,n,{stroke:a,strokeOpacity:c,strokeWidth:d,tickSize:N,tickPadding:G,tickRotate:U,y:Z,...Ke}):null,Js(p)?null:function bne(e,t,n,{facetAnchor:r=t+("x"===e?"-empty":""),frameAnchor:i=t,tickSize:a,tickRotate:c=0,tickPadding:d=Math.max(3,9-a)+(Math.abs(c)>=10?4*Math.cos(c*m5):0),tickFormat:p,text:v=("function"==typeof p?p:void 0),textAnchor:E=(Math.abs(c)>=10?c<0^"bottom"===t?"start":"end":"middle"),lineAnchor:D=(Math.abs(c)>=10?"middle":"bottom"===t?"top":"bottom"),fontVariant:T,inset:P=0,insetTop:N=P,insetBottom:G=P,dy:U=0,x:Z=("x"===e?void 0:null),...ne}){return Fm(Wte,e,`${e}-axis tick label`,n,{facetAnchor:r,frameAnchor:i,text:void 0===v?null:v,textAnchor:E,lineAnchor:D,fontVariant:T,rotate:c,x:Z,...ne,dy:"bottom"===t?+U+ +a+ +d-G:+U-a-d+ +N},function(X,re,fe){void 0===T&&(this.fontVariant=X5(X)),void 0===v&&(fe.text=W5(X,re,p))})}(e,t,n,{fill:p,fillOpacity:v,stroke:D,strokeOpacity:T,strokeWidth:P,textAnchor:E,tickSize:N,tickPadding:G,tickRotate:U,y:Z,marginTop:ne,marginRight:X,marginBottom:re,marginLeft:fe,...Ke}),Js(p)||null===ve?null:E5([],{fill:p,fillOpacity:v,...Ke,lineWidth:void 0,textOverflow:void 0,facet:"super",x:null,y:null,initializer:function(lt,Ue,st,Fe,le){const de=Fe[e],{marginTop:pe,marginRight:Oe,marginBottom:Ye,marginLeft:Ze}="x"===e&&le.inset||le,et=Re??(de.bandwidth?"center":"right"),_t=We??("top"===t?pe:Ye)-3;return"center"===et?(this.frameAnchor=t,this.textAnchor=void 0):(this.frameAnchor=`${t}-${et}`,this.textAnchor="right"===et?"end":"start"),this.lineAnchor=t,this.dy="top"===t?-_t:_t,this.dx="right"===et?Oe-3:"left"===et?3-Ze:0,this.ariaLabel=`${e}-axis label`,{facets:[[0]],channels:{text:{value:[void 0===ve?Y5(e,de,et):ve]}}}}}))}function xne(){const[e,t]=Uh(...arguments);return G5("y",N5(t),e,t)}function wne(){const[e,t]=Uh(...arguments);return G5("fy",z5(t),e,t)}function Cne(){const[e,t]=Uh(...arguments);return q5("x",B5(t),e,t)}function Ene(){const[e,t]=Uh(...arguments);return q5("fx",V5(t),e,t)}function G5(e,t,n,{y:r=("y"===e?void 0:null),x:i=null,x1:a=("left"===t?i:null),x2:c=("right"===t?i:null),...d}){return Fm(Hte,e,`${e}-grid`,n,{y:r,x1:a,x2:c,...Z5(d)})}function q5(e,t,n,{x:r=("x"===e?void 0:null),y:i=null,y1:a=("top"===t?i:null),y2:c=("bottom"===t?i:null),...d}){return Fm(jte,e,`${e}-grid`,n,{x:r,y1:a,y2:c,...Z5(d)})}function Z5({color:e="currentColor",opacity:t=.1,stroke:n=e,strokeOpacity:r=t,strokeWidth:i=1,...a}){return{stroke:n,strokeOpacity:r,strokeWidth:i,...a}}function Fm(e,t,n,r,i,a){let c;const d=e(r,wx(i,function(p,v,E,D){const{[t]:T}=D;if(!T)throw new Error(`missing scale: ${t}`);let{ticks:P,tickSpacing:N,interval:G}=i;if(n5(T)&&"string"==typeof P&&(G=P,P=void 0),null==p){if(Vh(P))p=Sc(P);else if(T.ticks)if(void 0!==P)p=T.ticks(P);else if(G=d_(void 0===G?T.interval:G,T.type),void 0!==G){const[U,Z]=Qp(T.domain());p=G.range(U,G.offset(G.floor(Z)))}else{const[U,Z]=Qp(T.range());P=(Z-U)/(void 0===N?"x"===t?80:35:N),p=T.ticks(P)}else p=T.domain();"y"===t||"x"===t?v=[u_(p)]:(c[t]={scale:t,value:Cu},v=void 0)}return a?.call(this,T,P,c),{data:p,facets:v,channels:Object.fromEntries(Object.entries(c).map(([U,Z])=>[U,{...Z,value:Dc(p,Z.value)}]))}}));return null==r?(c=d.channels,d.channels={}):c={},d.ariaLabel=n,d}function W5(e,t,n){return{value:Dne(e,t,n)}}function Dne(e,t,n){return e.tickFormat?e.tickFormat(Vh(t)?null:t,n):void 0===n?vx:"string"==typeof n?(Ml(e.domain())?s_:um)(n):Mm(n)}const Sne={draw(e,t){e.moveTo(0,0),e.lineTo(0,t)}},Mne={draw(e,t){e.moveTo(0,0),e.lineTo(0,-t)}},Tne={draw(e,t){e.moveTo(0,0),e.lineTo(-t,0)}},Ine={draw(e,t){e.moveTo(0,0),e.lineTo(t,0)}};function X5(e){return e.bandwidth&&void 0===e.interval?void 0:"tabular-nums"}function Y5(e,t,n){const r=t.label;if(t.bandwidth||!r?.inferred)return r;const i=function Ane(e){return Math.sign(p_(e.domain()))*Math.sign(p_(e.range()))}(t);return i?"x"===e||"center"===n?"x"===e==i<0?`\u2190 ${r}`:`${r} \u2192`:`${i<0?"\u2191 ":"\u2193 "}${r}`:r}const kne={ariaLabel:"frame",fill:"none",stroke:"currentColor"},Pne={ariaLabel:"frame",fill:null,stroke:"currentColor",strokeLinecap:"square"};class Rne extends Ic{constructor(t={}){const{anchor:n=null,inset:r=0,insetTop:i=r,insetRight:a=r,insetBottom:c=r,insetLeft:d=r,rx:p,ry:v}=t;super(void 0,void 0,t,null==n?kne:Pne),this.anchor=p3(n,"anchor",["top","right","bottom","left"]),this.insetTop=So(i),this.insetRight=So(a),this.insetBottom=So(c),this.insetLeft=So(d),this.rx=So(p),this.ry=So(v)}render(t,n,r,i,a){const{marginTop:c,marginRight:d,marginBottom:p,marginLeft:v,width:E,height:D}=i,{anchor:T,insetTop:P,insetRight:N,insetBottom:G,insetLeft:U,rx:Z,ry:ne}=this,X=v+U,re=E-d-N,fe=c+P,ve=D-p-G;return ls(T?"svg:line":"svg:rect",a).call(Sf,this,i,a).call(Mf,this).call(Tf,this,{}).call("left"===T?Re=>Re.attr("x1",X).attr("x2",X).attr("y1",fe).attr("y2",ve):"right"===T?Re=>Re.attr("x1",re).attr("x2",re).attr("y1",fe).attr("y2",ve):"top"===T?Re=>Re.attr("x1",X).attr("x2",re).attr("y1",fe).attr("y2",fe):"bottom"===T?Re=>Re.attr("x1",X).attr("x2",re).attr("y1",ve).attr("y2",ve):Re=>Re.attr("x",X).attr("y",fe).attr("width",re-X).attr("height",ve-fe).attr("rx",Z).attr("ry",ne)).node()}}function K5(e={}){const{facet:t,style:n,caption:r,ariaLabel:i,ariaDescription:a}=e,c=PS(e.className),d=void 0===e.marks?[]:J5(e.marks),p=function Bne(e,t){if(null==e)return;const{x:n,y:r}=e;if(null==n&&null==r)return;const i=Sc(e.data??n??r);if(void 0===i)throw new Error("missing facet data");const a={};null!=n&&(a.fx=m_(i,{value:n,scale:"fx"})),null!=r&&(a.fy=m_(i,{value:r,scale:"fy"})),JS(a,t);return{channels:a,groups:OS(i,a),data:e.data}}(t,e),v=new Map;for(const Fe of d){const le=e4(Fe,p,e);le&&v.set(Fe,le)}const E=new Map;p&&x_(E,[p]),x_(E,v);const D=J5(function Vne(e,t,n){let{projection:r,x:i={},y:a={},fx:c={},fy:d={},axis:p,grid:v,facet:E={},facet:{axis:D=p,grid:T}=E,x:{axis:P=p,grid:N=(null===P?null:v)}=i,y:{axis:G=p,grid:U=(null===G?null:v)}=a,fx:{axis:Z=D,grid:ne=(null===Z?null:T)}=c,fy:{axis:X=D,grid:re=(null===X?null:T)}=d}=n;(r||!aS(i)&&!t4("x",e))&&(P=N=null),(r||!aS(a)&&!t4("y",e))&&(G=U=null),t.has("fx")||(Z=ne=null),t.has("fy")||(X=re=null),void 0===P&&(P=!Ix(e,"x")),void 0===G&&(G=!Ix(e,"y")),void 0===Z&&(Z=!Ix(e,"fx")),void 0===X&&(X=!Ix(e,"fy")),!0===P&&(P="bottom"),!0===G&&(G="left"),!0===Z&&(Z="top"===P||null===P?"bottom":"top"),!0===X&&(X="right"===G||null===G?"left":"right");const fe=[];return Tx(fe,re,wne,d),Mx(fe,X,mne,"right","left",E,d),Tx(fe,ne,Ene,c),Mx(fe,Z,gne,"top","bottom",E,c),Tx(fe,U,xne,a),Mx(fe,G,U5,"left","right",n,a),Tx(fe,N,Cne,i),Mx(fe,P,$5,"bottom","top",n,i),fe}(d,E,e));for(const Fe of D){const le=e4(Fe,p,e);le&&v.set(Fe,le)}d.unshift(...D);const T=function gte(e,t){const{fx:n,fy:r}=TS(e,t),i=n?.scale.domain(),a=r?.scale.domain();return i&&a?function kG(...e){const t="function"==typeof e[e.length-1]&&function AG(e){return t=>e(...t)}(e.pop()),n=(e=e.map(IG)).map(MG),r=e.length-1,i=new Array(r+1).fill(0),a=[];if(r<0||n.some(TG))return a;for(;;){a.push(i.map((d,p)=>e[p][d]));let c=r;for(;++i[c]===n[c];){if(0===c)return t?a.map(t):a;i[c--]=0}}}(i,a).map(([c,d],p)=>({x:c,y:d,i:p})):i?i.map((c,d)=>({x:c,i:d})):a?a.map((c,d)=>({y:c,i:d})):void 0}(E,e);if(void 0!==T){const Fe=p?VS(T,p):void 0;for(const de of d){if(null===de.facet||"super"===de.facet)continue;const pe=v.get(de);void 0!==pe&&(pe.facetsIndex=null!=de.fx||null!=de.fy?VS(T,pe):Fe)}const le=new Set;for(const{facetsIndex:de}of v.values())de?.forEach((pe,Oe)=>{pe?.length>0&&le.add(Oe)});T.forEach(0<le.size&&le.size<T.length?(de,pe)=>de.empty=!le.has(pe):de=>de.empty=!1);for(const de of d)if("exclude"===de.facet){const pe=v.get(de);void 0!==pe&&(pe.facetsIndex=vte(pe.facetsIndex))}}for(const Fe of ii.keys())aS(e[Fe])&&"fx"!==Fe&&"fy"!==Fe&&E.set(Fe,[]);const P=new Map;for(const Fe of d){if(P.has(Fe))throw new Error("duplicate mark; each mark must be unique");const{facetsIndex:le,channels:de}=v.get(Fe)??{},{data:pe,facets:Oe,channels:Ye}=Fe.initialize(le,de);JS(Ye,e),P.set(Fe,{data:pe,facets:Oe,channels:Ye})}const N=TS(x_(E,P),e),G=W3(N),U=function pte(e,t,n={}){let r=.5-Qs,i=.5+Qs,a=.5+Qs,c=.5-Qs;for(const{marginTop:G,marginRight:U,marginBottom:Z,marginLeft:ne}of t)G>r&&(r=G),U>i&&(i=U),Z>a&&(a=Z),ne>c&&(c=ne);let{margin:d,marginTop:p=(void 0!==d?d:r),marginRight:v=(void 0!==d?d:i),marginBottom:E=(void 0!==d?d:a),marginLeft:D=(void 0!==d?d:c)}=n;p=+p,v=+v,E=+E,D=+D;let{width:T=640,height:P=mte(e,t,n,{width:T,marginTopDefault:r,marginRightDefault:i,marginBottomDefault:a,marginLeftDefault:c})+Math.max(0,p-r+E-a)}=n;T=+T,P=+P;const N={width:T,height:P,marginTop:p,marginRight:v,marginBottom:E,marginLeft:D};if(e.fx||e.fy){let{margin:G,marginTop:U=(void 0!==G?G:p),marginRight:Z=(void 0!==G?G:v),marginBottom:ne=(void 0!==G?G:E),marginLeft:X=(void 0!==G?G:D)}=n.facet??{};U=+U,Z=+Z,ne=+ne,X=+X,N.facet={marginTop:U,marginRight:Z,marginBottom:ne,marginLeft:X}}return N}(N,d,e);!function Bee(e,t){const{x:n,y:r,fx:i,fy:a}=e,c=i||a?IS(t):t;i&&Y3(i,c),a&&K3(a,c);const d=i||a?X3(e,t):t;n&&Y3(n,d),r&&K3(r,d)}(N,U);const{fx:Z,fy:ne}=G,X=Z||ne?X3(N,U):U,re=Z||ne?function Zne({fx:e,fy:t},n){const{marginTop:r,marginRight:i,marginBottom:a,marginLeft:c,width:d,height:p}=IS(n),v=e&&n4(e),E=t&&n4(t);return{marginTop:t?E[0]:r,marginRight:e?d-v[1]:i,marginBottom:t?p-E[1]:a,marginLeft:e?v[0]:c,inset:{marginTop:n.marginTop,marginRight:n.marginRight,marginBottom:n.marginBottom,marginLeft:n.marginLeft},width:d,height:p}}(G,U):U,fe=CS(e,X),ve=new Set;for(const[Fe,le]of P)if(null!=Fe.initializer){const pe=Fe.initializer(le.data,le.facets,le.channels,G,"super"===Fe.facet?re:X,fe);if(void 0!==pe.data&&(le.data=pe.data),void 0!==pe.facets&&(le.facets=pe.facets),void 0!==pe.channels){zne(pe.channels),Object.assign(le.channels,pe.channels);for(const Ze of Object.values(pe.channels)){const{scale:et}=Ze;null!=et&&ii.get(et)!==Mc&&(Q5(Ze,e),ve.add(et))}const{fx:Oe,fy:Ye}=pe.channels;if(null!=Oe||null!=Ye){const Ze=v.get(Fe)??{channels:{}};null!=Oe&&(Ze.channels.fx=Oe),null!=Ye&&(Ze.channels.fy=Ye),Ze.groups=OS(le.data,Ze.channels),Ze.facetsIndex=le.facets=VS(T,Ze),v.set(Fe,Ze)}}}if(ve.size){const Fe=new Map;x_(Fe,P,pe=>ve.has(pe)),x_(E,P,pe=>ve.has(pe));const le=function qne(e,t){for(const n in e){const r=e[n],i=t[n];void 0===r.label&&i&&(r.label=i.label)}return e}(TS(Fe,e),N),de=W3(le);Object.assign(N,le),Object.assign(G,de)}for(const[Fe,le]of P)le.values=Fe.scale(le.channels,G,fe);const{width:Re,height:We}=U,Ke=ls("svg",fe).attr("class",c).attr("fill","currentColor").attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("text-anchor","middle").attr("width",Re).attr("height",We).attr("viewBox",`0 0 ${Re} ${We}`).attr("aria-label",i).attr("aria-description",a).call(Fe=>Fe.append("style").text(`\n        .${c} {\n          display: block;\n          background: white;\n          height: auto;\n          height: intrinsic;\n          max-width: 100%;\n        }\n        .${c} text,\n        .${c} tspan {\n          white-space: pre;\n        }\n      `)).call(RS,n).node();if(void 0!==T){const Fe={x:Z?.domain(),y:ne?.domain()};T.sort(function yte({x:e,y:t}){const n=e&&new Map(e.map((i,a)=>[i,a])),r=t&&new Map(t.map((i,a)=>[i,a]));return e&&t?(i,a)=>n.get(i.x)-n.get(a.x)||r.get(i.y)-r.get(a.y):e?(i,a)=>n.get(i.x)-n.get(a.x):(i,a)=>r.get(i.y)-r.get(a.y)}(Fe)),ZD(Ke).selectAll().data(T).enter().append("g").attr("aria-label","facet").attr("transform",function _te(e,t,{marginTop:n,marginLeft:r}){return e&&t?({x:i,y:a})=>`translate(${e(i)-r},${t(a)-n})`:e?({x:i})=>`translate(${e(i)-r},0)`:({y:i})=>`translate(0,${t(i)-n})`}(Z,ne,U)).each(function(le){let de=!0;for(const pe of d){if("super"===pe.facet)continue;const{channels:Oe,values:Ye,facets:Ze}=P.get(pe);if(!(pe.facetAnchor?.(T,Fe,le)??!le.empty))continue;let et=null;if(Ze){if(et=Ze[v.has(pe)?le.i:0],et=pe.filter(et,Oe,Ye),0===et.length)continue;et.fi=le.i}const _t=pe.render(et,G,Ye,X,fe);null!=_t&&(de=!1,this.appendChild(_t))}de&&this.remove()})}for(const Fe of d){if(void 0!==T&&"super"!==Fe.facet)continue;const{channels:le,values:de,facets:pe}=P.get(Fe);let Oe=null;if(pe&&(Oe=pe[0],Oe=Fe.filter(Oe,le,de),0===Oe.length))continue;const Ye=Fe.render(Oe,G,de,re,fe);null!=Ye&&Ke.appendChild(Ye)}let lt=Ke;const Ue=function Fte(e,t,n){const r=[];for(const[i,a]of xx){const c=n[i];if(c?.legend&&i in e){const d=a(e[i],US(t,e[i],c),p=>e[p]);null!=d&&r.push(d)}}return r}(N,fe,e);if(null!=r||Ue.length>0){const{document:Fe}=fe;lt=Fe.createElement("figure"),lt.style.maxWidth="initial";for(const le of Ue)lt.appendChild(le);if(lt.appendChild(Ke),null!=r){const le=Fe.createElement("figcaption");le.appendChild(r instanceof Node?r:Fe.createTextNode(r)),lt.appendChild(le)}}lt.scale=function qee(e){return t=>{if(!ii.has(t=`${t}`))throw new Error(`unknown scale: ${t}`);return t in e?function i5({scale:e,type:t,domain:n,range:r,interpolate:i,interval:a,transform:c,percent:d,pivot:p}){if("identity"===t)return{type:"identity",apply:E=>E,invert:E=>E};const v=e.unknown?e.unknown():void 0;return{type:t,domain:sS(n),...void 0!==r&&{range:sS(r)},...void 0!==c&&{transform:c},...d&&{percent:d},...void 0!==v&&{unknown:v},...void 0!==a&&{interval:a},...void 0!==i&&{interpolate:i},...e.clamp&&{clamp:e.clamp()},...void 0!==p&&{pivot:p,symmetric:!1},...e.base&&{base:e.base()},...e.exponent&&{exponent:e.exponent()},...e.constant&&{constant:e.constant()},...e.align&&{align:e.align(),round:e.round()},...e.padding&&(e.paddingInner?{paddingInner:e.paddingInner(),paddingOuter:e.paddingOuter()}:{padding:e.padding()}),...e.bandwidth&&{bandwidth:e.bandwidth(),step:e.step()},apply:E=>e(E),...e.invert&&{invert:E=>e.invert(E)}}}(e[t]):void 0}}(N),lt.legend=function kte(e,t,n={}){return(r,i)=>{if(!xx.has(r))throw new Error(`unknown legend type: ${r}`);if(r in e)return xx.get(r)(e[r],US(t,n[r],i),a=>e[a])}}(N,fe,e);const st=function eee(){const e=xS;return xS=0,e}();return st>0&&ZD(Ke).append("text").attr("x",Re).attr("y",20).attr("dy","-1em").attr("text-anchor","end").attr("font-family","initial").text("\u26a0\ufe0f").append("title").text(`${st.toLocaleString("en-US")} warning${1===st?"":"s"}. Please check the console.`),lt}function J5(e){return e.flat(1/0).filter(t=>null!=t).map(Lne)}function Lne(e){return"function"==typeof e.render?e:new Nne(e)}Ic.prototype.plot=function One({marks:e=[],...t}={}){return K5({...t,marks:[...e,this]})};class Nne extends Ic{constructor(t){if("function"!=typeof t)throw new TypeError("invalid mark; missing render function");super(),this.render=t}render(){}}function JS(e,t){for(const n in e)Q5(e[n],t);return e}function Q5(e,t){const{scale:n}=e;if(null==n)return;const{type:r,percent:i,interval:a,transform:c=(i?d=>100*d:uS(a,r)?.floor)}=t[n]??{};null!=c&&(e.value=Go(e.value,c))}function zne(e){for(const t in e)S3(t,e[t])}function x_(e,t,n=yQ){for(const{channels:r}of t.values())for(const i in r){const a=r[i],{scale:c}=a;if(null!=c&&n(c)){const d=e.get(c);void 0!==d?d.push(a):e.set(c,[a])}}return e}function e4(e,t,n){if(null===e.facet||"super"===e.facet)return;const{fx:r,fy:i}=e;if(null!=r||null!=i){const p=Sc(e.data??r??i);if(void 0===p)throw new Error(`missing facet data in ${e.ariaLabel}`);if(null===p)return;const v={};return null!=r&&(v.fx=m_(p,{value:r,scale:"fx"})),null!=i&&(v.fy=m_(p,{value:i,scale:"fy"})),JS(v,n),{channels:v,groups:OS(p,v)}}if(void 0===t)return;const{channels:a,groups:c,data:d}=t;if("auto"!==e.facet||e.data===d)return{channels:a,groups:c};(c.size>1||1===c.size&&a.fx&&a.fy&&[...c][0][1].size>1)&&Sc(e.data)?.length===d.length&&Ef(`Warning: the ${e.ariaLabel} mark appears to use faceted data, but isn\u2019t faceted. The mark data has the same length as the facet data and the mark facet option is "auto", but the mark data and facet data are distinct. If this mark should be faceted, set the mark facet option to true; otherwise, suppress this warning by setting the mark facet option to false.`)}function Mx(e,t,n,r,i,a,c){if(!t)return;const d=function Une(e){return/^\s*both\s*$/i.test(e)}(t);c=function $ne(e,t,{line:n=t.line,ticks:r,tickSize:i,tickSpacing:a,tickPadding:c,tickFormat:d,tickRotate:p,fontVariant:v,ariaLabel:E,ariaDescription:D,label:T=t.label,labelAnchor:P,labelOffset:N}){return{anchor:e,line:n,ticks:r,tickSize:i,tickSpacing:a,tickPadding:c,tickFormat:d,tickRotate:p,fontVariant:v,ariaLabel:E,ariaDescription:D,label:T,labelAnchor:P,labelOffset:N}}(d?r:t,a,c);const{line:p}=c;(n===U5||n===$5)&&p&&!f_(p)&&e.push(function Fne(e){return new Rne(e)}(function jne(e){const{anchor:t,line:n}=e;return{anchor:t,facetAnchor:t+"-empty",stroke:!0===n?void 0:n}}(c))),e.push(n(c)),d&&e.push(n({...c,anchor:i,label:null}))}function Tx(e,t,n,r){!t||f_(t)||e.push(n(function Hne(e,{stroke:t=(ax(e)?e:void 0),ticks:n=(Gne(e)?e:void 0),tickSpacing:r,ariaLabel:i,ariaDescription:a}){return{stroke:t,ticks:n,tickSpacing:r,ariaLabel:i,ariaDescription:a}}(t,r)))}function Gne(e){switch(typeof e){case"number":return!0;case"string":return!ax(e)}return Vh(e)||"function"==typeof e?.range}function Ix(e,t){const n=`${t}-axis `;return e.some(r=>r.ariaLabel?.startsWith(n))}function t4(e,t){for(const n of t)for(const r in n.channels)if(n.channels[r].scale===e)return!0;return!1}function n4(e){const t=e.domain();let n=e(t[0]),r=e(t[t.length-1]);return r<n&&([n,r]=[r,n]),[n,r+e.bandwidth()]}const Wne={ariaLabel:"dot",fill:"none",stroke:"currentColor",strokeWidth:1.5};class QS extends Ic{constructor(t,n={}){const{x:r,y:i,r:a,rotate:c,symbol:d=l_,frameAnchor:p}=n,[v,E]=As(c,0),[D,T]=function OQ(e){if(null==e||mS(e))return[void 0,e];if("string"==typeof e){const t=pS.get(`${e}`.toLowerCase());if(t)return[void 0,t]}return[e,void 0]}(d),[P,N]=As(a,null==D?3:4.5);super(t,{x:{value:r,scale:"x",optional:!0},y:{value:i,scale:"y",optional:!0},r:{value:P,scale:"r",filter:ix,optional:!0},rotate:{value:v,optional:!0},symbol:{value:D,scale:"auto",optional:!0}},function Xne(e){return void 0===e.sort&&void 0===e.reverse?function Ote(e,{sort:t,...n}={}){return{...(sx(e)&&void 0!==e.channel?wx:Cx)(n,ZS(e)),sort:Am(t)?t:null}}({channel:"r",order:"descending"},e):e}(n),Wne),this.r=N,this.rotate=E,this.symbol=T,this.frameAnchor=fS(p);const{channels:G}=this,{symbol:U}=G;if(U){const{fill:Z,stroke:ne}=G;U.hint={fill:Z?Z.value===U.value?"color":"currentColor":this.fill,stroke:ne?ne.value===U.value?"color":"currentColor":this.stroke}}}render(t,n,r,i,a){const{x:c,y:d}=n,{x:p,y:v,r:E,rotate:D,symbol:T}=r,{r:P,rotate:N,symbol:G}=this,[U,Z]=FS(this,i),ne=this.symbol===l_,X=E?void 0:P*P*Math.PI;return rS(P)&&(t=[]),ls("svg:g",a).call(Sf,this,i,a).call(Tf,this,{x:p&&c,y:v&&d}).call(re=>re.selectAll().data(t).enter().append(ne?"circle":"path").call(Mf,this).call(ne?fe=>{fe.attr("cx",p?ve=>p[ve]:U).attr("cy",v?ve=>v[ve]:Z).attr("r",E?ve=>E[ve]:P)}:fe=>{fe.attr("transform",WS`translate(${p?ve=>p[ve]:U},${v?ve=>v[ve]:Z})${D?ve=>` rotate(${D[ve]})`:N?` rotate(${N})`:""}`).attr("d",E&&T?ve=>{const Re=_f();return T[ve].draw(Re,E[ve]*E[ve]*Math.PI),Re}:E?ve=>{const Re=_f();return G.draw(Re,E[ve]*E[ve]*Math.PI),Re}:T?ve=>{const Re=_f();return T[ve].draw(Re,X),Re}:(()=>{const ve=_f();return G.draw(ve,X),ve})())}).call(v_,this,r)).node()}}function Ax(e,t={}){let{x:n,y:r,...i}=t;return void 0===t.frameAnchor&&([n,r]=lS(n,r)),new QS(e,{...i,x:n,y:r})}const Yne=new Map([["basis",function OJ(e){return new ex(e)}],["basis-closed",function LJ(e){return new GN(e)}],["basis-open",function NJ(e){return new qN(e)}],["bundle",UJ],["bump-x",function BJ(e){return new ZN(e,!0)}],["bump-y",function VJ(e){return new ZN(e,!1)}],["cardinal",$J],["cardinal-closed",jJ],["cardinal-open",HJ],["catmull-rom",GJ],["catmull-rom-closed",qJ],["catmull-rom-open",ZJ],["linear",Yb],["linear-closed",function WJ(e){return new JN(e)}],["monotone-x",function XJ(e){return new nx(e)}],["monotone-y",function YJ(e){return new n3(e)}],["natural",function KJ(e){return new i3(e)}],["step",function JJ(e){return new rx(e,.5)}],["step-after",function eQ(e){return new rx(e,1)}],["step-before",function QJ(e){return new rx(e,0)}]]);function kx(e){return Yb(e)}function e2(e){if(null==e||!1===e)return null;if(!0===e)return r4;if("function"==typeof e)return e;switch(`${e}`.toLowerCase()){case"none":return null;case"arrow":return ere;case"dot":return tre;case"circle":case"circle-fill":return r4;case"circle-stroke":return nre}throw new Error(`invalid marker: ${e}`)}function ere(e,t){return ls("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("orient","auto").attr("fill","none").attr("stroke",e).attr("stroke-width",1.5).attr("stroke-linecap","round").attr("stroke-linejoin","round").call(n=>n.append("path").attr("d","M-1.5,-3l3,3l-3,3")).node()}function tre(e,t){return ls("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","none").call(n=>n.append("circle").attr("r",2.5)).node()}function r4(e,t){return ls("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill",e).attr("stroke","white").attr("stroke-width",1.5).call(n=>n.append("circle").attr("r",3)).node()}function nre(e,t){return ls("svg:marker",t).attr("viewBox","-5 -5 10 10").attr("markerWidth",6.67).attr("markerHeight",6.67).attr("fill","white").attr("stroke",e).attr("stroke-width",1.5).call(n=>n.append("circle").attr("r",3)).node()}let rre=0;function ire(e,t,{stroke:n},r){return function i4(e,{markerStart:t,markerMid:n,markerEnd:r,stroke:i},a=(()=>i),c){const d=new Map;function p(v){return function(E){const D=a(E);let T=d.get(v);T||d.set(v,T=new Map);let P=T.get(D);if(!P){const N=this.parentNode.insertBefore(v(D,c),this),G="plot-marker-"+ ++rre;N.setAttribute("id",G),T.set(D,P=`url(#${G})`)}return P}}t&&e.attr("marker-start",p(t)),n&&e.attr("marker-mid",p(n)),r&&e.attr("marker-end",p(r))}(e,t,n&&(([i])=>n[i]),r)}const ore={ariaLabel:"line",fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:1};class t2 extends Ic{constructor(t,n={}){const{x:r,y:i,z:a,curve:c,tension:d}=n;super(t,{x:{value:r,scale:"x"},y:{value:i,scale:"y"},z:{value:m3(n),optional:!0}},n,ore),this.z=a,this.curve=function Jne(e=kx,t){return"function"!=typeof e&&"auto"===`${e}`.toLowerCase()?kx:function Kne(e=Yb,t){if("function"==typeof e)return e;const n=Yne.get(`${e}`.toLowerCase());if(!n)throw new Error(`unknown curve: ${e}`);if(void 0!==t){if("beta"in n)return n.beta(t);if("tension"in n)return n.tension(t);if("alpha"in n)return n.alpha(t)}return n}(e,t)}(c,d),function Qne(e,{marker:t,markerStart:n=t,markerMid:r=t,markerEnd:i=t}={}){e.markerStart=e2(n),e.markerMid=e2(r),e.markerEnd=e2(i)}(this,n)}filter(t){return t}project(t,n,r){this.curve!==kx&&super.project(t,n,r)}render(t,n,r,i,a){const{x:c,y:d}=r,{curve:p}=this;return ls("svg:g",a).call(Sf,this,i,a).call(Tf,this,n).call(v=>v.selectAll().data(function*cte(e,t,{z:n},r){const{z:i}=r,a=function ate({ariaLabel:e,title:t,fill:n,fillOpacity:r,stroke:i,strokeOpacity:a,strokeWidth:c,opacity:d,href:p}){return[e,t,n,r,i,a,c,d,p].filter(v=>void 0!==v)}(r),c=[...t,...a];for(const d of i?function lte(e,t,n){const r=XP(e,i=>t[i]);return void 0===n&&r.size>e.length>>1&&Ef("Warning: the implicit z channel has high cardinality. This may occur when the fill or stroke channel is associated with quantitative data rather than ordinal or categorical data. You can suppress this warning by setting the z option explicitly; if this data represents a single series, set z to null."),r.values()}(e,i,n):[e]){let p,v;e:for(const E of d){for(const D of c)if(!Dl(D[E])){v&&v.push(-1);continue e}if(void 0!==p){v.push(E);for(let D=0;D<a.length;++D)if(cS(a[D][E])!==p[D]){yield v,p=a.map(P=>cS(P[E])),v=[E];continue e}}else v&&(yield v),p=a.map(D=>cS(D[E])),v=[E]}v&&(yield v)}}(t,[c,d],this,r)).enter().append("path").call(Mf,this).call(ste,this,r).call(ire,this,r,a).attr("d",p===kx&&a.projection?function sre(e,t,n){const r=iD(e);return t=ox(t),n=ox(n),i=>{let a=[];const c=[a];for(const d of i)-1===d?(a=[],c.push(a)):a.push([t[d],n[d]]);return r({type:"MultiLineString",coordinates:c})}}(a.projection,c,d):function DJ(e,t){var n=Cm(!0),r=null,i=Yb,a=null,c=function wJ(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(null==n)t=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);t=r}return e},()=>new Rb(t)}(d);function d(p){var v,D,P,E=(p=function xJ(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}(p)).length,T=!1;for(null==r&&(a=i(P=c())),v=0;v<=E;++v)!(v<E&&n(D=p[v],v,p))===T&&((T=!T)?a.lineStart():a.lineEnd()),T&&a.point(+e(D,v,p),+t(D,v,p));if(P)return a=null,P+""||null}return e="function"==typeof e?e:void 0===e?CJ:Cm(e),t="function"==typeof t?t:void 0===t?EJ:Cm(t),d.x=function(p){return arguments.length?(e="function"==typeof p?p:Cm(+p),d):e},d.y=function(p){return arguments.length?(t="function"==typeof p?p:Cm(+p),d):t},d.defined=function(p){return arguments.length?(n="function"==typeof p?p:Cm(!!p),d):n},d.curve=function(p){return arguments.length?(i=p,null!=r&&(a=i(r)),d):i},d.context=function(p){return arguments.length?(null==p?r=a=null:a=i(r=p),d):r},d}().curve(p).defined(E=>E>=0).x(E=>c[E]).y(E=>d[E]))).node()}}function o4(e,t={}){let{x:n,y:r,...i}=t;return[n,r]=lS(n,r),new t2(e,{...i,x:n,y:r})}function are(e,t={}){return s4(Object.fromEntries(["y","y1","y2"].filter(n=>null!=t[n]).map(n=>[n,e])),t)}const s4=function lre(e={},t={}){const n=m3(t),r=Object.entries(e).map(([i,a])=>{const c=function bQ(e,t){if(void 0!==t[e])return t[e];switch(e){case"x1":case"x2":e="x";break;case"y1":case"y2":e="y"}return t[e]}(i,t);if(null==c)throw new Error(`missing channel: ${i}`);const[d,p]=function g3(e){let t;return[{transform:()=>t,label:h_(e)},n=>t=n]}(c);return{key:i,input:c,output:d,setOutput:p,map:cre(a)}});return{...$S(t,(i,a)=>{const c=Dc(i,n),d=r.map(({input:v})=>Dc(i,v)),p=r.map(({setOutput:v})=>v(new Array(i.length)));for(const v of a)for(const E of c?XP(v,D=>c[D]).values():[v])r.forEach(({map:D},T)=>D.mapIndex(E,d[T],p[T]));return{data:i,facets:a}}),...Object.fromEntries(r.map(({key:i,output:a})=>[i,a]))}};function cre(e){if(null==e)throw new Error("missing map");if("function"==typeof e.mapIndex)return e;if("function"==typeof e.map&&Im(e))return function ure(e){return console.warn("deprecated map interface; implement mapIndex instead."),{mapIndex:e.map.bind(e)}}(e);if("function"==typeof e)return n2(e);switch(`${e}`.toLowerCase()){case"cumsum":return dre;case"rank":return n2(nR);case"quantile":return n2(hre)}throw new Error(`invalid map: ${e}`)}function hre(e){const t=function SG(e,t){let n=0;if(void 0===t)for(let r of e)null!=r&&(r=+r)>=r&&++n;else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(i=+i)>=i&&++n}return n}(e)-1;return nR(e).map(n=>n/t)}function n2(e){return{mapIndex(t,n,r){const i=e(km(n,t));if(i.length!==t.length)throw new Error("map function returned a mismatched length");for(let a=0,c=t.length;a<c;++a)r[t[a]]=i[a]}}}const dre={mapIndex(e,t,n){let r=0;for(const i of e)n[i]=r+=t[i]}};function a4(e={},t){return 1===arguments.length&&(t=e),are(l4(e),t)}function l4(e={}){"number"==typeof e&&(e={k:e});let{k:t,reduce:n,shift:r,anchor:i,strict:a}=e;if(void 0===i&&void 0!==r&&(i=function pre(e){switch(`${e}`.toLowerCase()){case"centered":return"middle";case"leading":return"start";case"trailing":return"end"}throw new Error(`invalid shift: ${e}`)}(r),Ef(`Warning: the shift option is deprecated; please use anchor "${i}" instead.`)),!((t=Math.floor(t))>0))throw new Error(`invalid k: ${t}`);return function mre(e="mean"){if("string"==typeof e){if(/^p\d{2}$/i.test(e))return Px(f3(e));switch(e.toLowerCase()){case"deviation":return Px(GP);case"max":return Rx(Xs);case"mean":return gre;case"median":return Px(z0);case"min":return Rx(uf);case"mode":return Rx(eR);case"sum":return c4;case"variance":return Px(fE);case"difference":return vre;case"ratio":return bre;case"first":return xre;case"last":return wre}}if("function"!=typeof e)throw new Error(`invalid reduce: ${e}`);return Rx(e)}(n)(t,function fre(e="middle",t){switch(`${e}`.toLowerCase()){case"middle":return t-1>>1;case"start":return 0;case"end":return t-1}throw new Error(`invalid anchor: ${e}`)}(i,t),a)}function r2(e,t,n){return e.subarray?e.subarray(t,n):e.slice(t,n)}function Px(e){return(t,n,r)=>r?{mapIndex(i,a,c){const d=Float64Array.from(i,v=>null===a[v]?NaN:a[v]);let p=0;for(let v=0;v<t-1;++v)isNaN(d[v])&&++p;for(let v=0,E=i.length-t+1;v<E;++v)isNaN(d[v+t-1])&&++p,c[i[v+n]]=0===p?e(d.subarray(v,v+t)):NaN,isNaN(d[v])&&--p}}:{mapIndex(i,a,c){const d=Float64Array.from(i,p=>null===a[p]?NaN:a[p]);for(let p=-n;p<0;++p)c[i[p+n]]=e(d.subarray(0,p+t));for(let p=0,v=i.length-n;p<v;++p)c[i[p+n]]=e(d.subarray(p,p+t))}}}function Rx(e){return(t,n,r)=>r?{mapIndex(i,a,c){let d=0;for(let p=0;p<t-1;++p)d+=Dl(a[i[p]]);for(let p=0,v=i.length-t+1;p<v;++p)d+=Dl(a[i[p+t-1]]),d===t&&(c[i[p+n]]=e(km(a,r2(i,p,p+t)))),d-=Dl(a[i[p]])}}:{mapIndex(i,a,c){for(let d=-n;d<0;++d)c[i[d+n]]=e(km(a,r2(i,0,d+t)));for(let d=0,p=i.length-n;d<p;++d)c[i[d+n]]=e(km(a,r2(i,d,d+t)))}}}function c4(e,t,n){return n?{mapIndex(r,i,a){let c=0,d=0;for(let p=0;p<e-1;++p){const v=i[r[p]];null===v||isNaN(v)?++c:d+=+v}for(let p=0,v=r.length-e+1;p<v;++p){const E=i[r[p]],D=i[r[p+e-1]];null===D||isNaN(D)?++c:d+=+D,a[r[p+t]]=0===c?d:NaN,null===E||isNaN(E)?--c:d-=+E}}}:{mapIndex(r,i,a){let c=0;const d=r.length;for(let p=0,v=Math.min(d,e-t-1);p<v;++p)c+=+i[r[p]]||0;for(let p=-t,v=d-t;p<v;++p)c+=+i[r[p+e-1]]||0,a[r[p+t]]=c,c-=+i[r[p]]||0}}}function gre(e,t,n){if(n){const r=c4(e,t,n);return{mapIndex(i,a,c){r.mapIndex(i,a,c);for(let d=0,p=i.length-e+1;d<p;++d)c[i[d+t]]/=e}}}return{mapIndex(r,i,a){let c=0,d=0;const p=r.length;for(let v=0,E=Math.min(p,e-t-1);v<E;++v){let D=i[r[v]];null!==D&&!isNaN(D=+D)&&(c+=D,++d)}for(let v=-t,E=p-t;v<E;++v){let D=i[r[v+e-1]],T=i[r[v]];null!==D&&!isNaN(D=+D)&&(c+=D,++d),a[r[v+t]]=c/d,null!==T&&!isNaN(T=+T)&&(c-=T,--d)}}}}function yre(e,t,n,r){for(let i=n+r;n<i;++n){const a=e[t[n]];if(Dl(a))return a}}function _re(e,t,n,r){for(let i=n+r-1;i>=n;--i){const a=e[t[i]];if(Dl(a))return a}}function u4(e,t,n,r){for(let i=n+r;n<i;++n){let a=e[t[n]];if(null!==a&&!isNaN(a=+a))return a}}function h4(e,t,n,r){for(let i=n+r-1;i>=n;--i){let a=e[t[i]];if(null!==a&&!isNaN(a=+a))return a}}function vre(e,t,n){return n?{mapIndex(r,i,a){for(let c=0,d=r.length-e;c<d;++c){const p=i[r[c]],v=i[r[c+e-1]];a[r[c+t]]=null===p||null===v?NaN:v-p}}}:{mapIndex(r,i,a){for(let c=-t,d=r.length-e+t+1;c<d;++c)a[r[c+t]]=h4(i,r,c,e)-u4(i,r,c,e)}}}function bre(e,t,n){return n?{mapIndex(r,i,a){for(let c=0,d=r.length-e;c<d;++c){const p=i[r[c]],v=i[r[c+e-1]];a[r[c+t]]=null===p||null===v?NaN:v/p}}}:{mapIndex(r,i,a){for(let c=-t,d=r.length-e+t+1;c<d;++c)a[r[c+t]]=h4(i,r,c,e)/u4(i,r,c,e)}}}function xre(e,t,n){return n?{mapIndex(r,i,a){for(let c=0,d=r.length-e;c<d;++c)a[r[c+t]]=i[r[c]]}}:{mapIndex(r,i,a){for(let c=-t,d=r.length-e+t+1;c<d;++c)a[r[c+t]]=yre(i,r,c,e)}}}function wre(e,t,n){return n?{mapIndex(r,i,a){for(let c=0,d=r.length-e;c<d;++c)a[r[c+t]]=i[r[c+e-1]]}}:{mapIndex(r,i,a){for(let c=-t,d=r.length-e+t+1;c<d;++c)a[r[c+t]]=_re(i,r,c,e)}}}var Fx=ku(943);const Cre=["map"];let Ere=(()=>{class e{constructor(){this.device={},this.cameraBearing=0,this.enableRotation=!1}ngOnInit(){}ngOnChanges(){this.addMarkerForDevice(this.device,this.map)}ngAfterViewInit(){this.map||(this.map=new Fx.Map({container:this.mapContainer.nativeElement,style:"https://pax.lab5e.com/map/styles/basic.json",center:[10.14,63.42],zoom:3,maxBounds:[[9.78,63.17],[10.97,63.56]]}),this.map.addControl(new Fx.NavigationControl),this.map.addControl(new Fx.AttributionControl({compact:!1,customAttribution:"Style \xa9 <a href='http://openmaptiles.org/'>MapTiler</a> | Data \xa9 <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap contributors</a>"})),this.addMarkerForDevice(this.device,this.map))}ngOnDestroy(){this.enableRotation=!1,this.map?.remove()}addMarkerForDevice(n,r){if(!(n&&r&&n.lat&&0!=n.lat&&n.lon&&0!=n.lon))return;let i=n.lat,a=n.lon,c=new Fx.Marker({color:"#ff0000"});c.setLngLat([i,a]),c.addTo(this.map),this.enableRotation&&(this.enableRotation=!1,this.cameraBearing=0),this.map?.flyTo({center:[i,a],zoom:16,pitch:45,bearing:0,speed:1,curve:1,easing:p=>p,essential:!0});let d=p=>{!this.enableRotation||(r.rotateTo(this.cameraBearing,{duration:0}),this.cameraBearing+=.25,this.cameraBearing>=360&&(this.cameraBearing=0),requestAnimationFrame(d))};this.map?.on("click",()=>{this.enableRotation=!1}),this.map?.once("moveend",()=>{this.enableRotation=!0,d(0)})}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=zs({type:e,selectors:[["app-device-map-view"]],viewQuery:function(n,r){if(1&n&&Fv(Cre,5),2&n){let i;$p(i=jp())&&(r.mapContainer=i.first)}},inputs:{device:"device"},features:[yt],decls:2,vars:0,consts:[[1,"map"],["map",""]],template:function(n,r){1&n&&xa(0,"div",0,1)},styles:[".map[_ngcontent-%COMP%]{overflow:hidden;border-radius:1em;border:solid 1px silver;width:100%;height:100%}"]}),e})();const Dre=["chart"];function Sre(e,t){if(1&e&&(jn(0,"div",8)(1,"div",9),zr(2),Wn(),jn(3,"div",10),zr(4),Wn()()),2&e){const n=t.$implicit;kr(2),Sh(n.bigText),kr(2),Sh(n.smallText)}}let Mre=(()=>{class e{constructor(n,r){this.paxService=n,this.renderer=r,this.device={},this.metrics=[],this.data=[],this.errorMessage="",this.lastPoll=new Date,this.chartIntervalHours=24}ngOnInit(){}ngAfterViewInit(){}ngOnChanges(n){this.loadData()}loadData(){let n=""+((new Date).getTime()-3600*this.chartIntervalHours*1e3),r=""+(new Date).getTime();this.paxService.paxServiceListData(n,r,19e6).subscribe({next:i=>{i.data&&i.data.forEach((a,c)=>{a.deviceId==this.device.id&&(this.data=a.samples?.map(d=>({time:new Date(parseInt(d.timestamp)),ble:d.bluetoothCount||0,wifi:d.wifiCount||0}))||[])})},error:i=>{this.errorMessage=i.message},complete:()=>{this.buildMetrics(),this.lastPoll=new Date,this.showChart()}})}showChart(){this.chart&&this.renderer.removeChild(this.chartRef?.nativeElement,this.chart,!1);let n=this.chartRef?.nativeElement.offsetWidth,r=this.chartRef?.nativeElement.height,i=uf(this.data,c=>c.time),a=Xs(this.data,c=>c.time);this.chart=K5({width:n,height:r,margin:50,inset:5,y:{grid:!0,label:"Antall"},x:{label:"Klokkeslett",grid:!0,tickFormat:s_("%H:%M"),domain:[i,a]},marks:[Ax(this.data,{x:c=>c.time,y:"ble",stroke:"blue",opacity:.2}),o4(this.data,a4({reduce:"mean",k:7,anchor:"middle"},{x:"time",y:"ble",stroke:"blue",strokeWidth:2,opacity:.8})),Ax(this.data,{x:"time",y:"wifi",stroke:"red",opacity:.3}),o4(this.data,a4({reduce:"mean",k:7,anchor:"middle"},{x:"time",y:"wifi",stroke:"red",strokeWidth:2,opacity:.9}))],color:{legend:!0,domain:["wifi","ble"],range:["red","blue"]},style:{fontFamily:"sans-serif",fontSize:"10pt",background:"#eeeeee",fill:"#808080",border:"solid 1px silver"}}),this.renderer.appendChild(this.chartRef?.nativeElement,this.chart)}buildMetrics(){let n=Xs(this.data,p=>p.ble)||0,r=Xs(this.data,p=>p.wifi)||0,i="Rolig",a=this.data.length-1,d=Math.round(100*(this.data[a].ble+this.data[a].wifi)/(n+r));d>=80&&(i="Sv\xe6rt h\xf8y"),d>=60&&d<80&&(i="H\xf8y"),d>=40&&d<60&&(i="Normal"),d>=25&&d<40&&(i="Lav"),d<25&&(i="Sv\xe6rt Lav"),this.metrics=[{bigText:String(n),smallText:"Maks antall BLE"},{bigText:String(r),smallText:"Maks antall WiFi"},{bigText:String(this.data.length),smallText:"M\xe5linger i perioden"},{bigText:i,smallText:"Folketetthet ("+d+"% av maks)"}]}}return e.\u0275fac=function(n){return new(n||e)(qe(Dy),qe(sc))},e.\u0275cmp=zs({type:e,selectors:[["app-device-view"]],viewQuery:function(n,r){if(1&n&&Fv(Dre,5),2&n){let i;$p(i=jp())&&(r.chartRef=i.first)}},inputs:{device:"device"},features:[yt],decls:10,vars:6,consts:[[1,"device-status-page"],[1,"data"],["id","chart",1,"chart"],["chart",""],[1,"device-info"],["class","metric",4,"ngFor","ngForOf"],[1,"location"],[3,"device"],[1,"metric"],[1,"metric-value"],[1,"metric-desc"]],template:function(n,r){1&n&&(jn(0,"div",0)(1,"div",1),xa(2,"div",2,3),zr(4),kv(5,"date"),Wn(),jn(6,"div",4),Dh(7,Sre,5,2,"div",5),Wn(),jn(8,"div",6),xa(9,"app-device-map-view",7),Wn()()),2&n&&(kr(4),Kd(" Sist oppdatert ",Pv(5,3,r.lastPoll,"YYYY-mm-dd HH:MM")," "),kr(3),Co("ngForOf",r.metrics),kr(2),Co("device",r.device))},dependencies:[n0,Ere,gC],styles:[".device-status-page[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(2,1fr);grid-row-gap:10px;grid-column-gap:10px;height:100%}.device-info[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);grid-template-rows:1fr 1fr;grid-column-gap:1em;grid-row-gap:1em}.info-title[_ngcontent-%COMP%]{font-size:24pt;color:#005aa7;grid-column:span 2;text-align:center}.metric[_ngcontent-%COMP%]{background-color:#2696f9;color:#fff;border-radius:1em;display:grid;grid-template-columns:1fr;grid-template-rows:3fr 1fr}.metric-value[_ngcontent-%COMP%]{font-size:6vh;text-align:center;margin-top:auto;margin-bottom:auto}.metric-desc[_ngcontent-%COMP%]{font-size:1vw;text-align:center}.location[_ngcontent-%COMP%]{background-color:#ddd;border-radius:1em}.data[_ngcontent-%COMP%]{grid-column:span 2;vertical-align:middle}#chart[_ngcontent-%COMP%]{display:flex}#chart[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{flex:1}"]}),e})();const d4=function(e){return{active:e}};function Tre(e,t){if(1&e){const n=function BM(){return He()}();jn(0,"div",6),Ri("click",function(){const a=function Zl(e){return Vt.lFrame.contextLView=e,e[8]}(n).$implicit;return function el(e){return Vt.lFrame.contextLView=null,e}(qg().setActiveDevice(a))}),jn(1,"div",7),zr(2),Wn(),jn(3,"div",8),zr(4),Wn()()}if(2&e){const n=t.$implicit,r=qg();Co("ngClass",ef(3,d4,r.activeDevice==n)),kr(2),Kd(" ",n.name," "),kr(2),Kd(" Id: ",n.id," ")}}function Ire(e,t){1&e&&xa(0,"app-main-chart")}function Are(e,t){1&e&&xa(0,"app-device-view",13),2&e&&Co("device",qg().activeDevice)}let kre=(()=>{class e{constructor(n){this.paxService=n,this.devices=[],n.paxServiceListDevices().subscribe({next:r=>{r.devices&&(this.devices=r.devices,this.devices.forEach(i=>{"17dj5j4ce8bkbg"==i.id&&(this.activeDevice=i)}))},error:r=>{console.error(r)},complete:()=>{}})}ngOnInit(){}setActiveDevice(n){this.activeDevice=n}}return e.\u0275fac=function(n){return new(n||e)(qe(Dy))},e.\u0275cmp=zs({type:e,selectors:[["app-main-page"]],decls:16,vars:6,consts:[[1,"page"],[1,"heading"],[1,"logo"],[1,"title"],[1,"content"],[1,"list"],[1,"list-item",3,"ngClass","click"],[1,"item-title"],[1,"item-subtitle"],["class","list-item",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"detail"],[4,"ngIf"],[3,"device",4,"ngIf"],[3,"device"]],template:function(n,r){1&n&&(jn(0,"div",0)(1,"div",1),xa(2,"span",2),jn(3,"span",3),zr(4," PAX "),Wn()(),jn(5,"div",4)(6,"div",5)(7,"div",6),Ri("click",function(){return r.setActiveDevice()}),jn(8,"div",7),zr(9," Alle "),Wn(),jn(10,"div",8),zr(11," Vis aggregerte data for alle tellere "),Wn()(),Dh(12,Tre,5,5,"div",9),Wn(),jn(13,"div",10),Dh(14,Ire,1,0,"app-main-chart",11),Dh(15,Are,1,1,"app-device-view",12),Wn()()()),2&n&&(kr(7),Co("ngClass",ef(4,d4,null==r.activeDevice)),kr(5),Co("ngForOf",r.devices),kr(2),Co("ngIf",null==r.activeDevice),kr(1),Co("ngIf",null!=r.activeDevice))},dependencies:[dC,n0,fC,DG,Mre],styles:[".page[_ngcontent-%COMP%]{margin:0;padding:0;width:100vw;height:100vh;background-color:#eee;display:flex;flex-direction:column}.heading[_ngcontent-%COMP%]{color:#fff;background-color:#009bdf;height:5em;padding:1em}.heading[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:24pt}.content[_ngcontent-%COMP%]{height:calc(100vh - 5em);background-color:gray;display:flex;flex-direction:row}.list[_ngcontent-%COMP%]{direction:rtl;width:20em;min-height:100%;background-color:#ddd;display:flex;flex-direction:column;overflow-y:auto}.list-item[_ngcontent-%COMP%]{direction:ltr;width:100%;height:6em!important}.list-item[_ngcontent-%COMP%]:not(.active){border-bottom:solid 1px #cccccc}.list-item[_ngcontent-%COMP%]:hover:not(.active){background-color:#80add3;cursor:pointer}.active[_ngcontent-%COMP%]{background-color:#eee;color:#000;box-shadow:10px 5px 5px silver}.item-title[_ngcontent-%COMP%]{font-size:14pt;margin-top:1em;margin-left:1em}.item-subtitle[_ngcontent-%COMP%]{font-size:10pt;color:gray;margin-top:.5em;margin-left:2em;margin-bottom:1em;font-weight:light}.detail[_ngcontent-%COMP%]{background-color:#eee;flex:auto 1;padding:1em}"]}),e})(),Pre=(()=>{class e{constructor(n){this.paxService=n,this.title="PAX",this.paxService.configuration.basePath="https://pax.lab5e.com"}}return e.\u0275fac=function(n){return new(n||e)(qe(Dy))},e.\u0275cmp=zs({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(n,r){1&n&&xa(0,"app-main-page")},dependencies:[kre]}),e})(),nz=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=li({type:e}),e.\u0275inj=Di({}),e})();const v2=new Tt("NgModelWithFormControlWarning");let vz=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=li({type:e}),e.\u0275inj=Di({imports:[nz]}),e})(),Pie=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=li({type:e}),e.\u0275inj=Di({imports:[vz]}),e})(),Rie=(()=>{class e{static withConfig(n){return{ngModule:e,providers:[{provide:v2,useValue:n.warnOnNgModelWithFormControl}]}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=li({type:e}),e.\u0275inj=Di({imports:[vz]}),e})(),Bie=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=li({type:e}),e.\u0275inj=Di({imports:[jA]}),e})(),Vie=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=li({type:e,bootstrap:[Pre]}),e.\u0275inj=Di({imports:[_9,oG,Pie,Rie,_G,Bie]}),e})();(function OU(){hA=!1})(),y9().bootstrapModule(Vie).catch(e=>console.error(e))},943:function(Lm){Lm.exports=function(){"use strict";var Au,ku,ar;function qh(b,wr){if(Au)if(ku){var ks="var sharedChunk = {}; ("+Au+")(sharedChunk); ("+ku+")(sharedChunk);",us={};Au(us),ar=wr(us),typeof window<"u"&&(ar.workerUrl=window.URL.createObjectURL(new Blob([ks],{type:"text/javascript"})))}else ku=wr;else Au=wr}return qh(0,function(b){var wr=ks;function ks(l,o,u,f){this.cx=3*l,this.bx=3*(u-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=o,this.p2x=u,this.p2y=f}function us(l,o,u,f){const _=new wr(l,o,u,f);return function(x){return _.solve(x)}}ks.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,o){if(void 0===o&&(o=1e-6),l<0)return 0;if(l>1)return 1;for(var u=l,f=0;f<8;f++){var _=this.sampleCurveX(u)-l;if(Math.abs(_)<o)return u;var x=this.sampleCurveDerivativeX(u);if(Math.abs(x)<1e-6)break;u-=_/x}var C=0,M=1;for(u=l,f=0;f<20&&(_=this.sampleCurveX(u),!(Math.abs(_-l)<o));f++)l>_?C=u:M=u,u=.5*(M-C)+C;return u},solve:function(l,o){return this.sampleCurveY(this.solveCurveX(l,o))}};const Il=us(.25,.1,.25,1);function Zt(l,o,u){return Math.min(u,Math.max(o,l))}function Ie(l,o,u){const f=u-o,_=((l-o)%f+f)%f+o;return _===o?u:_}function Bi(l,...o){for(const u of o)for(const f in u)l[f]=u[f];return l}let Ps=1;function Rs(l,o){l.forEach(u=>{o[u]&&(o[u]=o[u].bind(o))})}function Pa(l,o,u){const f={};for(const _ in l)f[_]=o.call(u||this,l[_],_,l);return f}function Al(l,o,u){const f={};for(const _ in l)o.call(u||this,l[_],_,l)&&(f[_]=l[_]);return f}function Ci(l){return Array.isArray(l)?l.map(Ci):"object"==typeof l&&l?Pa(l,Ci):l}const io={};function fn(l){io[l]||(typeof console<"u"&&console.warn(l),io[l]=!0)}function si(l,o,u){return(u.y-l.y)*(o.x-l.x)>(o.y-l.y)*(u.x-l.x)}function kc(l){let o=0;for(let u,f,_=0,x=l.length,C=x-1;_<x;C=_++)u=l[_],f=l[C],o+=(f.x-u.x)*(u.y+f.y);return o}function To(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let ta=null;function Fs(l){if(null==ta){const o=l.navigator?l.navigator.userAgent:null;ta=!!l.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return ta}function oo(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}const Ra="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let hs,Gn;const Pu={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(l){const o=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(l,o=0){return this.getImageCanvasContext(l).getImageData(-o,-o,l.width+2*o,l.height+2*o)},getImageCanvasContext(l){const o=window.document.createElement("canvas"),u=o.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return o.width=l.width,o.height=l.height,u.drawImage(l,0,0,l.width,l.height),u},resolveURL:l=>(hs||(hs=document.createElement("a")),hs.href=l,hs.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==Gn&&(Gn=matchMedia("(prefers-reduced-motion: reduce)")),Gn.matches)}};var It=Wr;function Wr(l,o){this.x=l,this.y=o}Wr.prototype={clone:function(){return new Wr(this.x,this.y)},add:function(l){return this.clone()._add(l)},sub:function(l){return this.clone()._sub(l)},multByPoint:function(l){return this.clone()._multByPoint(l)},divByPoint:function(l){return this.clone()._divByPoint(l)},mult:function(l){return this.clone()._mult(l)},div:function(l){return this.clone()._div(l)},rotate:function(l){return this.clone()._rotate(l)},rotateAround:function(l,o){return this.clone()._rotateAround(l,o)},matMult:function(l){return this.clone()._matMult(l)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(l){return this.x===l.x&&this.y===l.y},dist:function(l){return Math.sqrt(this.distSqr(l))},distSqr:function(l){var o=l.x-this.x,u=l.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith:function(l){return this.angleWithSep(l.x,l.y)},angleWithSep:function(l,o){return Math.atan2(this.x*o-this.y*l,this.x*l+this.y*o)},_matMult:function(l){var o=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=o,this},_add:function(l){return this.x+=l.x,this.y+=l.y,this},_sub:function(l){return this.x-=l.x,this.y-=l.y,this},_mult:function(l){return this.x*=l,this.y*=l,this},_div:function(l){return this.x/=l,this.y/=l,this},_multByPoint:function(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint:function(l){return this.x/=l.x,this.y/=l.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var l=this.y;return this.y=this.x,this.x=-l,this},_rotate:function(l){var o=Math.cos(l),u=Math.sin(l),f=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=f,this},_rotateAround:function(l,o){var u=Math.cos(l),f=Math.sin(l),_=o.y+f*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-f*(this.y-o.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Wr.convert=function(l){return l instanceof Wr?l:Array.isArray(l)?new Wr(l[0],l[1]):l};const Fa={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,REGISTERED_PROTOCOLS:{}};class Os extends Error{constructor(o,u,f,_){super(`AJAXError: ${u} (${o}): ${f}`),this.status=o,this.statusText=u,this.url=f,this.body=_}}const Bn=To()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href;function Pc(l,o){const u=new AbortController,f=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Bn(),signal:u.signal});let _=!1,x=!1;return"json"===l.type&&f.headers.set("Accept","application/json"),x||fetch(f).then(C=>{return C.ok?(M=C,void("arrayBuffer"===l.type?M.arrayBuffer():"json"===l.type?M.json():M.text()).then(A=>{x||(_=!0,o(null,A,M.headers.get("Cache-Control"),M.headers.get("Expires")))}).catch(A=>{x||o(new Error(A.message))})):C.blob().then(M=>o(new Os(C.status,C.statusText,l.url,M)));var M}).catch(C=>{20!==C.code&&o(new Error(C.message))}),{cancel:()=>{x=!0,_||u.abort()}}}const kl=function(l,o){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){if(To()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,o);if(!To()){const f=l.url.substring(0,l.url.indexOf("://"));return(Fa.REGISTERED_PROTOCOLS[f]||Pc)(l,o)}}if(!(/^file:/.test(u=l.url)||/^file:/.test(Bn())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Pc(l,o);if(To()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,o,void 0,!0)}var u;return function(f,_){const x=new XMLHttpRequest;x.open(f.method||"GET",f.url,!0),"arrayBuffer"===f.type&&(x.responseType="arraybuffer");for(const C in f.headers)x.setRequestHeader(C,f.headers[C]);return"json"===f.type&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials="include"===f.credentials,x.onerror=()=>{_(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||0===x.status)&&null!==x.response){let C=x.response;if("json"===f.type)try{C=JSON.parse(x.response)}catch(M){return _(M)}_(null,C,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else{const C=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});_(new Os(x.status,x.statusText,f.url,C))}},x.send(f.body),{cancel:()=>x.abort()}}(l,o)},Oa=function(l,o){return kl(Bi(l,{type:"arrayBuffer"}),o)};function Rc(l){const o=window.document.createElement("a");return o.href=l,o.protocol===window.document.location.protocol&&o.host===window.document.location.host}function pi(l,o,u){u[l]&&-1!==u[l].indexOf(o)||(u[l]=u[l]||[],u[l].push(o))}function La(l,o,u){if(u&&u[l]){const f=u[l].indexOf(o);-1!==f&&u[l].splice(f,1)}}class na{constructor(o,u={}){Bi(this,u),this.type=o}}class yr extends na{constructor(o,u={}){super("error",Bi({error:o},u))}}class tr{on(o,u){return this._listeners=this._listeners||{},pi(o,u,this._listeners),this}off(o,u){return La(o,u,this._listeners),La(o,u,this._oneTimeListeners),this}once(o,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},pi(o,u,this._oneTimeListeners),this):new Promise(f=>this.once(o,f))}fire(o,u){"string"==typeof o&&(o=new na(o,u||{}));const f=o.type;if(this.listens(f)){o.target=this;const _=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const M of _)M.call(this,o);const x=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const M of x)La(f,M,this._oneTimeListeners),M.call(this,o);const C=this._eventedParent;C&&(Bi(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),C.fire(o))}else o instanceof yr&&console.error(o.error);return this}listens(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)}setEventedParent(o,u){return this._eventedParent=o,this._eventedParentData=u,this}}var Ae={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Pe{constructor(o,u,f,_){this.message=(o?`${o}: `:"")+f,_&&(this.identifier=_),null!=u&&u.__line__&&(this.line=u.__line__)}}function Na(l){const o=l.value;return o?[new Pe(l.key,o,"constants have been deprecated as of v8")]:[]}function Vi(l,...o){for(const u of o)for(const f in u)l[f]=u[f];return l}function Vn(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function ds(l){if(Array.isArray(l))return l.map(ds);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const o={};for(const u in l)o[u]=ds(l[u]);return o}return Vn(l)}class Ui extends Error{constructor(o,u){super(u),this.message=u,this.key=o}}class Pl{constructor(o,u=[]){this.parent=o,this.bindings={};for(const[f,_]of u)this.bindings[f]=_}concat(o){return new Pl(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const fs={kind:"null"},rt={kind:"number"},Jt={kind:"string"},jt={kind:"boolean"},so={kind:"color"},ps={kind:"object"},At={kind:"value"},Ls={kind:"collator"},Ei={kind:"formatted"},ra={kind:"padding"},ao={kind:"resolvedImage"};function $i(l,o){return{kind:"array",itemType:l,N:o}}function Nn(l){if("array"===l.kind){const o=Nn(l.itemType);return"number"==typeof l.N?`array<${o}, ${l.N}>`:"value"===l.itemType.kind?"array":`array<${o}>`}return l.kind}const Fc=[fs,rt,Jt,jt,so,Ei,ps,$i(At),ra,ao];function lo(l,o){if("error"===o.kind)return null;if("array"===l.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!lo(l.itemType,o.itemType))&&("number"!=typeof l.N||l.N===o.N))return null}else{if(l.kind===o.kind)return null;if("value"===l.kind)for(const u of Fc)if(!lo(u,o))return null}return`Expected ${Nn(l)} but found ${Nn(o)} instead.`}function Rl(l,o){return o.some(u=>u.kind===l.kind)}function pn(l,o){return o.some(u=>"null"===u?null===l:"array"===u?Array.isArray(l):"object"===u?l&&!Array.isArray(l)&&"object"==typeof l:u===typeof l)}var ia,Oc={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function za(l){return(l=Math.round(l))<0?0:l>255?255:l}function Ru(l){return za("%"===l[l.length-1]?parseFloat(l)/100*255:parseInt(l))}function oa(l){return(o="%"===l[l.length-1]?parseFloat(l)/100:parseFloat(l))<0?0:o>1?1:o;var o}function Ba(l,o,u){return u<0?u+=1:u>1&&(u-=1),6*u<1?l+(o-l)*u*6:2*u<1?o:3*u<2?l+(o-l)*(2/3-u)*6:l}try{ia={}.parseCSSColor=function(l){var o,u=l.replace(/ /g,"").toLowerCase();if(u in Oc)return Oc[u].slice();if("#"===u[0])return 4===u.length?(o=parseInt(u.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===u.length&&(o=parseInt(u.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var f=u.indexOf("("),_=u.indexOf(")");if(-1!==f&&_+1===u.length){var x=u.substr(0,f),C=u.substr(f+1,_-(f+1)).split(","),M=1;switch(x){case"rgba":if(4!==C.length)return null;M=oa(C.pop());case"rgb":return 3!==C.length?null:[Ru(C[0]),Ru(C[1]),Ru(C[2]),M];case"hsla":if(4!==C.length)return null;M=oa(C.pop());case"hsl":if(3!==C.length)return null;var A=(parseFloat(C[0])%360+360)%360/360,F=oa(C[1]),O=oa(C[2]),B=O<=.5?O*(F+1):O+F-O*F,H=2*O-B;return[za(255*Ba(H,B,A+1/3)),za(255*Ba(H,B,A)),za(255*Ba(H,B,A-1/3)),M];default:return null}}return null}}catch{}class Sn{constructor(o,u,f,_=1){this.r=o,this.g=u,this.b=f,this.a=_}static parse(o){if(!o)return;if(o instanceof Sn)return o;if("string"!=typeof o)return;const u=ia(o);return u?new Sn(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3]):void 0}toString(){const[o,u,f,_]=this.toArray();return`rgba(${Math.round(o)},${Math.round(u)},${Math.round(f)},${_})`}toArray(){const{r:o,g:u,b:f,a:_}=this;return 0===_?[0,0,0,0]:[255*o/_,255*u/_,255*f/_,_]}}Sn.black=new Sn(0,0,0,1),Sn.white=new Sn(1,1,1,1),Sn.transparent=new Sn(0,0,0,0),Sn.red=new Sn(1,0,0,1);class Fl{constructor(o,u,f){this.sensitivity=o?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,u){return this.collator.compare(o,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class co{constructor(o,u,f,_,x){this.text=o,this.image=u,this.scale=f,this.fontStack=_,this.textColor=x}}class Xr{constructor(o){this.sections=o}static fromString(o){return new Xr([new co(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof Xr?o:Xr.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}}class $r{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof $r)return o;if("number"==typeof o)return new $r([o,o,o,o]);if(Array.isArray(o)&&!(o.length<1||o.length>4)){for(const u of o)if("number"!=typeof u)return;switch(o.length){case 1:o=[o[0],o[0],o[0],o[0]];break;case 2:o=[o[0],o[1],o[0],o[1]];break;case 3:o=[o[0],o[1],o[2],o[1]]}return new $r(o)}}toString(){return JSON.stringify(this.values)}}class mi{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new mi({name:o,available:!1}):null}}function gi(l,o,u,f){return"number"==typeof l&&l>=0&&l<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof u&&u>=0&&u<=255?void 0===f||"number"==typeof f&&f>=0&&f<=1?null:`Invalid rgba value [${[l,o,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof f?[l,o,u,f]:[l,o,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ns(l){if(null===l||"string"==typeof l||"boolean"==typeof l||"number"==typeof l||l instanceof Sn||l instanceof Fl||l instanceof Xr||l instanceof $r||l instanceof mi)return!0;if(Array.isArray(l)){for(const o of l)if(!Ns(o))return!1;return!0}if("object"==typeof l){for(const o in l)if(!Ns(l[o]))return!1;return!0}return!1}function J(l){if(null===l)return fs;if("string"==typeof l)return Jt;if("boolean"==typeof l)return jt;if("number"==typeof l)return rt;if(l instanceof Sn)return so;if(l instanceof Fl)return Ls;if(l instanceof Xr)return Ei;if(l instanceof $r)return ra;if(l instanceof mi)return ao;if(Array.isArray(l)){const o=l.length;let u;for(const f of l){const _=J(f);if(u){if(u===_)continue;u=At;break}u=_}return $i(u||At,o)}return ps}function V(l){const o=typeof l;return null===l?"":"string"===o||"number"===o||"boolean"===o?String(l):l instanceof Sn||l instanceof Xr||l instanceof $r||l instanceof mi?l.toString():JSON.stringify(l)}class ${constructor(o,u){this.type=o,this.value=u}static parse(o,u){if(2!==o.length)return u.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Ns(o[1]))return u.error("invalid value");const f=o[1];let _=J(f);const x=u.expectedType;return"array"!==_.kind||0!==_.N||!x||"array"!==x.kind||"number"==typeof x.N&&0!==x.N||(_=x),new $(_,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class K{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const te={string:Jt,number:rt,boolean:jt,object:ps};class ce{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");let f,_=1;const x=o[0];if("array"===x){let M,A;if(o.length>2){const F=o[1];if("string"!=typeof F||!(F in te)||"object"===F)return u.error('The item type argument of "array" must be one of string, number, boolean',1);M=te[F],_++}else M=At;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return u.error('The length argument to "array" must be a positive integer literal',2);A=o[2],_++}f=$i(M,A)}else{if(!te[x])throw new Error(`Types doesn't contain name = ${x}`);f=te[x]}const C=[];for(;_<o.length;_++){const M=u.parse(o[_],_,At);if(!M)return null;C.push(M)}return new ce(f,C)}evaluate(o){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(o);if(!lo(this.type,J(f)))return f;if(u===this.args.length-1)throw new K(`Expected value to be of type ${Nn(this.type)}, but found ${Nn(J(f))} instead.`)}throw new Error}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const ge={"to-boolean":jt,"to-color":so,"to-number":rt,"to-string":Jt};class he{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");const f=o[0];if(!ge[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if(("to-boolean"===f||"to-string"===f)&&2!==o.length)return u.error("Expected one argument.");const _=ge[f],x=[];for(let C=1;C<o.length;C++){const M=u.parse(o[C],C,At);if(!M)return null;x.push(M)}return new he(_,x)}evaluate(o){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(o));if("color"===this.type.kind){let u,f;for(const _ of this.args){if(u=_.evaluate(o),f=null,u instanceof Sn)return u;if("string"==typeof u){const x=o.parseColor(u);if(x)return x}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:gi(u[0],u[1],u[2],u[3]),!f))return new Sn(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new K(f||`Could not parse color from value '${"string"==typeof u?u:JSON.stringify(u)}'`)}if("padding"===this.type.kind){let u;for(const f of this.args){u=f.evaluate(o);const _=$r.parse(u);if(_)return _}throw new K(`Could not parse padding from value '${"string"==typeof u?u:JSON.stringify(u)}'`)}if("number"===this.type.kind){let u=null;for(const f of this.args){if(u=f.evaluate(o),null===u)return 0;const _=Number(u);if(!isNaN(_))return _}throw new K(`Could not convert ${JSON.stringify(u)} to number.`)}return"formatted"===this.type.kind?Xr.fromString(V(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?mi.fromString(V(this.args[0].evaluate(o))):V(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const ue=["Unknown","Point","LineString","Polygon"];class xe{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ue[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(o){let u=this._parseColorCache[o];return u||(u=this._parseColorCache[o]=Sn.parse(o)),u}}class Me{constructor(o,u,f,_){this.name=o,this.type=u,this._evaluate=f,this.args=_}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}static parse(o,u){const f=o[0],_=Me.definitions[f];if(!_)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(_)?_[0]:_.type,C=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,M=C.filter(([F])=>!Array.isArray(F)||F.length===o.length-1);let A=null;for(const[F,O]of M){A=new Ol(u.registry,u.path,null,u.scope);const B=[];let H=!1;for(let q=1;q<o.length;q++){const W=o[q],se=Array.isArray(F)?F[q-1]:F.type,oe=A.parse(W,1+B.length,se);if(!oe){H=!0;break}B.push(oe)}if(!H)if(Array.isArray(F)&&F.length!==B.length)A.error(`Expected ${F.length} arguments, but found ${B.length} instead.`);else{for(let q=0;q<B.length;q++){const W=Array.isArray(F)?F[q]:F.type,se=B[q];A.concat(q+1).checkSubtype(W,se.type)}if(0===A.errors.length)return new Me(f,x,O,B)}}if(1===M.length)u.errors.push(...A.errors);else{const F=(M.length?M:C).map(([B])=>{return H=B,Array.isArray(H)?`(${H.map(Nn).join(", ")})`:`(${Nn(H.type)}...)`;var H}).join(" | "),O=[];for(let B=1;B<o.length;B++){const H=u.parse(o[B],1+O.length);if(!H)return null;O.push(Nn(H.type))}u.error(`Expected arguments of type ${F}, but found (${O.join(", ")}) instead.`)}return null}static register(o,u){Me.definitions=u;for(const f in u)o[f]=Me}}class je{constructor(o,u,f){this.type=Ls,this.locale=f,this.caseSensitive=o,this.diacriticSensitive=u}static parse(o,u){if(2!==o.length)return u.error("Expected one argument.");const f=o[1];if("object"!=typeof f||Array.isArray(f))return u.error("Collator options argument must be an object.");const _=u.parse(void 0!==f["case-sensitive"]&&f["case-sensitive"],1,jt);if(!_)return null;const x=u.parse(void 0!==f["diacritic-sensitive"]&&f["diacritic-sensitive"],1,jt);if(!x)return null;let C=null;return f.locale&&(C=u.parse(f.locale,1,Jt),!C)?null:new je(_,x,C)}evaluate(o){return new Fl(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}}const Te=8192;function Dt(l,o){l[0]=Math.min(l[0],o[0]),l[1]=Math.min(l[1],o[1]),l[2]=Math.max(l[2],o[0]),l[3]=Math.max(l[3],o[1])}function ht(l,o){return!(l[0]<=o[0]||l[2]>=o[2]||l[1]<=o[1]||l[3]>=o[3])}function dt(l,o){const u=(180+l[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,_=Math.pow(2,o.z);return[Math.round(u*_*Te),Math.round(f*_*Te)]}function xt(l,o,u){const f=l[0]-o[0],_=l[1]-o[1],x=l[0]-u[0],C=l[1]-u[1];return f*C-x*_==0&&f*x<=0&&_*C<=0}function ln(l,o){let u=!1;for(let C=0,M=o.length;C<M;C++){const A=o[C];for(let F=0,O=A.length;F<O-1;F++){if(xt(l,A[F],A[F+1]))return!1;(_=A[F])[1]>(f=l)[1]!=(x=A[F+1])[1]>f[1]&&f[0]<(x[0]-_[0])*(f[1]-_[1])/(x[1]-_[1])+_[0]&&(u=!u)}}var f,_,x;return u}function qn(l,o){for(let u=0;u<o.length;u++)if(ln(l,o[u]))return!0;return!1}function sn(l,o,u,f){const _=f[0]-u[0],x=f[1]-u[1],C=(l[0]-u[0])*x-_*(l[1]-u[1]),M=(o[0]-u[0])*x-_*(o[1]-u[1]);return C>0&&M<0||C<0&&M>0}function an(l,o,u){for(const F of u)for(let O=0;O<F.length-1;++O)if((M=[(C=F[O+1])[0]-(x=F[O])[0],C[1]-x[1]])[0]*(A=[(_=o)[0]-(f=l)[0],_[1]-f[1]])[1]-M[1]*A[0]!=0&&sn(f,_,x,C)&&sn(x,C,f,_))return!0;var f,_,x,C,M,A;return!1}function Zn(l,o){for(let u=0;u<l.length;++u)if(!ln(l[u],o))return!1;for(let u=0;u<l.length-1;++u)if(an(l[u],l[u+1],o))return!1;return!0}function lr(l,o){for(let u=0;u<o.length;u++)if(Zn(l,o[u]))return!0;return!1}function ai(l,o,u){const f=[];for(let _=0;_<l.length;_++){const x=[];for(let C=0;C<l[_].length;C++){const M=dt(l[_][C],u);Dt(o,M),x.push(M)}f.push(x)}return f}function Pr(l,o,u){const f=[];for(let _=0;_<l.length;_++){const x=ai(l[_],o,u);f.push(x)}return f}function Va(l,o,u,f){if(l[0]<u[0]||l[0]>u[2]){const _=.5*f;let x=l[0]-u[0]>_?-f:u[0]-l[0]>_?f:0;0===x&&(x=l[0]-u[2]>_?-f:u[2]-l[0]>_?f:0),l[0]+=x}Dt(o,l)}function kf(l,o,u,f){const _=Math.pow(2,f.z)*Te,x=[f.x*Te,f.y*Te],C=[];for(const M of l)for(const A of M){const F=[A.x+x[0],A.y+x[1]];Va(F,o,u,_),C.push(F)}return C}function Pf(l,o,u,f){const _=Math.pow(2,f.z)*Te,x=[f.x*Te,f.y*Te],C=[];for(const A of l){const F=[];for(const O of A){const B=[O.x+x[0],O.y+x[1]];Dt(o,B),F.push(B)}C.push(F)}if(o[2]-o[0]<=_/2){(M=o)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const A of C)for(const F of A)Va(F,o,u,_)}var M;return C}class Ua{constructor(o,u){this.type=jt,this.geojson=o,this.geometries=u}static parse(o,u){if(2!==o.length)return u.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Ns(o[1])){const f=o[1];if("FeatureCollection"===f.type)for(let _=0;_<f.features.length;++_){const x=f.features[_].geometry.type;if("Polygon"===x||"MultiPolygon"===x)return new Ua(f,f.features[_].geometry)}else if("Feature"===f.type){const _=f.geometry.type;if("Polygon"===_||"MultiPolygon"===_)return new Ua(f,f.geometry)}else if("Polygon"===f.type||"MultiPolygon"===f.type)return new Ua(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(u,f){const _=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],C=u.canonicalID();if("Polygon"===f.type){const M=ai(f.coordinates,x,C),A=kf(u.geometry(),_,x,C);if(!ht(_,x))return!1;for(const F of A)if(!ln(F,M))return!1}if("MultiPolygon"===f.type){const M=Pr(f.coordinates,x,C),A=kf(u.geometry(),_,x,C);if(!ht(_,x))return!1;for(const F of A)if(!qn(F,M))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(u,f){const _=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],C=u.canonicalID();if("Polygon"===f.type){const M=ai(f.coordinates,x,C),A=Pf(u.geometry(),_,x,C);if(!ht(_,x))return!1;for(const F of A)if(!Zn(F,M))return!1}if("MultiPolygon"===f.type){const M=Pr(f.coordinates,x,C),A=Pf(u.geometry(),_,x,C);if(!ht(_,x))return!1;for(const F of A)if(!lr(F,M))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Fu(l){if(l instanceof Me&&("get"===l.name&&1===l.args.length||"feature-state"===l.name||"has"===l.name&&1===l.args.length||"properties"===l.name||"geometry-type"===l.name||"id"===l.name||/^filter-/.test(l.name))||l instanceof Ua)return!1;let o=!0;return l.eachChild(u=>{o&&!Fu(u)&&(o=!1)}),o}function $a(l){if(l instanceof Me&&"feature-state"===l.name)return!1;let o=!0;return l.eachChild(u=>{o&&!$a(u)&&(o=!1)}),o}function sa(l,o){if(l instanceof Me&&o.indexOf(l.name)>=0)return!1;let u=!0;return l.eachChild(f=>{u&&!sa(f,o)&&(u=!1)}),u}class Ou{constructor(o,u){this.type=u.type,this.name=o,this.boundExpression=u}static parse(o,u){if(2!==o.length||"string"!=typeof o[1])return u.error("'var' expression requires exactly one string literal argument.");const f=o[1];return u.scope.has(f)?new Ou(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}}class Cr{constructor(o,u=[],f,_=new Pl,x=[]){this.registry=o,this.path=u,this.key=u.map(C=>`[${C}]`).join(""),this.scope=_,this.errors=x,this.expectedType=f}parse(o,u,f,_,x={}){return u?this.concat(u,f,_)._parse(o,x):this._parse(o,x)}_parse(o,u){function f(_,x,C){return"assert"===C?new ce(x,[_]):"coerce"===C?new he(x,[_]):_}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=o[0];if("string"!=typeof _)return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[_];if(x){let C=x.parse(o,this);if(!C)return null;if(this.expectedType){const M=this.expectedType,A=C.type;if("string"!==M.kind&&"number"!==M.kind&&"boolean"!==M.kind&&"object"!==M.kind&&"array"!==M.kind||"value"!==A.kind)if("color"!==M.kind&&"formatted"!==M.kind&&"resolvedImage"!==M.kind||"value"!==A.kind&&"string"!==A.kind)if("padding"!==M.kind||"value"!==A.kind&&"number"!==A.kind&&"array"!==A.kind){if(this.checkSubtype(M,A))return null}else C=f(C,M,u.typeAnnotation||"coerce");else C=f(C,M,u.typeAnnotation||"coerce");else C=f(C,M,u.typeAnnotation||"assert")}if(!(C instanceof $)&&"resolvedImage"!==C.type.kind&&Zh(C)){const M=new xe;try{C=new $(C.type,C.evaluate(M))}catch(A){return this.error(A.message),null}}return C}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,u,f){const _="number"==typeof o?this.path.concat(o):this.path,x=f?this.scope.concat(f):this.scope;return new Cr(this.registry,_,u||null,x,this.errors)}error(o,...u){const f=`${this.key}${u.map(_=>`[${_}]`).join("")}`;this.errors.push(new Ui(f,o))}checkSubtype(o,u){const f=lo(o,u);return f&&this.error(f),f}}var Ol=Cr;function Zh(l){if(l instanceof Ou)return Zh(l.boundExpression);if(l instanceof Me&&"error"===l.name||l instanceof je||l instanceof Ua)return!1;const o=l instanceof he||l instanceof ce;let u=!0;return l.eachChild(f=>{u=o?u&&Zh(f):u&&f instanceof $}),!!u&&Fu(l)&&sa(l,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ll(l,o){const u=l.length-1;let f,_,x=0,C=u,M=0;for(;x<=C;)if(M=Math.floor((x+C)/2),f=l[M],_=l[M+1],f<=o){if(M===u||o<_)return M;x=M+1}else{if(!(f>o))throw new K("Input is not a number.");C=M-1}return 0}class zn{constructor(o,u,f){this.type=o,this.input=u,this.labels=[],this.outputs=[];for(const[_,x]of f)this.labels.push(_),this.outputs.push(x)}static parse(o,u){if(o.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(o[1],1,rt);if(!f)return null;const _=[];let x=null;u.expectedType&&"value"!==u.expectedType.kind&&(x=u.expectedType);for(let C=1;C<o.length;C+=2){const M=1===C?-1/0:o[C],A=o[C+1],F=C,O=C+1;if("number"!=typeof M)return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(_.length&&_[_.length-1][0]>=M)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const B=u.parse(A,O,x);if(!B)return null;x=x||B.type,_.push([M,B])}return new zn(x,f,_)}evaluate(o){const u=this.labels,f=this.outputs;if(1===u.length)return f[0].evaluate(o);const _=this.input.evaluate(o);if(_<=u[0])return f[0].evaluate(o);const x=u.length;return _>=u[x-1]?f[x-1].evaluate(o):f[Ll(u,_)].evaluate(o)}eachChild(o){o(this.input);for(const u of this.outputs)o(u)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Kn(l,o,u){return l*(1-u)+o*u}var Mn=Object.freeze({__proto__:null,array:function(l,o,u){return l.map((f,_)=>Kn(f,o[_],u))},color:function(l,o,u){return new Sn(Kn(l.r,o.r,u),Kn(l.g,o.g,u),Kn(l.b,o.b,u),Kn(l.a,o.a,u))},number:Kn,padding:function(l,o,u){const f=l.values,_=o.values;return new $r([Kn(f[0],_[0],u),Kn(f[1],_[1],u),Kn(f[2],_[2],u),Kn(f[3],_[3],u)])}});const Jn=4/29,Mt=6/29,Nl=3*Mt*Mt,Ff=Math.PI/180,nt=180/Math.PI;function wn(l){return l>.008856451679035631?Math.pow(l,1/3):l/Nl+Jn}function $t(l){return l>Mt?l*l*l:Nl*(l-Jn)}function gn(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function Wh(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Of(l){const o=Wh(l.r),u=Wh(l.g),f=Wh(l.b),_=wn((.4124564*o+.3575761*u+.1804375*f)/.95047),x=wn((.2126729*o+.7151522*u+.072175*f)/1);return{l:116*x-16,a:500*(_-x),b:200*(x-wn((.0193339*o+.119192*u+.9503041*f)/1.08883)),alpha:l.a}}function Xh(l){let o=(l.l+16)/116,u=isNaN(l.a)?o:o+l.a/500,f=isNaN(l.b)?o:o-l.b/200;return o=1*$t(o),u=.95047*$t(u),f=1.08883*$t(f),new Sn(gn(3.2404542*u-1.5371385*o-.4985314*f),gn(-.969266*u+1.8760108*o+.041556*f),gn(.0556434*u-.2040259*o+1.0572252*f),l.alpha)}function Nu(l,o,u){const f=o-l;return l+u*(f>180||f<-180?f-360*Math.round(f/360):f)}const Yr={forward:Of,reverse:Xh,interpolate:function(l,o,u){return{l:Kn(l.l,o.l,u),a:Kn(l.a,o.a,u),b:Kn(l.b,o.b,u),alpha:Kn(l.alpha,o.alpha,u)}}},Lc={forward:function(l){const{l:o,a:u,b:f}=Of(l),_=Math.atan2(f,u)*nt;return{h:_<0?_+360:_,c:Math.sqrt(u*u+f*f),l:o,alpha:l.a}},reverse:function(l){const o=l.h*Ff,u=l.c;return Xh({l:l.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:l.alpha})},interpolate:function(l,o,u){return{h:Nu(l.h,o.h,u),c:Kn(l.c,o.c,u),l:Kn(l.l,o.l,u),alpha:Kn(l.alpha,o.alpha,u)}}};var Lf=Object.freeze({__proto__:null,hcl:Lc,lab:Yr});class Io{constructor(o,u,f,_,x){this.type=o,this.operator=u,this.interpolation=f,this.input=_,this.labels=[],this.outputs=[];for(const[C,M]of x)this.labels.push(C),this.outputs.push(M)}static interpolationFactor(o,u,f,_){let x=0;if("exponential"===o.name)x=Zo(u,o.base,f,_);else if("linear"===o.name)x=Zo(u,1,f,_);else if("cubic-bezier"===o.name){const C=o.controlPoints;x=new wr(C[0],C[1],C[2],C[3]).solve(Zo(u,1,f,_))}return x}static parse(o,u){let[f,_,x,...C]=o;if(!Array.isArray(_)||0===_.length)return u.error("Expected an interpolation type expression.",1);if("linear"===_[0])_={name:"linear"};else if("exponential"===_[0]){const F=_[1];if("number"!=typeof F)return u.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:F}}else{if("cubic-bezier"!==_[0])return u.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const F=_.slice(1);if(4!==F.length||F.some(O=>"number"!=typeof O||O<0||O>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:F}}}if(o.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(x=u.parse(x,2,rt),!x)return null;const M=[];let A=null;"interpolate-hcl"===f||"interpolate-lab"===f?A=so:u.expectedType&&"value"!==u.expectedType.kind&&(A=u.expectedType);for(let F=0;F<C.length;F+=2){const O=C[F],B=C[F+1],H=F+3,q=F+4;if("number"!=typeof O)return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(M.length&&M[M.length-1][0]>=O)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const W=u.parse(B,q,A);if(!W)return null;A=A||W.type,M.push([O,W])}return"number"===A.kind||"color"===A.kind||"padding"===A.kind||"array"===A.kind&&"number"===A.itemType.kind&&"number"==typeof A.N?new Io(A,f,_,x,M):u.error(`Type ${Nn(A)} is not interpolatable.`)}evaluate(o){const u=this.labels,f=this.outputs;if(1===u.length)return f[0].evaluate(o);const _=this.input.evaluate(o);if(_<=u[0])return f[0].evaluate(o);const x=u.length;if(_>=u[x-1])return f[x-1].evaluate(o);const C=Ll(u,_),M=Io.interpolationFactor(this.interpolation,_,u[C],u[C+1]),A=f[C].evaluate(o),F=f[C+1].evaluate(o);return"interpolate"===this.operator?Mn[this.type.kind.toLowerCase()](A,F,M):"interpolate-hcl"===this.operator?Lc.reverse(Lc.interpolate(Lc.forward(A),Lc.forward(F),M)):Yr.reverse(Yr.interpolate(Yr.forward(A),Yr.forward(F),M))}eachChild(o){o(this.input);for(const u of this.outputs)o(u)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Zo(l,o,u,f){const _=f-u,x=l-u;return 0===_?0:1===o?x/_:(Math.pow(o,x)-1)/(Math.pow(o,_)-1)}class Yh{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expectected at least one argument.");let f=null;const _=u.expectedType;_&&"value"!==_.kind&&(f=_);const x=[];for(const M of o.slice(1)){const A=u.parse(M,1+x.length,f,void 0,{typeAnnotation:"omit"});if(!A)return null;f=f||A.type,x.push(A)}if(!f)throw new Error("No output type");const C=_&&x.some(M=>lo(_,M.type));return new Yh(C?At:f,x)}evaluate(o){let u,f=null,_=0;for(const x of this.args)if(_++,f=x.evaluate(o),f&&f instanceof mi&&!f.available&&(u||(u=f.name),f=null,_===this.args.length&&(f=u)),null!==f)break;return f}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}class zu{constructor(o,u){this.type=u.type,this.bindings=[].concat(o),this.result=u}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const u of this.bindings)o(u[1]);o(this.result)}static parse(o,u){if(o.length<4)return u.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const f=[];for(let x=1;x<o.length-1;x+=2){const C=o[x];if("string"!=typeof C)return u.error(`Expected string, but found ${typeof C} instead.`,x);if(/[^a-zA-Z0-9_]/.test(C))return u.error("Variable names must contain only alphanumeric characters or '_'.",x);const M=u.parse(o[x+1],x+1);if(!M)return null;f.push([C,M])}const _=u.parse(o[o.length-1],o.length-1,u.expectedType,f);return _?new zu(f,_):null}outputDefined(){return this.result.outputDefined()}}class Kh{constructor(o,u,f){this.type=o,this.index=u,this.input=f}static parse(o,u){if(3!==o.length)return u.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,rt),_=u.parse(o[2],2,$i(u.expectedType||At));return f&&_?new Kh(_.type.itemType,f,_):null}evaluate(o){const u=this.index.evaluate(o),f=this.input.evaluate(o);if(u<0)throw new K(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new K(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new K(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}}class Nf{constructor(o,u){this.type=jt,this.needle=o,this.haystack=u}static parse(o,u){if(3!==o.length)return u.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,At),_=u.parse(o[2],2,At);return f&&_?Rl(f.type,[jt,Jt,rt,fs,At])?new Nf(f,_):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nn(f.type)} instead`):null}evaluate(o){const u=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!f)return!1;if(!pn(u,["boolean","string","number","null"]))throw new K(`Expected first argument to be of type boolean, string, number or null, but found ${Nn(J(u))} instead.`);if(!pn(f,["string","array"]))throw new K(`Expected second argument to be of type array or string, but found ${Nn(J(f))} instead.`);return f.indexOf(u)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}}class Bu{constructor(o,u,f){this.type=rt,this.needle=o,this.haystack=u,this.fromIndex=f}static parse(o,u){if(o.length<=2||o.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,At),_=u.parse(o[2],2,At);if(!f||!_)return null;if(!Rl(f.type,[jt,Jt,rt,fs,At]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nn(f.type)} instead`);if(4===o.length){const x=u.parse(o[3],3,rt);return x?new Bu(f,_,x):null}return new Bu(f,_)}evaluate(o){const u=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!pn(u,["boolean","string","number","null"]))throw new K(`Expected first argument to be of type boolean, string, number or null, but found ${Nn(J(u))} instead.`);if(!pn(f,["string","array"]))throw new K(`Expected second argument to be of type array or string, but found ${Nn(J(f))} instead.`);if(this.fromIndex){const _=this.fromIndex.evaluate(o);return f.indexOf(u,_)}return f.indexOf(u)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}}class Vu{constructor(o,u,f,_,x,C){this.inputType=o,this.type=u,this.input=f,this.cases=_,this.outputs=x,this.otherwise=C}static parse(o,u){if(o.length<5)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return u.error("Expected an even number of arguments.");let f,_;u.expectedType&&"value"!==u.expectedType.kind&&(_=u.expectedType);const x={},C=[];for(let F=2;F<o.length-1;F+=2){let O=o[F];const B=o[F+1];Array.isArray(O)||(O=[O]);const H=u.concat(F);if(0===O.length)return H.error("Expected at least one branch label.");for(const W of O){if("number"!=typeof W&&"string"!=typeof W)return H.error("Branch labels must be numbers or strings.");if("number"==typeof W&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof W&&Math.floor(W)!==W)return H.error("Numeric branch labels must be integer values.");if(f){if(H.checkSubtype(f,J(W)))return null}else f=J(W);if(void 0!==x[String(W)])return H.error("Branch labels must be unique.");x[String(W)]=C.length}const q=u.parse(B,F,_);if(!q)return null;_=_||q.type,C.push(q)}const M=u.parse(o[1],1,At);if(!M)return null;const A=u.parse(o[o.length-1],o.length-1,_);return A?"value"!==M.type.kind&&u.concat(1).checkSubtype(f,M.type)?null:new Vu(f,_,M,x,C,A):null}evaluate(o){const u=this.input.evaluate(o);return(J(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}}class Jh{constructor(o,u,f){this.type=o,this.branches=u,this.otherwise=f}static parse(o,u){if(o.length<4)return u.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&"value"!==u.expectedType.kind&&(f=u.expectedType);const _=[];for(let C=1;C<o.length-1;C+=2){const M=u.parse(o[C],C,jt);if(!M)return null;const A=u.parse(o[C+1],C+1,f);if(!A)return null;_.push([M,A]),f=f||A.type}const x=u.parse(o[o.length-1],o.length-1,f);if(!x)return null;if(!f)throw new Error("Can't infer output type");return new Jh(f,_,x)}evaluate(o){for(const[u,f]of this.branches)if(u.evaluate(o))return f.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[u,f]of this.branches)o(u),o(f);o(this.otherwise)}outputDefined(){return this.branches.every(([o,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class Qh{constructor(o,u,f,_){this.type=o,this.input=u,this.beginIndex=f,this.endIndex=_}static parse(o,u){if(o.length<=2||o.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,At),_=u.parse(o[2],2,rt);if(!f||!_)return null;if(!Rl(f.type,[$i(At),Jt,At]))return u.error(`Expected first argument to be of type array or string, but found ${Nn(f.type)} instead`);if(4===o.length){const x=u.parse(o[3],3,rt);return x?new Qh(f.type,f,_,x):null}return new Qh(f.type,f,_)}evaluate(o){const u=this.input.evaluate(o),f=this.beginIndex.evaluate(o);if(!pn(u,["string","array"]))throw new K(`Expected first argument to be of type array or string, but found ${Nn(J(u))} instead.`);if(this.endIndex){const _=this.endIndex.evaluate(o);return u.slice(f,_)}return u.slice(f)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}}function ji(l,o){return"=="===l||"!="===l?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function Rn(l,o,u,f){return 0===f.compare(o,u)}function zl(l,o,u){const f="=="!==l&&"!="!==l;return class xz{constructor(x,C,M){this.type=jt,this.lhs=x,this.rhs=C,this.collator=M,this.hasUntypedArgument="value"===x.type.kind||"value"===C.type.kind}static parse(x,C){if(3!==x.length&&4!==x.length)return C.error("Expected two or three arguments.");const M=x[0];let A=C.parse(x[1],1,At);if(!A)return null;if(!ji(M,A.type))return C.concat(1).error(`"${M}" comparisons are not supported for type '${Nn(A.type)}'.`);let F=C.parse(x[2],2,At);if(!F)return null;if(!ji(M,F.type))return C.concat(2).error(`"${M}" comparisons are not supported for type '${Nn(F.type)}'.`);if(A.type.kind!==F.type.kind&&"value"!==A.type.kind&&"value"!==F.type.kind)return C.error(`Cannot compare types '${Nn(A.type)}' and '${Nn(F.type)}'.`);f&&("value"===A.type.kind&&"value"!==F.type.kind?A=new ce(F.type,[A]):"value"!==A.type.kind&&"value"===F.type.kind&&(F=new ce(A.type,[F])));let O=null;if(4===x.length){if("string"!==A.type.kind&&"string"!==F.type.kind&&"value"!==A.type.kind&&"value"!==F.type.kind)return C.error("Cannot use collator to compare non-string types.");if(O=C.parse(x[3],3,Ls),!O)return null}return new xz(A,F,O)}evaluate(x){const C=this.lhs.evaluate(x),M=this.rhs.evaluate(x);if(f&&this.hasUntypedArgument){const A=J(C),F=J(M);if(A.kind!==F.kind||"string"!==A.kind&&"number"!==A.kind)throw new K(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${A.kind}, ${F.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const A=J(C),F=J(M);if("string"!==A.kind||"string"!==F.kind)return o(x,C,M)}return this.collator?u(x,C,M,this.collator.evaluate(x)):o(x,C,M)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const M_=zl("==",function(l,o,u){return o===u},Rn),T_=zl("!=",function(l,o,u){return o!==u},function(l,o,u,f){return!Rn(0,o,u,f)}),zt=zl("<",function(l,o,u){return o<u},function(l,o,u,f){return f.compare(o,u)<0}),zm=zl(">",function(l,o,u){return o>u},function(l,o,u,f){return f.compare(o,u)>0}),Di=zl("<=",function(l,o,u){return o<=u},function(l,o,u,f){return f.compare(o,u)<=0}),Uu=zl(">=",function(l,o,u){return o>=u},function(l,o,u,f){return f.compare(o,u)>=0});class ed{constructor(o,u,f,_,x){this.type=Jt,this.number=o,this.locale=u,this.currency=f,this.minFractionDigits=_,this.maxFractionDigits=x}static parse(o,u){if(3!==o.length)return u.error("Expected two arguments.");const f=u.parse(o[1],1,rt);if(!f)return null;const _=o[2];if("object"!=typeof _||Array.isArray(_))return u.error("NumberFormat options argument must be an object.");let x=null;if(_.locale&&(x=u.parse(_.locale,1,Jt),!x))return null;let C=null;if(_.currency&&(C=u.parse(_.currency,1,Jt),!C))return null;let M=null;if(_["min-fraction-digits"]&&(M=u.parse(_["min-fraction-digits"],1,rt),!M))return null;let A=null;return _["max-fraction-digits"]&&(A=u.parse(_["max-fraction-digits"],1,rt),!A)?null:new ed(f,x,C,M,A)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}}class Nc{constructor(o){this.type=Ei,this.sections=o}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");const f=o[1];if(!Array.isArray(f)&&"object"==typeof f)return u.error("First argument must be an image or text section.");const _=[];let x=!1;for(let C=1;C<=o.length-1;++C){const M=o[C];if(x&&"object"==typeof M&&!Array.isArray(M)){x=!1;let A=null;if(M["font-scale"]&&(A=u.parse(M["font-scale"],1,rt),!A))return null;let F=null;if(M["text-font"]&&(F=u.parse(M["text-font"],1,$i(Jt)),!F))return null;let O=null;if(M["text-color"]&&(O=u.parse(M["text-color"],1,so),!O))return null;const B=_[_.length-1];B.scale=A,B.font=F,B.textColor=O}else{const A=u.parse(o[C],1,At);if(!A)return null;const F=A.type.kind;if("string"!==F&&"value"!==F&&"null"!==F&&"resolvedImage"!==F)return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,_.push({content:A,scale:null,font:null,textColor:null})}}return new Nc(_)}evaluate(o){return new Xr(this.sections.map(u=>{const f=u.content.evaluate(o);return J(f)===ao?new co("",f,null,null,null):new co(V(f),null,u.scale?u.scale.evaluate(o):null,u.font?u.font.evaluate(o).join(","):null,u.textColor?u.textColor.evaluate(o):null)}))}eachChild(o){for(const u of this.sections)o(u.content),u.scale&&o(u.scale),u.font&&o(u.font),u.textColor&&o(u.textColor)}outputDefined(){return!1}}class td{constructor(o){this.type=ao,this.input=o}static parse(o,u){if(2!==o.length)return u.error("Expected two arguments.");const f=u.parse(o[1],1,Jt);return f?new td(f):u.error("No image name provided.")}evaluate(o){const u=this.input.evaluate(o),f=mi.fromString(u);return f&&o.availableImages&&(f.available=o.availableImages.indexOf(u)>-1),f}eachChild(o){o(this.input)}outputDefined(){return!1}}class nd{constructor(o){this.type=rt,this.input=o}static parse(o,u){if(2!==o.length)return u.error(`Expected 1 argument, but found ${o.length-1} instead.`);const f=u.parse(o[1],1);return f?"array"!==f.type.kind&&"string"!==f.type.kind&&"value"!==f.type.kind?u.error(`Expected argument of type string or array, but found ${Nn(f.type)} instead.`):new nd(f):null}evaluate(o){const u=this.input.evaluate(o);if("string"==typeof u||Array.isArray(u))return u.length;throw new K(`Expected value to be of type string or array, but found ${Nn(J(u))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}}const ja={"==":M_,"!=":T_,">":zm,"<":zt,">=":Uu,"<=":Di,array:ce,at:Kh,boolean:ce,case:Jh,coalesce:Yh,collator:je,format:Nc,image:td,in:Nf,"index-of":Bu,interpolate:Io,"interpolate-hcl":Io,"interpolate-lab":Io,length:nd,let:zu,literal:$,match:Vu,number:ce,"number-format":ed,object:ce,slice:Qh,step:zn,string:ce,"to-boolean":he,"to-color":he,"to-number":he,"to-string":he,var:Ou,within:Ua};function mn(l,[o,u,f,_]){o=o.evaluate(l),u=u.evaluate(l),f=f.evaluate(l);const x=_?_.evaluate(l):1,C=gi(o,u,f,x);if(C)throw new K(C);return new Sn(o/255*x,u/255*x,f/255*x,x)}function $u(l,o){return l in o}function ju(l,o){const u=o[l];return void 0===u?null:u}function Ha(l){return{type:l}}function Rt(l){return{result:"success",value:l}}function aa(l){return{result:"error",value:l}}function Bl(l){return"data-driven"===l["property-type"]||"cross-faded-data-driven"===l["property-type"]}function uo(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function Hu(l){return!!l.expression&&l.expression.interpolated}function Un(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":null===l?"null":typeof l}function Wo(l){return"object"==typeof l&&null!==l&&!Array.isArray(l)}function Xo(l){return l}function Bm(l,o){const u="color"===o.type,f=l.stops&&"object"==typeof l.stops[0][0],_=f||!(f||void 0!==l.property),x=l.type||(Hu(o)?"exponential":"interval");if(u||"padding"===o.type){const F=u?Sn.parse:$r.parse;(l=Vi({},l)).stops&&(l.stops=l.stops.map(O=>[O[0],F(O[1])])),l.default=F(l.default?l.default:o.default)}if(l.colorSpace&&"rgb"!==l.colorSpace&&!Lf[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let C,M,A;if("exponential"===x)C=Vm;else if("interval"===x)C=nr;else if("categorical"===x){C=ms,M=Object.create(null);for(const F of l.stops)M[F[0]]=F[1];A=typeof l.stops[0][0]}else{if("identity"!==x)throw new Error(`Unknown function type "${x}"`);C=I_}if(f){const F={},O=[];for(let q=0;q<l.stops.length;q++){const W=l.stops[q],se=W[0].zoom;void 0===F[se]&&(F[se]={zoom:se,type:l.type,property:l.property,default:l.default,stops:[]},O.push(se)),F[se].stops.push([W[0].value,W[1]])}const B=[];for(const q of O)B.push([F[q].zoom,Bm(F[q],o)]);const H={name:"linear"};return{kind:"composite",interpolationType:H,interpolationFactor:Io.interpolationFactor.bind(void 0,H),zoomStops:B.map(q=>q[0]),evaluate:({zoom:q},W)=>Vm({stops:B,base:l.base},o,q).evaluate(q,W)}}if(_){const F="exponential"===x?{name:"exponential",base:void 0!==l.base?l.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:Io.interpolationFactor.bind(void 0,F),zoomStops:l.stops.map(O=>O[0]),evaluate:({zoom:O})=>C(l,o,O,M,A)}}return{kind:"source",evaluate(F,O){const B=O&&O.properties?O.properties[l.property]:void 0;return void 0===B?Gu(l.default,o.default):C(l,o,B,M,A)}}}function Gu(l,o,u){return void 0!==l?l:void 0!==o?o:void 0!==u?u:void 0}function ms(l,o,u,f,_){return Gu(typeof u===_?f[u]:void 0,l.default,o.default)}function nr(l,o,u){if("number"!==Un(u))return Gu(l.default,o.default);const f=l.stops.length;if(1===f||u<=l.stops[0][0])return l.stops[0][1];if(u>=l.stops[f-1][0])return l.stops[f-1][1];const _=Ll(l.stops.map(x=>x[0]),u);return l.stops[_][1]}function Vm(l,o,u){const f=void 0!==l.base?l.base:1;if("number"!==Un(u))return Gu(l.default,o.default);const _=l.stops.length;if(1===_||u<=l.stops[0][0])return l.stops[0][1];if(u>=l.stops[_-1][0])return l.stops[_-1][1];const x=Ll(l.stops.map(O=>O[0]),u),C=function(O,B,H,q){const W=q-H,se=O-H;return 0===W?0:1===B?se/W:(Math.pow(B,se)-1)/(Math.pow(B,W)-1)}(u,f,l.stops[x][0],l.stops[x+1][0]),M=l.stops[x][1],A=l.stops[x+1][1];let F=Mn[o.type]||Xo;if(l.colorSpace&&"rgb"!==l.colorSpace){const O=Lf[l.colorSpace];F=(B,H)=>O.reverse(O.interpolate(O.forward(B),O.forward(H),C))}return"function"==typeof M.evaluate?{evaluate(...O){const B=M.evaluate.apply(void 0,O),H=A.evaluate.apply(void 0,O);if(void 0!==B&&void 0!==H)return F(B,H,C)}}:F(M,A,C)}function I_(l,o,u){switch(o.type){case"color":u=Sn.parse(u);break;case"formatted":u=Xr.fromString(u.toString());break;case"resolvedImage":u=mi.fromString(u.toString());break;case"padding":u=$r.parse(u);break;default:Un(u)===o.type||"enum"===o.type&&o.values[u]||(u=void 0)}return Gu(u,l.default,o.default)}Me.register(ja,{error:[{kind:"error"},[Jt],(l,[o])=>{throw new K(o.evaluate(l))}],typeof:[Jt,[At],(l,[o])=>Nn(J(o.evaluate(l)))],"to-rgba":[$i(rt,4),[so],(l,[o])=>o.evaluate(l).toArray()],rgb:[so,[rt,rt,rt],mn],rgba:[so,[rt,rt,rt,rt],mn],has:{type:jt,overloads:[[[Jt],(l,[o])=>$u(o.evaluate(l),l.properties())],[[Jt,ps],(l,[o,u])=>$u(o.evaluate(l),u.evaluate(l))]]},get:{type:At,overloads:[[[Jt],(l,[o])=>ju(o.evaluate(l),l.properties())],[[Jt,ps],(l,[o,u])=>ju(o.evaluate(l),u.evaluate(l))]]},"feature-state":[At,[Jt],(l,[o])=>ju(o.evaluate(l),l.featureState||{})],properties:[ps,[],l=>l.properties()],"geometry-type":[Jt,[],l=>l.geometryType()],id:[At,[],l=>l.id()],zoom:[rt,[],l=>l.globals.zoom],"heatmap-density":[rt,[],l=>l.globals.heatmapDensity||0],"line-progress":[rt,[],l=>l.globals.lineProgress||0],accumulated:[At,[],l=>void 0===l.globals.accumulated?null:l.globals.accumulated],"+":[rt,Ha(rt),(l,o)=>{let u=0;for(const f of o)u+=f.evaluate(l);return u}],"*":[rt,Ha(rt),(l,o)=>{let u=1;for(const f of o)u*=f.evaluate(l);return u}],"-":{type:rt,overloads:[[[rt,rt],(l,[o,u])=>o.evaluate(l)-u.evaluate(l)],[[rt],(l,[o])=>-o.evaluate(l)]]},"/":[rt,[rt,rt],(l,[o,u])=>o.evaluate(l)/u.evaluate(l)],"%":[rt,[rt,rt],(l,[o,u])=>o.evaluate(l)%u.evaluate(l)],ln2:[rt,[],()=>Math.LN2],pi:[rt,[],()=>Math.PI],e:[rt,[],()=>Math.E],"^":[rt,[rt,rt],(l,[o,u])=>Math.pow(o.evaluate(l),u.evaluate(l))],sqrt:[rt,[rt],(l,[o])=>Math.sqrt(o.evaluate(l))],log10:[rt,[rt],(l,[o])=>Math.log(o.evaluate(l))/Math.LN10],ln:[rt,[rt],(l,[o])=>Math.log(o.evaluate(l))],log2:[rt,[rt],(l,[o])=>Math.log(o.evaluate(l))/Math.LN2],sin:[rt,[rt],(l,[o])=>Math.sin(o.evaluate(l))],cos:[rt,[rt],(l,[o])=>Math.cos(o.evaluate(l))],tan:[rt,[rt],(l,[o])=>Math.tan(o.evaluate(l))],asin:[rt,[rt],(l,[o])=>Math.asin(o.evaluate(l))],acos:[rt,[rt],(l,[o])=>Math.acos(o.evaluate(l))],atan:[rt,[rt],(l,[o])=>Math.atan(o.evaluate(l))],min:[rt,Ha(rt),(l,o)=>Math.min(...o.map(u=>u.evaluate(l)))],max:[rt,Ha(rt),(l,o)=>Math.max(...o.map(u=>u.evaluate(l)))],abs:[rt,[rt],(l,[o])=>Math.abs(o.evaluate(l))],round:[rt,[rt],(l,[o])=>{const u=o.evaluate(l);return u<0?-Math.round(-u):Math.round(u)}],floor:[rt,[rt],(l,[o])=>Math.floor(o.evaluate(l))],ceil:[rt,[rt],(l,[o])=>Math.ceil(o.evaluate(l))],"filter-==":[jt,[Jt,At],(l,[o,u])=>l.properties()[o.value]===u.value],"filter-id-==":[jt,[At],(l,[o])=>l.id()===o.value],"filter-type-==":[jt,[Jt],(l,[o])=>l.geometryType()===o.value],"filter-<":[jt,[Jt,At],(l,[o,u])=>{const f=l.properties()[o.value],_=u.value;return typeof f==typeof _&&f<_}],"filter-id-<":[jt,[At],(l,[o])=>{const u=l.id(),f=o.value;return typeof u==typeof f&&u<f}],"filter->":[jt,[Jt,At],(l,[o,u])=>{const f=l.properties()[o.value],_=u.value;return typeof f==typeof _&&f>_}],"filter-id->":[jt,[At],(l,[o])=>{const u=l.id(),f=o.value;return typeof u==typeof f&&u>f}],"filter-<=":[jt,[Jt,At],(l,[o,u])=>{const f=l.properties()[o.value],_=u.value;return typeof f==typeof _&&f<=_}],"filter-id-<=":[jt,[At],(l,[o])=>{const u=l.id(),f=o.value;return typeof u==typeof f&&u<=f}],"filter->=":[jt,[Jt,At],(l,[o,u])=>{const f=l.properties()[o.value],_=u.value;return typeof f==typeof _&&f>=_}],"filter-id->=":[jt,[At],(l,[o])=>{const u=l.id(),f=o.value;return typeof u==typeof f&&u>=f}],"filter-has":[jt,[At],(l,[o])=>o.value in l.properties()],"filter-has-id":[jt,[],l=>null!==l.id()&&void 0!==l.id()],"filter-type-in":[jt,[$i(Jt)],(l,[o])=>o.value.indexOf(l.geometryType())>=0],"filter-id-in":[jt,[$i(At)],(l,[o])=>o.value.indexOf(l.id())>=0],"filter-in-small":[jt,[Jt,$i(At)],(l,[o,u])=>u.value.indexOf(l.properties()[o.value])>=0],"filter-in-large":[jt,[Jt,$i(At)],(l,[o,u])=>function(f,_,x,C){for(;x<=C;){const M=x+C>>1;if(_[M]===f)return!0;_[M]>f?C=M-1:x=M+1}return!1}(l.properties()[o.value],u.value,0,u.value.length-1)],all:{type:jt,overloads:[[[jt,jt],(l,[o,u])=>o.evaluate(l)&&u.evaluate(l)],[Ha(jt),(l,o)=>{for(const u of o)if(!u.evaluate(l))return!1;return!0}]]},any:{type:jt,overloads:[[[jt,jt],(l,[o,u])=>o.evaluate(l)||u.evaluate(l)],[Ha(jt),(l,o)=>{for(const u of o)if(u.evaluate(l))return!0;return!1}]]},"!":[jt,[jt],(l,[o])=>!o.evaluate(l)],"is-supported-script":[jt,[Jt],(l,[o])=>{const u=l.globals&&l.globals.isSupportedScript;return!u||u(o.evaluate(l))}],upcase:[Jt,[Jt],(l,[o])=>o.evaluate(l).toUpperCase()],downcase:[Jt,[Jt],(l,[o])=>o.evaluate(l).toLowerCase()],concat:[Jt,Ha(At),(l,o)=>o.map(u=>V(u.evaluate(l))).join("")],"resolved-locale":[Jt,[Ls],(l,[o])=>o.evaluate(l).resolvedLocale()]});class la{constructor(o,u){var f;this.expression=o,this._warningHistory={},this._evaluator=new xe,this._defaultValue=u?"color"===(f=u).type&&Wo(f.default)?new Sn(0,0,0,0):"color"===f.type?Sn.parse(f.default)||null:"padding"===f.type?$r.parse(f.default)||null:void 0===f.default?null:f.default:null,this._enumValues=u&&"enum"===u.type?u.values:null}evaluateWithoutErrorHandling(o,u,f,_,x,C){return this._evaluator.globals=o,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=_,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=C,this.expression.evaluate(this._evaluator)}evaluate(o,u,f,_,x,C){this._evaluator.globals=o,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=_,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=C||null;try{const M=this.expression.evaluate(this._evaluator);if(null==M||"number"==typeof M&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new K(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function Cn(l){return Array.isArray(l)&&l.length>0&&"string"==typeof l[0]&&l[0]in ja}function Ga(l,o){const u=new Ol(ja,[],o?function(_){const x={color:so,string:Jt,number:rt,enum:Jt,boolean:jt,formatted:Ei,padding:ra,resolvedImage:ao};return"array"===_.type?$i(x[_.value]||At,_.length):x[_.type]}(o):void 0),f=u.parse(l,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return f?Rt(new la(f,o)):aa(u.errors)}class zc{constructor(o,u){this.kind=o,this._styleExpression=u,this.isStateDependent="constant"!==o&&!$a(u.expression)}evaluateWithoutErrorHandling(o,u,f,_,x,C){return this._styleExpression.evaluateWithoutErrorHandling(o,u,f,_,x,C)}evaluate(o,u,f,_,x,C){return this._styleExpression.evaluate(o,u,f,_,x,C)}}class Bc{constructor(o,u,f,_){this.kind=o,this.zoomStops=f,this._styleExpression=u,this.isStateDependent="camera"!==o&&!$a(u.expression),this.interpolationType=_}evaluateWithoutErrorHandling(o,u,f,_,x,C){return this._styleExpression.evaluateWithoutErrorHandling(o,u,f,_,x,C)}evaluate(o,u,f,_,x,C){return this._styleExpression.evaluate(o,u,f,_,x,C)}interpolationFactor(o,u,f){return this.interpolationType?Io.interpolationFactor(this.interpolationType,o,u,f):0}}function rd(l,o){const u=Ga(l,o);if("error"===u.result)return u;const f=u.value.expression,_=Fu(f);if(!_&&!Bl(o))return aa([new Ui("","data expressions not supported")]);const x=sa(f,["zoom"]);if(!x&&!uo(o))return aa([new Ui("","zoom expressions not supported")]);const C=ca(f);return C||x?C instanceof Ui?aa([C]):C instanceof Io&&!Hu(o)?aa([new Ui("",'"interpolate" expressions cannot be used with this property')]):Rt(C?new Bc(_?"camera":"composite",u.value,C.labels,C instanceof Io?C.interpolation:void 0):new zc(_?"constant":"source",u.value)):aa([new Ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ao{constructor(o,u){this._parameters=o,this._specification=u,Vi(this,Bm(this._parameters,this._specification))}static deserialize(o){return new Ao(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function ca(l){let o=null;if(l instanceof zu)o=ca(l.result);else if(l instanceof Yh){for(const u of l.args)if(o=ca(u),o)break}else(l instanceof zn||l instanceof Io)&&l.input instanceof Me&&"zoom"===l.input.name&&(o=l);return o instanceof Ui||l.eachChild(u=>{const f=ca(u);f instanceof Ui?o=f:!o&&f?o=new Ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&f&&o!==f&&(o=new Ui("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}function ko(l){const o=l.key,u=l.value,f=l.valueSpec||{},_=l.objectElementValidators||{},x=l.style,C=l.styleSpec,M=l.validateSpec;let A=[];const F=Un(u);if("object"!==F)return[new Pe(o,u,`object expected, ${F} found`)];for(const O in u){const B=O.split(".")[0],H=f[B]||f["*"];let q;if(_[B])q=_[B];else if(f[B])q=M;else if(_["*"])q=_["*"];else{if(!f["*"]){A.push(new Pe(o,u[O],`unknown property "${O}"`));continue}q=M}A=A.concat(q({key:(o&&`${o}.`)+O,value:u[O],valueSpec:H,style:x,styleSpec:C,object:u,objectKey:O,validateSpec:M},u))}for(const O in f)_[O]||f[O].required&&void 0===f[O].default&&void 0===u[O]&&A.push(new Pe(o,u,`missing required property "${O}"`));return A}function zs(l){const o=l.value,u=l.valueSpec,f=l.style,_=l.styleSpec,x=l.key,C=l.arrayElementValidator||l.validateSpec;if("array"!==Un(o))return[new Pe(x,o,`array expected, ${Un(o)} found`)];if(u.length&&o.length!==u.length)return[new Pe(x,o,`array length ${u.length} expected, length ${o.length} found`)];if(u["min-length"]&&o.length<u["min-length"])return[new Pe(x,o,`array length at least ${u["min-length"]} expected, length ${o.length} found`)];let M={type:u.value,values:u.values};_.$version<7&&(M.function=u.function),"object"===Un(u.value)&&(M=u.value);let A=[];for(let F=0;F<o.length;F++)A=A.concat(C({array:o,arrayIndex:F,value:o[F],valueSpec:M,validateSpec:l.validateSpec,style:f,styleSpec:_,key:`${x}[${F}]`}));return A}function id(l){const o=l.key,u=l.value,f=l.valueSpec;let _=Un(u);return"number"===_&&u!=u&&(_="NaN"),"number"!==_?[new Pe(o,u,`number expected, ${_} found`)]:"minimum"in f&&u<f.minimum?[new Pe(o,u,`${u} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&u>f.maximum?[new Pe(o,u,`${u} is greater than the maximum value ${f.maximum}`)]:[]}function od(l){const o=l.valueSpec,u=Vn(l.value.type);let f,_,x,C={};const M="categorical"!==u&&void 0===l.value.property,A=!M,F="array"===Un(l.value.stops)&&"array"===Un(l.value.stops[0])&&"object"===Un(l.value.stops[0][0]),O=ko({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(q){if("identity"===u)return[new Pe(q.key,q.value,'identity function may not have a "stops" property')];let W=[];const se=q.value;return W=W.concat(zs({key:q.key,value:se,valueSpec:q.valueSpec,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:B})),"array"===Un(se)&&0===se.length&&W.push(new Pe(q.key,se,"array must have at least one stop")),W},default:function(q){return q.validateSpec({key:q.key,value:q.value,valueSpec:o,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec})}}});return"identity"===u&&M&&O.push(new Pe(l.key,l.value,'missing required property "property"')),"identity"===u||l.value.stops||O.push(new Pe(l.key,l.value,'missing required property "stops"')),"exponential"===u&&l.valueSpec.expression&&!Hu(l.valueSpec)&&O.push(new Pe(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(A&&!Bl(l.valueSpec)?O.push(new Pe(l.key,l.value,"property functions not supported")):M&&!uo(l.valueSpec)&&O.push(new Pe(l.key,l.value,"zoom functions not supported"))),"categorical"!==u&&!F||void 0!==l.value.property||O.push(new Pe(l.key,l.value,'"property" property is required')),O;function B(q){let W=[];const se=q.value,oe=q.key;if("array"!==Un(se))return[new Pe(oe,se,`array expected, ${Un(se)} found`)];if(2!==se.length)return[new Pe(oe,se,`array length 2 expected, length ${se.length} found`)];if(F){if("object"!==Un(se[0]))return[new Pe(oe,se,`object expected, ${Un(se[0])} found`)];if(void 0===se[0].zoom)return[new Pe(oe,se,"object stop key must have zoom")];if(void 0===se[0].value)return[new Pe(oe,se,"object stop key must have value")];if(x&&x>Vn(se[0].zoom))return[new Pe(oe,se[0].zoom,"stop zoom values must appear in ascending order")];Vn(se[0].zoom)!==x&&(x=Vn(se[0].zoom),_=void 0,C={}),W=W.concat(ko({key:`${oe}[0]`,value:se[0],valueSpec:{zoom:{}},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:id,value:H}}))}else W=W.concat(H({key:`${oe}[0]`,value:se[0],valueSpec:{},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec},se));return Cn(ds(se[1]))?W.concat([new Pe(`${oe}[1]`,se[1],"expressions are not allowed in function stops.")]):W.concat(q.validateSpec({key:`${oe}[1]`,value:se[1],valueSpec:o,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec}))}function H(q,W){const se=Un(q.value),oe=Vn(q.value),be=null!==q.value?q.value:W;if(f){if(se!==f)return[new Pe(q.key,be,`${se} stop domain type must match previous stop domain type ${f}`)]}else f=se;if("number"!==se&&"string"!==se&&"boolean"!==se)return[new Pe(q.key,be,"stop domain value must be a number, string, or boolean")];if("number"!==se&&"categorical"!==u){let Ce=`number expected, ${se} found`;return Bl(o)&&void 0===u&&(Ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pe(q.key,be,Ce)]}return"categorical"!==u||"number"!==se||isFinite(oe)&&Math.floor(oe)===oe?"categorical"!==u&&"number"===se&&void 0!==_&&oe<_?[new Pe(q.key,be,"stop domain values must appear in ascending order")]:(_=oe,"categorical"===u&&oe in C?[new Pe(q.key,be,"stop domain values must be unique")]:(C[oe]=!0,[])):[new Pe(q.key,be,`integer expected, found ${oe}`)]}}function qa(l){const o=("property"===l.expressionContext?rd:Ga)(ds(l.value),l.valueSpec);if("error"===o.result)return o.value.map(f=>new Pe(`${l.key}${f.key}`,l.value,f.message));const u=o.value.expression||o.value._styleExpression.expression;if("property"===l.expressionContext&&"text-font"===l.propertyKey&&!u.outputDefined())return[new Pe(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===l.expressionContext&&"layout"===l.propertyType&&!$a(u))return[new Pe(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===l.expressionContext&&!$a(u))return[new Pe(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&0===l.expressionContext.indexOf("cluster")){if(!sa(u,["zoom","feature-state"]))return[new Pe(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===l.expressionContext&&!Fu(u))return[new Pe(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function li(l){const o=l.key,u=l.value,f=l.valueSpec,_=[];return Array.isArray(f.values)?-1===f.values.indexOf(Vn(u))&&_.push(new Pe(o,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):-1===Object.keys(f.values).indexOf(Vn(u))&&_.push(new Pe(o,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),_}function qu(l){if(!0===l||!1===l)return!0;if(!Array.isArray(l)||0===l.length)return!1;switch(l[0]){case"has":return l.length>=2&&"$id"!==l[1]&&"$type"!==l[1];case"in":return l.length>=3&&("string"!=typeof l[1]||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==l.length||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const o of l.slice(1))if(!qu(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}const zf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ot(l){if(null==l)return{filter:()=>!0,needGeometry:!1};qu(l)||(l=Kr(l));const o=Ga(l,zf);if("error"===o.result)throw new Error(o.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,f,_)=>o.value.evaluate(u,f,{},_),needGeometry:Lt(l)}}function Hi(l,o){return l<o?-1:l>o?1:0}function Lt(l){if(!Array.isArray(l))return!1;if("within"===l[0])return!0;for(let o=1;o<l.length;o++)if(Lt(l[o]))return!0;return!1}function Kr(l){if(!l)return!0;const o=l[0];return l.length<=1?"any"!==o:"=="===o?kt(l[1],l[2],"=="):"!="===o?nn(kt(l[1],l[2],"==")):"<"===o||">"===o||"<="===o||">="===o?kt(l[1],l[2],o):"any"===o?(u=l.slice(1),["any"].concat(u.map(Kr))):"all"===o?["all"].concat(l.slice(1).map(Kr)):"none"===o?["all"].concat(l.slice(1).map(Kr).map(nn)):"in"===o?Bs(l[1],l.slice(2)):"!in"===o?nn(Bs(l[1],l.slice(2))):"has"===o?cn(l[1]):"!has"===o?nn(cn(l[1])):"within"!==o||l;var u}function kt(l,o,u){switch(l){case"$type":return[`filter-type-${u}`,o];case"$id":return[`filter-id-${u}`,o];default:return[`filter-${u}`,l,o]}}function Bs(l,o){if(0===o.length)return!1;switch(l){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(u=>typeof u!=typeof o[0])?["filter-in-large",l,["literal",o.sort(Hi)]]:["filter-in-small",l,["literal",o]]}}function cn(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function nn(l){return["!",l]}function ut(l){return qu(ds(l.value))?qa(Vi({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Wt(l)}function Wt(l){const o=l.value,u=l.key;if("array"!==Un(o))return[new Pe(u,o,`array expected, ${Un(o)} found`)];const f=l.styleSpec;let _,x=[];if(o.length<1)return[new Pe(u,o,"filter array must have at least 1 element")];switch(x=x.concat(li({key:`${u}[0]`,value:o[0],valueSpec:f.filter_operator,style:l.style,styleSpec:l.styleSpec})),Vn(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===Vn(o[1])&&x.push(new Pe(u,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&x.push(new Pe(u,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(_=Un(o[1]),"string"!==_&&x.push(new Pe(`${u}[1]`,o[1],`string expected, ${_} found`)));for(let C=2;C<o.length;C++)_=Un(o[C]),"$type"===Vn(o[1])?x=x.concat(li({key:`${u}[${C}]`,value:o[C],valueSpec:f.geometry_type,style:l.style,styleSpec:l.styleSpec})):"string"!==_&&"number"!==_&&"boolean"!==_&&x.push(new Pe(`${u}[${C}]`,o[C],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let C=1;C<o.length;C++)x=x.concat(Wt({key:`${u}[${C}]`,value:o[C],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":_=Un(o[1]),2!==o.length?x.push(new Pe(u,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==_&&x.push(new Pe(`${u}[1]`,o[1],`string expected, ${_} found`));break;case"within":_=Un(o[1]),2!==o.length?x.push(new Pe(u,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==_&&x.push(new Pe(`${u}[1]`,o[1],`object expected, ${_} found`))}return x}function cr(l,o){const u=l.key,f=l.validateSpec,_=l.style,x=l.styleSpec,C=l.value,M=l.objectKey,A=x[`${o}_${l.layerType}`];if(!A)return[];const F=M.match(/^(.*)-transition$/);if("paint"===o&&F&&A[F[1]]&&A[F[1]].transition)return f({key:u,value:C,valueSpec:x.transition,style:_,styleSpec:x});const O=l.valueSpec||A[M];if(!O)return[new Pe(u,C,`unknown property "${M}"`)];let B;if("string"===Un(C)&&Bl(O)&&!O.tokens&&(B=/^{([^}]+)}$/.exec(C)))return[new Pe(u,C,`"${M}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(B[1])} }\`.`)];const H=[];return"symbol"===l.layerType&&("text-field"===M&&_&&!_.glyphs&&H.push(new Pe(u,C,'use of "text-field" requires a style "glyphs" property')),"text-font"===M&&Wo(ds(C))&&"identity"===Vn(C.type)&&H.push(new Pe(u,C,'"text-font" does not support identity functions'))),H.concat(f({key:l.key,value:C,valueSpec:O,style:_,styleSpec:x,expressionContext:"property",propertyType:o,propertyKey:M}))}function Gi(l){return cr(l,"paint")}function ua(l){return cr(l,"layout")}function jr(l){let o=[];const u=l.value,f=l.key,_=l.style,x=l.styleSpec;u.type||u.ref||o.push(new Pe(f,u,'either "type" or "ref" is required'));let C=Vn(u.type);const M=Vn(u.ref);if(u.id){const A=Vn(u.id);for(let F=0;F<l.arrayIndex;F++){const O=_.layers[F];Vn(O.id)===A&&o.push(new Pe(f,u.id,`duplicate layer id "${u.id}", previously used at line ${O.id.__line__}`))}}if("ref"in u){let A;["type","source","source-layer","filter","layout"].forEach(F=>{F in u&&o.push(new Pe(f,u[F],`"${F}" is prohibited for ref layers`))}),_.layers.forEach(F=>{Vn(F.id)===M&&(A=F)}),A?A.ref?o.push(new Pe(f,u.ref,"ref cannot reference another ref layer")):C=Vn(A.type):o.push(new Pe(f,u.ref,`ref layer "${M}" not found`))}else if("background"!==C)if(u.source){const A=_.sources&&_.sources[u.source],F=A&&Vn(A.type);A?"vector"===F&&"raster"===C?o.push(new Pe(f,u.source,`layer "${u.id}" requires a raster source`)):"raster"===F&&"raster"!==C?o.push(new Pe(f,u.source,`layer "${u.id}" requires a vector source`)):"vector"!==F||u["source-layer"]?"raster-dem"===F&&"hillshade"!==C?o.push(new Pe(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==C||!u.paint||!u.paint["line-gradient"]||"geojson"===F&&A.lineMetrics||o.push(new Pe(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new Pe(f,u,`layer "${u.id}" must specify a "source-layer"`)):o.push(new Pe(f,u.source,`source "${u.source}" not found`))}else o.push(new Pe(f,u,'missing required property "source"'));return o=o.concat(ko({key:f,value:u,valueSpec:x.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${f}.type`,value:u.type,valueSpec:x.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:u,objectKey:"type"}),filter:ut,layout:A=>ko({layer:u,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":F=>ua(Vi({layerType:C},F))}}),paint:A=>ko({layer:u,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":F=>Gi(Vi({layerType:C},F))}})}})),o}function qi(l){const o=l.value,u=l.key,f=Un(o);return"string"!==f?[new Pe(u,o,`string expected, ${f} found`)]:[]}const _r={promoteId:function({key:l,value:o}){if("string"===Un(o))return qi({key:l,value:o});{const u=[];for(const f in o)u.push(...qi({key:`${l}.${f}`,value:o[f]}));return u}}};function Za(l){const o=l.value,u=l.key,f=l.styleSpec,_=l.style,x=l.validateSpec;if(!o.type)return[new Pe(u,o,'"type" is required')];const C=Vn(o.type);let M;switch(C){case"vector":case"raster":case"raster-dem":return M=ko({key:u,value:o,valueSpec:f[`source_${C.replace("-","_")}`],style:l.style,styleSpec:f,objectElementValidators:_r,validateSpec:x}),M;case"geojson":if(M=ko({key:u,value:o,valueSpec:f.source_geojson,style:_,styleSpec:f,validateSpec:x,objectElementValidators:_r}),o.cluster)for(const A in o.clusterProperties){const[F,O]=o.clusterProperties[A],B="string"==typeof F?[F,["accumulated"],["get",A]]:F;M.push(...qa({key:`${u}.${A}.map`,value:O,validateSpec:x,expressionContext:"cluster-map"})),M.push(...qa({key:`${u}.${A}.reduce`,value:B,validateSpec:x,expressionContext:"cluster-reduce"}))}return M;case"video":return ko({key:u,value:o,valueSpec:f.source_video,style:_,validateSpec:x,styleSpec:f});case"image":return ko({key:u,value:o,valueSpec:f.source_image,style:_,validateSpec:x,styleSpec:f});case"canvas":return[new Pe(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return li({key:`${u}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,validateSpec:x,styleSpec:f})}}function Wa(l){const o=l.value,u=l.styleSpec,f=u.light,_=l.style;let x=[];const C=Un(o);if(void 0===o)return x;if("object"!==C)return x=x.concat([new Pe("light",o,`object expected, ${C} found`)]),x;for(const M in o){const A=M.match(/^(.*)-transition$/);x=x.concat(A&&f[A[1]]&&f[A[1]].transition?l.validateSpec({key:M,value:o[M],valueSpec:u.transition,validateSpec:l.validateSpec,style:_,styleSpec:u}):f[M]?l.validateSpec({key:M,value:o[M],valueSpec:f[M],validateSpec:l.validateSpec,style:_,styleSpec:u}):[new Pe(M,o[M],`unknown property "${M}"`)])}return x}function Xt(l){const o=l.value,u=l.styleSpec,f=u.terrain,_=l.style;let x=[];const C=Un(o);if(void 0===o)return x;if("object"!==C)return x=x.concat([new Pe("terrain",o,`object expected, ${C} found`)]),x;for(const M in o)x=x.concat(f[M]?l.validateSpec({key:M,value:o[M],valueSpec:f[M],validateSpec:l.validateSpec,style:_,styleSpec:u}):[new Pe(M,o[M],`unknown property "${M}"`)]);return x}function Vc(l){let o=[];const u=l.value,f=l.key;if(Array.isArray(u)){const _=[],x=[];for(const C in u)u[C].id&&_.includes(u[C].id)&&o.push(new Pe(f,u,`all the sprites' ids must be unique, but ${u[C].id} is duplicated`)),_.push(u[C].id),u[C].url&&x.includes(u[C].url)&&o.push(new Pe(f,u,`all the sprites' URLs must be unique, but ${u[C].url} is duplicated`)),x.push(u[C].url),o=o.concat(ko({key:`${f}[${C}]`,value:u[C],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return o}return qi({key:f,value:u})}const Xa={"*":()=>[],array:zs,boolean:function(l){const o=l.value,u=l.key,f=Un(o);return"boolean"!==f?[new Pe(u,o,`boolean expected, ${f} found`)]:[]},number:id,color:function(l){const o=l.key,u=l.value,f=Un(u);return"string"!==f?[new Pe(o,u,`color expected, ${f} found`)]:null===ia(u)?[new Pe(o,u,`color expected, "${u}" found`)]:[]},constants:Na,enum:li,filter:ut,function:od,layer:jr,object:ko,source:Za,light:Wa,terrain:Xt,string:qi,formatted:function(l){return 0===qi(l).length?[]:qa(l)},resolvedImage:function(l){return 0===qi(l).length?[]:qa(l)},padding:function(l){const o=l.key,u=l.value;if("array"===Un(u)){if(u.length<1||u.length>4)return[new Pe(o,u,`padding requires 1 to 4 values; ${u.length} values found`)];const f={type:"number"};let _=[];for(let x=0;x<u.length;x++)_=_.concat(l.validateSpec({key:`${o}[${x}]`,value:u[x],validateSpec:l.validateSpec,valueSpec:f}));return _}return id({key:o,value:u,valueSpec:{}})},sprite:Vc};function Ya(l){const o=l.value,u=l.valueSpec,f=l.styleSpec;return l.validateSpec=Ya,u.expression&&Wo(Vn(o))?od(l):u.expression&&Cn(ds(o))?qa(l):u.type&&Xa[u.type]?Xa[u.type](l):ko(Vi({},l,{valueSpec:u.type?f[u.type]:u}))}function ha(l){const o=l.value,u=l.key,f=qi(l);return f.length||(-1===o.indexOf("{fontstack}")&&f.push(new Pe(u,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&f.push(new Pe(u,o,'"glyphs" url must include a "{range}" token'))),f}function ur(l,o=Ae){let u=[];return u=u.concat(Ya({key:"",value:l,valueSpec:o.$root,styleSpec:o,style:l,validateSpec:Ya,objectElementValidators:{glyphs:ha,"*":()=>[]}})),l.constants&&(u=u.concat(Na({key:"constants",value:l.constants,style:l,styleSpec:o,validateSpec:Ya}))),Ka(u)}function ho(l){return function(o){return l({...o,validateSpec:Ya})}}function Ka(l){return[].concat(l).sort((o,u)=>o.line-u.line)}function Hr(l){return function(...o){return Ka(l.apply(this,o))}}ur.source=Hr(ho(Za)),ur.sprite=Hr(ho(Vc)),ur.glyphs=Hr(ho(ha)),ur.light=Hr(ho(Wa)),ur.terrain=Hr(ho(Xt)),ur.layer=Hr(ho(jr)),ur.filter=Hr(ho(ut)),ur.paintProperty=Hr(ho(Gi)),ur.layoutProperty=Hr(ho(ua));const Yo=ur,sd=Yo.light,$n=Yo.paintProperty,Um=Yo.layoutProperty;function ad(l,o){let u=!1;if(o&&o.length)for(const f of o)l.fire(new yr(new Error(f.message))),u=!0;return u}class Vs{constructor(o,u,f){const _=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;const C=new Int32Array(this.arrayBuffer);o=C[0],this.d=(u=C[1])+2*(f=C[2]);for(let A=0;A<this.d*this.d;A++){const F=C[3+A],O=C[3+A+1];_.push(F===O?null:C.subarray(F,O))}const M=C[3+_.length+1];this.keys=C.subarray(C[3+_.length],M),this.bboxes=C.subarray(M),this.insert=this._insertReadonly}else{this.d=u+2*f;for(let C=0;C<this.d*this.d;C++)_.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=f,this.scale=u/o,this.uid=0;const x=f/u*o;this.min=-x,this.max=o+x}insert(o,u,f,_,x){this._forEachCell(u,f,_,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(o,u,f,_,x,C){this.cells[x].push(C)}query(o,u,f,_,x){const C=this.min,M=this.max;if(o<=C&&u<=C&&M<=f&&M<=_&&!x)return Array.prototype.slice.call(this.keys);{const A=[];return this._forEachCell(o,u,f,_,this._queryCell,A,{},x),A}}_queryCell(o,u,f,_,x,C,M,A){const F=this.cells[x];if(null!==F){const O=this.keys,B=this.bboxes;for(let H=0;H<F.length;H++){const q=F[H];if(void 0===M[q]){const W=4*q;(A?A(B[W+0],B[W+1],B[W+2],B[W+3]):o<=B[W+2]&&u<=B[W+3]&&f>=B[W+0]&&_>=B[W+1])?(M[q]=!0,C.push(O[q])):M[q]=!1}}}}_forEachCell(o,u,f,_,x,C,M,A){const F=this._convertToCellCoord(o),O=this._convertToCellCoord(u),B=this._convertToCellCoord(f),H=this._convertToCellCoord(_);for(let q=F;q<=B;q++)for(let W=O;W<=H;W++){const se=this.d*W+q;if((!A||A(this._convertFromCellCoord(q),this._convertFromCellCoord(W),this._convertFromCellCoord(q+1),this._convertFromCellCoord(W+1)))&&x.call(this,o,u,f,_,se,C,M,A))return}}_convertFromCellCoord(o){return(o-this.padding)/this.scale}_convertToCellCoord(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const o=this.cells,u=3+this.cells.length+1+1;let f=0;for(let C=0;C<this.cells.length;C++)f+=this.cells[C].length;const _=new Int32Array(u+f+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let x=u;for(let C=0;C<o.length;C++){const M=o[C];_[3+C]=x,_.set(M,x),x+=M.length}return _[3+o.length]=x,_.set(this.keys,x),x+=this.keys.length,_[3+o.length+1]=x,_.set(this.bboxes,x),x+=this.bboxes.length,_.buffer}static serialize(o,u){const f=o.toArrayBuffer();return u&&u.push(f),{buffer:f}}static deserialize(o){return new Vs(o.buffer)}}const gs={};function ct(l,o,u={}){if(gs[l])throw new Error(`${l} is already registered.`);Object.defineProperty(o,"_classRegistryKey",{value:l,writeable:!1}),gs[l]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}ct("Object",Object),ct("TransferableGridIndex",Vs),ct("Color",Sn),ct("Error",Error),ct("AJAXError",Os),ct("ResolvedImage",mi),ct("StylePropertyFunction",Ao),ct("StyleExpression",la,{omit:["_evaluator"]}),ct("ZoomDependentExpression",Bc),ct("ZoomConstantExpression",zc),ct("CompoundExpression",Me,{omit:["_evaluate"]});for(const l in ja)ja[l]._classRegistryKey||ct(`Expression_${l}`,ja[l]);function da(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&"ArrayBuffer"===l.constructor.name)}function fo(l,o){if(null==l||"boolean"==typeof l||"number"==typeof l||"string"==typeof l||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob)return l;if(da(l)||oo(l))return o&&o.push(l),l;if(ArrayBuffer.isView(l)){const u=l;return o&&o.push(u.buffer),u}if(l instanceof ImageData)return o&&o.push(l.data.buffer),l;if(Array.isArray(l)){const u=[];for(const f of l)u.push(fo(f,o));return u}if("object"==typeof l){const u=l.constructor,f=u._classRegistryKey;if(!f)throw new Error("can't serialize object of unregistered class");if(!gs[f])throw new Error(`${f} is not registered.`);const _=u.serialize?u.serialize(l,o):{};if(u.serialize){if(o&&_===o[o.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in l){if(!l.hasOwnProperty(x)||gs[f].omit.indexOf(x)>=0)continue;const C=l[x];_[x]=gs[f].shallow.indexOf(x)>=0?C:fo(C,o)}l instanceof Error&&(_.message=l.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==f&&(_.$name=f),_}throw new Error("can't serialize object of type "+typeof l)}function Er(l){if(null==l||"boolean"==typeof l||"number"==typeof l||"string"==typeof l||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||da(l)||oo(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(Er);if("object"==typeof l){const o=l.$name||"Object";if(!gs[o])throw new Error(`can't deserialize unregistered class ${o}`);const{klass:u}=gs[o];if(!u)throw new Error(`can't deserialize unregistered class ${o}`);if(u.deserialize)return u.deserialize(l);const f=Object.create(u.prototype);for(const _ of Object.keys(l)){if("$name"===_)continue;const x=l[_];f[_]=gs[o].shallow.indexOf(_)>=0?x:Er(x)}return f}throw new Error("can't deserialize object of type "+typeof l)}class Bf{constructor(){this.first=!0}update(o,u){const f=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=f,!0))}}const Xe={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519};function po(l){for(const o of l)if(Vl(o.charCodeAt(0)))return!0;return!1}function ld(l){for(const o of l)if(!Zu(o.charCodeAt(0)))return!1;return!0}function Zu(l){return!(Xe.Arabic(l)||Xe["Arabic Supplement"](l)||Xe["Arabic Extended-A"](l)||Xe["Arabic Presentation Forms-A"](l)||Xe["Arabic Presentation Forms-B"](l))}function Vl(l){return!(746!==l&&747!==l&&(l<4352||!(Xe["Bopomofo Extended"](l)||Xe.Bopomofo(l)||Xe["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||Xe["CJK Compatibility Ideographs"](l)||Xe["CJK Compatibility"](l)||Xe["CJK Radicals Supplement"](l)||Xe["CJK Strokes"](l)||!(!Xe["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||12336===l)||Xe["CJK Unified Ideographs Extension A"](l)||Xe["CJK Unified Ideographs"](l)||Xe["Enclosed CJK Letters and Months"](l)||Xe["Hangul Compatibility Jamo"](l)||Xe["Hangul Jamo Extended-A"](l)||Xe["Hangul Jamo Extended-B"](l)||Xe["Hangul Jamo"](l)||Xe["Hangul Syllables"](l)||Xe.Hiragana(l)||Xe["Ideographic Description Characters"](l)||Xe.Kanbun(l)||Xe["Kangxi Radicals"](l)||Xe["Katakana Phonetic Extensions"](l)||Xe.Katakana(l)&&12540!==l||!(!Xe["Halfwidth and Fullwidth Forms"](l)||65288===l||65289===l||65293===l||l>=65306&&l<=65310||65339===l||65341===l||65343===l||l>=65371&&l<=65503||65507===l||l>=65512&&l<=65519)||!(!Xe["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||Xe["Unified Canadian Aboriginal Syllabics"](l)||Xe["Unified Canadian Aboriginal Syllabics Extended"](l)||Xe["Vertical Forms"](l)||Xe["Yijing Hexagram Symbols"](l)||Xe["Yi Syllables"](l)||Xe["Yi Radicals"](l))))}function Po(l){return!(Vl(l)||(o=l,Xe["Latin-1 Supplement"](o)&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||Xe["General Punctuation"](o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||Xe["Letterlike Symbols"](o)||Xe["Number Forms"](o)||Xe["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||Xe["Control Pictures"](o)&&9251!==o||Xe["Optical Character Recognition"](o)||Xe["Enclosed Alphanumerics"](o)||Xe["Geometric Shapes"](o)||Xe["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Xe["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Xe["CJK Symbols and Punctuation"](o)||Xe.Katakana(o)||Xe["Private Use Area"](o)||Xe["CJK Compatibility Forms"](o)||Xe["Small Form Variants"](o)||Xe["Halfwidth and Fullwidth Forms"](o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o}function Uc(l){return l>=1424&&l<=2303||Xe["Arabic Presentation Forms-A"](l)||Xe["Arabic Presentation Forms-B"](l)}function cd(l,o){return!(!o&&Uc(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||Xe.Khmer(l))}function Ro(l){for(const o of l)if(Uc(o.charCodeAt(0)))return!0;return!1}const Ul="deferred",Vf="loading",Uf="loaded";let $f=null,mo="unavailable",Us=null;const $m=function(l){l&&"string"==typeof l&&l.indexOf("NetworkError")>-1&&(mo="error"),$f&&$f(l)};function Wu(){jf.fire(new na("pluginStateChange",{pluginStatus:mo,pluginURL:Us}))}const jf=new tr,$l=function(){return mo},jm=function(){if(mo!==Ul||!Us)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");mo=Vf,Wu(),Us&&Oa({url:Us},l=>{l?$m(l):(mo=Uf,Wu())})},go={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>mo===Uf||null!=go.applyArabicShaping,isLoading:()=>mo===Vf,setState(l){if(!To())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");mo=l.pluginStatus,Us=l.pluginURL},isParsed(){if(!To())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return null!=go.applyArabicShaping&&null!=go.processBidirectionalText&&null!=go.processStyledBidirectionalText},getPluginURL(){if(!To())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Us}};class hr{constructor(o,u){this.zoom=o,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Bf,this.transition={})}isSupportedScript(o){return function(u,f){for(const _ of u)if(!cd(_.charCodeAt(0),f))return!1;return!0}(o,go.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,u=o-Math.floor(o),f=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}}}class $c{constructor(o,u){this.property=o,this.value=u,this.expression=function(f,_){if(Wo(f))return new Ao(f,_);if(Cn(f)){const x=rd(f,_);if("error"===x.result)throw new Error(x.value.map(C=>`${C.key}: ${C.message}`).join(", "));return x.value}{let x=f;return"color"===_.type&&"string"==typeof f?x=Sn.parse(f):"padding"!==_.type||"number"!=typeof f&&!Array.isArray(f)||(x=$r.parse(f)),{kind:"constant",evaluate:()=>x}}}(void 0===u?o.specification.default:u,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,u,f){return this.property.possiblyEvaluate(this,o,u,f)}}class ud{constructor(o){this.property=o,this.value=new $c(o,void 0)}transitioned(o,u){return new Yu(this.property,this.value,u,Bi({},o.transition,this.transition),o.now)}untransitioned(){return new Yu(this.property,this.value,null,{},0)}}class Xu{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return Ci(this._values[o].value.value)}setValue(o,u){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new ud(this._values[o].property)),this._values[o].value=new $c(this._values[o].property,null===u?void 0:Ci(u))}getTransition(o){return Ci(this._values[o].transition)}setTransition(o,u){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new ud(this._values[o].property)),this._values[o].transition=Ci(u)||void 0}serialize(){const o={};for(const u of Object.keys(this._values)){const f=this.getValue(u);void 0!==f&&(o[u]=f);const _=this.getTransition(u);void 0!==_&&(o[`${u}-transition`]=_)}return o}transitioned(o,u){const f=new hd(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].transitioned(o,u._values[_]);return f}untransitioned(){const o=new hd(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].untransitioned();return o}}class Yu{constructor(o,u,f,_,x){this.property=o,this.value=u,this.begin=x+_.delay||0,this.end=this.begin+_.duration||0,o.specification.transition&&(_.delay||_.duration)&&(this.prior=f)}possiblyEvaluate(o,u,f){const _=o.now||0,x=this.value.possiblyEvaluate(o,u,f),C=this.prior;if(C){if(_>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(_<this.begin)return C.possiblyEvaluate(o,u,f);{const M=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(C.possiblyEvaluate(o,u,f),x,function(A){if(A<=0)return 0;if(A>=1)return 1;const F=A*A,O=F*A;return 4*(A<.5?O:3*(A-F)+O-.75)}(M))}}return x}}class hd{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,u,f){const _=new _s(this._properties);for(const x of Object.keys(this._values))_._values[x]=this._values[x].possiblyEvaluate(o,u,f);return _}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class dd{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return Ci(this._values[o].value)}setValue(o,u){this._values[o]=new $c(this._values[o].property,null===u?void 0:Ci(u))}serialize(){const o={};for(const u of Object.keys(this._values)){const f=this.getValue(u);void 0!==f&&(o[u]=f)}return o}possiblyEvaluate(o,u,f){const _=new _s(this._properties);for(const x of Object.keys(this._values))_._values[x]=this._values[x].possiblyEvaluate(o,u,f);return _}}class ys{constructor(o,u,f){this.property=o,this.value=u,this.parameters=f}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,u,f,_){return this.property.evaluate(this.value,this.parameters,o,u,f,_)}}class _s{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class wt{constructor(o){this.specification=o}possiblyEvaluate(o,u){if(o.isDataDriven())throw new Error("Value should not be data driven");return o.expression.evaluate(u)}interpolate(o,u,f){const _=Mn[this.specification.type];return _?_(o,u,f):o}}class yt{constructor(o,u){this.specification=o,this.overrides=u}possiblyEvaluate(o,u,f,_){return new ys(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(u,null,{},f,_)}:o.expression,u)}interpolate(o,u,f){if("constant"!==o.value.kind||"constant"!==u.value.kind)return o;if(void 0===o.value.value||void 0===u.value.value)return new ys(this,{kind:"constant",value:void 0},o.parameters);const _=Mn[this.specification.type];return _?new ys(this,{kind:"constant",value:_(o.value.value,u.value.value,f)},o.parameters):o}evaluate(o,u,f,_,x,C){return"constant"===o.kind?o.value:o.evaluate(u,f,_,x,C)}}class Ja extends yt{possiblyEvaluate(o,u,f,_){if(void 0===o.value)return new ys(this,{kind:"constant",value:void 0},u);if("constant"===o.expression.kind){const x=o.expression.evaluate(u,null,{},f,_),C="resolvedImage"===o.property.specification.type&&"string"!=typeof x?x.name:x,M=this._calculate(C,C,C,u);return new ys(this,{kind:"constant",value:M},u)}if("camera"===o.expression.kind){const x=this._calculate(o.expression.evaluate({zoom:u.zoom-1}),o.expression.evaluate({zoom:u.zoom}),o.expression.evaluate({zoom:u.zoom+1}),u);return new ys(this,{kind:"constant",value:x},u)}return new ys(this,o.expression,u)}evaluate(o,u,f,_,x,C){if("source"===o.kind){const M=o.evaluate(u,f,_,x,C);return this._calculate(M,M,M,u)}return"composite"===o.kind?this._calculate(o.evaluate({zoom:Math.floor(u.zoom)-1},f,_),o.evaluate({zoom:Math.floor(u.zoom)},f,_),o.evaluate({zoom:Math.floor(u.zoom)+1},f,_),u):o.value}_calculate(o,u,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:o,to:u}:{from:f,to:u}}interpolate(o){return o}}class fd{constructor(o){this.specification=o}possiblyEvaluate(o,u,f,_){if(void 0!==o.value){if("constant"===o.expression.kind){const x=o.expression.evaluate(u,null,{},f,_);return this._calculate(x,x,x,u)}return this._calculate(o.expression.evaluate(new hr(Math.floor(u.zoom-1),u)),o.expression.evaluate(new hr(Math.floor(u.zoom),u)),o.expression.evaluate(new hr(Math.floor(u.zoom+1),u)),u)}}_calculate(o,u,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:o,to:u}:{from:f,to:u}}interpolate(o){return o}}class pd{constructor(o){this.specification=o}possiblyEvaluate(o,u,f,_){return!!o.expression.evaluate(u,null,{},f,_)}interpolate(){return!1}}class Si{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in o){const f=o[u];f.specification.overridable&&this.overridableProperties.push(u);const _=this.defaultPropertyValues[u]=new $c(f,void 0),x=this.defaultTransitionablePropertyValues[u]=new ud(f);this.defaultTransitioningPropertyValues[u]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=_.possiblyEvaluate({})}}}ct("DataDrivenProperty",yt),ct("DataConstantProperty",wt),ct("CrossFadedDataDrivenProperty",Ja),ct("CrossFadedProperty",fd),ct("ColorRampProperty",pd);const jc="-transition";class Ko extends tr{constructor(o,u){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),u.layout&&(this._unevaluatedLayout=new dd(u.layout)),u.paint)){this._transitionablePaint=new Xu(u.paint);for(const f in o.paint)this.setPaintProperty(f,o.paint[f],{validate:!1});for(const f in o.layout)this.setLayoutProperty(f,o.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _s(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,u,f={}){null!=u&&this._validate(Um,`layers.${this.id}.layout.${o}`,o,u,f)||("visibility"!==o?this._unevaluatedLayout.setValue(o,u):this.visibility=u)}getPaintProperty(o){return o.endsWith(jc)?this._transitionablePaint.getTransition(o.slice(0,-jc.length)):this._transitionablePaint.getValue(o)}setPaintProperty(o,u,f={}){if(null!=u&&this._validate($n,`layers.${this.id}.paint.${o}`,o,u,f))return!1;if(o.endsWith(jc))return this._transitionablePaint.setTransition(o.slice(0,-jc.length),u||void 0),!1;{const _=this._transitionablePaint._values[o],x="cross-faded-data-driven"===_.property.specification["property-type"],C=_.value.isDataDriven(),M=_.value;this._transitionablePaint.setValue(o,u),this._handleSpecialPaintPropertyUpdate(o);const A=this._transitionablePaint._values[o].value;return A.isDataDriven()||C||x||this._handleOverridablePaintPropertyUpdate(o,M,A)}}_handleSpecialPaintPropertyUpdate(o){}_handleOverridablePaintPropertyUpdate(o,u,f){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,u){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,u)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),Al(o,(u,f)=>!(void 0===u||"layout"===f&&!Object.keys(u).length||"paint"===f&&!Object.keys(u).length))}_validate(o,u,f,_,x={}){return(!x||!1!==x.validate)&&ad(this,o.call(Yo,{key:u,layerType:this.type,objectKey:f,value:_,styleSpec:Ae,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const u=this.paint.get(o);if(u instanceof ys&&Bl(u.property.specification)&&("source"===u.value.kind||"composite"===u.value.kind)&&u.value.isStateDependent)return!0}return!1}}const md={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ku{constructor(o,u){this._structArray=o,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Tn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,u){return o._trim(),u&&(o.isTransferred=!0,u.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const u=Object.create(this.prototype);return u.arrayBuffer=o.arrayBuffer,u.length=o.length,u.capacity=o.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Dr(l,o=1){let u=0,f=0;return{members:l.map(_=>{const x=md[_.type].BYTES_PER_ELEMENT,C=u=Hf(u,Math.max(o,x)),M=_.components||1;return f=Math.max(f,x),u+=x*M,{name:_.name,type:_.type,components:M,offset:C}}),size:Hf(u,Math.max(f,o)),alignment:o}}function Hf(l,o){return Math.ceil(l/o)*o}class Qa extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,u)}emplace(o,u,f){const _=2*o;return this.int16[_+0]=u,this.int16[_+1]=f,o}}Qa.prototype.bytesPerElement=4,ct("StructArrayLayout2i4",Qa);class Ju extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,f)}emplace(o,u,f,_){const x=3*o;return this.int16[x+0]=u,this.int16[x+1]=f,this.int16[x+2]=_,o}}Ju.prototype.bytesPerElement=6,ct("StructArrayLayout3i6",Ju);class Hc extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,o,u,f,_)}emplace(o,u,f,_,x){const C=4*o;return this.int16[C+0]=u,this.int16[C+1]=f,this.int16[C+2]=_,this.int16[C+3]=x,o}}Hc.prototype.bytesPerElement=8,ct("StructArrayLayout4i8",Hc);class Sr extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,_,x,C){const M=this.length;return this.resize(M+1),this.emplace(M,o,u,f,_,x,C)}emplace(o,u,f,_,x,C,M){const A=6*o;return this.int16[A+0]=u,this.int16[A+1]=f,this.int16[A+2]=_,this.int16[A+3]=x,this.int16[A+4]=C,this.int16[A+5]=M,o}}Sr.prototype.bytesPerElement=12,ct("StructArrayLayout2i4i12",Sr);class Gc extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,_,x,C){const M=this.length;return this.resize(M+1),this.emplace(M,o,u,f,_,x,C)}emplace(o,u,f,_,x,C,M){const A=4*o,F=8*o;return this.int16[A+0]=u,this.int16[A+1]=f,this.uint8[F+4]=_,this.uint8[F+5]=x,this.uint8[F+6]=C,this.uint8[F+7]=M,o}}Gc.prototype.bytesPerElement=8,ct("StructArrayLayout2i4ub8",Gc);class Qu extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,u)}emplace(o,u,f){const _=2*o;return this.float32[_+0]=u,this.float32[_+1]=f,o}}Qu.prototype.bytesPerElement=8,ct("StructArrayLayout2f8",Qu);class jl extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,_,x,C,M,A,F,O){const B=this.length;return this.resize(B+1),this.emplace(B,o,u,f,_,x,C,M,A,F,O)}emplace(o,u,f,_,x,C,M,A,F,O,B){const H=10*o;return this.uint16[H+0]=u,this.uint16[H+1]=f,this.uint16[H+2]=_,this.uint16[H+3]=x,this.uint16[H+4]=C,this.uint16[H+5]=M,this.uint16[H+6]=A,this.uint16[H+7]=F,this.uint16[H+8]=O,this.uint16[H+9]=B,o}}jl.prototype.bytesPerElement=20,ct("StructArrayLayout10ui20",jl);class Mi extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,_,x,C,M,A,F,O,B,H){const q=this.length;return this.resize(q+1),this.emplace(q,o,u,f,_,x,C,M,A,F,O,B,H)}emplace(o,u,f,_,x,C,M,A,F,O,B,H,q){const W=12*o;return this.int16[W+0]=u,this.int16[W+1]=f,this.int16[W+2]=_,this.int16[W+3]=x,this.uint16[W+4]=C,this.uint16[W+5]=M,this.uint16[W+6]=A,this.uint16[W+7]=F,this.int16[W+8]=O,this.int16[W+9]=B,this.int16[W+10]=H,this.int16[W+11]=q,o}}Mi.prototype.bytesPerElement=24,ct("StructArrayLayout4i4ui4i24",Mi);class eh extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,f)}emplace(o,u,f,_){const x=3*o;return this.float32[x+0]=u,this.float32[x+1]=f,this.float32[x+2]=_,o}}eh.prototype.bytesPerElement=12,ct("StructArrayLayout3f12",eh);class Hl extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.uint32[1*o+0]=u,o}}Hl.prototype.bytesPerElement=4,ct("StructArrayLayout1ul4",Hl);class fa extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,_,x,C,M,A,F){const O=this.length;return this.resize(O+1),this.emplace(O,o,u,f,_,x,C,M,A,F)}emplace(o,u,f,_,x,C,M,A,F,O){const B=10*o,H=5*o;return this.int16[B+0]=u,this.int16[B+1]=f,this.int16[B+2]=_,this.int16[B+3]=x,this.int16[B+4]=C,this.int16[B+5]=M,this.uint32[H+3]=A,this.uint16[B+8]=F,this.uint16[B+9]=O,o}}fa.prototype.bytesPerElement=20,ct("StructArrayLayout6i1ul2ui20",fa);class Ti extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,_,x,C){const M=this.length;return this.resize(M+1),this.emplace(M,o,u,f,_,x,C)}emplace(o,u,f,_,x,C,M){const A=6*o;return this.int16[A+0]=u,this.int16[A+1]=f,this.int16[A+2]=_,this.int16[A+3]=x,this.int16[A+4]=C,this.int16[A+5]=M,o}}Ti.prototype.bytesPerElement=12,ct("StructArrayLayout2i2i2i12",Ti);class gd extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,o,u,f,_,x)}emplace(o,u,f,_,x,C){const M=4*o,A=8*o;return this.float32[M+0]=u,this.float32[M+1]=f,this.float32[M+2]=_,this.int16[A+6]=x,this.int16[A+7]=C,o}}gd.prototype.bytesPerElement=16,ct("StructArrayLayout2f1f2i16",gd);class Gl extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,o,u,f,_)}emplace(o,u,f,_,x){const C=12*o,M=3*o;return this.uint8[C+0]=u,this.uint8[C+1]=f,this.float32[M+1]=_,this.float32[M+2]=x,o}}Gl.prototype.bytesPerElement=12,ct("StructArrayLayout2ub2f12",Gl);class th extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,f)}emplace(o,u,f,_){const x=3*o;return this.uint16[x+0]=u,this.uint16[x+1]=f,this.uint16[x+2]=_,o}}th.prototype.bytesPerElement=6,ct("StructArrayLayout3ui6",th);class vs extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,_,x,C,M,A,F,O,B,H,q,W,se,oe,be){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,o,u,f,_,x,C,M,A,F,O,B,H,q,W,se,oe,be)}emplace(o,u,f,_,x,C,M,A,F,O,B,H,q,W,se,oe,be,Ce){const me=24*o,Ee=12*o,$e=48*o;return this.int16[me+0]=u,this.int16[me+1]=f,this.uint16[me+2]=_,this.uint16[me+3]=x,this.uint32[Ee+2]=C,this.uint32[Ee+3]=M,this.uint32[Ee+4]=A,this.uint16[me+10]=F,this.uint16[me+11]=O,this.uint16[me+12]=B,this.float32[Ee+7]=H,this.float32[Ee+8]=q,this.uint8[$e+36]=W,this.uint8[$e+37]=se,this.uint8[$e+38]=oe,this.uint32[Ee+10]=be,this.int16[me+22]=Ce,o}}vs.prototype.bytesPerElement=48,ct("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",vs);class $s extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,_,x,C,M,A,F,O,B,H,q,W,se,oe,be,Ce,me,Ee,$e,Ve,gt,Ct,at,tt,Qe,ot){const it=this.length;return this.resize(it+1),this.emplace(it,o,u,f,_,x,C,M,A,F,O,B,H,q,W,se,oe,be,Ce,me,Ee,$e,Ve,gt,Ct,at,tt,Qe,ot)}emplace(o,u,f,_,x,C,M,A,F,O,B,H,q,W,se,oe,be,Ce,me,Ee,$e,Ve,gt,Ct,at,tt,Qe,ot,it){const Ge=34*o,Et=17*o;return this.int16[Ge+0]=u,this.int16[Ge+1]=f,this.int16[Ge+2]=_,this.int16[Ge+3]=x,this.int16[Ge+4]=C,this.int16[Ge+5]=M,this.int16[Ge+6]=A,this.int16[Ge+7]=F,this.uint16[Ge+8]=O,this.uint16[Ge+9]=B,this.uint16[Ge+10]=H,this.uint16[Ge+11]=q,this.uint16[Ge+12]=W,this.uint16[Ge+13]=se,this.uint16[Ge+14]=oe,this.uint16[Ge+15]=be,this.uint16[Ge+16]=Ce,this.uint16[Ge+17]=me,this.uint16[Ge+18]=Ee,this.uint16[Ge+19]=$e,this.uint16[Ge+20]=Ve,this.uint16[Ge+21]=gt,this.uint16[Ge+22]=Ct,this.uint32[Et+12]=at,this.float32[Et+13]=tt,this.float32[Et+14]=Qe,this.float32[Et+15]=ot,this.float32[Et+16]=it,o}}$s.prototype.bytesPerElement=68,ct("StructArrayLayout8i15ui1ul4f68",$s);class ql extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.float32[1*o+0]=u,o}}ql.prototype.bytesPerElement=4,ct("StructArrayLayout1f4",ql);class Vt extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,f)}emplace(o,u,f,_){const x=4*o;return this.uint32[2*o+0]=u,this.uint16[x+2]=f,this.uint16[x+3]=_,o}}Vt.prototype.bytesPerElement=8,ct("StructArrayLayout1ul2ui8",Vt);class nh extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,u)}emplace(o,u,f){const _=2*o;return this.uint16[_+0]=u,this.uint16[_+1]=f,o}}nh.prototype.bytesPerElement=4,ct("StructArrayLayout2ui4",nh);class yd extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.uint16[1*o+0]=u,o}}yd.prototype.bytesPerElement=2,ct("StructArrayLayout1ui2",yd);class _d extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,o,u,f,_)}emplace(o,u,f,_,x){const C=4*o;return this.float32[C+0]=u,this.float32[C+1]=f,this.float32[C+2]=_,this.float32[C+3]=x,o}}_d.prototype.bytesPerElement=16,ct("StructArrayLayout4f16",_d);class Gf extends Ku{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new It(this.anchorPointX,this.anchorPointY)}}Gf.prototype.size=20;class vd extends fa{get(o){return new Gf(this,o)}}ct("CollisionBoxArray",vd);class qc extends Ku{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(o){this._structArray.uint8[this._pos1+37]=o}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(o){this._structArray.uint8[this._pos1+38]=o}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(o){this._structArray.uint32[this._pos4+10]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}qc.prototype.size=48;class bd extends vs{get(o){return new qc(this,o)}}ct("PlacedSymbolArray",bd);class rh extends Ku{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(o){this._structArray.uint32[this._pos4+12]=o}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}rh.prototype.size=68;class He extends $s{get(o){return new rh(this,o)}}ct("SymbolInstanceArray",He);class en extends ql{getoffsetX(o){return this.float32[1*o+0]}}ct("GlyphOffsetArray",en);class Zl extends Ju{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}ct("SymbolLineVertexArray",Zl);class el extends Ku{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}el.prototype.size=8;class Rr extends Vt{get(o){return new el(this,o)}}ct("FeatureIndexArray",Rr);class ih extends Qa{}class js extends Qa{}class bs extends Qa{}class xd extends Sr{}class oh extends Gc{}class A_ extends Qu{}class pa extends jl{}class g extends Mi{}class s extends eh{}class h extends Hl{}class m extends Ti{}class y extends Gl{}class w extends th{}class S extends nh{}const I=Dr([{name:"a_pos",components:2,type:"Int16"}],4),{members:k}=I;class R{constructor(o=[]){this.segments=o}prepareSegment(o,u,f,_){let x=this.segments[this.segments.length-1];return o>R.MAX_VERTEX_ARRAY_LENGTH&&fn(`Max vertices per segment is ${R.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!x||x.vertexLength+o>R.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==_)&&(x={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},void 0!==_&&(x.sortKey=_),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const o of this.segments)for(const u in o.vaos)o.vaos[u].destroy()}static simpleSegment(o,u,f,_){return new R([{vertexOffset:o,primitiveOffset:u,vertexLength:f,primitiveLength:_,vaos:{},sortKey:0}])}}function z(l,o){return 256*(l=Zt(Math.floor(l),0,255))+Zt(Math.floor(o),0,255)}R.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ct("SegmentVector",R);const L=Dr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var j={},Q={get exports(){return j},set exports(l){j=l}},ee={};({get exports(){return ee},set exports(l){ee=l}}).exports=function(l,o){var u,f,_,x,C,M,A,F;for(f=l.length-(u=3&l.length),_=o,C=3432918353,M=461845907,F=0;F<f;)A=255&l.charCodeAt(F)|(255&l.charCodeAt(++F))<<8|(255&l.charCodeAt(++F))<<16|(255&l.charCodeAt(++F))<<24,++F,_=27492+(65535&(x=5*(65535&(_=(_^=A=(65535&(A=(A=(65535&A)*C+(((A>>>16)*C&65535)<<16)&4294967295)<<15|A>>>17))*M+(((A>>>16)*M&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(A=0,u){case 3:A^=(255&l.charCodeAt(F+2))<<16;case 2:A^=(255&l.charCodeAt(F+1))<<8;case 1:_^=A=(65535&(A=(A=(65535&(A^=255&l.charCodeAt(F)))*C+(((A>>>16)*C&65535)<<16)&4294967295)<<15|A>>>17))*M+(((A>>>16)*M&65535)<<16)&4294967295}return _^=l.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0};var Y={};({get exports(){return Y},set exports(l){Y=l}}).exports=function(l,o){for(var u,f=l.length,_=o^f,x=0;f>=4;)u=1540483477*(65535&(u=255&l.charCodeAt(x)|(255&l.charCodeAt(++x))<<8|(255&l.charCodeAt(++x))<<16|(255&l.charCodeAt(++x))<<24))+((1540483477*(u>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++x;switch(f){case 3:_^=(255&l.charCodeAt(x+2))<<16;case 2:_^=(255&l.charCodeAt(x+1))<<8;case 1:_=1540483477*(65535&(_^=255&l.charCodeAt(x)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0};var ae=ee,_e=Y;Q.exports=ae,j.murmur3=ae,j.murmur2=_e;class ye{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,u,f,_){this.ids.push(ie(o)),this.positions.push(u,f,_)}getPositions(o){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=ie(o);let f=0,_=this.ids.length-1;for(;f<_;){const C=f+_>>1;this.ids[C]>=u?_=C:f=C+1}const x=[];for(;this.ids[f]===u;)x.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return x}static serialize(o,u){const f=new Float64Array(o.ids),_=new Uint32Array(o.positions);return we(f,_,0,f.length-1),u&&u.push(f.buffer,_.buffer),{ids:f,positions:_}}static deserialize(o){const u=new ye;return u.ids=o.ids,u.positions=o.positions,u.indexed=!0,u}}function ie(l){const o=+l;return!isNaN(o)&&o<=Number.MAX_SAFE_INTEGER?o:j(String(l))}function we(l,o,u,f){for(;u<f;){const _=l[u+f>>1];let x=u-1,C=f+1;for(;;){do{x++}while(l[x]<_);do{C--}while(l[C]>_);if(x>=C)break;De(l,x,C),De(o,3*x,3*C),De(o,3*x+1,3*C+1),De(o,3*x+2,3*C+2)}C-u<f-C?(we(l,o,u,C),u=C+1):(we(l,o,C+1,f),f=C)}}function De(l,o,u){const f=l[o];l[o]=l[u],l[u]=f}ct("FeaturePositionMap",ye);class Se{constructor(o,u){this.gl=o.gl,this.location=u}}class ke extends Se{constructor(o,u){super(o,u),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Be extends Se{constructor(o,u){super(o,u),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class Le extends Se{constructor(o,u){super(o,u),this.current=Sn.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const Ne=new Float32Array(16);function ze(l){return[z(255*l.r,255*l.g),z(255*l.b,255*l.a)]}class ft{constructor(o,u,f){this.value=o,this.uniformNames=u.map(_=>`u_${_}`),this.type=f}setUniform(o,u,f){o.set(f.constantOr(this.value))}getBinding(o,u,f){return"color"===this.type?new Le(o,u):new ke(o,u)}}class Pt{constructor(o,u){this.uniformNames=u.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=o.tlbr}setUniform(o,u,f,_){const x="u_pattern_to"===_?this.patternTo:"u_pattern_from"===_?this.patternFrom:"u_pixel_ratio_to"===_?this.pixelRatioTo:"u_pixel_ratio_from"===_?this.pixelRatioFrom:null;x&&o.set(x)}getBinding(o,u,f){return"u_pattern"===f.substr(0,9)?new Be(o,u):new ke(o,u)}}class Nt{constructor(o,u,f,_){this.expression=o,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===f?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(o,u,f,_,x){const C=this.paintVertexArray.length,M=this.expression.evaluate(new hr(0),u,{},_,[],x);this.paintVertexArray.resize(o),this._setPaintValue(C,o,M)}updatePaintArray(o,u,f,_){const x=this.expression.evaluate({zoom:0},f,_);this._setPaintValue(o,u,x)}_setPaintValue(o,u,f){if("color"===this.type){const _=ze(f);for(let x=o;x<u;x++)this.paintVertexArray.emplace(x,_[0],_[1])}else{for(let _=o;_<u;_++)this.paintVertexArray.emplace(_,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class mt{constructor(o,u,f,_,x,C){this.expression=o,this.uniformNames=u.map(M=>`u_${M}_t`),this.type=f,this.useIntegerZoom=_,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=u.map(M=>({name:`a_${M}`,type:"Float32",components:"color"===f?4:2,offset:0})),this.paintVertexArray=new C}populatePaintArray(o,u,f,_,x){const C=this.expression.evaluate(new hr(this.zoom),u,{},_,[],x),M=this.expression.evaluate(new hr(this.zoom+1),u,{},_,[],x),A=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(A,o,C,M)}updatePaintArray(o,u,f,_){const x=this.expression.evaluate({zoom:this.zoom},f,_),C=this.expression.evaluate({zoom:this.zoom+1},f,_);this._setPaintValue(o,u,x,C)}_setPaintValue(o,u,f,_){if("color"===this.type){const x=ze(f),C=ze(_);for(let M=o;M<u;M++)this.paintVertexArray.emplace(M,x[0],x[1],C[0],C[1])}else{for(let x=o;x<u;x++)this.paintVertexArray.emplace(x,f,_);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(_))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,u){const f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,_=Zt(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);o.set(_)}getBinding(o,u,f){return new ke(o,u)}}class In{constructor(o,u,f,_,x,C){this.expression=o,this.type=u,this.useIntegerZoom=f,this.zoom=_,this.layerId=C,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(o,u,f){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(_,o,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(o,u,f,_,x){this._setPaintValues(o,u,f.patterns&&f.patterns[this.layerId],x)}_setPaintValues(o,u,f,_){if(!_||!f)return;const{min:x,mid:C,max:M}=f,A=_[x],F=_[C],O=_[M];if(A&&F&&O)for(let B=o;B<u;B++)this.zoomInPaintVertexArray.emplace(B,F.tl[0],F.tl[1],F.br[0],F.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],F.pixelRatio,A.pixelRatio),this.zoomOutPaintVertexArray.emplace(B,F.tl[0],F.tl[1],F.br[0],F.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],F.pixelRatio,O.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,L.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,L.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class An{constructor(o,u,f){this.binders={},this._buffers=[];const _=[];for(const x in o.paint._values){if(!f(x))continue;const C=o.paint.get(x);if(!(C instanceof ys&&Bl(C.property.specification)))continue;const M=rn(x,o.type),A=C.value,F=C.property.specification.type,O=C.property.useIntegerZoom,B=C.property.specification["property-type"],H="cross-faded"===B||"cross-faded-data-driven"===B;if("constant"===A.kind)this.binders[x]=H?new Pt(A.value,M):new ft(A.value,M,F),_.push(`/u_${x}`);else if("source"===A.kind||H){const q=Fn(x,F,"source");this.binders[x]=H?new In(A,F,O,u,q,o.id):new Nt(A,M,F,q),_.push(`/a_${x}`)}else{const q=Fn(x,F,"composite");this.binders[x]=new mt(A,M,F,O,u,q),_.push(`/z_${x}`)}}this.cacheKey=_.sort().join("")}getMaxValue(o){const u=this.binders[o];return u instanceof Nt||u instanceof mt?u.maxValue:0}populatePaintArrays(o,u,f,_,x){for(const C in this.binders){const M=this.binders[C];(M instanceof Nt||M instanceof mt||M instanceof In)&&M.populatePaintArray(o,u,f,_,x)}}setConstantPatternPositions(o,u){for(const f in this.binders){const _=this.binders[f];_ instanceof Pt&&_.setConstantPatternPositions(o,u)}}updatePaintArrays(o,u,f,_,x){let C=!1;for(const M in o){const A=u.getPositions(M);for(const F of A){const O=f.feature(F.index);for(const B in this.binders){const H=this.binders[B];if((H instanceof Nt||H instanceof mt||H instanceof In)&&!0===H.expression.isStateDependent){const q=_.paint.get(B);H.expression=q.value,H.updatePaintArray(F.start,F.end,O,o[M],x),C=!0}}}}return C}defines(){const o=[];for(const u in this.binders){const f=this.binders[u];(f instanceof ft||f instanceof Pt)&&o.push(...f.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return o}getBinderAttributes(){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Nt||f instanceof mt)for(let _=0;_<f.paintVertexAttributes.length;_++)o.push(f.paintVertexAttributes[_].name);else if(f instanceof In)for(let _=0;_<L.members.length;_++)o.push(L.members[_].name)}return o}getBinderUniforms(){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof ft||f instanceof Pt||f instanceof mt)for(const _ of f.uniformNames)o.push(_)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,u){const f=[];for(const _ in this.binders){const x=this.binders[_];if(x instanceof ft||x instanceof Pt||x instanceof mt)for(const C of x.uniformNames)if(u[C]){const M=x.getBinding(o,u[C],C);f.push({name:C,property:_,binding:M})}}return f}setUniforms(o,u,f,_){for(const{name:x,property:C,binding:M}of u)this.binders[C].setUniform(M,_,f.get(C),x)}updatePaintBuffers(o){this._buffers=[];for(const u in this.binders){const f=this.binders[u];if(o&&f instanceof In){const _=2===o.fromScale?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(f instanceof Nt||f instanceof mt)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(o){for(const u in this.binders){const f=this.binders[u];(f instanceof Nt||f instanceof mt||f instanceof In)&&f.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const u=this.binders[o];(u instanceof Nt||u instanceof mt||u instanceof In)&&u.destroy()}}}class Ht{constructor(o,u,f=(()=>!0)){this.programConfigurations={};for(const _ of o)this.programConfigurations[_.id]=new An(_,u,f);this.needsUpload=!1,this._featureMap=new ye,this._bufferOffset=0}populatePaintArrays(o,u,f,_,x,C){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(o,u,_,x,C);void 0!==u.id&&this._featureMap.add(u.id,f,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,u,f,_){for(const x of f)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(o,this._featureMap,u,x,_)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}function rn(l,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${o}-`,"").replace(/-/g,"_")]}function Fn(l,o,u){const _={"line-pattern":{source:pa,composite:pa},"fill-pattern":{source:pa,composite:pa},"fill-extrusion-pattern":{source:pa,composite:pa}}[l];return _&&_[u]||{color:{source:Qu,composite:_d},number:{source:ql,composite:Qu}}[o][u]}ct("ConstantBinder",ft),ct("CrossFadedConstantBinder",Pt),ct("SourceExpressionBinder",Nt),ct("CrossFadedCompositeBinder",In),ct("CompositeExpressionBinder",mt),ct("ProgramConfiguration",An,{omit:["_buffers"]}),ct("ProgramConfigurationSet",Ht);var yn=8192;const yo=Math.pow(2,14)-1,Fo=-yo-1;function vr(l){const o=yn/l.extent,u=l.loadGeometry();for(let f=0;f<u.length;f++){const _=u[f];for(let x=0;x<_.length;x++){const C=_[x],M=Math.round(C.x*o),A=Math.round(C.y*o);C.x=Zt(M,Fo,yo),C.y=Zt(A,Fo,yo),(M<C.x||M>C.x+1||A<C.y||A>C.y+1)&&fn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function ci(l,o){return{type:l.type,id:l.id,properties:l.properties,geometry:o?vr(l):[]}}function Ii(l,o,u,f,_){l.emplaceBack(2*o+(f+1)/2,2*u+(_+1)/2)}class Jo{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new js,this.indexArray=new w,this.segments=new R,this.programConfigurations=new Ht(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,f){const _=this.layers[0],x=[];let C=null,M=!1;"circle"===_.type&&(C=_.layout.get("circle-sort-key"),M=!C.isConstant());for(const{feature:A,id:F,index:O,sourceLayerIndex:B}of o){const H=this.layers[0]._featureFilter.needGeometry,q=ci(A,H);if(!this.layers[0]._featureFilter.filter(new hr(this.zoom),q,f))continue;const W=M?C.evaluate(q,{},f):void 0,se={id:F,properties:A.properties,type:A.type,sourceLayerIndex:B,index:O,geometry:H?q.geometry:vr(A),patterns:{},sortKey:W};x.push(se)}M&&x.sort((A,F)=>A.sortKey-F.sortKey);for(const A of x){const{geometry:F,index:O,sourceLayerIndex:B}=A,H=o[O].feature;this.addFeature(A,F,O,f),u.featureIndex.insert(H,F,O,B,this.index)}}update(o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,k),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,u,f,_){for(const x of u)for(const C of x){const M=C.x,A=C.y;if(M<0||M>=yn||A<0||A>=yn)continue;const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),O=F.vertexLength;Ii(this.layoutVertexArray,M,A,-1,-1),Ii(this.layoutVertexArray,M,A,1,-1),Ii(this.layoutVertexArray,M,A,1,1),Ii(this.layoutVertexArray,M,A,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+3,O+2),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,{},_)}}function Oo(l,o){for(let u=0;u<l.length;u++)if(Wi(o,l[u]))return!0;for(let u=0;u<o.length;u++)if(Wi(l,o[u]))return!0;return!!On(l,o)}function Wl(l,o,u){return!!Wi(l,o)||!!Jr(o,l,u)}function Fr(l,o){if(1===l.length)return Qo(o,l[0]);for(let u=0;u<o.length;u++){const f=o[u];for(let _=0;_<f.length;_++)if(Wi(l,f[_]))return!0}for(let u=0;u<l.length;u++)if(Qo(o,l[u]))return!0;for(let u=0;u<o.length;u++)if(On(l,o[u]))return!0;return!1}function dr(l,o,u){if(l.length>1){if(On(l,o))return!0;for(let f=0;f<o.length;f++)if(Jr(o[f],l,u))return!0}for(let f=0;f<l.length;f++)if(Jr(l[f],o,u))return!0;return!1}function On(l,o){if(0===l.length||0===o.length)return!1;for(let u=0;u<l.length-1;u++){const f=l[u],_=l[u+1];for(let x=0;x<o.length-1;x++)if(Zi(f,_,o[x],o[x+1]))return!0}return!1}function Zi(l,o,u,f){return si(l,u,f)!==si(o,u,f)&&si(l,o,u)!==si(l,o,f)}function Jr(l,o,u){const f=u*u;if(1===o.length)return l.distSqr(o[0])<f;for(let _=1;_<o.length;_++)if(rr(l,o[_-1],o[_])<f)return!0;return!1}function rr(l,o,u){const f=o.distSqr(u);if(0===f)return l.distSqr(o);const _=((l.x-o.x)*(u.x-o.x)+(l.y-o.y)*(u.y-o.y))/f;return l.distSqr(_<0?o:_>1?u:u.sub(o)._mult(_)._add(o))}function Qo(l,o){let u,f,_,x=!1;for(let C=0;C<l.length;C++){u=l[C];for(let M=0,A=u.length-1;M<u.length;A=M++)f=u[M],_=u[A],f.y>o.y!=_.y>o.y&&o.x<(_.x-f.x)*(o.y-f.y)/(_.y-f.y)+f.x&&(x=!x)}return x}function Wi(l,o){let u=!1;for(let f=0,_=l.length-1;f<l.length;_=f++){const x=l[f],C=l[_];x.y>o.y!=C.y>o.y&&o.x<(C.x-x.x)*(o.y-x.y)/(C.y-x.y)+x.x&&(u=!u)}return u}function sh(l,o,u){const f=u[0],_=u[2];if(l.x<f.x&&o.x<f.x||l.x>_.x&&o.x>_.x||l.y<f.y&&o.y<f.y||l.y>_.y&&o.y>_.y)return!1;const x=si(l,o,u[0]);return x!==si(l,o,u[1])||x!==si(l,o,u[2])||x!==si(l,o,u[3])}function ma(l,o,u){const f=o.paint.get(l).value;return"constant"===f.kind?f.value:u.programConfigurations.get(o.id).getMaxValue(l)}function Hs(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function ah(l,o,u,f,_){if(!o[0]&&!o[1])return l;const x=It.convert(o)._mult(_);"viewport"===u&&x._rotate(-f);const C=[];for(let M=0;M<l.length;M++)C.push(l[M].sub(x));return C}ct("CircleBucket",Jo,{omit:["layers"]});const xs=new Si({"circle-sort-key":new yt(Ae.layout_circle["circle-sort-key"])});var wd={paint:new Si({"circle-radius":new yt(Ae.paint_circle["circle-radius"]),"circle-color":new yt(Ae.paint_circle["circle-color"]),"circle-blur":new yt(Ae.paint_circle["circle-blur"]),"circle-opacity":new yt(Ae.paint_circle["circle-opacity"]),"circle-translate":new wt(Ae.paint_circle["circle-translate"]),"circle-translate-anchor":new wt(Ae.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new wt(Ae.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new wt(Ae.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yt(Ae.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yt(Ae.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yt(Ae.paint_circle["circle-stroke-opacity"])}),layout:xs},Mr=1e-6,tl=typeof Float32Array<"u"?Float32Array:Array;function qf(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Hm(l,o,u){var f=o[0],_=o[1],x=o[2],C=o[3],M=o[4],A=o[5],F=o[6],O=o[7],B=o[8],H=o[9],q=o[10],W=o[11],se=o[12],oe=o[13],be=o[14],Ce=o[15],me=u[0],Ee=u[1],$e=u[2],Ve=u[3];return l[0]=me*f+Ee*M+$e*B+Ve*se,l[1]=me*_+Ee*A+$e*H+Ve*oe,l[2]=me*x+Ee*F+$e*q+Ve*be,l[3]=me*C+Ee*O+$e*W+Ve*Ce,l[4]=(me=u[4])*f+(Ee=u[5])*M+($e=u[6])*B+(Ve=u[7])*se,l[5]=me*_+Ee*A+$e*H+Ve*oe,l[6]=me*x+Ee*F+$e*q+Ve*be,l[7]=me*C+Ee*O+$e*W+Ve*Ce,l[8]=(me=u[8])*f+(Ee=u[9])*M+($e=u[10])*B+(Ve=u[11])*se,l[9]=me*_+Ee*A+$e*H+Ve*oe,l[10]=me*x+Ee*F+$e*q+Ve*be,l[11]=me*C+Ee*O+$e*W+Ve*Ce,l[12]=(me=u[12])*f+(Ee=u[13])*M+($e=u[14])*B+(Ve=u[15])*se,l[13]=me*_+Ee*A+$e*H+Ve*oe,l[14]=me*x+Ee*F+$e*q+Ve*be,l[15]=me*C+Ee*O+$e*W+Ve*Ce,l}Math.hypot||(Math.hypot=function(){for(var l=0,o=arguments.length;o--;)l+=arguments[o]*arguments[o];return Math.sqrt(l)});var Cd,ga=Hm;function Zf(l,o,u){var f=o[0],_=o[1],x=o[2],C=o[3];return l[0]=u[0]*f+u[4]*_+u[8]*x+u[12]*C,l[1]=u[1]*f+u[5]*_+u[9]*x+u[13]*C,l[2]=u[2]*f+u[6]*_+u[10]*x+u[14]*C,l[3]=u[3]*f+u[7]*_+u[11]*x+u[15]*C,l}function lh(l,o){const u=Zf([],[l.x,l.y,0,1],o);return new It(u[0]/u[3],u[1]/u[3])}Cd=new tl(4),tl!=Float32Array&&(Cd[0]=0,Cd[1]=0,Cd[2]=0,Cd[3]=0);class Wf extends Jo{}ct("HeatmapBucket",Wf,{omit:["layers"]});var Gm={paint:new Si({"heatmap-radius":new yt(Ae.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yt(Ae.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new wt(Ae.paint_heatmap["heatmap-intensity"]),"heatmap-color":new pd(Ae.paint_heatmap["heatmap-color"]),"heatmap-opacity":new wt(Ae.paint_heatmap["heatmap-opacity"])})};function ch(l,{width:o,height:u},f,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==o*u*f)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${o*u*f}`)}else _=new Uint8Array(o*u*f);return l.width=o,l.height=u,l.data=_,l}function Ed(l,{width:o,height:u},f){if(o===l.width&&u===l.height)return;const _=ch({},{width:o,height:u},f);qm(l,_,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,o),height:Math.min(l.height,u)},f),l.width=o,l.height=u,l.data=_.data}function qm(l,o,u,f,_,x){if(0===_.width||0===_.height)return o;if(_.width>l.width||_.height>l.height||u.x>l.width-_.width||u.y>l.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>o.width||_.height>o.height||f.x>o.width-_.width||f.y>o.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const C=l.data,M=o.data;if(C===M)throw new Error("srcData equals dstData, so image is already copied");for(let A=0;A<_.height;A++){const F=((u.y+A)*l.width+u.x)*x,O=((f.y+A)*o.width+f.x)*x;for(let B=0;B<_.width*x;B++)M[O+B]=C[F+B]}return o}class uh{constructor(o,u){ch(this,o,1,u)}resize(o){Ed(this,o,1)}clone(){return new uh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,u,f,_,x){qm(o,u,f,_,x,1)}}class Lo{constructor(o,u){ch(this,o,4,u)}resize(o){Ed(this,o,4)}replace(o,u){u?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Lo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,u,f,_,x){qm(o,u,f,_,x,4)}}function Zm(l){const o={},u=l.resolution||256,f=l.clips?l.clips.length:1,_=l.image||new Lo({width:u,height:f});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const x=(C,M,A)=>{o[l.evaluationKey]=A;const F=l.expression.evaluate(o);_.data[C+M+0]=Math.floor(255*F.r/F.a),_.data[C+M+1]=Math.floor(255*F.g/F.a),_.data[C+M+2]=Math.floor(255*F.b/F.a),_.data[C+M+3]=Math.floor(255*F.a)};if(l.clips)for(let C=0,M=0;C<f;++C,M+=4*u)for(let A=0,F=0;A<u;A++,F+=4){const O=A/(u-1),{start:B,end:H}=l.clips[C];x(M,F,B*(1-O)+H*O)}else for(let C=0,M=0;C<u;C++,M+=4)x(0,M,C/(u-1));return _}ct("AlphaImage",uh),ct("RGBAImage",Lo);var k_={paint:new Si({"hillshade-illumination-direction":new wt(Ae.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new wt(Ae.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new wt(Ae.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new wt(Ae.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new wt(Ae.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new wt(Ae.paint_hillshade["hillshade-accent-color"])})};const Hx=Dr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Xf}=Hx;var nl={};function Yf(l,o,u){u=u||2;var f,_,x,C,M,A,F,O=o&&o.length,B=O?o[0]*u:l.length,H=Wm(l,0,B,u,!0),q=[];if(!H||H.next===H.prev)return q;if(O&&(H=function(se,oe,be,Ce){var me,Ee,$e,Ve=[];for(me=0,Ee=oe.length;me<Ee;me++)($e=Wm(se,oe[me]*Ce,me<Ee-1?oe[me+1]*Ce:se.length,Ce,!1))===$e.next&&($e.steiner=!0),Ve.push(dh($e));for(Ve.sort(P_),me=0;me<Ve.length;me++)be=Dd(Ve[me],be);return be}(l,o,H,u)),l.length>80*u){f=x=l[0],_=C=l[1];for(var W=u;W<B;W+=u)(M=l[W])<f&&(f=M),(A=l[W+1])<_&&(_=A),M>x&&(x=M),A>C&&(C=A);F=0!==(F=Math.max(x-f,C-_))?32767/F:0}return ya(H,q,u,f,_,F,0),q}function Wm(l,o,u,f,_){var x,C;if(_===O_(l,o,u,f)>0)for(x=o;x<u;x+=f)C=Wx(x,l[x],l[x+1],C);else for(x=u-f;x>=o;x-=f)C=Wx(x,l[x],l[x+1],C);return C&&Km(C,C.next)&&(Jf(C),C=C.next),C}function Xl(l,o){if(!l)return l;o||(o=l);var u,f=l;do{if(u=!1,f.steiner||!Km(f,f.next)&&0!==ir(f.prev,f,f.next))f=f.next;else{if(Jf(f),(f=o=f.prev)===f.next)break;u=!0}}while(u||f!==o);return o}function ya(l,o,u,f,_,x,C){if(l){!C&&x&&function(O,B,H,q){var W=O;do{0===W.z&&(W.z=Yl(W.x,W.y,B,H,q)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next}while(W!==O);W.prevZ.nextZ=null,W.prevZ=null,function(se){var oe,be,Ce,me,Ee,$e,Ve,gt,Ct=1;do{for(be=se,se=null,Ee=null,$e=0;be;){for($e++,Ce=be,Ve=0,oe=0;oe<Ct&&(Ve++,Ce=Ce.nextZ);oe++);for(gt=Ct;Ve>0||gt>0&&Ce;)0!==Ve&&(0===gt||!Ce||be.z<=Ce.z)?(me=be,be=be.nextZ,Ve--):(me=Ce,Ce=Ce.nextZ,gt--),Ee?Ee.nextZ=me:se=me,me.prevZ=Ee,Ee=me;be=Ce}Ee.nextZ=null,Ct*=2}while($e>1)}(W)}(l,f,_,x);for(var M,A,F=l;l.prev!==l.next;)if(M=l.prev,A=l.next,x?Xi(l,f,_,x):Gx(l))o.push(M.i/u|0),o.push(l.i/u|0),o.push(A.i/u|0),Jf(l),l=A.next,F=A.next;else if((l=A)===F){C?1===C?ya(l=Xm(Xl(l),o,u),o,u,f,_,x,2):2===C&&qx(l,o,u,f,_,x):ya(Xl(l),o,u,f,_,x,1);break}}}function Gx(l){var o=l.prev,u=l,f=l.next;if(ir(o,u,f)>=0)return!1;for(var _=o.x,x=u.x,C=f.x,M=o.y,A=u.y,F=f.y,O=_<x?_<C?_:C:x<C?x:C,B=M<A?M<F?M:F:A<F?A:F,H=_>x?_>C?_:C:x>C?x:C,q=M>A?M>F?M:F:A>F?A:F,W=f.next;W!==o;){if(W.x>=O&&W.x<=H&&W.y>=B&&W.y<=q&&Zc(_,M,x,A,C,F,W.x,W.y)&&ir(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function Xi(l,o,u,f){var _=l.prev,x=l,C=l.next;if(ir(_,x,C)>=0)return!1;for(var M=_.x,A=x.x,F=C.x,O=_.y,B=x.y,H=C.y,q=M<A?M<F?M:F:A<F?A:F,W=O<B?O<H?O:H:B<H?B:H,se=M>A?M>F?M:F:A>F?A:F,oe=O>B?O>H?O:H:B>H?B:H,be=Yl(q,W,o,u,f),Ce=Yl(se,oe,o,u,f),me=l.prevZ,Ee=l.nextZ;me&&me.z>=be&&Ee&&Ee.z<=Ce;){if(me.x>=q&&me.x<=se&&me.y>=W&&me.y<=oe&&me!==_&&me!==C&&Zc(M,O,A,B,F,H,me.x,me.y)&&ir(me.prev,me,me.next)>=0||(me=me.prevZ,Ee.x>=q&&Ee.x<=se&&Ee.y>=W&&Ee.y<=oe&&Ee!==_&&Ee!==C&&Zc(M,O,A,B,F,H,Ee.x,Ee.y)&&ir(Ee.prev,Ee,Ee.next)>=0))return!1;Ee=Ee.nextZ}for(;me&&me.z>=be;){if(me.x>=q&&me.x<=se&&me.y>=W&&me.y<=oe&&me!==_&&me!==C&&Zc(M,O,A,B,F,H,me.x,me.y)&&ir(me.prev,me,me.next)>=0)return!1;me=me.prevZ}for(;Ee&&Ee.z<=Ce;){if(Ee.x>=q&&Ee.x<=se&&Ee.y>=W&&Ee.y<=oe&&Ee!==_&&Ee!==C&&Zc(M,O,A,B,F,H,Ee.x,Ee.y)&&ir(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.nextZ}return!0}function Xm(l,o,u){var f=l;do{var _=f.prev,x=f.next.next;!Km(_,x)&&R_(_,f,f.next,x)&&Kf(_,x)&&Kf(x,_)&&(o.push(_.i/u|0),o.push(f.i/u|0),o.push(x.i/u|0),Jf(f),Jf(f.next),f=l=x),f=f.next}while(f!==l);return Xl(f)}function qx(l,o,u,f,_,x){var C=l;do{for(var M=C.next.next;M!==C.prev;){if(C.i!==M.i&&Ym(C,M)){var A=Zx(C,M);return C=Xl(C,C.next),A=Xl(A,A.next),ya(C,o,u,f,_,x,0),void ya(A,o,u,f,_,x,0)}M=M.next}C=C.next}while(C!==l)}function P_(l,o){return l.x-o.x}function Dd(l,o){var u=function(_,x){var C,M=x,A=_.x,F=_.y,O=-1/0;do{if(F<=M.y&&F>=M.next.y&&M.next.y!==M.y){var B=M.x+(F-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(B<=A&&B>O&&(O=B,C=M.x<M.next.x?M:M.next,B===A))return C}M=M.next}while(M!==x);if(!C)return null;var H,q=C,W=C.x,se=C.y,oe=1/0;M=C;do{A>=M.x&&M.x>=W&&A!==M.x&&Zc(F<se?A:O,F,W,se,F<se?O:A,F,M.x,M.y)&&(H=Math.abs(F-M.y)/(A-M.x),Kf(M,_)&&(H<oe||H===oe&&(M.x>C.x||M.x===C.x&&hh(C,M)))&&(C=M,oe=H)),M=M.next}while(M!==q);return C}(l,o);if(!u)return o;var f=Zx(u,l);return Xl(f,f.next),Xl(u,u.next)}function hh(l,o){return ir(l.prev,l,o.prev)<0&&ir(o.next,l,l.next)<0}function Yl(l,o,u,f,_){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-u)*_|0)|l<<8))|l<<4))|l<<2))|l<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-f)*_|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function dh(l){var o=l,u=l;do{(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next}while(o!==l);return u}function Zc(l,o,u,f,_,x,C,M){return(_-C)*(o-M)>=(l-C)*(x-M)&&(l-C)*(f-M)>=(u-C)*(o-M)&&(u-C)*(x-M)>=(_-C)*(f-M)}function Ym(l,o){return l.next.i!==o.i&&l.prev.i!==o.i&&!function(u,f){var _=u;do{if(_.i!==u.i&&_.next.i!==u.i&&_.i!==f.i&&_.next.i!==f.i&&R_(_,_.next,u,f))return!0;_=_.next}while(_!==u);return!1}(l,o)&&(Kf(l,o)&&Kf(o,l)&&function(u,f){var _=u,x=!1,C=(u.x+f.x)/2,M=(u.y+f.y)/2;do{_.y>M!=_.next.y>M&&_.next.y!==_.y&&C<(_.next.x-_.x)*(M-_.y)/(_.next.y-_.y)+_.x&&(x=!x),_=_.next}while(_!==u);return x}(l,o)&&(ir(l.prev,l,o.prev)||ir(l,o.prev,o))||Km(l,o)&&ir(l.prev,l,l.next)>0&&ir(o.prev,o,o.next)>0)}function ir(l,o,u){return(o.y-l.y)*(u.x-o.x)-(o.x-l.x)*(u.y-o.y)}function Km(l,o){return l.x===o.x&&l.y===o.y}function R_(l,o,u,f){var _=Jm(ir(l,o,u)),x=Jm(ir(l,o,f)),C=Jm(ir(u,f,l)),M=Jm(ir(u,f,o));return _!==x&&C!==M||!(0!==_||!Tt(l,u,o))||!(0!==x||!Tt(l,f,o))||!(0!==C||!Tt(u,l,f))||!(0!==M||!Tt(u,o,f))}function Tt(l,o,u){return o.x<=Math.max(l.x,u.x)&&o.x>=Math.min(l.x,u.x)&&o.y<=Math.max(l.y,u.y)&&o.y>=Math.min(l.y,u.y)}function Jm(l){return l>0?1:l<0?-1:0}function Kf(l,o){return ir(l.prev,l,l.next)<0?ir(l,o,l.next)>=0&&ir(l,l.prev,o)>=0:ir(l,o,l.prev)<0||ir(l,l.next,o)<0}function Zx(l,o){var u=new F_(l.i,l.x,l.y),f=new F_(o.i,o.x,o.y),_=l.next,x=o.prev;return l.next=o,o.prev=l,u.next=_,_.prev=u,f.next=u,u.prev=f,x.next=f,f.prev=x,f}function Wx(l,o,u,f){var _=new F_(l,o,u);return f?(_.next=f.next,_.prev=f,f.next.prev=_,f.next=_):(_.prev=_,_.next=_),_}function Jf(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function F_(l,o,u){this.i=l,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O_(l,o,u,f){for(var _=0,x=o,C=u-f;x<u;x+=f)_+=(l[C]-l[x])*(l[x+1]+l[C+1]),C=x;return _}function Sd(l,o,u,f,_){Xx(l,o,u||0,f||l.length-1,_||ui)}function Xx(l,o,u,f,_){for(;f>u;){if(f-u>600){var x=f-u+1,C=o-u+1,M=Math.log(x),A=.5*Math.exp(2*M/3),F=.5*Math.sqrt(M*A*(x-A)/x)*(C-x/2<0?-1:1);Xx(l,o,Math.max(u,Math.floor(o-C*A/x+F)),Math.min(f,Math.floor(o+(x-C)*A/x+F)),_)}var O=l[o],B=u,H=f;for(Qf(l,u,o),_(l[f],O)>0&&Qf(l,u,f);B<H;){for(Qf(l,B,H),B++,H--;_(l[B],O)<0;)B++;for(;_(l[H],O)>0;)H--}0===_(l[u],O)?Qf(l,u,H):Qf(l,++H,f),H<=o&&(u=H+1),o<=H&&(f=H-1)}}function Qf(l,o,u){var f=l[o];l[o]=l[u],l[u]=f}function ui(l,o){return l<o?-1:l>o?1:0}function Md(l,o){const u=l.length;if(u<=1)return[l];const f=[];let _,x;for(let C=0;C<u;C++){const M=kc(l[C]);0!==M&&(l[C].area=Math.abs(M),void 0===x&&(x=M<0),x===M<0?(_&&f.push(_),_=[l[C]]):_.push(l[C]))}if(_&&f.push(_),o>1)for(let C=0;C<f.length;C++)f[C].length<=o||(Sd(f[C],o,1,f[C].length-1,Td),f[C]=f[C].slice(0,o));return f}function Td(l,o){return o.area-l.area}function L_(l,o,u){const f=u.patternDependencies;let _=!1;for(const x of o){const C=x.paint.get(`${l}-pattern`);C.isConstant()||(_=!0);const M=C.constantOr(null);M&&(_=!0,f[M.to]=!0,f[M.from]=!0)}return _}function Qm(l,o,u,f,_){const x=_.patternDependencies;for(const C of o){const M=C.paint.get(`${l}-pattern`).value;if("constant"!==M.kind){let A=M.evaluate({zoom:f-1},u,{},_.availableImages),F=M.evaluate({zoom:f},u,{},_.availableImages),O=M.evaluate({zoom:f+1},u,{},_.availableImages);A=A&&A.name?A.name:A,F=F&&F.name?F.name:F,O=O&&O.name?O.name:O,x[A]=!0,x[F]=!0,x[O]=!0,u.patterns[C.id]={min:A,mid:F,max:O}}}return u}({get exports(){return nl},set exports(l){nl=l}}).exports=Yf,nl.default=Yf,Yf.deviation=function(l,o,u,f){var _=o&&o.length,x=Math.abs(O_(l,0,_?o[0]*u:l.length,u));if(_)for(var C=0,M=o.length;C<M;C++)x-=Math.abs(O_(l,o[C]*u,C<M-1?o[C+1]*u:l.length,u));var A=0;for(C=0;C<f.length;C+=3){var F=f[C]*u,O=f[C+1]*u,B=f[C+2]*u;A+=Math.abs((l[F]-l[B])*(l[O+1]-l[F+1])-(l[F]-l[O])*(l[B+1]-l[F+1]))}return 0===x&&0===A?0:Math.abs((A-x)/x)},Yf.flatten=function(l){for(var o=l[0][0].length,u={vertices:[],holes:[],dimensions:o},f=0,_=0;_<l.length;_++){for(var x=0;x<l[_].length;x++)for(var C=0;C<o;C++)u.vertices.push(l[_][x][C]);_>0&&u.holes.push(f+=l[_-1].length)}return u};class _o{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new bs,this.indexArray=new w,this.indexArray2=new S,this.programConfigurations=new Ht(o.layers,o.zoom),this.segments=new R,this.segments2=new R,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,f){this.hasPattern=L_("fill",this.layers,u);const _=this.layers[0].layout.get("fill-sort-key"),x=!_.isConstant(),C=[];for(const{feature:M,id:A,index:F,sourceLayerIndex:O}of o){const B=this.layers[0]._featureFilter.needGeometry,H=ci(M,B);if(!this.layers[0]._featureFilter.filter(new hr(this.zoom),H,f))continue;const q=x?_.evaluate(H,{},f,u.availableImages):void 0,W={id:A,properties:M.properties,type:M.type,sourceLayerIndex:O,index:F,geometry:B?H.geometry:vr(M),patterns:{},sortKey:q};C.push(W)}x&&C.sort((M,A)=>M.sortKey-A.sortKey);for(const M of C){const{geometry:A,index:F,sourceLayerIndex:O}=M;if(this.hasPattern){const B=Qm("fill",this.layers,M,this.zoom,u);this.patternFeatures.push(B)}else this.addFeature(M,A,F,f,{});u.featureIndex.insert(o[F].feature,A,F,O,this.index)}}update(o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f)}addFeatures(o,u,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Xf),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,u,f,_,x){for(const C of Md(u,500)){let M=0;for(const q of C)M+=q.length;const A=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),F=A.vertexLength,O=[],B=[];for(const q of C){if(0===q.length)continue;q!==C[0]&&B.push(O.length/2);const W=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),se=W.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(se+q.length-1,se),O.push(q[0].x),O.push(q[0].y);for(let oe=1;oe<q.length;oe++)this.layoutVertexArray.emplaceBack(q[oe].x,q[oe].y),this.indexArray2.emplaceBack(se+oe-1,se+oe),O.push(q[oe].x),O.push(q[oe].y);W.vertexLength+=q.length,W.primitiveLength+=q.length}const H=nl(O,B);for(let q=0;q<H.length;q+=3)this.indexArray.emplaceBack(F+H[q],F+H[q+1],F+H[q+2]);A.vertexLength+=M,A.primitiveLength+=H.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,x,_)}}ct("FillBucket",_o,{omit:["layers","patternFeatures"]});const rl=new Si({"fill-sort-key":new yt(Ae.layout_fill["fill-sort-key"])});var N_={paint:new Si({"fill-antialias":new wt(Ae.paint_fill["fill-antialias"]),"fill-opacity":new yt(Ae.paint_fill["fill-opacity"]),"fill-color":new yt(Ae.paint_fill["fill-color"]),"fill-outline-color":new yt(Ae.paint_fill["fill-outline-color"]),"fill-translate":new wt(Ae.paint_fill["fill-translate"]),"fill-translate-anchor":new wt(Ae.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ja(Ae.paint_fill["fill-pattern"])}),layout:rl};const ep=Dr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Id=Dr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:z_}=ep;var Kl={},Yx=It,Kx=Ad;function Ad(l,o,u,f,_){this.properties={},this.extent=u,this.type=0,this._pbf=l,this._geometry=-1,this._keys=f,this._values=_,l.readFields(B_,this,o)}function B_(l,o,u){1==l?o.id=u.readVarint():2==l?function(f,_){for(var x=f.readVarint()+f.pos;f.pos<x;){var C=_._keys[f.readVarint()],M=_._values[f.readVarint()];_.properties[C]=M}}(u,o):3==l?o.type=u.readVarint():4==l&&(o._geometry=u.pos)}function es(l){for(var o,u,f=0,_=0,x=l.length,C=x-1;_<x;C=_++)f+=((u=l[C]).x-(o=l[_]).x)*(o.y+u.y);return f}Ad.types=["Unknown","Point","LineString","Polygon"],Ad.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var o,u=l.readVarint()+l.pos,f=1,_=0,x=0,C=0,M=[];l.pos<u;){if(_<=0){var A=l.readVarint();f=7&A,_=A>>3}if(_--,1===f||2===f)x+=l.readSVarint(),C+=l.readSVarint(),1===f&&(o&&M.push(o),o=[]),o.push(new Yx(x,C));else{if(7!==f)throw new Error("unknown command "+f);o&&o.push(o[0].clone())}}return o&&M.push(o),M},Ad.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var o=l.readVarint()+l.pos,u=1,f=0,_=0,x=0,C=1/0,M=-1/0,A=1/0,F=-1/0;l.pos<o;){if(f<=0){var O=l.readVarint();u=7&O,f=O>>3}if(f--,1===u||2===u)(_+=l.readSVarint())<C&&(C=_),_>M&&(M=_),(x+=l.readSVarint())<A&&(A=x),x>F&&(F=x);else if(7!==u)throw new Error("unknown command "+u)}return[C,A,M,F]},Ad.prototype.toGeoJSON=function(l,o,u){var f,_,x=this.extent*Math.pow(2,u),C=this.extent*l,M=this.extent*o,A=this.loadGeometry(),F=Ad.types[this.type];function O(q){for(var W=0;W<q.length;W++){var se=q[W];q[W]=[360*(se.x+C)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(se.y+M)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(f=0;f<A.length;f++)B[f]=A[f][0];O(A=B);break;case 2:for(f=0;f<A.length;f++)O(A[f]);break;case 3:for(A=function(q){var W=q.length;if(W<=1)return[q];for(var se,oe,be=[],Ce=0;Ce<W;Ce++){var me=es(q[Ce]);0!==me&&(void 0===oe&&(oe=me<0),oe===me<0?(se&&be.push(se),se=[q[Ce]]):se.push(q[Ce]))}return se&&be.push(se),be}(A),f=0;f<A.length;f++)for(_=0;_<A[f].length;_++)O(A[f][_])}1===A.length?A=A[0]:F="Multi"+F;var H={type:"Feature",geometry:{type:F,coordinates:A},properties:this.properties};return"id"in this&&(H.id=this.id),H};var eg=Kx,Wc=Jx;function Jx(l,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(V_,this,o),this.length=this._features.length}function V_(l,o,u){15===l?o.version=u.readVarint():1===l?o.name=u.readString():5===l?o.extent=u.readVarint():2===l?o._features.push(u.pos):3===l?o._keys.push(u.readString()):4===l&&o._values.push(function(f){for(var _=null,x=f.readVarint()+f.pos;f.pos<x;){var C=f.readVarint()>>3;_=1===C?f.readString():2===C?f.readFloat():3===C?f.readDouble():4===C?f.readVarint64():5===C?f.readVarint():6===C?f.readSVarint():7===C?f.readBoolean():null}return _}(u))}Jx.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var o=this._pbf.readVarint()+this._pbf.pos;return new eg(this._pbf,o,this.extent,this._keys,this._values)};var Qx=Wc;function e1(l,o,u){if(3===l){var f=new Qx(u,u.readVarint()+u.pos);f.length&&(o[f.name]=f)}}Kl.VectorTile=function(l,o){this.layers=l.readFields(e1,{},o)},Kl.VectorTileFeature=Kx,Kl.VectorTileLayer=Wc;const t1=Kl.VectorTileFeature.types,tg=Math.pow(2,13);function kd(l,o,u,f,_,x,C,M){l.emplaceBack(o,u,2*Math.floor(f*tg)+C,_*tg*2,x*tg*2,Math.round(M))}class ng{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new xd,this.centroidVertexArray=new ih,this.indexArray=new w,this.programConfigurations=new Ht(o.layers,o.zoom),this.segments=new R,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,f){this.features=[],this.hasPattern=L_("fill-extrusion",this.layers,u);for(const{feature:_,id:x,index:C,sourceLayerIndex:M}of o){const A=this.layers[0]._featureFilter.needGeometry,F=ci(_,A);if(!this.layers[0]._featureFilter.filter(new hr(this.zoom),F,f))continue;const O={id:x,sourceLayerIndex:M,index:C,geometry:A?F.geometry:vr(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(Qm("fill-extrusion",this.layers,O,this.zoom,u)):this.addFeature(O,O.geometry,C,f,{}),u.featureIndex.insert(_,O.geometry,C,M,this.index,!0)}}addFeatures(o,u,f){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,u,f)}}update(o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,z_),this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,Id.members,!0),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(o,u,f,_,x){const C={x:0,y:0,vertexCount:0};for(const M of Md(u,500)){let A=0;for(const W of M)A+=W.length;let F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const W of M){if(0===W.length||((l=W).every(o=>o.x<0)||l.every(o=>o.x>yn)||l.every(o=>o.y<0)||l.every(o=>o.y>yn)))continue;let se=0;for(let oe=0;oe<W.length;oe++){const be=W[oe];if(oe>=1){const Ce=W[oe-1];if(!rg(be,Ce)){F.vertexLength+4>R.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const me=be.sub(Ce)._perp()._unit(),Ee=Ce.dist(be);se+Ee>32768&&(se=0),kd(this.layoutVertexArray,be.x,be.y,me.x,me.y,0,0,se),kd(this.layoutVertexArray,be.x,be.y,me.x,me.y,0,1,se),C.x+=2*be.x,C.y+=2*be.y,C.vertexCount+=2,se+=Ee,kd(this.layoutVertexArray,Ce.x,Ce.y,me.x,me.y,0,0,se),kd(this.layoutVertexArray,Ce.x,Ce.y,me.x,me.y,0,1,se),C.x+=2*Ce.x,C.y+=2*Ce.y,C.vertexCount+=2;const $e=F.vertexLength;this.indexArray.emplaceBack($e,$e+2,$e+1),this.indexArray.emplaceBack($e+1,$e+2,$e+3),F.vertexLength+=4,F.primitiveLength+=2}}}}if(F.vertexLength+A>R.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray)),"Polygon"!==t1[o.type])continue;const O=[],B=[],H=F.vertexLength;for(const W of M)if(0!==W.length){W!==M[0]&&B.push(O.length/2);for(let se=0;se<W.length;se++){const oe=W[se];kd(this.layoutVertexArray,oe.x,oe.y,0,0,1,1,0),C.x+=oe.x,C.y+=oe.y,C.vertexCount+=1,O.push(oe.x),O.push(oe.y)}}const q=nl(O,B);for(let W=0;W<q.length;W+=3)this.indexArray.emplaceBack(H+q[W],H+q[W+2],H+q[W+1]);F.primitiveLength+=q.length/3,F.vertexLength+=A}var l;for(let M=0;M<C.vertexCount;M++)this.centroidVertexArray.emplaceBack(Math.floor(C.x/C.vertexCount),Math.floor(C.y/C.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,x,_)}}function rg(l,o){return l.x===o.x&&(l.x<0||l.x>yn)||l.y===o.y&&(l.y<0||l.y>yn)}ct("FillExtrusionBucket",ng,{omit:["layers","features"]});var S2={paint:new Si({"fill-extrusion-opacity":new wt(Ae["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yt(Ae["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new wt(Ae["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new wt(Ae["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ja(Ae["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yt(Ae["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yt(Ae["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new wt(Ae["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function il(l,o){return l.x*o.x+l.y*o.y}function np(l,o){if(1===l.length){let u=0;const f=o[u++];let _;for(;!_||f.equals(_);)if(_=o[u++],!_)return 1/0;for(;u<o.length;u++){const x=o[u],C=l[0],M=_.sub(f),A=x.sub(f),F=C.sub(f),O=il(M,M),B=il(M,A),H=il(A,A),q=il(F,M),W=il(F,A),se=O*H-B*B,oe=(H*q-B*W)/se,be=(O*W-B*q)/se,Ce=f.z*(1-oe-be)+_.z*oe+x.z*be;if(isFinite(Ce))return Ce}return 1/0}{let u=1/0;for(const f of o)u=Math.min(u,f.z);return u}}const rp=Dr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:n1}=rp,r1=Dr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:i1}=r1,U_=Kl.VectorTileFeature.types,Pd=Math.cos(Math.PI/180*37.5),Xc=Math.pow(2,14)/.5;class ig{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new oh,this.layoutVertexArray2=new A_,this.indexArray=new w,this.programConfigurations=new Ht(o.layers,o.zoom),this.segments=new R,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,f){this.hasPattern=L_("line",this.layers,u);const _=this.layers[0].layout.get("line-sort-key"),x=!_.isConstant(),C=[];for(const{feature:M,id:A,index:F,sourceLayerIndex:O}of o){const B=this.layers[0]._featureFilter.needGeometry,H=ci(M,B);if(!this.layers[0]._featureFilter.filter(new hr(this.zoom),H,f))continue;const q=x?_.evaluate(H,{},f):void 0,W={id:A,properties:M.properties,type:M.type,sourceLayerIndex:O,index:F,geometry:B?H.geometry:vr(M),patterns:{},sortKey:q};C.push(W)}x&&C.sort((M,A)=>M.sortKey-A.sortKey);for(const M of C){const{geometry:A,index:F,sourceLayerIndex:O}=M;if(this.hasPattern){const B=Qm("line",this.layers,M,this.zoom,u);this.patternFeatures.push(B)}else this.addFeature(M,A,F,f,{});u.featureIndex.insert(o[F].feature,A,F,O,this.index)}}update(o,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f)}addFeatures(o,u,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,u,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,i1)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,n1),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,u,f,_,x){const C=this.layers[0].layout,M=C.get("line-join").evaluate(o,{}),A=C.get("line-cap"),F=C.get("line-miter-limit"),O=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const B of u)this.addLine(B,o,M,A,F,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,x,_)}addLine(o,u,f,_,x,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let be=0;be<o.length-1;be++)this.totalDistance+=o[be].dist(o[be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M="Polygon"===U_[u.type];let A=o.length;for(;A>=2&&o[A-1].equals(o[A-2]);)A--;let F=0;for(;F<A-1&&o[F].equals(o[F+1]);)F++;if(A<(M?3:2))return;"bevel"===f&&(x=1.05);const O=this.overscaling<=16?122880/(512*this.overscaling):0,B=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let H,q,W,se,oe;this.e1=this.e2=-1,M&&(H=o[A-2],oe=o[F].sub(H)._unit()._perp());for(let be=F;be<A;be++){if(W=be===A-1?M?o[F+1]:void 0:o[be+1],W&&o[be].equals(W))continue;oe&&(se=oe),H&&(q=H),H=o[be],oe=W?W.sub(H)._unit()._perp():se,se=se||oe;let Ce=se.add(oe);0===Ce.x&&0===Ce.y||Ce._unit();const me=se.x*oe.x+se.y*oe.y,Ee=Ce.x*oe.x+Ce.y*oe.y,$e=0!==Ee?1/Ee:1/0,Ve=2*Math.sqrt(2-2*Ee),gt=Ee<Pd&&q&&W,Ct=se.x*oe.y-se.y*oe.x>0;if(gt&&be>F){const Qe=H.dist(q);if(Qe>2*O){const ot=H.sub(H.sub(q)._mult(O/Qe)._round());this.updateDistance(q,ot),this.addCurrentVertex(ot,se,0,0,B),q=ot}}const at=q&&W;let tt=at?f:M?"butt":_;if(at&&"round"===tt&&($e<C?tt="miter":$e<=2&&(tt="fakeround")),"miter"===tt&&$e>x&&(tt="bevel"),"bevel"===tt&&($e>2&&(tt="flipbevel"),$e<x&&(tt="miter")),q&&this.updateDistance(q,H),"miter"===tt)Ce._mult($e),this.addCurrentVertex(H,Ce,0,0,B);else if("flipbevel"===tt){if($e>100)Ce=oe.mult(-1);else{const Qe=$e*se.add(oe).mag()/se.sub(oe).mag();Ce._perp()._mult(Qe*(Ct?-1:1))}this.addCurrentVertex(H,Ce,0,0,B),this.addCurrentVertex(H,Ce.mult(-1),0,0,B)}else if("bevel"===tt||"fakeround"===tt){const Qe=-Math.sqrt($e*$e-1),ot=Ct?Qe:0,it=Ct?0:Qe;if(q&&this.addCurrentVertex(H,se,ot,it,B),"fakeround"===tt){const Ge=Math.round(180*Ve/Math.PI/20);for(let Et=1;Et<Ge;Et++){let pt=Et/Ge;if(.5!==pt){const Qn=pt-.5;pt+=pt*Qn*(pt-1)*((1.0904+me*(me*(3.55645-1.43519*me)-3.2452))*Qn*Qn+(.848013+me*(.215638*me-1.06021)))}const Yt=oe.sub(se)._mult(pt)._add(se)._unit()._mult(Ct?-1:1);this.addHalfVertex(H,Yt.x,Yt.y,!1,Ct,0,B)}}W&&this.addCurrentVertex(H,oe,-ot,-it,B)}else if("butt"===tt)this.addCurrentVertex(H,Ce,0,0,B);else if("square"===tt){const Qe=q?1:-1;this.addCurrentVertex(H,Ce,Qe,Qe,B)}else"round"===tt&&(q&&(this.addCurrentVertex(H,se,0,0,B),this.addCurrentVertex(H,se,1,1,B,!0)),W&&(this.addCurrentVertex(H,oe,-1,-1,B,!0),this.addCurrentVertex(H,oe,0,0,B)));if(gt&&be<A-1){const Qe=H.dist(W);if(Qe>2*O){const ot=H.add(W.sub(H)._mult(O/Qe)._round());this.updateDistance(H,ot),this.addCurrentVertex(ot,oe,0,0,B),H=ot}}}}addCurrentVertex(o,u,f,_,x,C=!1){const M=u.y*_-u.x,A=-u.y-u.x*_;this.addHalfVertex(o,u.x+u.y*f,u.y-u.x*f,C,!1,f,x),this.addHalfVertex(o,M,A,C,!0,-_,x),this.distance>Xc/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(o,u,f,_,x,C))}addHalfVertex({x:o,y:u},f,_,x,C,M,A){const F=.5*(this.lineClips?this.scaledDistance*(Xc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o<<1)+(x?1:0),(u<<1)+(C?1:0),Math.round(63*f)+128,Math.round(63*_)+128,1+(0===M?0:M<0?-1:1)|(63&F)<<2,F>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const O=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),A.primitiveLength++),C?this.e2=O:this.e1=O}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(o,u){this.distance+=o.dist(u),this.updateScaledDistance()}}ct("LineBucket",ig,{omit:["layers","patternFeatures"]});const St=new Si({"line-cap":new wt(Ae.layout_line["line-cap"]),"line-join":new yt(Ae.layout_line["line-join"]),"line-miter-limit":new wt(Ae.layout_line["line-miter-limit"]),"line-round-limit":new wt(Ae.layout_line["line-round-limit"]),"line-sort-key":new yt(Ae.layout_line["line-sort-key"])});var og={paint:new Si({"line-opacity":new yt(Ae.paint_line["line-opacity"]),"line-color":new yt(Ae.paint_line["line-color"]),"line-translate":new wt(Ae.paint_line["line-translate"]),"line-translate-anchor":new wt(Ae.paint_line["line-translate-anchor"]),"line-width":new yt(Ae.paint_line["line-width"]),"line-gap-width":new yt(Ae.paint_line["line-gap-width"]),"line-offset":new yt(Ae.paint_line["line-offset"]),"line-blur":new yt(Ae.paint_line["line-blur"]),"line-dasharray":new fd(Ae.paint_line["line-dasharray"]),"line-pattern":new Ja(Ae.paint_line["line-pattern"]),"line-gradient":new pd(Ae.paint_line["line-gradient"])}),layout:St};const Or=new class extends yt{possiblyEvaluate(l,o){return o=new hr(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(l,o)}evaluate(l,o,u,f){return o=Bi({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(l,o,u,f)}}(og.paint.properties["line-width"].specification);function ip(l,o){return o>0?o+2*l:l}Or.useIntegerZoom=!0;const Rd=Dr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),o1=Dr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Dr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const s1=Dr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Dr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $_=Dr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),sg=Dr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Fd(l,o,u){return l.sections.forEach(f=>{f.text=function(_,x,C){const M=x.layout.get("text-transform").evaluate(C,{});return"uppercase"===M?_=_.toLocaleUpperCase():"lowercase"===M&&(_=_.toLocaleLowerCase()),go.applyArabicShaping&&(_=go.applyArabicShaping(_)),_}(f.text,o,u)}),l}Dr([{name:"triangle",components:3,type:"Uint16"}]),Dr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Dr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Dr([{type:"Float32",name:"offsetX"}]),Dr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const fh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};var ag=Ln,lg=function(l,o,u,f,_){var x,C,M=8*_-f-1,A=(1<<M)-1,F=A>>1,O=-7,B=u?_-1:0,H=u?-1:1,q=l[o+B];for(B+=H,x=q&(1<<-O)-1,q>>=-O,O+=M;O>0;x=256*x+l[o+B],B+=H,O-=8);for(C=x&(1<<-O)-1,x>>=-O,O+=f;O>0;C=256*C+l[o+B],B+=H,O-=8);if(0===x)x=1-F;else{if(x===A)return C?NaN:1/0*(q?-1:1);C+=Math.pow(2,f),x-=F}return(q?-1:1)*C*Math.pow(2,x-f)},ph=function(l,o,u,f,_,x){var C,M,A,F=8*x-_-1,O=(1<<F)-1,B=O>>1,H=23===_?Math.pow(2,-24)-Math.pow(2,-77):0,q=f?0:x-1,W=f?1:-1,se=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(M=isNaN(o)?1:0,C=O):(C=Math.floor(Math.log(o)/Math.LN2),o*(A=Math.pow(2,-C))<1&&(C--,A*=2),(o+=C+B>=1?H/A:H*Math.pow(2,1-B))*A>=2&&(C++,A/=2),C+B>=O?(M=0,C=O):C+B>=1?(M=(o*A-1)*Math.pow(2,_),C+=B):(M=o*Math.pow(2,B-1)*Math.pow(2,_),C=0));_>=8;l[u+q]=255&M,q+=W,M/=256,_-=8);for(C=C<<_|M,F+=_;F>0;l[u+q]=255&C,q+=W,C/=256,F-=8);l[u+q-W]|=128*se};function Ln(l){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(l)?l:new Uint8Array(l||0),this.pos=0,this.type=0,this.length=this.buf.length}Ln.Varint=0,Ln.Fixed64=1,Ln.Bytes=2,Ln.Fixed32=5;var ol,cg=4294967296,j_=1/cg,Yc=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ts(l){return l.type===Ln.Bytes?l.readVarint()+l.pos:l.pos+1}function a1(l,o,u){var f=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(f);for(var _=u.pos-1;_>=l;_--)u.buf[_+f]=u.buf[_]}function H_(l,o){for(var u=0;u<l.length;u++)o.writeVarint(l[u])}function l1(l,o){for(var u=0;u<l.length;u++)o.writeSVarint(l[u])}function M2(l,o){for(var u=0;u<l.length;u++)o.writeFloat(l[u])}function c1(l,o){for(var u=0;u<l.length;u++)o.writeDouble(l[u])}function u1(l,o){for(var u=0;u<l.length;u++)o.writeBoolean(l[u])}function h1(l,o){for(var u=0;u<l.length;u++)o.writeFixed32(l[u])}function op(l,o){for(var u=0;u<l.length;u++)o.writeSFixed32(l[u])}function G_(l,o){for(var u=0;u<l.length;u++)o.writeFixed64(l[u])}function d1(l,o){for(var u=0;u<l.length;u++)o.writeSFixed64(l[u])}function Od(l,o){return(l[o]|l[o+1]<<8|l[o+2]<<16)+16777216*l[o+3]}function Ld(l,o,u){l[u]=o,l[u+1]=o>>>8,l[u+2]=o>>>16,l[u+3]=o>>>24}function ug(l,o){return(l[o]|l[o+1]<<8|l[o+2]<<16)+(l[o+3]<<24)}function T2(l,o,u){1===l&&u.readMessage(f1,o)}function f1(l,o,u){if(3===l){const{id:f,bitmap:_,width:x,height:C,left:M,top:A,advance:F}=u.readMessage(p1,{});o.push({id:f,bitmap:new uh({width:x+6,height:C+6},_),metrics:{width:x,height:C,left:M,top:A,advance:F}})}}function p1(l,o,u){1===l?o.id=u.readVarint():2===l?o.bitmap=u.readBytes():3===l?o.width=u.readVarint():4===l?o.height=u.readVarint():5===l?o.left=u.readSVarint():6===l?o.top=u.readSVarint():7===l&&(o.advance=u.readVarint())}function sp(l){let o=0,u=0;for(const C of l)o+=C.w*C.h,u=Math.max(u,C.w);l.sort((C,M)=>M.h-C.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}];let _=0,x=0;for(const C of l)for(let M=f.length-1;M>=0;M--){const A=f[M];if(!(C.w>A.w||C.h>A.h)){if(C.x=A.x,C.y=A.y,x=Math.max(x,C.y+C.h),_=Math.max(_,C.x+C.w),C.w===A.w&&C.h===A.h){const F=f.pop();M<f.length&&(f[M]=F)}else C.h===A.h?(A.x+=C.w,A.w-=C.w):C.w===A.w?(A.y+=C.h,A.h-=C.h):(f.push({x:A.x+C.w,y:A.y,w:A.w-C.w,h:C.h}),A.y+=C.h,A.h-=C.h);break}}return{w:_,h:x,fill:o/(_*x)||0}}Ln.prototype={destroy:function(){this.buf=null},readFields:function(l,o,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),_=f>>3,x=this.pos;this.type=7&f,l(_,o,this),this.pos===x&&this.skip(f)}return o},readMessage:function(l,o){return this.readFields(l,o,this.readVarint()+this.pos)},readFixed32:function(){var l=Od(this.buf,this.pos);return this.pos+=4,l},readSFixed32:function(){var l=ug(this.buf,this.pos);return this.pos+=4,l},readFixed64:function(){var l=Od(this.buf,this.pos)+Od(this.buf,this.pos+4)*cg;return this.pos+=8,l},readSFixed64:function(){var l=Od(this.buf,this.pos)+ug(this.buf,this.pos+4)*cg;return this.pos+=8,l},readFloat:function(){var l=lg(this.buf,this.pos,!0,23,4);return this.pos+=4,l},readDouble:function(){var l=lg(this.buf,this.pos,!0,52,8);return this.pos+=8,l},readVarint:function(l){var o,u,f=this.buf;return o=127&(u=f[this.pos++]),u<128?o:(o|=(127&(u=f[this.pos++]))<<7,u<128?o:(o|=(127&(u=f[this.pos++]))<<14,u<128?o:(o|=(127&(u=f[this.pos++]))<<21,u<128?o:function(_,x,C){var M,A,F=C.buf;if(M=(112&(A=F[C.pos++]))>>4,A<128||(M|=(127&(A=F[C.pos++]))<<3,A<128)||(M|=(127&(A=F[C.pos++]))<<10,A<128)||(M|=(127&(A=F[C.pos++]))<<17,A<128)||(M|=(127&(A=F[C.pos++]))<<24,A<128)||(M|=(1&(A=F[C.pos++]))<<31,A<128))return function mh(l,o,u){return u?4294967296*o+(l>>>0):4294967296*(o>>>0)+(l>>>0)}(_,M,x);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=f[this.pos]))<<28,l,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var l=this.readVarint();return l%2==1?(l+1)/-2:l/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var l=this.readVarint()+this.pos,o=this.pos;return this.pos=l,l-o>=12&&Yc?Yc.decode(this.buf.subarray(o,l)):function(u,f,_){for(var x="",C=f;C<_;){var M,A,F,O=u[C],B=null,H=O>239?4:O>223?3:O>191?2:1;if(C+H>_)break;1===H?O<128&&(B=O):2===H?128==(192&(M=u[C+1]))&&(B=(31&O)<<6|63&M)<=127&&(B=null):3===H?(A=u[C+2],128==(192&(M=u[C+1]))&&128==(192&A)&&((B=(15&O)<<12|(63&M)<<6|63&A)<=2047||B>=55296&&B<=57343)&&(B=null)):4===H&&(A=u[C+2],F=u[C+3],128==(192&(M=u[C+1]))&&128==(192&A)&&128==(192&F)&&((B=(15&O)<<18|(63&M)<<12|(63&A)<<6|63&F)<=65535||B>=1114112)&&(B=null)),null===B?(B=65533,H=1):B>65535&&(B-=65536,x+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),x+=String.fromCharCode(B),C+=H}return x}(this.buf,o,l)},readBytes:function(){var l=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,l);return this.pos=l,o},readPackedVarint:function(l,o){if(this.type!==Ln.Bytes)return l.push(this.readVarint(o));var u=ts(this);for(l=l||[];this.pos<u;)l.push(this.readVarint(o));return l},readPackedSVarint:function(l){if(this.type!==Ln.Bytes)return l.push(this.readSVarint());var o=ts(this);for(l=l||[];this.pos<o;)l.push(this.readSVarint());return l},readPackedBoolean:function(l){if(this.type!==Ln.Bytes)return l.push(this.readBoolean());var o=ts(this);for(l=l||[];this.pos<o;)l.push(this.readBoolean());return l},readPackedFloat:function(l){if(this.type!==Ln.Bytes)return l.push(this.readFloat());var o=ts(this);for(l=l||[];this.pos<o;)l.push(this.readFloat());return l},readPackedDouble:function(l){if(this.type!==Ln.Bytes)return l.push(this.readDouble());var o=ts(this);for(l=l||[];this.pos<o;)l.push(this.readDouble());return l},readPackedFixed32:function(l){if(this.type!==Ln.Bytes)return l.push(this.readFixed32());var o=ts(this);for(l=l||[];this.pos<o;)l.push(this.readFixed32());return l},readPackedSFixed32:function(l){if(this.type!==Ln.Bytes)return l.push(this.readSFixed32());var o=ts(this);for(l=l||[];this.pos<o;)l.push(this.readSFixed32());return l},readPackedFixed64:function(l){if(this.type!==Ln.Bytes)return l.push(this.readFixed64());var o=ts(this);for(l=l||[];this.pos<o;)l.push(this.readFixed64());return l},readPackedSFixed64:function(l){if(this.type!==Ln.Bytes)return l.push(this.readSFixed64());var o=ts(this);for(l=l||[];this.pos<o;)l.push(this.readSFixed64());return l},skip:function(l){var o=7&l;if(o===Ln.Varint)for(;this.buf[this.pos++]>127;);else if(o===Ln.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Ln.Fixed32)this.pos+=4;else{if(o!==Ln.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(l,o){this.writeVarint(l<<3|o)},realloc:function(l){for(var o=this.length||16;o<this.pos+l;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(l){this.realloc(4),Ld(this.buf,l,this.pos),this.pos+=4},writeSFixed32:function(l){this.realloc(4),Ld(this.buf,l,this.pos),this.pos+=4},writeFixed64:function(l){this.realloc(8),Ld(this.buf,-1&l,this.pos),Ld(this.buf,Math.floor(l*j_),this.pos+4),this.pos+=8},writeSFixed64:function(l){this.realloc(8),Ld(this.buf,-1&l,this.pos),Ld(this.buf,Math.floor(l*j_),this.pos+4),this.pos+=8},writeVarint:function(l){(l=+l||0)>268435455||l<0?function(o,u){var f,_,x,M;if(o>=0?(f=o%4294967296|0,_=o/4294967296|0):(_=~(-o/4294967296),4294967295^(f=~(-o%4294967296))?f=f+1|0:(f=0,_=_+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),x=f,(M=u).buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,M.buf[M.pos]=127&(x>>>=7),function(x,C){var M=(7&x)<<4;C.buf[C.pos++]|=M|((x>>>=3)?128:0),x&&(C.buf[C.pos++]=127&x|((x>>>=7)?128:0),x&&(C.buf[C.pos++]=127&x|((x>>>=7)?128:0),x&&(C.buf[C.pos++]=127&x|((x>>>=7)?128:0),x&&(C.buf[C.pos++]=127&x|((x>>>=7)?128:0),x&&(C.buf[C.pos++]=127&x)))))}(_,u)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))},writeSVarint:function(l){this.writeVarint(l<0?2*-l-1:2*l)},writeBoolean:function(l){this.writeVarint(Boolean(l))},writeString:function(l){l=String(l),this.realloc(4*l.length),this.pos++;var o=this.pos;this.pos=function(f,_,x){for(var C,M,A=0;A<_.length;A++){if((C=_.charCodeAt(A))>55295&&C<57344){if(!M){C>56319||A+1===_.length?(f[x++]=239,f[x++]=191,f[x++]=189):M=C;continue}if(C<56320){f[x++]=239,f[x++]=191,f[x++]=189,M=C;continue}C=M-55296<<10|C-56320|65536,M=null}else M&&(f[x++]=239,f[x++]=191,f[x++]=189,M=null);C<128?f[x++]=C:(C<2048?f[x++]=C>>6|192:(C<65536?f[x++]=C>>12|224:(f[x++]=C>>18|240,f[x++]=C>>12&63|128),f[x++]=C>>6&63|128),f[x++]=63&C|128)}return x}(this.buf,l,this.pos);var u=this.pos-o;u>=128&&a1(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(l){this.realloc(4),ph(this.buf,l,this.pos,!0,23,4),this.pos+=4},writeDouble:function(l){this.realloc(8),ph(this.buf,l,this.pos,!0,52,8),this.pos+=8},writeBytes:function(l){var o=l.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=l[u]},writeRawMessage:function(l,o){this.pos++;var u=this.pos;l(o,this);var f=this.pos-u;f>=128&&a1(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(l,o,u){this.writeTag(l,Ln.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(l,o){o.length&&this.writeMessage(l,H_,o)},writePackedSVarint:function(l,o){o.length&&this.writeMessage(l,l1,o)},writePackedBoolean:function(l,o){o.length&&this.writeMessage(l,u1,o)},writePackedFloat:function(l,o){o.length&&this.writeMessage(l,M2,o)},writePackedDouble:function(l,o){o.length&&this.writeMessage(l,c1,o)},writePackedFixed32:function(l,o){o.length&&this.writeMessage(l,h1,o)},writePackedSFixed32:function(l,o){o.length&&this.writeMessage(l,op,o)},writePackedFixed64:function(l,o){o.length&&this.writeMessage(l,G_,o)},writePackedSFixed64:function(l,o){o.length&&this.writeMessage(l,d1,o)},writeBytesField:function(l,o){this.writeTag(l,Ln.Bytes),this.writeBytes(o)},writeFixed32Field:function(l,o){this.writeTag(l,Ln.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(l,o){this.writeTag(l,Ln.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(l,o){this.writeTag(l,Ln.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(l,o){this.writeTag(l,Ln.Fixed64),this.writeSFixed64(o)},writeVarintField:function(l,o){this.writeTag(l,Ln.Varint),this.writeVarint(o)},writeSVarintField:function(l,o){this.writeTag(l,Ln.Varint),this.writeSVarint(o)},writeStringField:function(l,o){this.writeTag(l,Ln.Bytes),this.writeString(o)},writeFloatField:function(l,o){this.writeTag(l,Ln.Fixed32),this.writeFloat(o)},writeDoubleField:function(l,o){this.writeTag(l,Ln.Fixed64),this.writeDouble(o)},writeBooleanField:function(l,o){this.writeVarintField(l,Boolean(o))}};class q_{constructor(o,{pixelRatio:u,version:f,stretchX:_,stretchY:x,content:C}){this.paddedRect=o,this.pixelRatio=u,this.stretchX=_,this.stretchY=x,this.content=C,this.version=f}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class m1{constructor(o,u){const f={},_={};this.haveRenderCallbacks=[];const x=[];this.addImages(o,f,x),this.addImages(u,_,x);const{w:C,h:M}=sp(x),A=new Lo({width:C||1,height:M||1});for(const F in o){const O=o[F],B=f[F].paddedRect;Lo.copy(O.data,A,{x:0,y:0},{x:B.x+1,y:B.y+1},O.data)}for(const F in u){const O=u[F],B=_[F].paddedRect,H=B.x+1,q=B.y+1,W=O.data.width,se=O.data.height;Lo.copy(O.data,A,{x:0,y:0},{x:H,y:q},O.data),Lo.copy(O.data,A,{x:0,y:se-1},{x:H,y:q-1},{width:W,height:1}),Lo.copy(O.data,A,{x:0,y:0},{x:H,y:q+se},{width:W,height:1}),Lo.copy(O.data,A,{x:W-1,y:0},{x:H-1,y:q},{width:1,height:se}),Lo.copy(O.data,A,{x:0,y:0},{x:H+W,y:q},{width:1,height:se})}this.image=A,this.iconPositions=f,this.patternPositions=_}addImages(o,u,f){for(const _ in o){const x=o[_],C={x:0,y:0,w:x.data.width+2,h:x.data.height+2};f.push(C),u[_]=new q_(C,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(o,u){o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in o.updatedImages)this.patchUpdatedImage(this.iconPositions[f],o.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],o.getImage(f),u)}patchUpdatedImage(o,u,f){if(!o||!u||o.version===u.version)return;o.version=u.version;const[_,x]=o.tl;f.update(u.data,void 0,{x:_,y:x})}}ct("ImagePosition",q_),ct("ImageAtlas",m1),b.WritingMode=void 0,(ol=b.WritingMode||(b.WritingMode={}))[ol.none=0]="none",ol[ol.horizontal=1]="horizontal",ol[ol.vertical=2]="vertical",ol[ol.horizontalOnly=3]="horizontalOnly";class ap{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,u){const f=new ap;return f.scale=o||1,f.fontStack=u,f}static forImage(o){const u=new ap;return u.imageName=o,u}}class Nd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,u){const f=new Nd;for(let _=0;_<o.sections.length;_++){const x=o.sections[_];x.image?f.addImageSection(x):f.addTextSection(x,u)}return f}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(){this.text=function(o){let u="";for(let f=0;f<o.length;f++){const _=o.charCodeAt(f+1)||null,x=o.charCodeAt(f-1)||null;u+=_&&Po(_)&&!fh[o[f+1]]||x&&Po(x)&&!fh[o[f-1]]||!fh[o[f]]?o[f]:fh[o[f]]}return u}(this.text)}trim(){let o=0;for(let f=0;f<this.text.length&&dg[this.text.charCodeAt(f)];f++)o++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=o&&dg[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(o,u),this.sectionIndex=this.sectionIndex.slice(o,u)}substring(o,u){const f=new Nd;return f.text=this.text.substring(o,u),f.sectionIndex=this.sectionIndex.slice(o,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,u)=>Math.max(o,this.sections[u].scale),0)}addTextSection(o,u){this.text+=o.text,this.sections.push(ap.forText(o.scale,o.fontStack||u));const f=this.sections.length-1;for(let _=0;_<o.text.length;++_)this.sectionIndex.push(f)}addImageSection(o){const u=o.image?o.image.name:"";if(0===u.length)return void fn("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(ap.forImage(u)),this.sectionIndex.push(this.sections.length-1)):fn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hg(l,o,u,f,_,x,C,M,A,F,O,B,H,q,W,se){const oe=Nd.fromFeature(l,_);let be;B===b.WritingMode.vertical&&oe.verticalizePunctuation();const{processBidirectionalText:Ce,processStyledBidirectionalText:me}=go;if(Ce&&1===oe.sections.length){be=[];const Ve=Ce(oe.toString(),lp(oe,F,x,o,f,q,W));for(const gt of Ve){const Ct=new Nd;Ct.text=gt,Ct.sections=oe.sections;for(let at=0;at<gt.length;at++)Ct.sectionIndex.push(0);be.push(Ct)}}else if(me){be=[];const Ve=me(oe.text,oe.sectionIndex,lp(oe,F,x,o,f,q,W));for(const gt of Ve){const Ct=new Nd;Ct.text=gt[0],Ct.sectionIndex=gt[1],Ct.sections=oe.sections,be.push(Ct)}}else be=function(Ve,gt){const Ct=[],at=Ve.text;let tt=0;for(const Qe of gt)Ct.push(Ve.substring(tt,Qe)),tt=Qe;return tt<at.length&&Ct.push(Ve.substring(tt,at.length)),Ct}(oe,lp(oe,F,x,o,f,q,W));const Ee=[],$e={positionedLines:Ee,text:oe.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:B,iconsInText:!1,verticalizable:!1};return function(Ve,gt,Ct,at,tt,Qe,ot,it,Ge,Et,pt,Yt){let Qn=0,or=-17,Lr=0,ws=0;const Ai="right"===it?1:"left"===it?0:.5;let Gr=0;for(const Ar of tt){Ar.trim();const yi=Ar.getMaxScale(),ki=24*(yi-1),Ji={positionedGlyphs:[],lineOffset:0};Ve.positionedLines[Gr]=Ji;const bo=Ji.positionedGlyphs;let Qi=0;if(!Ar.length()){or+=Qe,++Gr;continue}for(let _i=0;_i<Ar.length();_i++){const Qt=Ar.getSection(_i),Bo=Ar.getSectionIndex(_i),_n=Ar.getCharCode(_i);let Pi=0,Cs=null,ns=null,Es=null,al=24;const Ds=!(Ge===b.WritingMode.horizontal||!pt&&!Vl(_n)||pt&&(dg[_n]||(Nr=_n,Xe.Arabic(Nr)||Xe["Arabic Supplement"](Nr)||Xe["Arabic Extended-A"](Nr)||Xe["Arabic Presentation Forms-A"](Nr)||Xe["Arabic Presentation Forms-B"](Nr))));if(Qt.imageName){const rs=at[Qt.imageName];if(!rs)continue;Es=Qt.imageName,Ve.iconsInText=Ve.iconsInText||!0,ns=rs.paddedRect;const xo=rs.displaySize;Qt.scale=24*Qt.scale/Yt,Cs={width:xo[0],height:xo[1],left:1,top:-3,advance:Ds?xo[1]:xo[0]},Pi=ki+(24-xo[1]*Qt.scale),al=Cs.advance;const ll=Ds?xo[0]*Qt.scale-24*yi:xo[1]*Qt.scale-24*yi;ll>0&&ll>Qi&&(Qi=ll)}else{const rs=Ct[Qt.fontStack],xo=rs&&rs[_n];if(xo&&xo.rect)ns=xo.rect,Cs=xo.metrics;else{const ll=gt[Qt.fontStack],xp=ll&&ll[_n];if(!xp)continue;Cs=xp.metrics}Pi=24*(yi-Qt.scale)}Ds?(Ve.verticalizable=!0,bo.push({glyph:_n,imageName:Es,x:Qn,y:or+Pi,vertical:Ds,scale:Qt.scale,fontStack:Qt.fontStack,sectionIndex:Bo,metrics:Cs,rect:ns}),Qn+=al*Qt.scale+Et):(bo.push({glyph:_n,imageName:Es,x:Qn,y:or+Pi,vertical:Ds,scale:Qt.scale,fontStack:Qt.fontStack,sectionIndex:Bo,metrics:Cs,rect:ns}),Qn+=Cs.advance*Qt.scale+Et)}0!==bo.length&&(Lr=Math.max(Qn-Et,Lr),g1(bo,0,bo.length-1,Ai,Qi)),Qn=0;const fr=Qe*yi+Qi;Ji.lineOffset=Math.max(Qi,ki),or+=fr,ws=Math.max(fr,ws),++Gr}var Nr;const Qr=or- -17,{horizontalAlign:Ki,verticalAlign:zo}=Yi(ot);(function(Ar,yi,ki,Ji,bo,Qi,fr,_i,Qt){const Bo=(yi-ki)*bo;let _n=0;_n=Qi!==fr?-_i*Ji- -17:(-Ji*Qt+.5)*fr;for(const Pi of Ar)for(const Cs of Pi.positionedGlyphs)Cs.x+=Bo,Cs.y+=_n})(Ve.positionedLines,Ai,Ki,zo,Lr,ws,Qe,Qr,tt.length),Ve.top+=-zo*Qr,Ve.bottom=Ve.top+Qr,Ve.left+=-Ki*Lr,Ve.right=Ve.left+Lr}($e,o,u,f,be,C,M,A,B,F,H,se),!function(Ve){for(const gt of Ve)if(0!==gt.positionedGlyphs.length)return!1;return!0}(Ee)&&$e}const dg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},I2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Z_(l,o,u,f,_,x){if(o.imageName){const C=f[o.imageName];return C?C.displaySize[0]*o.scale*24/x+_:0}{const C=u[o.fontStack],M=C&&C[l];return M?M.metrics.advance*o.scale+_:0}}function fg(l,o,u,f){const _=Math.pow(l-o,2);return f?l<o?_/2:2*_:_+Math.abs(u)*u}function pg(l,o,u){let f=0;return 10===l&&(f-=1e4),u&&(f+=150),40!==l&&65288!==l||(f+=50),41!==o&&65289!==o||(f+=50),f}function mg(l,o,u,f,_,x){let C=null,M=fg(o,u,_,x);for(const A of f){const F=fg(o-A.x,u,_,x)+A.badness;F<=M&&(C=A,M=F)}return{index:l,x:o,priorBreak:C,badness:M}}function gg(l){return l?gg(l.priorBreak).concat(l.index):[]}function lp(l,o,u,f,_,x,C){if("point"!==x)return[];if(!l)return[];const M=[],A=function(H,q,W,se,oe,be){let Ce=0;for(let me=0;me<H.length();me++){const Ee=H.getSection(me);Ce+=Z_(H.getCharCode(me),Ee,se,oe,q,be)}return Ce/Math.max(1,Math.ceil(Ce/W))}(l,o,u,f,_,C),F=l.text.indexOf("\u200b")>=0;let O=0;for(let H=0;H<l.length();H++){const q=l.getSection(H),W=l.getCharCode(H);if(dg[W]||(O+=Z_(W,q,f,_,o,C)),H<l.length()-1){const se=!((B=W)<11904||!(Xe["Bopomofo Extended"](B)||Xe.Bopomofo(B)||Xe["CJK Compatibility Forms"](B)||Xe["CJK Compatibility Ideographs"](B)||Xe["CJK Compatibility"](B)||Xe["CJK Radicals Supplement"](B)||Xe["CJK Strokes"](B)||Xe["CJK Symbols and Punctuation"](B)||Xe["CJK Unified Ideographs Extension A"](B)||Xe["CJK Unified Ideographs"](B)||Xe["Enclosed CJK Letters and Months"](B)||Xe["Halfwidth and Fullwidth Forms"](B)||Xe.Hiragana(B)||Xe["Ideographic Description Characters"](B)||Xe["Kangxi Radicals"](B)||Xe["Katakana Phonetic Extensions"](B)||Xe.Katakana(B)||Xe["Vertical Forms"](B)||Xe["Yi Radicals"](B)||Xe["Yi Syllables"](B)));(I2[W]||se||q.imageName)&&M.push(mg(H+1,O,A,M,pg(W,l.getCharCode(H+1),se&&F),!1))}}var B;return gg(mg(l.length(),O,A,M,0,!0))}function Yi(l){let o=.5,u=.5;switch(l){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function g1(l,o,u,f,_){if(!f&&!_)return;const x=l[u],C=(l[u].x+x.metrics.advance*x.scale)*f;for(let M=o;M<=u;M++)l[M].x-=C,l[M].y+=_}function y1(l,o,u){const{horizontalAlign:f,verticalAlign:_}=Yi(u),x=o[0]-l.displaySize[0]*f,C=o[1]-l.displaySize[1]*_;return{image:l,top:C,bottom:C+l.displaySize[1],left:x,right:x+l.displaySize[0]}}function W_(l,o,u,f,_,x){const C=l.image;let M;if(C.content){const oe=C.content,be=C.pixelRatio||1;M=[oe[0]/be,oe[1]/be,C.displaySize[0]-oe[2]/be,C.displaySize[1]-oe[3]/be]}const A=o.left*x,F=o.right*x;let O,B,H,q;"width"===u||"both"===u?(q=_[0]+A-f[3],B=_[0]+F+f[1]):(q=_[0]+(A+F-C.displaySize[0])/2,B=q+C.displaySize[0]);const W=o.top*x,se=o.bottom*x;return"height"===u||"both"===u?(O=_[1]+W-f[0],H=_[1]+se+f[2]):(O=_[1]+(W+se-C.displaySize[1])/2,H=O+C.displaySize[1]),{image:C,top:O,right:B,bottom:H,left:q,collisionPadding:M}}const _a=128;function cp(l,o){const{expression:u}=o;if("constant"===u.kind)return{kind:"constant",layoutSize:u.evaluate(new hr(l+1))};if("source"===u.kind)return{kind:"source"};{const{zoomStops:f,interpolationType:_}=u;let x=0;for(;x<f.length&&f[x]<=l;)x++;x=Math.max(0,x-1);let C=x;for(;C<f.length&&f[C]<l+1;)C++;C=Math.min(f.length-1,C);const M=f[x],A=f[C];return"composite"===u.kind?{kind:"composite",minZoom:M,maxZoom:A,interpolationType:_}:{kind:"camera",minZoom:M,maxZoom:A,minSize:u.evaluate(new hr(M)),maxSize:u.evaluate(new hr(A)),interpolationType:_}}}class Jl extends It{constructor(o,u,f,_){super(o,u),this.angle=f,void 0!==_&&(this.segment=_)}clone(){return new Jl(this.x,this.y,this.angle,this.segment)}}function X_(l,o,u,f,_){if(void 0===o.segment)return!0;let x=o,C=o.segment+1,M=0;for(;M>-u/2;){if(C--,C<0)return!1;M-=l[C].dist(x),x=l[C]}M+=l[C].dist(l[C+1]),C++;const A=[];let F=0;for(;M<u/2;){const O=l[C],B=l[C+1];if(!B)return!1;let H=l[C-1].angleTo(O)-O.angleTo(B);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:M,angleDelta:H}),F+=H;M-A[0].distance>f;)F-=A.shift().angleDelta;if(F>_)return!1;C++,M+=O.dist(B)}return!0}function Y_(l){let o=0;for(let u=0;u<l.length-1;u++)o+=l[u].dist(l[u+1]);return o}function yg(l,o,u){return l?.6*o*u:0}function K_(l,o){return Math.max(l?l.right-l.left:0,o?o.right-o.left:0)}function _1(l,o,u,f,_,x){const C=yg(u,_,x),M=K_(u,f)*x;let A=0;const F=Y_(l)/2;for(let O=0;O<l.length-1;O++){const B=l[O],H=l[O+1],q=B.dist(H);if(A+q>F){const W=(F-A)/q,se=Kn(B.x,H.x,W),oe=Kn(B.y,H.y,W),be=new Jl(se,oe,H.angleTo(B),O);return be._round(),!C||X_(l,be,M,C,o)?be:void 0}A+=q}}function vo(l,o,u,f,_,x,C,M,A){const F=yg(f,x,C),O=K_(f,_),B=O*C,H=0===l[0].x||l[0].x===A||0===l[0].y||l[0].y===A;return o-B<o/4&&(o=B+o/4),up(l,H?o/2*M%o:(O/2+2*x)*C*M%o,o,F,u,B,H,!1,A)}function up(l,o,u,f,_,x,C,M,A){const F=x/2,O=Y_(l);let B=0,H=o-u,q=[];for(let W=0;W<l.length-1;W++){const se=l[W],oe=l[W+1],be=se.dist(oe),Ce=oe.angleTo(se);for(;H+u<B+be;){H+=u;const me=(H-B)/be,Ee=Kn(se.x,oe.x,me),$e=Kn(se.y,oe.y,me);if(Ee>=0&&Ee<A&&$e>=0&&$e<A&&H-F>=0&&H+F<=O){const Ve=new Jl(Ee,$e,Ce,W);Ve._round(),f&&!X_(l,Ve,x,f,_)||q.push(Ve)}}B+=be}return M||q.length||C||(q=up(l,B/2,u,f,_,x,C,!0,A)),q}function _g(l,o,u,f,_){const x=[];for(let C=0;C<l.length;C++){const M=l[C];let A;for(let F=0;F<M.length-1;F++){let O=M[F],B=M[F+1];O.x<o&&B.x<o||(O.x<o?O=new It(o,O.y+(o-O.x)/(B.x-O.x)*(B.y-O.y))._round():B.x<o&&(B=new It(o,O.y+(o-O.x)/(B.x-O.x)*(B.y-O.y))._round()),O.y<u&&B.y<u||(O.y<u?O=new It(O.x+(u-O.y)/(B.y-O.y)*(B.x-O.x),u)._round():B.y<u&&(B=new It(O.x+(u-O.y)/(B.y-O.y)*(B.x-O.x),u)._round()),O.x>=f&&B.x>=f||(O.x>=f?O=new It(f,O.y+(f-O.x)/(B.x-O.x)*(B.y-O.y))._round():B.x>=f&&(B=new It(f,O.y+(f-O.x)/(B.x-O.x)*(B.y-O.y))._round()),O.y>=_&&B.y>=_||(O.y>=_?O=new It(O.x+(_-O.y)/(B.y-O.y)*(B.x-O.x),_)._round():B.y>=_&&(B=new It(O.x+(_-O.y)/(B.y-O.y)*(B.x-O.x),_)._round()),A&&O.equals(A[A.length-1])||(A=[O],x.push(A)),A.push(B)))))}}return x}function hp(l,o,u,f){const _=[],x=l.image,C=x.pixelRatio,M=x.paddedRect.w-2,A=x.paddedRect.h-2,F=l.right-l.left,O=l.bottom-l.top,B=x.stretchX||[[0,M]],H=x.stretchY||[[0,A]],q=(Qe,ot)=>Qe+ot[1]-ot[0],W=B.reduce(q,0),se=H.reduce(q,0),oe=M-W,be=A-se;let Ce=0,me=W,Ee=0,$e=se,Ve=0,gt=oe,Ct=0,at=be;if(x.content&&f){const Qe=x.content;Ce=hi(B,0,Qe[0]),Ee=hi(H,0,Qe[1]),me=hi(B,Qe[0],Qe[2]),$e=hi(H,Qe[1],Qe[3]),Ve=Qe[0]-Ce,Ct=Qe[1]-Ee,gt=Qe[2]-Qe[0]-me,at=Qe[3]-Qe[1]-$e}const tt=(Qe,ot,it,Ge)=>{const Et=zd(Qe.stretch-Ce,me,F,l.left),pt=dp(Qe.fixed-Ve,gt,Qe.stretch,W),Yt=zd(ot.stretch-Ee,$e,O,l.top),Qn=dp(ot.fixed-Ct,at,ot.stretch,se),or=zd(it.stretch-Ce,me,F,l.left),Lr=dp(it.fixed-Ve,gt,it.stretch,W),ws=zd(Ge.stretch-Ee,$e,O,l.top),Ai=dp(Ge.fixed-Ct,at,Ge.stretch,se),Gr=new It(Et,Yt),Nr=new It(or,Yt),Qr=new It(or,ws),Ki=new It(Et,ws),zo=new It(pt/C,Qn/C),Ar=new It(Lr/C,Ai/C),yi=o*Math.PI/180;if(yi){const bo=Math.sin(yi),Qi=Math.cos(yi),fr=[Qi,-bo,bo,Qi];Gr._matMult(fr),Nr._matMult(fr),Ki._matMult(fr),Qr._matMult(fr)}const ki=Qe.stretch+Qe.fixed,Ji=ot.stretch+ot.fixed;return{tl:Gr,tr:Nr,bl:Ki,br:Qr,tex:{x:x.paddedRect.x+1+ki,y:x.paddedRect.y+1+Ji,w:it.stretch+it.fixed-ki,h:Ge.stretch+Ge.fixed-Ji},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:zo,pixelOffsetBR:Ar,minFontScaleX:gt/C/F,minFontScaleY:at/C/O,isSDF:u}};if(f&&(x.stretchX||x.stretchY)){const Qe=yh(B,oe,W),ot=yh(H,be,se);for(let it=0;it<Qe.length-1;it++){const Ge=Qe[it],Et=Qe[it+1];for(let pt=0;pt<ot.length-1;pt++)_.push(tt(Ge,ot[pt],Et,ot[pt+1]))}}else _.push(tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:A+1}));return _}function hi(l,o,u){let f=0;for(const _ of l)f+=Math.max(o,Math.min(u,_[1]))-Math.max(o,Math.min(u,_[0]));return f}function yh(l,o,u){const f=[{fixed:-1,stretch:0}];for(const[_,x]of l){const C=f[f.length-1];f.push({fixed:_-C.stretch,stretch:C.stretch}),f.push({fixed:_-C.stretch,stretch:C.stretch+(x-_)})}return f.push({fixed:o+1,stretch:u}),f}function zd(l,o,u,f){return l/o*u+f}function dp(l,o,u,f){return l-o*u/f}ct("Anchor",Jl);class fp{constructor(o,u,f,_,x,C,M,A,F,O){if(this.boxStartIndex=o.length,F){let B=C.top,H=C.bottom;const q=C.collisionPadding;q&&(B-=q[1],H+=q[3]);let W=H-B;W>0&&(W=Math.max(10,W),this.circleDiameter=W)}else{let B=C.top*M-A[0],H=C.bottom*M+A[2],q=C.left*M-A[3],W=C.right*M+A[1];const se=C.collisionPadding;if(se&&(q-=se[0]*M,B-=se[1]*M,W+=se[2]*M,H+=se[3]*M),O){const oe=new It(q,B),be=new It(W,B),Ce=new It(q,H),me=new It(W,H),Ee=O*Math.PI/180;oe._rotate(Ee),be._rotate(Ee),Ce._rotate(Ee),me._rotate(Ee),q=Math.min(oe.x,be.x,Ce.x,me.x),W=Math.max(oe.x,be.x,Ce.x,me.x),B=Math.min(oe.y,be.y,Ce.y,me.y),H=Math.max(oe.y,be.y,Ce.y,me.y)}o.emplaceBack(u.x,u.y,q,B,W,H,f,_,x)}this.boxEndIndex=o.length}}class J_{constructor(o=[],u=v1){if(this.data=o,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:u,compare:f}=this,_=u[o];for(;o>0;){const x=o-1>>1,C=u[x];if(f(_,C)>=0)break;u[o]=C,o=x}u[o]=_}_down(o){const{data:u,compare:f}=this,_=this.length>>1,x=u[o];for(;o<_;){let C=1+(o<<1),M=u[C];const A=C+1;if(A<this.length&&f(u[A],M)<0&&(C=A,M=u[A]),f(M,x)>=0)break;u[o]=M,o=C}u[o]=x}}function v1(l,o){return l<o?-1:l>o?1:0}function Q_(l,o=1,u=!1){let f=1/0,_=1/0,x=-1/0,C=-1/0;const M=l[0];for(let q=0;q<M.length;q++){const W=M[q];(!q||W.x<f)&&(f=W.x),(!q||W.y<_)&&(_=W.y),(!q||W.x>x)&&(x=W.x),(!q||W.y>C)&&(C=W.y)}const A=Math.min(x-f,C-_);let F=A/2;const O=new J_([],b1);if(0===A)return new It(f,_);for(let q=f;q<x;q+=A)for(let W=_;W<C;W+=A)O.push(new Kc(q+F,W+F,F,l));let B=function(q){let W=0,se=0,oe=0;const be=q[0];for(let Ce=0,me=be.length,Ee=me-1;Ce<me;Ee=Ce++){const $e=be[Ce],Ve=be[Ee],gt=$e.x*Ve.y-Ve.x*$e.y;se+=($e.x+Ve.x)*gt,oe+=($e.y+Ve.y)*gt,W+=3*gt}return new Kc(se/W,oe/W,0,q)}(l),H=O.length;for(;O.length;){const q=O.pop();(q.d>B.d||!B.d)&&(B=q,u&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,H)),q.max-B.d<=o||(F=q.h/2,O.push(new Kc(q.p.x-F,q.p.y-F,F,l)),O.push(new Kc(q.p.x+F,q.p.y-F,F,l)),O.push(new Kc(q.p.x-F,q.p.y+F,F,l)),O.push(new Kc(q.p.x+F,q.p.y+F,F,l)),H+=4)}return u&&(console.log(`num probes: ${H}`),console.log(`best distance: ${B.d}`)),B.p}function b1(l,o){return o.max-l.max}function Kc(l,o,u,f){this.p=new It(l,o),this.h=u,this.d=function(_,x){let C=!1,M=1/0;for(let A=0;A<x.length;A++){const F=x[A];for(let O=0,B=F.length,H=B-1;O<B;H=O++){const q=F[O],W=F[H];q.y>_.y!=W.y>_.y&&_.x<(W.x-q.x)*(_.y-q.y)/(W.y-q.y)+q.x&&(C=!C),M=Math.min(M,rr(_,q,W))}}return(C?1:-1)*Math.sqrt(M)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}const vg=Number.POSITIVE_INFINITY;function ev(l,o){return o[1]!==vg?function(u,f,_){let x=0,C=0;switch(f=Math.abs(f),_=Math.abs(_),u){case"top-right":case"top-left":case"top":C=_-7;break;case"bottom-right":case"bottom-left":case"bottom":C=7-_}switch(u){case"top-right":case"bottom-right":case"right":x=-f;break;case"top-left":case"bottom-left":case"left":x=f}return[x,C]}(l,o[0],o[1]):function(u,f){let _=0,x=0;f<0&&(f=0);const C=f/Math.sqrt(2);switch(u){case"top-right":case"top-left":x=C-7;break;case"bottom-right":case"bottom-left":x=7-C;break;case"bottom":x=7-f;break;case"top":x=f-7}switch(u){case"top-right":case"bottom-right":_=-C;break;case"top-left":case"bottom-left":_=C;break;case"left":_=f;break;case"right":_=-f}return[_,x]}(l,o[0])}function Bd(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bg(l,o,u,f,_,x,C,M,A,F,O){let B=x.textMaxSize.evaluate(o,{});void 0===B&&(B=C);const H=l.layers[0].layout,q=H.get("icon-offset").evaluate(o,{},O),W=tv(u.horizontal),se=C/24,oe=l.tilePixelRatio*se,be=l.tilePixelRatio*B/24,Ce=l.tilePixelRatio*M,me=l.tilePixelRatio*H.get("symbol-spacing"),Ee=H.get("text-padding")*l.tilePixelRatio,$e=function(Ge,Et,pt,Yt=1){const Qn=Ge.get("icon-padding").evaluate(Et,{},pt),or=Qn&&Qn.values;return[or[0]*Yt,or[1]*Yt,or[2]*Yt,or[3]*Yt]}(H,o,O,l.tilePixelRatio),Ve=H.get("text-max-angle")/180*Math.PI,gt="viewport"!==H.get("text-rotation-alignment")&&"point"!==H.get("symbol-placement"),Ct="map"===H.get("icon-rotation-alignment")&&"point"!==H.get("symbol-placement"),at=H.get("symbol-placement"),tt=me/2,Qe=H.get("icon-text-fit");let ot;f&&"none"!==Qe&&(l.allowVerticalPlacement&&u.vertical&&(ot=W_(f,u.vertical,Qe,H.get("icon-text-fit-padding"),q,se)),W&&(f=W_(f,W,Qe,H.get("icon-text-fit-padding"),q,se)));const it=(Ge,Et)=>{Et.x<0||Et.x>=yn||Et.y<0||Et.y>=yn||function(pt,Yt,Qn,or,Lr,ws,Ai,Gr,Nr,Qr,Ki,zo,Ar,yi,ki,Ji,bo,Qi,fr,_i,Qt,Bo,_n,Pi,Cs){const ns=pt.addToLineVertexArray(Yt,Qn);let Es,al,Ds,rs,xo=0,ll=0,xp=0,A1=0,Qc=-1,Zd=-1;const va={};let Rg=j(""),wp=0,Fg=0;if(void 0===Gr._unevaluatedLayout.getValue("text-radial-offset")?[wp,Fg]=Gr.layout.get("text-offset").evaluate(Qt,{},Pi).map(wo=>24*wo):(wp=24*Gr.layout.get("text-radial-offset").evaluate(Qt,{},Pi),Fg=vg),pt.allowVerticalPlacement&&or.vertical){const wo=Gr.layout.get("text-rotate").evaluate(Qt,{},Pi)+90;Ds=new fp(Nr,Yt,Qr,Ki,zo,or.vertical,Ar,yi,ki,wo),Ai&&(rs=new fp(Nr,Yt,Qr,Ki,zo,Ai,bo,Qi,ki,wo))}if(Lr){const wo=Gr.layout.get("icon-rotate").evaluate(Qt,{}),Ss="none"!==Gr.layout.get("icon-text-fit"),oc=hp(Lr,wo,_n,Ss),Ms=Ai?hp(Ai,wo,_n,Ss):void 0;al=new fp(Nr,Yt,Qr,Ki,zo,Lr,bo,Qi,!1,wo),xo=4*oc.length;const zg=pt.iconSizeData;let cl=null;"source"===zg.kind?(cl=[_a*Gr.layout.get("icon-size").evaluate(Qt,{})],cl[0]>Ql&&fn(`${pt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===zg.kind&&(cl=[_a*Bo.compositeIconSizes[0].evaluate(Qt,{},Pi),_a*Bo.compositeIconSizes[1].evaluate(Qt,{},Pi)],(cl[0]>Ql||cl[1]>Ql)&&fn(`${pt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),pt.addSymbols(pt.icon,oc,cl,_i,fr,Qt,b.WritingMode.none,Yt,ns.lineStartIndex,ns.lineLength,-1,Pi),Qc=pt.icon.placedSymbolArray.length-1,Ms&&(ll=4*Ms.length,pt.addSymbols(pt.icon,Ms,cl,_i,fr,Qt,b.WritingMode.vertical,Yt,ns.lineStartIndex,ns.lineLength,-1,Pi),Zd=pt.icon.placedSymbolArray.length-1)}const Og=Object.keys(or.horizontal);for(const wo of Og){const Ss=or.horizontal[wo];if(!Es){Rg=j(Ss.text);const Ms=Gr.layout.get("text-rotate").evaluate(Qt,{},Pi);Es=new fp(Nr,Yt,Qr,Ki,zo,Ss,Ar,yi,ki,Ms)}const oc=1===Ss.positionedLines.length;if(xp+=xg(pt,Yt,Ss,ws,Gr,ki,Qt,Ji,ns,or.vertical?b.WritingMode.horizontal:b.WritingMode.horizontalOnly,oc?Og:[wo],va,Qc,Bo,Pi),oc)break}or.vertical&&(A1+=xg(pt,Yt,or.vertical,ws,Gr,ki,Qt,Ji,ns,b.WritingMode.vertical,["vertical"],va,Zd,Bo,Pi));const cv=Es?Es.boxStartIndex:pt.collisionBoxArray.length,Lg=Es?Es.boxEndIndex:pt.collisionBoxArray.length,A2=Ds?Ds.boxStartIndex:pt.collisionBoxArray.length,k1=Ds?Ds.boxEndIndex:pt.collisionBoxArray.length,Ng=al?al.boxStartIndex:pt.collisionBoxArray.length,uv=al?al.boxEndIndex:pt.collisionBoxArray.length,hv=rs?rs.boxStartIndex:pt.collisionBoxArray.length,eu=rs?rs.boxEndIndex:pt.collisionBoxArray.length;let Gs=-1;const wh=(wo,Ss)=>wo&&wo.circleDiameter?Math.max(wo.circleDiameter,Ss):Ss;Gs=wh(Es,Gs),Gs=wh(Ds,Gs),Gs=wh(al,Gs),Gs=wh(rs,Gs);const Wd=Gs>-1?1:0;Wd&&(Gs*=Cs/24),pt.glyphOffsetArray.length>=tc.MAX_GLYPHS&&fn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Qt.sortKey&&pt.addToSortKeyRanges(pt.symbolInstances.length,Qt.sortKey),pt.symbolInstances.emplaceBack(Yt.x,Yt.y,va.right>=0?va.right:-1,va.center>=0?va.center:-1,va.left>=0?va.left:-1,va.vertical||-1,Qc,Zd,Rg,cv,Lg,A2,k1,Ng,uv,hv,eu,Qr,xp,A1,xo,ll,Wd,0,Ar,wp,Fg,Gs)}(l,Et,Ge,u,f,_,ot,l.layers[0],l.collisionBoxArray,o.index,o.sourceLayerIndex,l.index,oe,[Ee,Ee,Ee,Ee],gt,A,Ce,$e,Ct,q,o,x,F,O,C)};if("line"===at)for(const Ge of _g(o.geometry,0,0,yn,yn)){const Et=vo(Ge,me,Ve,u.vertical||W,f,24,be,l.overscaling,yn);for(const pt of Et)W&&Vd(l,W.text,tt,pt)||it(Ge,pt)}else if("line-center"===at){for(const Ge of o.geometry)if(Ge.length>1){const Et=_1(Ge,Ve,u.vertical||W,f,24,be);Et&&it(Ge,Et)}}else if("Polygon"===o.type)for(const Ge of Md(o.geometry,0)){const Et=Q_(Ge,16);it(Ge[0],new Jl(Et.x,Et.y,0))}else if("LineString"===o.type)for(const Ge of o.geometry)it(Ge,new Jl(Ge[0].x,Ge[0].y,0));else if("Point"===o.type)for(const Ge of o.geometry)for(const Et of Ge)it([Et],new Jl(Et.x,Et.y,0))}const Ql=32640;function xg(l,o,u,f,_,x,C,M,A,F,O,B,H,q,W){const se=function(Ce,me,Ee,$e,Ve,gt,Ct,at){const tt=$e.layout.get("text-rotate").evaluate(gt,{})*Math.PI/180,Qe=[];for(const ot of me.positionedLines)for(const it of ot.positionedGlyphs){if(!it.rect)continue;const Ge=it.rect||{};let Et=4,pt=!0,Yt=1,Qn=0;const or=(Ve||at)&&it.vertical,Lr=it.metrics.advance*it.scale/2;if(at&&me.verticalizable&&(Qn=ot.lineOffset/2-(it.imageName?-(24-it.metrics.width*it.scale)/2:24*(it.scale-1))),it.imageName){const fr=Ct[it.imageName];pt=fr.sdf,Yt=fr.pixelRatio,Et=1/Yt}const ws=Ve?[it.x+Lr,it.y]:[0,0];let Ai=Ve?[0,0]:[it.x+Lr+Ee[0],it.y+Ee[1]-Qn],Gr=[0,0];or&&(Gr=Ai,Ai=[0,0]);const Nr=(it.metrics.left-Et)*it.scale-Lr+Ai[0],Qr=(-it.metrics.top-Et)*it.scale+Ai[1],Ki=Nr+Ge.w*it.scale/Yt,zo=Qr+Ge.h*it.scale/Yt,Ar=new It(Nr,Qr),yi=new It(Ki,Qr),ki=new It(Nr,zo),Ji=new It(Ki,zo);if(or){const fr=new It(-Lr,Lr- -17),_i=-Math.PI/2,Qt=12-Lr,Bo=new It(22-Qt,-(it.imageName?Qt:0)),_n=new It(...Gr);Ar._rotateAround(_i,fr)._add(Bo)._add(_n),yi._rotateAround(_i,fr)._add(Bo)._add(_n),ki._rotateAround(_i,fr)._add(Bo)._add(_n),Ji._rotateAround(_i,fr)._add(Bo)._add(_n)}if(tt){const fr=Math.sin(tt),_i=Math.cos(tt),Qt=[_i,-fr,fr,_i];Ar._matMult(Qt),yi._matMult(Qt),ki._matMult(Qt),Ji._matMult(Qt)}const bo=new It(0,0),Qi=new It(0,0);Qe.push({tl:Ar,tr:yi,bl:ki,br:Ji,tex:Ge,writingMode:me.writingMode,glyphOffset:ws,sectionIndex:it.sectionIndex,isSDF:pt,pixelOffsetTL:bo,pixelOffsetBR:Qi,minFontScaleX:0,minFontScaleY:0})}return Qe}(0,u,M,_,x,C,f,l.allowVerticalPlacement),oe=l.textSizeData;let be=null;"source"===oe.kind?(be=[_a*_.layout.get("text-size").evaluate(C,{})],be[0]>Ql&&fn(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===oe.kind&&(be=[_a*q.compositeTextSizes[0].evaluate(C,{},W),_a*q.compositeTextSizes[1].evaluate(C,{},W)],(be[0]>Ql||be[1]>Ql)&&fn(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),l.addSymbols(l.text,se,be,M,x,C,F,o,A.lineStartIndex,A.lineLength,H,W);for(const Ce of O)B[Ce]=l.text.placedSymbolArray.length-1;return 4*se.length}function tv(l){for(const o in l)return l[o];return null}function Vd(l,o,u,f){const _=l.compareText;if(o in _){const x=_[o];for(let C=x.length-1;C>=0;C--)if(f.dist(x[C])<u)return!0}else _[o]=[];return _[o].push(f),!1}const x1=Kl.VectorTileFeature.types,w1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function _h(l,o,u,f,_,x,C,M,A,F,O,B,H){const q=M?Math.min(Ql,Math.round(M[0])):0,W=M?Math.min(Ql,Math.round(M[1])):0;l.emplaceBack(o,u,Math.round(32*f),Math.round(32*_),x,C,(q<<1)+(A?1:0),W,16*F,16*O,256*B,256*H)}function Ud(l,o,u){l.emplaceBack(o.x,o.y,u),l.emplaceBack(o.x,o.y,u),l.emplaceBack(o.x,o.y,u),l.emplaceBack(o.x,o.y,u)}function nv(l){for(const o of l.sections)if(Ro(o.text))return!0;return!1}class rv{constructor(o){this.layoutVertexArray=new g,this.indexArray=new w,this.programConfigurations=o,this.segments=new R,this.dynamicLayoutVertexArray=new s,this.opacityVertexArray=new h,this.hasVisibleVertices=!1,this.placedSymbolArray=new bd}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,u,f,_){this.isEmpty()||(f&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Rd.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,o1.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,w1,!0),this.opacityVertexBuffer.itemSize=1),(f||_)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ct("SymbolBuffers",rv);class ec{constructor(o,u,f){this.layoutVertexArray=new o,this.layoutAttributes=u,this.indexArray=new f,this.segments=new R,this.collisionVertexArray=new y}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,s1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ct("CollisionBuffers",ec);class tc{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(C=>C.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=qf([]),this.placementViewportMatrix=qf([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=cp(this.zoom,u["text-size"]),this.iconSizeData=cp(this.zoom,u["icon-size"]);const f=this.layers[0].layout,_=f.get("symbol-sort-key"),x=f.get("symbol-z-order");this.canOverlap="never"!==Cg(f,"text-overlap","text-allow-overlap")||"never"!==Cg(f,"icon-overlap","icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==x&&!_.isConstant(),this.sortFeaturesByY=("viewport-y"===x||"auto"===x&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===f.get("symbol-placement")&&(this.writingModes=f.get("text-writing-mode").map(C=>b.WritingMode[C])),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.sourceID=o.sourceID}createArrays(){this.text=new rv(new Ht(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new rv(new Ht(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new en,this.lineVertexArray=new Zl,this.symbolInstances=new He}calculateGlyphDependencies(o,u,f,_,x){for(let C=0;C<o.length;C++)if(u[o.charCodeAt(C)]=!0,(f||_)&&x){const M=fh[o.charAt(C)];M&&(u[M.charCodeAt(0)]=!0)}}populate(o,u,f){const _=this.layers[0],x=_.layout,C=x.get("text-font"),M=x.get("text-field"),A=x.get("icon-image"),F=("constant"!==M.value.kind||M.value.value instanceof Xr&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&("constant"!==C.value.kind||C.value.value.length>0),O="constant"!==A.value.kind||!!A.value.value||Object.keys(A.parameters).length>0,B=x.get("symbol-sort-key");if(this.features=[],!F&&!O)return;const H=u.iconDependencies,q=u.glyphDependencies,W=u.availableImages,se=new hr(this.zoom);for(const{feature:oe,id:be,index:Ce,sourceLayerIndex:me}of o){const Ee=_._featureFilter.needGeometry,$e=ci(oe,Ee);if(!_._featureFilter.filter(se,$e,f))continue;let Ve,gt;if(Ee||($e.geometry=vr(oe)),F){const at=_.getValueAndResolveTokens("text-field",$e,f,W),tt=Xr.factory(at);nv(tt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===$l()||this.hasRTLText&&go.isParsed())&&(Ve=Fd(tt,_,$e))}if(O){const at=_.getValueAndResolveTokens("icon-image",$e,f,W);gt=at instanceof mi?at:mi.fromString(at)}if(!Ve&&!gt)continue;const Ct=this.sortFeaturesByKey?B.evaluate($e,{},f):void 0;if(this.features.push({id:be,text:Ve,icon:gt,index:Ce,sourceLayerIndex:me,geometry:$e.geometry,properties:oe.properties,type:x1[oe.type],sortKey:Ct}),gt&&(H[gt.name]=!0),Ve){const at=C.evaluate($e,{},f).join(","),tt="viewport"!==x.get("text-rotation-alignment")&&"point"!==x.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(b.WritingMode.vertical)>=0;for(const Qe of Ve.sections)if(Qe.image)H[Qe.image.name]=!0;else{const ot=po(Ve.toString()),it=Qe.fontStack||at,Ge=q[it]=q[it]||{};this.calculateGlyphDependencies(Qe.text,Ge,tt,this.allowVerticalPlacement,ot)}}}"line"===x.get("symbol-placement")&&(this.features=function(oe){const be={},Ce={},me=[];let Ee=0;function $e(at){me.push(oe[at]),Ee++}function Ve(at,tt,Qe){const ot=Ce[at];return delete Ce[at],Ce[tt]=ot,me[ot].geometry[0].pop(),me[ot].geometry[0]=me[ot].geometry[0].concat(Qe[0]),ot}function gt(at,tt,Qe){const ot=be[tt];return delete be[tt],be[at]=ot,me[ot].geometry[0].shift(),me[ot].geometry[0]=Qe[0].concat(me[ot].geometry[0]),ot}function Ct(at,tt,Qe){const ot=Qe?tt[0][tt[0].length-1]:tt[0][0];return`${at}:${ot.x}:${ot.y}`}for(let at=0;at<oe.length;at++){const tt=oe[at],Qe=tt.geometry,ot=tt.text?tt.text.toString():null;if(!ot){$e(at);continue}const it=Ct(ot,Qe),Ge=Ct(ot,Qe,!0);if(it in Ce&&Ge in be&&Ce[it]!==be[Ge]){const Et=gt(it,Ge,Qe),pt=Ve(it,Ge,me[Et].geometry);delete be[it],delete Ce[Ge],Ce[Ct(ot,me[pt].geometry,!0)]=pt,me[Et].geometry=null}else it in Ce?Ve(it,Ge,Qe):Ge in be?gt(it,Ge,Qe):($e(at),be[it]=Ee-1,Ce[Ge]=Ee-1)}return me.filter(at=>at.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((oe,be)=>oe.sortKey-be.sortKey)}update(o,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,u,this.layers,f),this.icon.programConfigurations.updatePaintArrays(o,u,this.layers,f))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,u){const f=this.lineVertexArray.length;if(void 0!==o.segment){let _=o.dist(u[o.segment+1]),x=o.dist(u[o.segment]);const C={};for(let M=o.segment+1;M<u.length;M++)C[M]={x:u[M].x,y:u[M].y,tileUnitDistanceFromAnchor:_},M<u.length-1&&(_+=u[M+1].dist(u[M]));for(let M=o.segment||0;M>=0;M--)C[M]={x:u[M].x,y:u[M].y,tileUnitDistanceFromAnchor:x},M>0&&(x+=u[M-1].dist(u[M]));for(let M=0;M<u.length;M++){const A=C[M];this.lineVertexArray.emplaceBack(A.x,A.y,A.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(o,u,f,_,x,C,M,A,F,O,B,H){const q=o.indexArray,W=o.layoutVertexArray,se=o.segments.prepareSegment(4*u.length,W,q,this.canOverlap?C.sortKey:void 0),oe=this.glyphOffsetArray.length,be=se.vertexLength,Ce=this.allowVerticalPlacement&&M===b.WritingMode.vertical?Math.PI/2:0,me=C.text&&C.text.sections;for(let Ee=0;Ee<u.length;Ee++){const{tl:$e,tr:Ve,bl:gt,br:Ct,tex:at,pixelOffsetTL:tt,pixelOffsetBR:Qe,minFontScaleX:ot,minFontScaleY:it,glyphOffset:Ge,isSDF:Et,sectionIndex:pt}=u[Ee],Yt=se.vertexLength,Qn=Ge[1];_h(W,A.x,A.y,$e.x,Qn+$e.y,at.x,at.y,f,Et,tt.x,tt.y,ot,it),_h(W,A.x,A.y,Ve.x,Qn+Ve.y,at.x+at.w,at.y,f,Et,Qe.x,tt.y,ot,it),_h(W,A.x,A.y,gt.x,Qn+gt.y,at.x,at.y+at.h,f,Et,tt.x,Qe.y,ot,it),_h(W,A.x,A.y,Ct.x,Qn+Ct.y,at.x+at.w,at.y+at.h,f,Et,Qe.x,Qe.y,ot,it),Ud(o.dynamicLayoutVertexArray,A,Ce),q.emplaceBack(Yt,Yt+1,Yt+2),q.emplaceBack(Yt+1,Yt+2,Yt+3),se.vertexLength+=4,se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ge[0]),Ee!==u.length-1&&pt===u[Ee+1].sectionIndex||o.programConfigurations.populatePaintArrays(W.length,C,C.index,{},H,me&&me[pt])}o.placedSymbolArray.emplaceBack(A.x,A.y,oe,this.glyphOffsetArray.length-oe,be,F,O,A.segment,f?f[0]:0,f?f[1]:0,_[0],_[1],M,0,!1,0,B)}_addCollisionDebugVertex(o,u,f,_,x,C){return u.emplaceBack(0,0),o.emplaceBack(f.x,f.y,_,x,Math.round(C.x),Math.round(C.y))}addCollisionDebugVertices(o,u,f,_,x,C,M){const A=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),F=A.vertexLength,O=x.layoutVertexArray,B=x.collisionVertexArray,H=M.anchorX,q=M.anchorY;this._addCollisionDebugVertex(O,B,C,H,q,new It(o,u)),this._addCollisionDebugVertex(O,B,C,H,q,new It(f,u)),this._addCollisionDebugVertex(O,B,C,H,q,new It(f,_)),this._addCollisionDebugVertex(O,B,C,H,q,new It(o,_)),A.vertexLength+=4;const W=x.indexArray;W.emplaceBack(F,F+1),W.emplaceBack(F+1,F+2),W.emplaceBack(F+2,F+3),W.emplaceBack(F+3,F),A.primitiveLength+=4}addDebugCollisionBoxes(o,u,f,_){for(let x=o;x<u;x++){const C=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(C.x1,C.y1,C.x2,C.y2,_?this.textCollisionBox:this.iconCollisionBox,C.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ec(m,$_.members,S),this.iconCollisionBox=new ec(m,$_.members,S);for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(o,u,f,_,x,C,M,A,F){const O={};for(let B=u;B<f;B++){const H=o.get(B);O.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},O.textFeatureIndex=H.featureIndex;break}for(let B=_;B<x;B++){const H=o.get(B);O.verticalTextBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},O.verticalTextFeatureIndex=H.featureIndex;break}for(let B=C;B<M;B++){const H=o.get(B);O.iconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},O.iconFeatureIndex=H.featureIndex;break}for(let B=A;B<F;B++){const H=o.get(B);O.verticalIconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},O.verticalIconFeatureIndex=H.featureIndex;break}return O}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,u){const f=o.placedSymbolArray.get(u),_=f.vertexStartIndex+4*f.numGlyphs;for(let x=f.vertexStartIndex;x<_;x+=4)o.indexArray.emplaceBack(x,x+1,x+2),o.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const u=Math.sin(o),f=Math.cos(o),_=[],x=[],C=[];for(let M=0;M<this.symbolInstances.length;++M){C.push(M);const A=this.symbolInstances.get(M);_.push(0|Math.round(u*A.anchorX+f*A.anchorY)),x.push(A.featureIndex)}return C.sort((M,A)=>_[M]-_[A]||x[A]-x[M]),C}addToSortKeyRanges(o,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((_,x,C)=>{_>=0&&C.indexOf(_)===x&&this.addIndicesForPlacedSymbol(this.text,_)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ct("SymbolBucket",tc,{omit:["layers","collisionBoxArray","features","compareText"]}),tc.MAX_GLYPHS=65535,tc.addDynamicAttributes=Ud;const iv=new Si({"symbol-placement":new wt(Ae.layout_symbol["symbol-placement"]),"symbol-spacing":new wt(Ae.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new wt(Ae.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yt(Ae.layout_symbol["symbol-sort-key"]),"symbol-z-order":new wt(Ae.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new wt(Ae.layout_symbol["icon-allow-overlap"]),"icon-overlap":new wt(Ae.layout_symbol["icon-overlap"]),"icon-ignore-placement":new wt(Ae.layout_symbol["icon-ignore-placement"]),"icon-optional":new wt(Ae.layout_symbol["icon-optional"]),"icon-rotation-alignment":new wt(Ae.layout_symbol["icon-rotation-alignment"]),"icon-size":new yt(Ae.layout_symbol["icon-size"]),"icon-text-fit":new wt(Ae.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new wt(Ae.layout_symbol["icon-text-fit-padding"]),"icon-image":new yt(Ae.layout_symbol["icon-image"]),"icon-rotate":new yt(Ae.layout_symbol["icon-rotate"]),"icon-padding":new yt(Ae.layout_symbol["icon-padding"]),"icon-keep-upright":new wt(Ae.layout_symbol["icon-keep-upright"]),"icon-offset":new yt(Ae.layout_symbol["icon-offset"]),"icon-anchor":new yt(Ae.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new wt(Ae.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new wt(Ae.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new wt(Ae.layout_symbol["text-rotation-alignment"]),"text-field":new yt(Ae.layout_symbol["text-field"]),"text-font":new yt(Ae.layout_symbol["text-font"]),"text-size":new yt(Ae.layout_symbol["text-size"]),"text-max-width":new yt(Ae.layout_symbol["text-max-width"]),"text-line-height":new wt(Ae.layout_symbol["text-line-height"]),"text-letter-spacing":new yt(Ae.layout_symbol["text-letter-spacing"]),"text-justify":new yt(Ae.layout_symbol["text-justify"]),"text-radial-offset":new yt(Ae.layout_symbol["text-radial-offset"]),"text-variable-anchor":new wt(Ae.layout_symbol["text-variable-anchor"]),"text-anchor":new yt(Ae.layout_symbol["text-anchor"]),"text-max-angle":new wt(Ae.layout_symbol["text-max-angle"]),"text-writing-mode":new wt(Ae.layout_symbol["text-writing-mode"]),"text-rotate":new yt(Ae.layout_symbol["text-rotate"]),"text-padding":new wt(Ae.layout_symbol["text-padding"]),"text-keep-upright":new wt(Ae.layout_symbol["text-keep-upright"]),"text-transform":new yt(Ae.layout_symbol["text-transform"]),"text-offset":new yt(Ae.layout_symbol["text-offset"]),"text-allow-overlap":new wt(Ae.layout_symbol["text-allow-overlap"]),"text-overlap":new wt(Ae.layout_symbol["text-overlap"]),"text-ignore-placement":new wt(Ae.layout_symbol["text-ignore-placement"]),"text-optional":new wt(Ae.layout_symbol["text-optional"])});var wg={paint:new Si({"icon-opacity":new yt(Ae.paint_symbol["icon-opacity"]),"icon-color":new yt(Ae.paint_symbol["icon-color"]),"icon-halo-color":new yt(Ae.paint_symbol["icon-halo-color"]),"icon-halo-width":new yt(Ae.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yt(Ae.paint_symbol["icon-halo-blur"]),"icon-translate":new wt(Ae.paint_symbol["icon-translate"]),"icon-translate-anchor":new wt(Ae.paint_symbol["icon-translate-anchor"]),"text-opacity":new yt(Ae.paint_symbol["text-opacity"]),"text-color":new yt(Ae.paint_symbol["text-color"],{runtimeType:so,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new yt(Ae.paint_symbol["text-halo-color"]),"text-halo-width":new yt(Ae.paint_symbol["text-halo-width"]),"text-halo-blur":new yt(Ae.paint_symbol["text-halo-blur"]),"text-translate":new wt(Ae.paint_symbol["text-translate"]),"text-translate-anchor":new wt(Ae.paint_symbol["text-translate-anchor"])}),layout:iv};class pp{constructor(o){if(void 0===o.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=o.property.overrides?o.property.overrides.runtimeType:fs,this.defaultValue=o}evaluate(o){if(o.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(o.formattedSection))return u.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ct("FormatSectionOverride",pp,{omit:["defaultValue"]});class mp extends Ko{constructor(o){super(o,wg)}recalculate(o,u){if(super.recalculate(o,u),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const f=this.layout.get("text-writing-mode");if(f){const _=[];for(const x of f)_.indexOf(x)<0&&_.push(x);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(o,u,f,_){const x=this.layout.get(o).evaluate(u,{},f,_),C=this._unevaluatedLayout._values[o];return C.isDataDriven()||Cn(C.value)||!x?x:(M=u.properties,x.replace(/{([^{}]+)}/g,(F,O)=>O in M?String(M[O]):""));var M}createBucket(o){return new tc(o)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const o of wg.paint.overridableProperties){if(!mp.hasPaintOverride(this.layout,o))continue;const u=this.paint.get(o),f=new pp(u),_=new la(f,u.property.specification);let x=null;x="constant"===u.value.kind||"source"===u.value.kind?new zc("source",_):new Bc("composite",_,u.value.zoomStops),this.paint._values[o]=new ys(u.property,x,u.parameters)}}_handleOverridablePaintPropertyUpdate(o,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&mp.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,u){const f=o.get("text-field"),_=wg.paint.properties[u];let x=!1;const C=M=>{for(const A of M)if(_.overrides&&_.overrides.hasOverride(A))return void(x=!0)};if("constant"===f.value.kind&&f.value.value instanceof Xr)C(f.value.value.sections);else if("source"===f.value.kind){const M=F=>{x||(F instanceof $&&J(F.value)===Ei?C(F.value.sections):F instanceof Nc?C(F.sections):F.eachChild(M))},A=f.value;A._styleExpression&&M(A._styleExpression.expression)}return x}}function Cg(l,o,u){let f="never";const _=l.get(o);return _?f=_:l.get(u)&&(f="always"),f}var C1={paint:new Si({"background-color":new wt(Ae.paint_background["background-color"]),"background-pattern":new fd(Ae.paint_background["background-pattern"]),"background-opacity":new wt(Ae.paint_background["background-opacity"])})},E1={paint:new Si({"raster-opacity":new wt(Ae.paint_raster["raster-opacity"]),"raster-hue-rotate":new wt(Ae.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new wt(Ae.paint_raster["raster-brightness-min"]),"raster-brightness-max":new wt(Ae.paint_raster["raster-brightness-max"]),"raster-saturation":new wt(Ae.paint_raster["raster-saturation"]),"raster-contrast":new wt(Ae.paint_raster["raster-contrast"]),"raster-resampling":new wt(Ae.paint_raster["raster-resampling"]),"raster-fade-duration":new wt(Ae.paint_raster["raster-fade-duration"])})};class D1 extends Ko{constructor(o){super(o,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const S1={circle:class extends Ko{constructor(l){super(l,wd)}createBucket(l){return new Jo(l)}queryRadius(l){const o=l;return ma("circle-radius",this,o)+ma("circle-stroke-width",this,o)+Hs(this.paint.get("circle-translate"))}queryIntersectsFeature(l,o,u,f,_,x,C,M){const A=ah(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,C),F=this.paint.get("circle-radius").evaluate(o,u)+this.paint.get("circle-stroke-width").evaluate(o,u),O="map"===this.paint.get("circle-pitch-alignment"),B=O?A:(W=M,A.map(se=>lh(se,W))),H=O?F*C:F;var W;for(const q of f)for(const W of q){const se=O?W:lh(W,M);let oe=H;const be=Zf([],[W.x,W.y,0,1],M);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?oe*=be[3]/x.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(oe*=x.cameraToCenterDistance/be[3]),Wl(B,se,oe))return!0}return!1}},heatmap:class extends Ko{createBucket(l){return new Wf(l)}constructor(l){super(l,Gm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){"heatmap-color"===l&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Zm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}},hillshade:class extends Ko{constructor(l){super(l,k_)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}},fill:class extends Ko{constructor(l){super(l,N_)}recalculate(l,o){super.recalculate(l,o);const u=this.paint._values["fill-outline-color"];"constant"===u.value.kind&&void 0===u.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new _o(l)}queryRadius(){return Hs(this.paint.get("fill-translate"))}queryIntersectsFeature(l,o,u,f,_,x,C){return Fr(ah(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,C),f)}isTileClipped(){return!0}},"fill-extrusion":class extends Ko{constructor(l){super(l,S2)}createBucket(l){return new ng(l)}queryRadius(){return Hs(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(l,o,u,f,_,x,C,M){const A=ah(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,C),F=this.paint.get("fill-extrusion-height").evaluate(o,u),O=this.paint.get("fill-extrusion-base").evaluate(o,u),B=function(q,W,se,oe){const be=[];for(const Ce of q){const me=[Ce.x,Ce.y,0,1];Zf(me,me,W),be.push(new It(me[0]/me[3],me[1]/me[3]))}return be}(A,M),H=function(q,W,se,oe){const be=[],Ce=[],me=oe[8]*W,Ee=oe[9]*W,$e=oe[10]*W,Ve=oe[11]*W,gt=oe[8]*se,Ct=oe[9]*se,at=oe[10]*se,tt=oe[11]*se;for(const Qe of q){const ot=[],it=[];for(const Ge of Qe){const Et=Ge.x,pt=Ge.y,Yt=oe[0]*Et+oe[4]*pt+oe[12],Qn=oe[1]*Et+oe[5]*pt+oe[13],or=oe[2]*Et+oe[6]*pt+oe[14],Lr=oe[3]*Et+oe[7]*pt+oe[15],ws=or+$e,Ai=Lr+Ve,Gr=Yt+gt,Nr=Qn+Ct,Qr=or+at,Ki=Lr+tt,zo=new It((Yt+me)/Ai,(Qn+Ee)/Ai);zo.z=ws/Ai,ot.push(zo);const Ar=new It(Gr/Ki,Nr/Ki);Ar.z=Qr/Ki,it.push(Ar)}be.push(ot),Ce.push(it)}return[be,Ce]}(f,O,F,M);return function(q,W,se){let oe=1/0;Fr(se,W)&&(oe=np(se,W[0]));for(let be=0;be<W.length;be++){const Ce=W[be],me=q[be];for(let Ee=0;Ee<Ce.length-1;Ee++){const $e=Ce[Ee],Ve=[$e,Ce[Ee+1],me[Ee+1],me[Ee],$e];Oo(se,Ve)&&(oe=Math.min(oe,np(se,Ve)))}}return oe!==1/0&&oe}(H[0],H[1],B)}},line:class extends Ko{constructor(l){super(l,og),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(l){"line-gradient"===l&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof zn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,o){super.recalculate(l,o),this.paint._values["line-floorwidth"]=Or.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new ig(l)}queryRadius(l){const o=l,u=ip(ma("line-width",this,o),ma("line-gap-width",this,o)),f=ma("line-offset",this,o);return u/2+Math.abs(f)+Hs(this.paint.get("line-translate"))}queryIntersectsFeature(l,o,u,f,_,x,C){const M=ah(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,C),A=C/2*ip(this.paint.get("line-width").evaluate(o,u),this.paint.get("line-gap-width").evaluate(o,u)),F=this.paint.get("line-offset").evaluate(o,u);return F&&(f=function(O,B){const H=[];for(let q=0;q<O.length;q++){const W=O[q],se=[];for(let oe=0;oe<W.length;oe++){const be=W[oe-1],Ce=W[oe],me=W[oe+1],Ee=0===oe?new It(0,0):Ce.sub(be)._unit()._perp(),$e=oe===W.length-1?new It(0,0):me.sub(Ce)._unit()._perp(),Ve=Ee._add($e)._unit(),gt=Ve.x*$e.x+Ve.y*$e.y;0!==gt&&Ve._mult(1/gt),se.push(Ve._mult(B)._add(Ce))}H.push(se)}return H}(f,F*C)),function(O,B,H){for(let q=0;q<B.length;q++){const W=B[q];if(O.length>=3)for(let se=0;se<W.length;se++)if(Wi(O,W[se]))return!0;if(dr(O,W,H))return!0}return!1}(M,f,A)}isTileClipped(){return!0}},symbol:mp,background:class extends Ko{constructor(l){super(l,C1)}},raster:class extends Ko{constructor(l){super(l,E1)}}};class ov{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const $d=6371008.8;class br{constructor(o,u){if(isNaN(o)||isNaN(u))throw new Error(`Invalid LngLat object: (${o}, ${u})`);if(this.lng=+o,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new br(Ie(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const u=Math.PI/180,f=this.lat*u,_=o.lat*u,x=Math.sin(f)*Math.sin(_)+Math.cos(f)*Math.cos(_)*Math.cos((o.lng-this.lng)*u);return $d*Math.acos(Math.min(x,1))}toBounds(o=0){const u=360*o/40075017,f=u/Math.cos(Math.PI/180*this.lat);return new sv(new br(this.lng-f,this.lat-u),new br(this.lng+f,this.lat+u))}static convert(o){if(o instanceof br)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new br(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new br(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class nc{constructor(o,u){o&&(u?this.setSouthWest(o).setNorthEast(u):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof br?new br(o.lng,o.lat):br.convert(o),this}setSouthWest(o){return this._sw=o instanceof br?new br(o.lng,o.lat):br.convert(o),this}extend(o){const u=this._sw,f=this._ne;let _,x;if(o instanceof br)_=o,x=o;else{if(!(o instanceof nc))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(nc.convert(o)):this.extend(br.convert(o)):this;if(_=o._sw,x=o._ne,!_||!x)return this}return u||f?(u.lng=Math.min(_.lng,u.lng),u.lat=Math.min(_.lat,u.lat),f.lng=Math.max(x.lng,f.lng),f.lat=Math.max(x.lat,f.lat)):(this._sw=new br(_.lng,_.lat),this._ne=new br(x.lng,x.lat)),this}getCenter(){return new br((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new br(this.getWest(),this.getNorth())}getSouthEast(){return new br(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:u,lat:f}=br.convert(o);let _=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&_}static convert(o){return o instanceof nc?o:o&&new nc(o)}}var sv=nc;const av=2*Math.PI*$d;function Eg(l){return av*Math.cos(l*Math.PI/180)}function Dg(l){return(180+l)/360}function rc(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function Sg(l,o){return l/Eg(o)}function gp(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}class yp{constructor(o,u,f=0){this.x=+o,this.y=+u,this.z=+f}static fromLngLat(o,u=0){const f=br.convert(o);return new yp(Dg(f.lng),rc(f.lat),Sg(u,f.lat))}toLngLat(){return new br(360*this.x-180,gp(this.y))}toAltitude(){return this.z*Eg(gp(this.y))}meterInMercatorCoordinateUnits(){return 1/av*(o=gp(this.y),1/Math.cos(o*Math.PI/180));var o}}function M1(l,o,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[l*f-2*Math.PI*6378137/2,o*f-2*Math.PI*6378137/2]}class vh{constructor(o,u,f){if(o<0||o>25||f<0||f>=Math.pow(2,o)||u<0||u>=Math.pow(2,o))throw new Error(`x=${u}, y=${f}, z=${o} outside of bounds. 0<=x<${Math.pow(2,o)}, 0<=y<${Math.pow(2,o)} 0<=z<=25 `);this.z=o,this.x=u,this.y=f,this.key=bh(0,o,o,u,f)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,u,f){const _=(C=this.y,M=this.z,A=M1(256*(x=this.x),256*(C=Math.pow(2,M)-C-1),M),F=M1(256*(x+1),256*(C+1),M),A[0]+","+A[1]+","+F[0]+","+F[1]);var x,C,M,A,F;const O=function(B,H,q){let W,se="";for(let oe=B;oe>0;oe--)W=1<<oe-1,se+=(H&W?1:0)+(q&W?2:0);return se}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===f?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,O).replace(/{bbox-epsg-3857}/g,_)}isChildOf(o){const u=this.z-o.z;return u>0&&o.x===this.x>>u&&o.y===this.y>>u}getTilePoint(o){const u=Math.pow(2,this.z);return new It((o.x*u-this.x)*yn,(o.y*u-this.y)*yn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class lv{constructor(o,u){this.wrap=o,this.canonical=u,this.key=bh(o,u.z,u.z,u.x,u.y)}}class No{constructor(o,u,f,_,x){if(o<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${o}; z = ${f}`);this.overscaledZ=o,this.wrap=u,this.canonical=new vh(f,+_,+x),this.key=bh(u,o,f,_,x)}clone(){return new No(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-o;return o>this.canonical.z?new No(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new No(o,this.wrap,o,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(o,u){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-o;return o>this.canonical.z?bh(this.wrap*+u,o,this.canonical.z,this.canonical.x,this.canonical.y):bh(this.wrap*+u,o,o,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(o){if(o.wrap!==this.wrap)return!1;const u=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>u&&o.canonical.y===this.canonical.y>>u}children(o){if(this.overscaledZ>=o)return[new No(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,_=2*this.canonical.y;return[new No(u,this.wrap,u,f,_),new No(u,this.wrap,u,f+1,_),new No(u,this.wrap,u,f,_+1),new No(u,this.wrap,u,f+1,_+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new No(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new No(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new lv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(o){return this.canonical.getTilePoint(new yp(o.x-this.wrap,o.y))}}function bh(l,o,u,f,_){(l*=2)<0&&(l=-1*l-1);const x=1<<u;return(x*x*l+x*_+f).toString(36)+u.toString(36)+o.toString(36)}ct("CanonicalTileID",vh),ct("OverscaledTileID",No,{omit:["posMatrix"]});class Mg{constructor(o,u,f){if(this.uid=o,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&"mapbox"!==f&&"terrarium"!==f)return void fn(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=u.height;const _=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=f||"mapbox";for(let x=0;x<_;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(_,x)]=this.data[this._idx(_-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,_)]=this.data[this._idx(x,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let x=0;x<_;x++)for(let C=0;C<_;C++){const M=this.get(x,C);M>this.max&&(this.max=M),M<this.min&&(this.min=M)}}get(o,u){const f=new Uint8Array(this.data.buffer),_=4*this._idx(o,u);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(f[_],f[_+1],f[_+2])}getUnpackVector(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(o,u){if(o<-1||o>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(o+1)}_unpackMapbox(o,u,f){return(256*o*256+256*u+f)/10-1e4}_unpackTerrarium(o,u,f){return 256*o+u+f/256-32768}getPixels(){return new Lo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(o,u,f){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let _=u*this.dim,x=u*this.dim+this.dim,C=f*this.dim,M=f*this.dim+this.dim;switch(u){case-1:_=x-1;break;case 1:x=_+1}switch(f){case-1:C=M-1;break;case 1:M=C+1}const A=-u*this.dim,F=-f*this.dim;for(let O=C;O<M;O++)for(let B=_;B<x;B++)this.data[this._idx(B,O)]=o.data[this._idx(B+A,O+F)]}}ct("DEMData",Mg);class _p{constructor(o){this._stringToNumber={},this._numberToString=[];for(let u=0;u<o.length;u++){const f=o[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(o){return this._stringToNumber[o]}decode(o){if(o>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${o} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[o]}}class Tg{constructor(o,u,f,_,x){this.type="Feature",this._vectorTileFeature=o,o._z=u,o._x=f,o._y=_,this.properties=o.properties,this.id=x}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={geometry:this.geometry};for(const u in this)"_geometry"!==u&&"_vectorTileFeature"!==u&&(o[u]=this[u]);return o}}class jd{constructor(o,u){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Vs(yn,16,0),this.grid3D=new Vs(yn,16,0),this.featureIndexArray=new Rr,this.promoteId=u}insert(o,u,f,_,x,C){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,_,x);const A=C?this.grid3D:this.grid;for(let F=0;F<u.length;F++){const O=u[F],B=[1/0,1/0,-1/0,-1/0];for(let H=0;H<O.length;H++){const q=O[H];B[0]=Math.min(B[0],q.x),B[1]=Math.min(B[1],q.y),B[2]=Math.max(B[2],q.x),B[3]=Math.max(B[3],q.y)}B[0]<yn&&B[1]<yn&&B[2]>=0&&B[3]>=0&&A.insert(M,B[0],B[1],B[2],B[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Kl.VectorTile(new ag(this.rawTileData)).layers,this.sourceLayerCoder=new _p(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(o,u,f,_){this.loadVTLayers();const x=o.params||{},C=yn/o.tileSize/o.scale,M=Ot(x.filter),A=o.queryGeometry,F=o.queryPadding*C,O=Ig(A),B=this.grid.query(O.minX-F,O.minY-F,O.maxX+F,O.maxY+F),H=Ig(o.cameraQueryGeometry),q=this.grid3D.query(H.minX-F,H.minY-F,H.maxX+F,H.maxY+F,(oe,be,Ce,me)=>function(Ee,$e,Ve,gt,Ct){for(const tt of Ee)if($e<=tt.x&&Ve<=tt.y&&gt>=tt.x&&Ct>=tt.y)return!0;const at=[new It($e,Ve),new It($e,Ct),new It(gt,Ct),new It(gt,Ve)];if(Ee.length>2)for(const tt of at)if(Wi(Ee,tt))return!0;for(let tt=0;tt<Ee.length-1;tt++)if(sh(Ee[tt],Ee[tt+1],at))return!0;return!1}(o.cameraQueryGeometry,oe-F,be-F,Ce+F,me+F));for(const oe of q)B.push(oe);B.sort(Ag);const W={};let se;for(let oe=0;oe<B.length;oe++){const be=B[oe];if(be===se)continue;se=be;const Ce=this.featureIndexArray.get(be);let me=null;this.loadMatchingFeature(W,Ce.bucketIndex,Ce.sourceLayerIndex,Ce.featureIndex,M,x.layers,x.availableImages,u,f,_,(Ee,$e,Ve)=>(me||(me=vr(Ee)),$e.queryIntersectsFeature(A,Ee,Ve,me,this.z,o.transform,C,o.pixelPosMatrix)))}return W}loadMatchingFeature(o,u,f,_,x,C,M,A,F,O,B){const H=this.bucketLayerIDs[u];if(C&&!function(oe,be){for(let Ce=0;Ce<oe.length;Ce++)if(be.indexOf(oe[Ce])>=0)return!0;return!1}(C,H))return;const q=this.sourceLayerCoder.decode(f),W=this.vtLayers[q].feature(_);if(x.needGeometry){const oe=ci(W,!0);if(!x.filter(new hr(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!x.filter(new hr(this.tileID.overscaledZ),W))return;const se=this.getId(W,q);for(let oe=0;oe<H.length;oe++){const be=H[oe];if(C&&C.indexOf(be)<0)continue;const Ce=A[be];if(!Ce)continue;let me={};se&&O&&(me=O.getState(Ce.sourceLayer||"_geojsonTileLayer",se));const Ee=Bi({},F[be]);Ee.paint=Hd(Ee.paint,Ce.paint,W,me,M),Ee.layout=Hd(Ee.layout,Ce.layout,W,me,M);const $e=!B||B(W,Ce,me);if(!$e)continue;const Ve=new Tg(W,this.z,this.x,this.y,se);Ve.layer=Ee;let gt=o[be];void 0===gt&&(gt=o[be]=[]),gt.push({featureIndex:_,feature:Ve,intersectionZ:$e})}}lookupSymbolFeatures(o,u,f,_,x,C,M,A){const F={};this.loadVTLayers();const O=Ot(x);for(const B of o)this.loadMatchingFeature(F,f,_,B,O,C,M,A,u);return F}hasLayer(o){for(const u of this.bucketLayerIDs)for(const f of u)if(o===f)return!0;return!1}getId(o,u){let f=o.id;return this.promoteId&&(f=o.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[u]],"boolean"==typeof f&&(f=Number(f))),f}}function Hd(l,o,u,f,_){return Pa(l,(x,C)=>{const M=o instanceof _s?o.get(C):null;return M&&M.evaluate?M.evaluate(u,f,_):M})}function Ig(l){let o=1/0,u=1/0,f=-1/0,_=-1/0;for(const x of l)o=Math.min(o,x.x),u=Math.min(u,x.y),f=Math.max(f,x.x),_=Math.max(_,x.y);return{minX:o,minY:u,maxX:f,maxY:_}}function Ag(l,o){return o-l}function Gd(l,o,u,f,_,x){if(_-f<=u)return;const C=f+_>>1;vp(l,o,C,f,_,x%2),Gd(l,o,u,f,C-1,x+1),Gd(l,o,u,C+1,_,x+1)}function vp(l,o,u,f,_,x){for(;_>f;){if(_-f>600){const F=_-f+1,O=u-f+1,B=Math.log(F),H=.5*Math.exp(2*B/3),q=.5*Math.sqrt(B*H*(F-H)/F)*(O-F/2<0?-1:1);vp(l,o,u,Math.max(f,Math.floor(u-O*H/F+q)),Math.min(_,Math.floor(u+(F-O)*H/F+q)),x)}const C=o[2*u+x];let M=f,A=_;for(sl(l,o,f,u),o[2*_+x]>C&&sl(l,o,f,_);M<A;){for(sl(l,o,M,A),M++,A--;o[2*M+x]<C;)M++;for(;o[2*A+x]>C;)A--}o[2*f+x]===C?sl(l,o,f,A):(A++,sl(l,o,A,_)),A<=u&&(f=A+1),u<=A&&(_=A-1)}}function sl(l,o,u,f){kg(l,u,f),kg(o,2*u,2*f),kg(o,2*u+1,2*f+1)}function kg(l,o,u){const f=l[o];l[o]=l[u],l[u]=f}function Pg(l,o,u,f){const _=l-u,x=o-f;return _*_+x*x}ct("FeatureIndex",jd,{omit:["rawTileData","sourceLayerCoder"]});const T1=l=>l[0],I1=l=>l[1];var bp;b.PerformanceMarkers=void 0,(bp=b.PerformanceMarkers||(b.PerformanceMarkers={})).create="create",bp.load="load",bp.fullLoad="fullLoad";let xh=null,ic=[];const qd=1e3/30,Jc={mark(l){performance.mark(l)},frame(l){const o=l;null!=xh&&ic.push(o-xh),xh=o},clearMetrics(){xh=null,ic=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const l in b.PerformanceMarkers)performance.clearMarks(b.PerformanceMarkers[l])},getPerformanceMetrics(){performance.measure("loadTime",b.PerformanceMarkers.create,b.PerformanceMarkers.load),performance.measure("fullLoadTime",b.PerformanceMarkers.create,b.PerformanceMarkers.fullLoad);const l=performance.getEntriesByName("loadTime")[0].duration,o=performance.getEntriesByName("fullLoadTime")[0].duration,u=ic.length,f=1/(ic.reduce((x,C)=>x+C,0)/u/1e3),_=ic.filter(x=>x>qd).reduce((x,C)=>x+(C-qd)/qd,0);return{loadTime:l,fullLoadTime:o,fps:f,percentDroppedFrames:_/(u+_)*100}}};b.AJAXError=Os,b.ARRAY_TYPE=tl,b.Actor=class{constructor(l,o,u){this.target=l,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Rs(["receive","process"],this),this.invoker=new ov(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=To()?l:window}send(l,o,u,f,_=!1){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[x]=u);const C=Fs(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:l,hasCallback:!!u,targetMapId:f,mustQueue:_,sourceMapId:this.mapId,data:fo(o,C)},C),{cancel:()=>{u&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(l){const o=l.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){delete this.tasks[u];const f=this.cancelCallbacks[u];delete this.cancelCallbacks[u],f&&f()}else To()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)}process(){if(!this.taskQueue.length)return;const l=this.taskQueue.shift(),o=this.tasks[l];delete this.tasks[l],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(l,o)}processTask(l,o){if("<response>"===o.type){const u=this.callbacks[l];delete this.callbacks[l],u&&(o.error?u(Er(o.error)):u(null,Er(o.data)))}else{let u=!1;const f=Fs(this.globalScope)?void 0:[],_=o.hasCallback?(M,A)=>{u=!0,delete this.cancelCallbacks[l],this.target.postMessage({id:l,type:"<response>",sourceMapId:this.mapId,error:M?fo(M):null,data:fo(A,f)},f)}:M=>{u=!0};let x=null;const C=Er(o.data);if(this.parent[o.type])x=this.parent[o.type](o.sourceMapId,C,_);else if(this.parent.getWorkerSource){const M=o.type.split(".");x=this.parent.getWorkerSource(o.sourceMapId,M[0],C.source)[M[1]](C,_)}else _(new Error(`Could not find function ${o.type}`));!u&&x&&x.cancel&&(this.cancelCallbacks[l]=x.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},b.AlphaImage=uh,b.CanonicalTileID=vh,b.CollisionBoxArray=vd,b.CollisionCircleLayoutArray=class extends gd{},b.Color=Sn,b.DEMData=Mg,b.DataConstantProperty=wt,b.DictionaryCoder=_p,b.EXTENT=yn,b.ErrorEvent=yr,b.EvaluationParameters=hr,b.Event=na,b.Evented=tr,b.FeatureIndex=jd,b.FillBucket=_o,b.FillExtrusionBucket=ng,b.GeoJSONFeature=Tg,b.ImageAtlas=m1,b.ImagePosition=q_,b.KDBush=class{constructor(l,o=T1,u=I1,f=64,_=Float64Array){this.nodeSize=f,this.points=l;const x=l.length<65536?Uint16Array:Uint32Array,C=this.ids=new x(l.length),M=this.coords=new _(2*l.length);for(let A=0;A<l.length;A++)C[A]=A,M[2*A]=o(l[A]),M[2*A+1]=u(l[A]);Gd(C,M,f,0,C.length-1,0)}range(l,o,u,f){return function(_,x,C,M,A,F,O){const B=[0,_.length-1,0],H=[];let q,W;for(;B.length;){const se=B.pop(),oe=B.pop(),be=B.pop();if(oe-be<=O){for(let Ee=be;Ee<=oe;Ee++)q=x[2*Ee],W=x[2*Ee+1],q>=C&&q<=A&&W>=M&&W<=F&&H.push(_[Ee]);continue}const Ce=Math.floor((be+oe)/2);q=x[2*Ce],W=x[2*Ce+1],q>=C&&q<=A&&W>=M&&W<=F&&H.push(_[Ce]);const me=(se+1)%2;(0===se?C<=q:M<=W)&&(B.push(be),B.push(Ce-1),B.push(me)),(0===se?A>=q:F>=W)&&(B.push(Ce+1),B.push(oe),B.push(me))}return H}(this.ids,this.coords,l,o,u,f,this.nodeSize)}within(l,o,u){return function(f,_,x,C,M,A){const F=[0,f.length-1,0],O=[],B=M*M;for(;F.length;){const H=F.pop(),q=F.pop(),W=F.pop();if(q-W<=A){for(let me=W;me<=q;me++)Pg(_[2*me],_[2*me+1],x,C)<=B&&O.push(f[me]);continue}const se=Math.floor((W+q)/2),oe=_[2*se],be=_[2*se+1];Pg(oe,be,x,C)<=B&&O.push(f[se]);const Ce=(H+1)%2;(0===H?x-M<=oe:C-M<=be)&&(F.push(W),F.push(se-1),F.push(Ce)),(0===H?x+M>=oe:C+M>=be)&&(F.push(se+1),F.push(q),F.push(Ce))}return O}(this.ids,this.coords,l,o,u,this.nodeSize)}},b.LineBucket=ig,b.LineStripIndexArray=class extends yd{},b.LngLat=br,b.LngLatBounds=sv,b.MercatorCoordinate=yp,b.ONE_EM=24,b.OverscaledTileID=No,b.PerformanceUtils=Jc,b.Pos3dArray=class extends Ju{},b.PosArray=ih,b.Properties=Si,b.QuadTriangleArray=class extends th{},b.RGBAImage=Lo,b.RasterBoundsArray=class extends Hc{},b.RequestPerformance=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return 0===l.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},b.SegmentVector=R,b.SymbolBucket=tc,b.Transitionable=Xu,b.TriangleIndexArray=w,b.Uniform1f=ke,b.Uniform1i=class extends Se{constructor(l,o){super(l,o),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},b.Uniform2f=class extends Se{constructor(l,o){super(l,o),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},b.Uniform3f=class extends Se{constructor(l,o){super(l,o),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},b.Uniform4f=Be,b.UniformColor=Le,b.UniformMatrix4f=class extends Se{constructor(l,o){super(l,o),this.current=Ne}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let o=1;o<16;o++)if(l[o]!==this.current[o]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},b.UnwrappedTileID=lv,b.ValidationError=Pe,b.ZoomHistory=Bf,b.addDynamicAttributes=Ud,b.arrayBufferToImage=function(l,o){const u=new Image;u.onload=()=>{o(null,u),URL.revokeObjectURL(u.src),u.onload=null,window.requestAnimationFrame(()=>{u.src=Ra})},u.onerror=()=>o(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(l)],{type:"image/png"});u.src=l.byteLength?URL.createObjectURL(f):Ra},b.arrayBufferToImageBitmap=function(l,o){const u=new Blob([new Uint8Array(l)],{type:"image/png"});createImageBitmap(u).then(f=>{o(null,f)}).catch(f=>{o(new Error(`Could not load image because of ${f.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},b.asyncAll=function(l,o,u){if(!l.length)return u(null,[]);let f=l.length;const _=new Array(l.length);let x=null;l.forEach((C,M)=>{o(C,(A,F)=>{A&&(x=A),_[M]=F,0==--f&&u(x,_)})})},b.bezier=us,b.bindAll=Rs,b.clamp=Zt,b.clipLine=_g,b.clone=function(l){var o=new tl(16);return o[0]=l[0],o[1]=l[1],o[2]=l[2],o[3]=l[3],o[4]=l[4],o[5]=l[5],o[6]=l[6],o[7]=l[7],o[8]=l[8],o[9]=l[9],o[10]=l[10],o[11]=l[11],o[12]=l[12],o[13]=l[13],o[14]=l[14],o[15]=l[15],o},b.clone$1=Ci,b.collisionCircleLayout=sg,b.config=Fa,b.copy=function(l,o){return l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[3],l[4]=o[4],l[5]=o[5],l[6]=o[6],l[7]=o[7],l[8]=o[8],l[9]=o[9],l[10]=o[10],l[11]=o[11],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15],l},b.create=function(){var l=new tl(16);return tl!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},b.createExpression=Ga,b.createFilter=Ot,b.createLayout=Dr,b.createStyleLayer=function(l){return"custom"===l.type?new D1(l):new S1[l.type](l)},b.dot=function(l,o){return l[0]*o[0]+l[1]*o[1]+l[2]*o[2]+l[3]*o[3]},b.earthRadius=$d,b.ease=Il,b.emitValidationErrors=ad,b.equals=function(l,o){var u=l[0],f=l[1],_=l[2],x=l[3],C=l[4],M=l[5],A=l[6],F=l[7],O=l[8],B=l[9],H=l[10],q=l[11],W=l[12],se=l[13],oe=l[14],be=l[15],Ce=o[0],me=o[1],Ee=o[2],$e=o[3],Ve=o[4],gt=o[5],Ct=o[6],at=o[7],tt=o[8],Qe=o[9],ot=o[10],it=o[11],Ge=o[12],Et=o[13],pt=o[14],Yt=o[15];return Math.abs(u-Ce)<=Mr*Math.max(1,Math.abs(u),Math.abs(Ce))&&Math.abs(f-me)<=Mr*Math.max(1,Math.abs(f),Math.abs(me))&&Math.abs(_-Ee)<=Mr*Math.max(1,Math.abs(_),Math.abs(Ee))&&Math.abs(x-$e)<=Mr*Math.max(1,Math.abs(x),Math.abs($e))&&Math.abs(C-Ve)<=Mr*Math.max(1,Math.abs(C),Math.abs(Ve))&&Math.abs(M-gt)<=Mr*Math.max(1,Math.abs(M),Math.abs(gt))&&Math.abs(A-Ct)<=Mr*Math.max(1,Math.abs(A),Math.abs(Ct))&&Math.abs(F-at)<=Mr*Math.max(1,Math.abs(F),Math.abs(at))&&Math.abs(O-tt)<=Mr*Math.max(1,Math.abs(O),Math.abs(tt))&&Math.abs(B-Qe)<=Mr*Math.max(1,Math.abs(B),Math.abs(Qe))&&Math.abs(H-ot)<=Mr*Math.max(1,Math.abs(H),Math.abs(ot))&&Math.abs(q-it)<=Mr*Math.max(1,Math.abs(q),Math.abs(it))&&Math.abs(W-Ge)<=Mr*Math.max(1,Math.abs(W),Math.abs(Ge))&&Math.abs(se-Et)<=Mr*Math.max(1,Math.abs(se),Math.abs(Et))&&Math.abs(oe-pt)<=Mr*Math.max(1,Math.abs(oe),Math.abs(pt))&&Math.abs(be-Yt)<=Mr*Math.max(1,Math.abs(be),Math.abs(Yt))},b.evaluateSizeForFeature=function(l,{uSize:o,uSizeT:u},{lowerSize:f,upperSize:_}){return"source"===l.kind?f/_a:"composite"===l.kind?Kn(f/_a,_/_a,u):o},b.evaluateSizeForZoom=function(l,o){let u=0,f=0;if("constant"===l.kind)f=l.layoutSize;else if("source"!==l.kind){const{interpolationType:_,minZoom:x,maxZoom:C}=l,M=_?Zt(Io.interpolationFactor(_,o,x,C),0,1):0;"camera"===l.kind?f=Kn(l.minSize,l.maxSize,M):u=M}return{uSizeT:u,uSize:f}},b.evaluateVariableOffset=ev,b.evented=jf,b.exported=Pu,b.extend=Bi,b.filterObject=Al,b.fromScaling=function(l,o){return l[0]=o[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=o[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=o[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},b.getAnchorAlignment=Yi,b.getAnchorJustification=Bd,b.getArrayBuffer=Oa,b.getJSON=function(l,o){return kl(Bi(l,{type:"json"}),o)},b.getOverlapMode=Cg,b.getRTLTextPluginStatus=$l,b.getReferrer=Bn,b.getVideo=function(l,o){const u=window.document.createElement("video");u.muted=!0,u.onloadstart=function(){o(null,u)};for(let f=0;f<l.length;f++){const _=window.document.createElement("source");Rc(l[f])||(u.crossOrigin="Anonymous"),_.src=l[f],u.appendChild(_)}return{cancel:()=>{}}},b.identity=qf,b.invert=function(l,o){var u=o[0],f=o[1],_=o[2],x=o[3],C=o[4],M=o[5],A=o[6],F=o[7],O=o[8],B=o[9],H=o[10],q=o[11],W=o[12],se=o[13],oe=o[14],be=o[15],Ce=u*M-f*C,me=u*A-_*C,Ee=u*F-x*C,$e=f*A-_*M,Ve=f*F-x*M,gt=_*F-x*A,Ct=O*se-B*W,at=O*oe-H*W,tt=O*be-q*W,Qe=B*oe-H*se,ot=B*be-q*se,it=H*be-q*oe,Ge=Ce*it-me*ot+Ee*Qe+$e*tt-Ve*at+gt*Ct;return Ge?(l[0]=(M*it-A*ot+F*Qe)*(Ge=1/Ge),l[1]=(_*ot-f*it-x*Qe)*Ge,l[2]=(se*gt-oe*Ve+be*$e)*Ge,l[3]=(H*Ve-B*gt-q*$e)*Ge,l[4]=(A*tt-C*it-F*at)*Ge,l[5]=(u*it-_*tt+x*at)*Ge,l[6]=(oe*Ee-W*gt-be*me)*Ge,l[7]=(O*gt-H*Ee+q*me)*Ge,l[8]=(C*ot-M*tt+F*Ct)*Ge,l[9]=(f*tt-u*ot-x*Ct)*Ge,l[10]=(W*Ve-se*Ee+be*Ce)*Ge,l[11]=(B*Ee-O*Ve-q*Ce)*Ge,l[12]=(M*at-C*Qe-A*Ct)*Ge,l[13]=(u*Qe-f*at+_*Ct)*Ge,l[14]=(se*me-W*$e-oe*Ce)*Ge,l[15]=(O*$e-B*me+H*Ce)*Ge,l):null},b.isImageBitmap=oo,b.isSafari=Fs,b.isWorker=To,b.keysDifference=function(l,o){const u=[];for(const f in l)f in o||u.push(f);return u},b.lazyLoadRTLTextPlugin=function(){go.isLoading()||go.isLoaded()||"deferred"!==$l()||jm()},b.makeRequest=kl,b.mapObject=Pa,b.mercatorXfromLng=Dg,b.mercatorYfromLat=rc,b.mercatorZfromAltitude=Sg,b.mul=ga,b.mul$1=function(l,o,u){return l[0]=o[0]*u[0],l[1]=o[1]*u[1],l[2]=o[2]*u[2],l[3]=o[3]*u[3],l},b.multiply=Hm,b.nextPowerOfTwo=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},b.number=Kn,b.ortho=function(l,o,u,f,_,x,C){var M=1/(o-u),A=1/(f-_),F=1/(x-C);return l[0]=-2*M,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*A,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*F,l[11]=0,l[12]=(o+u)*M,l[13]=(_+f)*A,l[14]=(C+x)*F,l[15]=1,l},b.parseCacheControl=function(l){const o={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,_,x)=>{const C=_||x;return o[f]=!C||C.toLowerCase(),""}),o["max-age"]){const u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o},b.parseGlyphPbf=function(l){return new ag(l).readFields(T2,[])},b.pbf=ag,b.performSymbolLayout=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=yn/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;const o=l.bucket.layers[0].layout,u=l.bucket.layers[0]._unevaluatedLayout._values,f={layoutIconSize:u["icon-size"].possiblyEvaluate(new hr(l.bucket.zoom+1),l.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new hr(l.bucket.zoom+1),l.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new hr(18))};if("composite"===l.bucket.textSizeData.kind){const{minZoom:A,maxZoom:F}=l.bucket.textSizeData;f.compositeTextSizes=[u["text-size"].possiblyEvaluate(new hr(A),l.canonical),u["text-size"].possiblyEvaluate(new hr(F),l.canonical)]}if("composite"===l.bucket.iconSizeData.kind){const{minZoom:A,maxZoom:F}=l.bucket.iconSizeData;f.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new hr(A),l.canonical),u["icon-size"].possiblyEvaluate(new hr(F),l.canonical)]}const _=24*o.get("text-line-height"),x="viewport"!==o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement"),C=o.get("text-keep-upright"),M=o.get("text-size");for(const A of l.bucket.features){const F=o.get("text-font").evaluate(A,{},l.canonical).join(","),O=M.evaluate(A,{},l.canonical),B=f.layoutTextSize.evaluate(A,{},l.canonical),H=f.layoutIconSize.evaluate(A,{},l.canonical),q={horizontal:{},vertical:void 0},W=A.text;let se,oe=[0,0];if(W){const me=W.toString(),Ee=24*o.get("text-letter-spacing").evaluate(A,{},l.canonical),$e=ld(me)?Ee:0,Ve=o.get("text-anchor").evaluate(A,{},l.canonical),gt=o.get("text-variable-anchor");if(!gt){const ot=o.get("text-radial-offset").evaluate(A,{},l.canonical);oe=ot?ev(Ve,[24*ot,vg]):o.get("text-offset").evaluate(A,{},l.canonical).map(it=>24*it)}let Ct=x?"center":o.get("text-justify").evaluate(A,{},l.canonical);const at=o.get("symbol-placement"),tt="point"===at?24*o.get("text-max-width").evaluate(A,{},l.canonical):0,Qe=()=>{l.bucket.allowVerticalPlacement&&po(me)&&(q.vertical=hg(W,l.glyphMap,l.glyphPositions,l.imagePositions,F,tt,_,Ve,"left",$e,oe,b.WritingMode.vertical,!0,at,B,O))};if(!x&&gt){const ot="auto"===Ct?gt.map(Ge=>Bd(Ge)):[Ct];let it=!1;for(let Ge=0;Ge<ot.length;Ge++){const Et=ot[Ge];if(!q.horizontal[Et])if(it)q.horizontal[Et]=q.horizontal[0];else{const pt=hg(W,l.glyphMap,l.glyphPositions,l.imagePositions,F,tt,_,"center",Et,$e,oe,b.WritingMode.horizontal,!1,at,B,O);pt&&(q.horizontal[Et]=pt,it=1===pt.positionedLines.length)}}Qe()}else{"auto"===Ct&&(Ct=Bd(Ve));const ot=hg(W,l.glyphMap,l.glyphPositions,l.imagePositions,F,tt,_,Ve,Ct,$e,oe,b.WritingMode.horizontal,!1,at,B,O);ot&&(q.horizontal[Ct]=ot),Qe(),po(me)&&x&&C&&(q.vertical=hg(W,l.glyphMap,l.glyphPositions,l.imagePositions,F,tt,_,Ve,Ct,$e,oe,b.WritingMode.vertical,!1,at,B,O))}}let be=!1;if(A.icon&&A.icon.name){const me=l.imageMap[A.icon.name];me&&(se=y1(l.imagePositions[A.icon.name],o.get("icon-offset").evaluate(A,{},l.canonical),o.get("icon-anchor").evaluate(A,{},l.canonical)),be=!!me.sdf,void 0===l.bucket.sdfIcons?l.bucket.sdfIcons=be:l.bucket.sdfIcons!==be&&fn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(me.pixelRatio!==l.bucket.pixelRatio||0!==o.get("icon-rotate").constantOr(1))&&(l.bucket.iconsNeedLinear=!0))}const Ce=tv(q.horizontal)||q.vertical;l.bucket.iconsInText=!!Ce&&Ce.iconsInText,(Ce||se)&&bg(l.bucket,A,q,se,l.imageMap,f,B,H,oe,be,l.canonical)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},b.perspective=function(l,o,u,f,_){var x,C=1/Math.tan(o/2);return l[0]=C/u,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=C,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,null!=_&&_!==1/0?(l[10]=(_+f)*(x=1/(f-_)),l[14]=2*_*f*x):(l[10]=-1,l[14]=-2*f),l},b.pick=function(l,o){const u={};for(let f=0;f<o.length;f++){const _=o[f];_ in l&&(u[_]=l[_])}return u},b.plugin=go,b.pointGeometry=It,b.polygonIntersectsPolygon=Oo,b.potpack=sp,b.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],b.register=ct,b.registerForPluginStateChange=function(l){return l({pluginStatus:mo,pluginURL:Us}),jf.on("pluginStateChange",l),l},b.renderColorRamp=Zm,b.rotateX=function(l,o,u){var f=Math.sin(u),_=Math.cos(u),x=o[4],C=o[5],M=o[6],A=o[7],F=o[8],O=o[9],B=o[10],H=o[11];return o!==l&&(l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[3],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[4]=x*_+F*f,l[5]=C*_+O*f,l[6]=M*_+B*f,l[7]=A*_+H*f,l[8]=F*_-x*f,l[9]=O*_-C*f,l[10]=B*_-M*f,l[11]=H*_-A*f,l},b.rotateZ=function(l,o,u){var f=Math.sin(u),_=Math.cos(u),x=o[0],C=o[1],M=o[2],A=o[3],F=o[4],O=o[5],B=o[6],H=o[7];return o!==l&&(l[8]=o[8],l[9]=o[9],l[10]=o[10],l[11]=o[11],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[0]=x*_+F*f,l[1]=C*_+O*f,l[2]=M*_+B*f,l[3]=A*_+H*f,l[4]=F*_-x*f,l[5]=O*_-C*f,l[6]=B*_-M*f,l[7]=H*_-A*f,l},b.scale=function(l,o,u){var f=u[0],_=u[1],x=u[2];return l[0]=o[0]*f,l[1]=o[1]*f,l[2]=o[2]*f,l[3]=o[3]*f,l[4]=o[4]*_,l[5]=o[5]*_,l[6]=o[6]*_,l[7]=o[7]*_,l[8]=o[8]*x,l[9]=o[9]*x,l[10]=o[10]*x,l[11]=o[11]*x,l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15],l},b.setRTLTextPlugin=function(l,o,u=!1){if(mo===Ul||mo===Vf||mo===Uf)throw new Error("setRTLTextPlugin cannot be called multiple times.");Us=Pu.resolveURL(l),mo=Ul,$f=o,Wu(),u||jm()},b.spec=Ae,b.sphericalToCartesian=function([l,o,u]){return o+=90,o*=Math.PI/180,u*=Math.PI/180,{x:l*Math.cos(o)*Math.sin(u),y:l*Math.sin(o)*Math.sin(u),z:l*Math.cos(u)}},b.toEvaluationFeature=ci,b.transformMat4=Zf,b.translate=function(l,o,u){var f,_,x,C,M,A,F,O,B,H,q,W,se=u[0],oe=u[1],be=u[2];return o===l?(l[12]=o[0]*se+o[4]*oe+o[8]*be+o[12],l[13]=o[1]*se+o[5]*oe+o[9]*be+o[13],l[14]=o[2]*se+o[6]*oe+o[10]*be+o[14],l[15]=o[3]*se+o[7]*oe+o[11]*be+o[15]):(_=o[1],x=o[2],C=o[3],M=o[4],A=o[5],F=o[6],O=o[7],B=o[8],H=o[9],q=o[10],W=o[11],l[0]=f=o[0],l[1]=_,l[2]=x,l[3]=C,l[4]=M,l[5]=A,l[6]=F,l[7]=O,l[8]=B,l[9]=H,l[10]=q,l[11]=W,l[12]=f*se+M*oe+B*be+o[12],l[13]=_*se+A*oe+H*be+o[13],l[14]=x*se+F*oe+q*be+o[14],l[15]=C*se+O*oe+W*be+o[15]),l},b.triggerPluginCompletionEvent=$m,b.unicodeBlockLookup=Xe,b.uniqueId=function(){return Ps++},b.validateCustomStyleLayer=function(l){const o=[],u=l.id;return void 0===u&&o.push({message:`layers.${u}: missing required property "id"`}),void 0===l.render&&o.push({message:`layers.${u}: missing required method "render"`}),l.renderingMode&&"2d"!==l.renderingMode&&"3d"!==l.renderingMode&&o.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),o},b.validateLight=sd,b.validateStyle=Yo,b.vectorTile=Kl,b.warnOnce=fn,b.wrap=Ie}),qh(0,function(b){function wr(J){const V=typeof J;if("number"===V||"boolean"===V||"string"===V||null==J)return JSON.stringify(J);if(Array.isArray(J)){let te="[";for(const ce of J)te+=`${wr(ce)},`;return`${te}]`}const $=Object.keys(J).sort();let K="{";for(let te=0;te<$.length;te++)K+=`${JSON.stringify($[te])}:${wr(J[$[te]])},`;return`${K}}`}function ks(J){let V="";for(const $ of b.refProperties)V+=`/${wr(J[$])}`;return V}class us{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,$){for(const te of V){this._layerConfigs[te.id]=te;const ce=this._layers[te.id]=b.createStyleLayer(te);ce._featureFilter=b.createFilter(ce.filter),this.keyCache[te.id]&&delete this.keyCache[te.id]}for(const te of $)delete this.keyCache[te],delete this._layerConfigs[te],delete this._layers[te];this.familiesBySource={};const K=function(te,ce){const ge={};for(let ue=0;ue<te.length;ue++){const xe=ce&&ce[te[ue].id]||ks(te[ue]);ce&&(ce[te[ue].id]=xe);let Me=ge[xe];Me||(Me=ge[xe]=[]),Me.push(te[ue])}const he=[];for(const ue in ge)he.push(ge[ue]);return he}(Object.values(this._layerConfigs),this.keyCache);for(const te of K){const ce=te.map(je=>this._layers[je.id]),ge=ce[0];if("none"===ge.visibility)continue;const he=ge.source||"";let ue=this.familiesBySource[he];ue||(ue=this.familiesBySource[he]={});const xe=ge.sourceLayer||"_geojsonTileLayer";let Me=ue[xe];Me||(Me=ue[xe]=[]),Me.push(ce)}}}class Il{constructor(V){const $={},K=[];for(const he in V){const ue=V[he],xe=$[he]={};for(const Me in ue){const je=ue[+Me];if(!je||0===je.bitmap.width||0===je.bitmap.height)continue;const Te={x:0,y:0,w:je.bitmap.width+2,h:je.bitmap.height+2};K.push(Te),xe[Me]={rect:Te,metrics:je.metrics}}}const{w:te,h:ce}=b.potpack(K),ge=new b.AlphaImage({width:te||1,height:ce||1});for(const he in V){const ue=V[he];for(const xe in ue){const Me=ue[+xe];if(!Me||0===Me.bitmap.width||0===Me.bitmap.height)continue;const je=$[he][xe].rect;b.AlphaImage.copy(Me.bitmap,ge,{x:0,y:0},{x:je.x+1,y:je.y+1},Me.bitmap)}}this.image=ge,this.positions=$}}b.register("GlyphAtlas",Il);class Zt{constructor(V){this.tileID=new b.OverscaledTileID(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId}parse(V,$,K,te,ce){this.status="parsing",this.data=V,this.collisionBoxArray=new b.CollisionBoxArray;const ge=new b.DictionaryCoder(Object.keys(V.layers).sort()),he=new b.FeatureIndex(this.tileID,this.promoteId);he.bucketLayerIDs=[];const ue={},xe={featureIndex:he,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:K},Me=$.familiesBySource[this.source];for(const sn in Me){const an=V.layers[sn];if(!an)continue;1===an.version&&b.warnOnce(`Vector tile source "${this.source}" layer "${sn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Zn=ge.encode(sn),lr=[];for(let ai=0;ai<an.length;ai++){const Pr=an.feature(ai),Va=he.getId(Pr,sn);lr.push({feature:Pr,id:Va,index:ai,sourceLayerIndex:Zn})}for(const ai of Me[sn]){const Pr=ai[0];Pr.source!==this.source&&b.warnOnce(`layer.source = ${Pr.source} does not equal this.source = ${this.source}`),Pr.minzoom&&this.zoom<Math.floor(Pr.minzoom)||Pr.maxzoom&&this.zoom>=Pr.maxzoom||"none"!==Pr.visibility&&(Ie(ai,this.zoom,K),(ue[Pr.id]=Pr.createBucket({index:he.bucketLayerIDs.length,layers:ai,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Zn,sourceID:this.source})).populate(lr,xe,this.tileID.canonical),he.bucketLayerIDs.push(ai.map(Va=>Va.id)))}}let je,Te,Dt,ht;const dt=b.mapObject(xe.glyphDependencies,sn=>Object.keys(sn).map(Number));Object.keys(dt).length?te.send("getGlyphs",{uid:this.uid,stacks:dt,source:this.source,tileID:this.tileID,type:"glyphs"},(sn,an)=>{je||(je=sn,Te=an,qn.call(this))}):Te={};const xt=Object.keys(xe.iconDependencies);xt.length?te.send("getImages",{icons:xt,source:this.source,tileID:this.tileID,type:"icons"},(sn,an)=>{je||(je=sn,Dt=an,qn.call(this))}):Dt={};const ln=Object.keys(xe.patternDependencies);function qn(){if(je)return ce(je);if(Te&&Dt&&ht){const sn=new Il(Te),an=new b.ImageAtlas(Dt,ht);for(const Zn in ue){const lr=ue[Zn];lr instanceof b.SymbolBucket?(Ie(lr.layers,this.zoom,K),b.performSymbolLayout({bucket:lr,glyphMap:Te,glyphPositions:sn.positions,imageMap:Dt,imagePositions:an.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):lr.hasPattern&&(lr instanceof b.LineBucket||lr instanceof b.FillBucket||lr instanceof b.FillExtrusionBucket)&&(Ie(lr.layers,this.zoom,K),lr.addFeatures(xe,this.tileID.canonical,an.patternPositions))}this.status="done",ce(null,{buckets:Object.values(ue).filter(Zn=>!Zn.isEmpty()),featureIndex:he,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:sn.image,imageAtlas:an,glyphMap:this.returnDependencies?Te:null,iconMap:this.returnDependencies?Dt:null,glyphPositions:this.returnDependencies?sn.positions:null})}}ln.length?te.send("getImages",{icons:ln,source:this.source,tileID:this.tileID,type:"patterns"},(sn,an)=>{je||(je=sn,ht=an,qn.call(this))}):ht={},qn.call(this)}}function Ie(J,V,$){const K=new b.EvaluationParameters(V);for(const te of J)te.recalculate(K,$)}function Bi(J,V){const $=b.getArrayBuffer(J.request,(K,te,ce,ge)=>{K?V(K):te&&V(null,{vectorTile:new b.vectorTile.VectorTile(new b.pbf(te)),rawData:te,cacheControl:ce,expires:ge})});return()=>{$.cancel(),V()}}class Ps{constructor(V,$,K,te){this.actor=V,this.layerIndex=$,this.availableImages=K,this.loadVectorData=te||Bi,this.loading={},this.loaded={}}loadTile(V,$){const K=V.uid;this.loading||(this.loading={});const te=!!(V&&V.request&&V.request.collectResourceTiming)&&new b.RequestPerformance(V.request),ce=this.loading[K]=new Zt(V);ce.abort=this.loadVectorData(V,(ge,he)=>{if(delete this.loading[K],ge||!he)return ce.status="done",this.loaded[K]=ce,$(ge);const ue=he.rawData,xe={};he.expires&&(xe.expires=he.expires),he.cacheControl&&(xe.cacheControl=he.cacheControl);const Me={};if(te){const je=te.finish();je&&(Me.resourceTiming=JSON.parse(JSON.stringify(je)))}ce.vectorTile=he.vectorTile,ce.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,(je,Te)=>{if(je||!Te)return $(je);$(null,b.extend({rawTileData:ue.slice(0)},Te,xe,Me))}),this.loaded=this.loaded||{},this.loaded[K]=ce})}reloadTile(V,$){const K=this.loaded,te=V.uid,ce=this;if(K&&K[te]){const ge=K[te];ge.showCollisionBoxes=V.showCollisionBoxes;const he=(ue,xe)=>{const Me=ge.reloadCallback;Me&&(delete ge.reloadCallback,ge.parse(ge.vectorTile,ce.layerIndex,this.availableImages,ce.actor,Me)),$(ue,xe)};"parsing"===ge.status?ge.reloadCallback=he:"done"===ge.status&&(ge.vectorTile?ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,he):he())}}abortTile(V,$){const K=this.loading,te=V.uid;K&&K[te]&&K[te].abort&&(K[te].abort(),delete K[te]),$()}removeTile(V,$){const K=this.loaded,te=V.uid;K&&K[te]&&delete K[te],$()}}class Rs{constructor(){this.loaded={}}loadTile(V,$){const{uid:K,encoding:te,rawImageData:ce}=V,ge=b.isImageBitmap(ce)?this.getImageData(ce):ce,he=new b.DEMData(K,ge,te);this.loaded=this.loaded||{},this.loaded[K]=he,$(null,he)}getImageData(V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const $=this.offscreenCanvasContext.getImageData(-1,-1,V.width+2,V.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new b.RGBAImage({width:$.width,height:$.height},$.data)}removeTile(V){const $=this.loaded,K=V.uid;$&&$[K]&&delete $[K]}}var Pa=function J(V,$){var K,te=V&&V.type;if("FeatureCollection"===te)for(K=0;K<V.features.length;K++)J(V.features[K],$);else if("GeometryCollection"===te)for(K=0;K<V.geometries.length;K++)J(V.geometries[K],$);else if("Feature"===te)J(V.geometry,$);else if("Polygon"===te)Al(V.coordinates,$);else if("MultiPolygon"===te)for(K=0;K<V.coordinates.length;K++)Al(V.coordinates[K],$);return V};function Al(J,V){if(0!==J.length){Ci(J[0],V);for(var $=1;$<J.length;$++)Ci(J[$],!V)}}function Ci(J,V){for(var $=0,K=0,te=0,ce=J.length,ge=ce-1;te<ce;ge=te++){var he=(J[te][0]-J[ge][0])*(J[ge][1]+J[te][1]),ue=$+he;K+=Math.abs($)>=Math.abs(he)?$-ue+he:he-ue+$,$=ue}$+K>=0!=!!V&&J.reverse()}const io=b.vectorTile.VectorTileFeature.prototype.toGeoJSON;var fn={},si={get exports(){return fn},set exports(J){fn=J}},kc=b.pointGeometry,To=b.vectorTile.VectorTileFeature,ta=Fs;function Fs(J,V){this.options=V||{},this.features=J,this.length=J.length}function oo(J,V){this.id="number"==typeof J.id?J.id:void 0,this.type=J.type,this.rawGeometry=1===J.type?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=V||4096}Fs.prototype.feature=function(J){return new oo(this.features[J],this.options.extent)},oo.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var V=0;V<J.length;V++){for(var $=J[V],K=[],te=0;te<$.length;te++)K.push(new kc($[te][0],$[te][1]));this.geometry.push(K)}return this.geometry},oo.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,V=1/0,$=-1/0,K=1/0,te=-1/0,ce=0;ce<J.length;ce++)for(var ge=J[ce],he=0;he<ge.length;he++){var ue=ge[he];V=Math.min(V,ue.x),$=Math.max($,ue.x),K=Math.min(K,ue.y),te=Math.max(te,ue.y)}return[V,K,$,te]},oo.prototype.toGeoJSON=To.prototype.toGeoJSON;var Ra=b.pbf,hs=ta;function Gn(J){var V=new Ra;return function($,K){for(var te in $.layers)K.writeMessage(3,Pu,$.layers[te])}(J,V),V.finish()}function Pu(J,V){var $;V.writeVarintField(15,J.version||1),V.writeStringField(1,J.name||""),V.writeVarintField(5,J.extent||4096);var K={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<J.length;$++)K.feature=J.feature($),V.writeMessage(2,It,K);var te=K.keys;for($=0;$<te.length;$++)V.writeStringField(3,te[$]);var ce=K.values;for($=0;$<ce.length;$++)V.writeMessage(4,Pc,ce[$])}function It(J,V){var $=J.feature;void 0!==$.id&&V.writeVarintField(1,$.id),V.writeMessage(2,Wr,J),V.writeVarintField(3,$.type),V.writeMessage(4,Bn,$)}function Wr(J,V){var $=J.feature,K=J.keys,te=J.values,ce=J.keycache,ge=J.valuecache;for(var he in $.properties){var ue=$.properties[he],xe=ce[he];if(null!==ue){void 0===xe&&(K.push(he),ce[he]=xe=K.length-1),V.writeVarint(xe);var Me=typeof ue;"string"!==Me&&"boolean"!==Me&&"number"!==Me&&(ue=JSON.stringify(ue));var je=Me+":"+ue,Te=ge[je];void 0===Te&&(te.push(ue),ge[je]=Te=te.length-1),V.writeVarint(Te)}}}function Fa(J,V){return(V<<3)+(7&J)}function Os(J){return J<<1^J>>31}function Bn(J,V){for(var $=J.loadGeometry(),K=J.type,te=0,ce=0,ge=$.length,he=0;he<ge;he++){var ue=$[he],xe=1;1===K&&(xe=ue.length),V.writeVarint(Fa(1,xe));for(var Me=3===K?ue.length-1:ue.length,je=0;je<Me;je++){1===je&&1!==K&&V.writeVarint(Fa(2,Me-1));var Te=ue[je].x-te,Dt=ue[je].y-ce;V.writeVarint(Os(Te)),V.writeVarint(Os(Dt)),te+=Te,ce+=Dt}3===K&&V.writeVarint(Fa(7,1))}}function Pc(J,V){var $=typeof J;"string"===$?V.writeStringField(1,J):"boolean"===$?V.writeBooleanField(7,J):"number"===$&&(J%1!=0?V.writeDoubleField(3,J):J<0?V.writeSVarintField(6,J):V.writeVarintField(5,J))}si.exports=Gn,fn.fromVectorTileJs=Gn,fn.fromGeojsonVt=function(J,V){V=V||{};var $={};for(var K in J)$[K]=new hs(J[K].features,V),$[K].name=K,$[K].version=V.version,$[K].extent=V.extent;return Gn({layers:$})},fn.GeoJSONWrapper=hs;const kl={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:J=>J},Oa=Math.fround||(Rc=new Float32Array(1),J=>(Rc[0]=+J,Rc[0]));var Rc;class pi{constructor(V){this.options=Vi(Object.create(kl),V),this.trees=new Array(this.options.maxZoom+1)}load(V){const{log:$,minZoom:K,maxZoom:te,nodeSize:ce}=this.options;$&&console.time("total time");const ge=`prepare ${V.length} points`;$&&console.time(ge),this.points=V;let he=[];for(let ue=0;ue<V.length;ue++)V[ue].geometry&&he.push(na(V[ue],ue));this.trees[te+1]=new b.KDBush(he,Vn,ds,ce,Float32Array),$&&console.timeEnd(ge);for(let ue=te;ue>=K;ue--){const xe=+Date.now();he=this._cluster(he,ue),this.trees[ue]=new b.KDBush(he,Vn,ds,ce,Float32Array),$&&console.log("z%d: %d clusters in %dms",ue,he.length,+Date.now()-xe)}return $&&console.timeEnd("total time"),this}getClusters(V,$){let K=((V[0]+180)%360+360)%360-180;const te=Math.max(-90,Math.min(90,V[1]));let ce=180===V[2]?180:((V[2]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)K=-180,ce=180;else if(K>ce){const Me=this.getClusters([K,te,180,ge],$),je=this.getClusters([-180,te,ce,ge],$);return Me.concat(je)}const he=this.trees[this._limitZoom($)],ue=he.range(Ae(K),Pe(ge),Ae(ce),Pe(te)),xe=[];for(const Me of ue){const je=he.points[Me];xe.push(je.numPoints?yr(je):this.points[je.index])}return xe}getChildren(V){const $=this._getOriginId(V),K=this._getOriginZoom(V),te="No cluster with the specified id.",ce=this.trees[K];if(!ce)throw new Error(te);const ge=ce.points[$];if(!ge)throw new Error(te);const he=this.options.radius/(this.options.extent*Math.pow(2,K-1)),ue=ce.within(ge.x,ge.y,he),xe=[];for(const Me of ue){const je=ce.points[Me];je.parentId===V&&xe.push(je.numPoints?yr(je):this.points[je.index])}if(0===xe.length)throw new Error(te);return xe}getLeaves(V,$,K){const te=[];return this._appendLeaves(te,V,$=$||10,K=K||0,0),te}getTile(V,$,K){const te=this.trees[this._limitZoom(V)],ce=Math.pow(2,V),{extent:ge,radius:he}=this.options,ue=he/ge,xe=(K-ue)/ce,Me=(K+1+ue)/ce,je={features:[]};return this._addTileFeatures(te.range(($-ue)/ce,xe,($+1+ue)/ce,Me),te.points,$,K,ce,je),0===$&&this._addTileFeatures(te.range(1-ue/ce,xe,1,Me),te.points,ce,K,ce,je),$===ce-1&&this._addTileFeatures(te.range(0,xe,ue/ce,Me),te.points,-1,K,ce,je),je.features.length?je:null}getClusterExpansionZoom(V){let $=this._getOriginZoom(V)-1;for(;$<=this.options.maxZoom;){const K=this.getChildren(V);if($++,1!==K.length)break;V=K[0].properties.cluster_id}return $}_appendLeaves(V,$,K,te,ce){const ge=this.getChildren($);for(const he of ge){const ue=he.properties;if(ue&&ue.cluster?ce+ue.point_count<=te?ce+=ue.point_count:ce=this._appendLeaves(V,ue.cluster_id,K,te,ce):ce<te?ce++:V.push(he),V.length===K)break}return ce}_addTileFeatures(V,$,K,te,ce,ge){for(const he of V){const ue=$[he],xe=ue.numPoints;let Me,je,Te;if(xe)Me=tr(ue),je=ue.x,Te=ue.y;else{const dt=this.points[ue.index];Me=dt.properties,je=Ae(dt.geometry.coordinates[0]),Te=Pe(dt.geometry.coordinates[1])}const Dt={type:1,geometry:[[Math.round(this.options.extent*(je*ce-K)),Math.round(this.options.extent*(Te*ce-te))]],tags:Me};let ht;xe?ht=ue.id:this.options.generateId?ht=ue.index:this.points[ue.index].id&&(ht=this.points[ue.index].id),void 0!==ht&&(Dt.id=ht),ge.features.push(Dt)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,$){const K=[],{radius:te,extent:ce,reduce:ge,minPoints:he}=this.options,ue=te/(ce*Math.pow(2,$));for(let xe=0;xe<V.length;xe++){const Me=V[xe];if(Me.zoom<=$)continue;Me.zoom=$;const je=this.trees[$+1],Te=je.within(Me.x,Me.y,ue),Dt=Me.numPoints||1;let ht=Dt;for(const dt of Te){const xt=je.points[dt];xt.zoom>$&&(ht+=xt.numPoints||1)}if(ht>Dt&&ht>=he){let dt=Me.x*Dt,xt=Me.y*Dt,ln=ge&&Dt>1?this._map(Me,!0):null;const qn=(xe<<5)+($+1)+this.points.length;for(const sn of Te){const an=je.points[sn];if(an.zoom<=$)continue;an.zoom=$;const Zn=an.numPoints||1;dt+=an.x*Zn,xt+=an.y*Zn,an.parentId=qn,ge&&(ln||(ln=this._map(Me,!0)),ge(ln,this._map(an)))}Me.parentId=qn,K.push(La(dt/ht,xt/ht,qn,ht,ln))}else if(K.push(Me),ht>1)for(const dt of Te){const xt=je.points[dt];xt.zoom<=$||(xt.zoom=$,K.push(xt))}}return K}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,$){if(V.numPoints)return $?Vi({},V.properties):V.properties;const K=this.points[V.index].properties,te=this.options.map(K);return $&&te===K?Vi({},te):te}}function La(J,V,$,K,te){return{x:Oa(J),y:Oa(V),zoom:1/0,id:$,parentId:-1,numPoints:K,properties:te}}function na(J,V){const[$,K]=J.geometry.coordinates;return{x:Oa(Ae($)),y:Oa(Pe(K)),zoom:1/0,index:V,parentId:-1}}function yr(J){return{type:"Feature",id:J.id,properties:tr(J),geometry:{type:"Point",coordinates:[(V=J.x,360*(V-.5)),Na(J.y)]}};var V}function tr(J){const V=J.numPoints,$=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V;return Vi(Vi({},J.properties),{cluster:!0,cluster_id:J.id,point_count:V,point_count_abbreviated:$})}function Ae(J){return J/360+.5}function Pe(J){const V=Math.sin(J*Math.PI/180),$=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return $<0?0:$>1?1:$}function Na(J){const V=(180-360*J)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function Vi(J,V){for(const $ in V)J[$]=V[$];return J}function Vn(J){return J.x}function ds(J){return J.y}function Ui(J,V,$,K){for(var te,ce=K,ge=$-V>>1,he=$-V,ue=J[V],xe=J[V+1],Me=J[$],je=J[$+1],Te=V+3;Te<$;Te+=3){var Dt=Pl(J[Te],J[Te+1],ue,xe,Me,je);if(Dt>ce)te=Te,ce=Dt;else if(Dt===ce){var ht=Math.abs(Te-ge);ht<he&&(te=Te,he=ht)}}ce>K&&(te-V>3&&Ui(J,V,te,K),J[te+2]=ce,$-te>3&&Ui(J,te,$,K))}function Pl(J,V,$,K,te,ce){var ge=te-$,he=ce-K;if(0!==ge||0!==he){var ue=((J-$)*ge+(V-K)*he)/(ge*ge+he*he);ue>1?($=te,K=ce):ue>0&&($+=ge*ue,K+=he*ue)}return(ge=J-$)*ge+(he=V-K)*he}function fs(J,V,$,K){var te={id:void 0===J?null:J,type:V,geometry:$,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ce){var ge=ce.geometry,he=ce.type;if("Point"===he||"MultiPoint"===he||"LineString"===he)rt(ce,ge);else if("Polygon"===he||"MultiLineString"===he)for(var ue=0;ue<ge.length;ue++)rt(ce,ge[ue]);else if("MultiPolygon"===he)for(ue=0;ue<ge.length;ue++)for(var xe=0;xe<ge[ue].length;xe++)rt(ce,ge[ue][xe])}(te),te}function rt(J,V){for(var $=0;$<V.length;$+=3)J.minX=Math.min(J.minX,V[$]),J.minY=Math.min(J.minY,V[$+1]),J.maxX=Math.max(J.maxX,V[$]),J.maxY=Math.max(J.maxY,V[$+1])}function Jt(J,V,$,K){if(V.geometry){var te=V.geometry.coordinates,ce=V.geometry.type,ge=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),he=[],ue=V.id;if($.promoteId?ue=V.properties[$.promoteId]:$.generateId&&(ue=K||0),"Point"===ce)jt(te,he);else if("MultiPoint"===ce)for(var xe=0;xe<te.length;xe++)jt(te[xe],he);else if("LineString"===ce)so(te,he,ge,!1);else if("MultiLineString"===ce){if($.lineMetrics){for(xe=0;xe<te.length;xe++)so(te[xe],he=[],ge,!1),J.push(fs(ue,"LineString",he,V.properties));return}ps(te,he,ge,!1)}else if("Polygon"===ce)ps(te,he,ge,!0);else{if("MultiPolygon"!==ce){if("GeometryCollection"===ce){for(xe=0;xe<V.geometry.geometries.length;xe++)Jt(J,{id:ue,geometry:V.geometry.geometries[xe],properties:V.properties},$,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(xe=0;xe<te.length;xe++){var Me=[];ps(te[xe],Me,ge,!0),he.push(Me)}}J.push(fs(ue,ce,he,V.properties))}}function jt(J,V){V.push(At(J[0])),V.push(Ls(J[1])),V.push(0)}function so(J,V,$,K){for(var te,ce,ge=0,he=0;he<J.length;he++){var ue=At(J[he][0]),xe=Ls(J[he][1]);V.push(ue),V.push(xe),V.push(0),he>0&&(ge+=K?(te*xe-ue*ce)/2:Math.sqrt(Math.pow(ue-te,2)+Math.pow(xe-ce,2))),te=ue,ce=xe}var Me=V.length-3;V[2]=1,Ui(V,0,Me,$),V[Me+2]=1,V.size=Math.abs(ge),V.start=0,V.end=V.size}function ps(J,V,$,K){for(var te=0;te<J.length;te++){var ce=[];so(J[te],ce,$,K),V.push(ce)}}function At(J){return J/360+.5}function Ls(J){var V=Math.sin(J*Math.PI/180),$=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return $<0?0:$>1?1:$}function Ei(J,V,$,K,te,ce,ge,he){if(K/=V,ce>=($/=V)&&ge<K)return J;if(ge<$||ce>=K)return null;for(var ue=[],xe=0;xe<J.length;xe++){var Me=J[xe],je=Me.geometry,Te=Me.type,Dt=0===te?Me.minX:Me.minY,ht=0===te?Me.maxX:Me.maxY;if(Dt>=$&&ht<K)ue.push(Me);else if(!(ht<$||Dt>=K)){var dt=[];if("Point"===Te||"MultiPoint"===Te)ra(je,dt,$,K,te);else if("LineString"===Te)ao(je,dt,$,K,te,!1,he.lineMetrics);else if("MultiLineString"===Te)Nn(je,dt,$,K,te,!1);else if("Polygon"===Te)Nn(je,dt,$,K,te,!0);else if("MultiPolygon"===Te)for(var xt=0;xt<je.length;xt++){var ln=[];Nn(je[xt],ln,$,K,te,!0),ln.length&&dt.push(ln)}if(dt.length){if(he.lineMetrics&&"LineString"===Te){for(xt=0;xt<dt.length;xt++)ue.push(fs(Me.id,Te,dt[xt],Me.tags));continue}"LineString"!==Te&&"MultiLineString"!==Te||(1===dt.length?(Te="LineString",dt=dt[0]):Te="MultiLineString"),"Point"!==Te&&"MultiPoint"!==Te||(Te=3===dt.length?"Point":"MultiPoint"),ue.push(fs(Me.id,Te,dt,Me.tags))}}}return ue.length?ue:null}function ra(J,V,$,K,te){for(var ce=0;ce<J.length;ce+=3){var ge=J[ce+te];ge>=$&&ge<=K&&(V.push(J[ce]),V.push(J[ce+1]),V.push(J[ce+2]))}}function ao(J,V,$,K,te,ce,ge){for(var he,ue,xe=$i(J),Me=0===te?lo:Rl,je=J.start,Te=0;Te<J.length-3;Te+=3){var Dt=J[Te],ht=J[Te+1],dt=J[Te+2],xt=J[Te+3],ln=J[Te+4],qn=0===te?Dt:ht,sn=0===te?xt:ln,an=!1;ge&&(he=Math.sqrt(Math.pow(Dt-xt,2)+Math.pow(ht-ln,2))),qn<$?sn>$&&(ue=Me(xe,Dt,ht,xt,ln,$),ge&&(xe.start=je+he*ue)):qn>K?sn<K&&(ue=Me(xe,Dt,ht,xt,ln,K),ge&&(xe.start=je+he*ue)):Fc(xe,Dt,ht,dt),sn<$&&qn>=$&&(ue=Me(xe,Dt,ht,xt,ln,$),an=!0),sn>K&&qn<=K&&(ue=Me(xe,Dt,ht,xt,ln,K),an=!0),!ce&&an&&(ge&&(xe.end=je+he*ue),V.push(xe),xe=$i(J)),ge&&(je+=he)}var Zn=J.length-3;Dt=J[Zn],ht=J[Zn+1],dt=J[Zn+2],(qn=0===te?Dt:ht)>=$&&qn<=K&&Fc(xe,Dt,ht,dt),Zn=xe.length-3,ce&&Zn>=3&&(xe[Zn]!==xe[0]||xe[Zn+1]!==xe[1])&&Fc(xe,xe[0],xe[1],xe[2]),xe.length&&V.push(xe)}function $i(J){var V=[];return V.size=J.size,V.start=J.start,V.end=J.end,V}function Nn(J,V,$,K,te,ce){for(var ge=0;ge<J.length;ge++)ao(J[ge],V,$,K,te,ce,!1)}function Fc(J,V,$,K){J.push(V),J.push($),J.push(K)}function lo(J,V,$,K,te,ce){var ge=(ce-V)/(K-V);return J.push(ce),J.push($+(te-$)*ge),J.push(1),ge}function Rl(J,V,$,K,te,ce){var ge=(ce-$)/(te-$);return J.push(V+(K-V)*ge),J.push(ce),J.push(1),ge}function pn(J,V){for(var $=[],K=0;K<J.length;K++){var te,ce=J[K],ge=ce.type;if("Point"===ge||"MultiPoint"===ge||"LineString"===ge)te=ia(ce.geometry,V);else if("MultiLineString"===ge||"Polygon"===ge){te=[];for(var he=0;he<ce.geometry.length;he++)te.push(ia(ce.geometry[he],V))}else if("MultiPolygon"===ge)for(te=[],he=0;he<ce.geometry.length;he++){for(var ue=[],xe=0;xe<ce.geometry[he].length;xe++)ue.push(ia(ce.geometry[he][xe],V));te.push(ue)}$.push(fs(ce.id,ge,te,ce.tags))}return $}function ia(J,V){var $=[];$.size=J.size,void 0!==J.start&&($.start=J.start,$.end=J.end);for(var K=0;K<J.length;K+=3)$.push(J[K]+V,J[K+1],J[K+2]);return $}function Oc(J,V){if(J.transformed)return J;var $,K,te,ce=1<<J.z,ge=J.x,he=J.y;for($=0;$<J.features.length;$++){var ue=J.features[$],xe=ue.geometry,Me=ue.type;if(ue.geometry=[],1===Me)for(K=0;K<xe.length;K+=2)ue.geometry.push(za(xe[K],xe[K+1],V,ce,ge,he));else for(K=0;K<xe.length;K++){var je=[];for(te=0;te<xe[K].length;te+=2)je.push(za(xe[K][te],xe[K][te+1],V,ce,ge,he));ue.geometry.push(je)}}return J.transformed=!0,J}function za(J,V,$,K,te,ce){return[Math.round($*(J*K-te)),Math.round($*(V*K-ce))]}function Ru(J,V,$,K,te){for(var ce=V===te.maxZoom?0:te.tolerance/((1<<V)*te.extent),ge={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:K,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},he=0;he<J.length;he++){ge.numFeatures++,oa(ge,J[he],ce,te);var ue=J[he].minX,xe=J[he].minY,Me=J[he].maxX,je=J[he].maxY;ue<ge.minX&&(ge.minX=ue),xe<ge.minY&&(ge.minY=xe),Me>ge.maxX&&(ge.maxX=Me),je>ge.maxY&&(ge.maxY=je)}return ge}function oa(J,V,$,K){var te=V.geometry,ce=V.type,ge=[];if("Point"===ce||"MultiPoint"===ce)for(var he=0;he<te.length;he+=3)ge.push(te[he]),ge.push(te[he+1]),J.numPoints++,J.numSimplified++;else if("LineString"===ce)Ba(ge,te,J,$,!1,!1);else if("MultiLineString"===ce||"Polygon"===ce)for(he=0;he<te.length;he++)Ba(ge,te[he],J,$,"Polygon"===ce,0===he);else if("MultiPolygon"===ce)for(var ue=0;ue<te.length;ue++){var xe=te[ue];for(he=0;he<xe.length;he++)Ba(ge,xe[he],J,$,!0,0===he)}if(ge.length){var Me=V.tags||null;if("LineString"===ce&&K.lineMetrics){for(var je in Me={},V.tags)Me[je]=V.tags[je];Me.mapbox_clip_start=te.start/te.size,Me.mapbox_clip_end=te.end/te.size}var Te={geometry:ge,type:"Polygon"===ce||"MultiPolygon"===ce?3:"LineString"===ce||"MultiLineString"===ce?2:1,tags:Me};null!==V.id&&(Te.id=V.id),J.features.push(Te)}}function Ba(J,V,$,K,te,ce){var ge=K*K;if(K>0&&V.size<(te?ge:K))$.numPoints+=V.length/3;else{for(var he=[],ue=0;ue<V.length;ue+=3)(0===K||V[ue+2]>ge)&&($.numSimplified++,he.push(V[ue]),he.push(V[ue+1])),$.numPoints++;te&&function(xe,Me){for(var je=0,Te=0,Dt=xe.length,ht=Dt-2;Te<Dt;ht=Te,Te+=2)je+=(xe[Te]-xe[ht])*(xe[Te+1]+xe[ht+1]);if(je>0===Me)for(Te=0,Dt=xe.length;Te<Dt/2;Te+=2){var dt=xe[Te],xt=xe[Te+1];xe[Te]=xe[Dt-2-Te],xe[Te+1]=xe[Dt-1-Te],xe[Dt-2-Te]=dt,xe[Dt-1-Te]=xt}}(he,ce),J.push(he)}}function Sn(J,V){var $=(V=this.options=function(te,ce){for(var ge in ce)te[ge]=ce[ge];return te}(Object.create(this.options),V)).debug;if($&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var te,ce,ge,he,ue,xe,K=function(te,ce){var ge=[];if("FeatureCollection"===te.type)for(var he=0;he<te.features.length;he++)Jt(ge,te.features[he],ce,he);else Jt(ge,"Feature"===te.type?te:{geometry:te},ce);return ge}(J,V);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),he=te=K,ue=Ei(te,1,-1-(ge=(ce=V).buffer/ce.extent),ge,0,-1,2,ce),xe=Ei(te,1,1-ge,2+ge,0,-1,2,ce),(ue||xe)&&(he=Ei(te,1,-ge,1+ge,0,-1,2,ce)||[],ue&&(he=pn(ue,1).concat(he)),xe&&(he=he.concat(pn(xe,-1)))),(K=he).length&&this.splitTile(K,0,0,0),$&&(K.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Fl(J,V,$){return 32*((1<<J)*$+V)+J}function co(J,V){return V?J.properties[V]:J.id}function Xr(J,V){if(null==J)return!0;if("Feature"===J.type)return null!=co(J,V);if("FeatureCollection"===J.type){const $=new Set;for(const K of J.features){const te=co(K,V);if(null==te||$.has(te))return!1;$.add(te)}return!0}return!1}function $r(J,V){const $=new Map;if(null!=J)if("Feature"===J.type)$.set(co(J,V),J);else for(const K of J.features)$.set(co(K,V),K);return $}function mi(J,V){const $=J.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const K=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!K)return V(null,null);const te=new class{constructor(ge){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=b.EXTENT,this.length=ge.length,this._features=ge}feature(ge){return new class{constructor(he){this._feature=he,this.extent=b.EXTENT,this.type=he.type,this.properties=he.tags,"id"in he&&!isNaN(he.id)&&(this.id=parseInt(he.id,10))}loadGeometry(){if(1===this._feature.type){const he=[];for(const ue of this._feature.geometry)he.push([new b.pointGeometry(ue[0],ue[1])]);return he}{const he=[];for(const ue of this._feature.geometry){const xe=[];for(const Me of ue)xe.push(new b.pointGeometry(Me[0],Me[1]));he.push(xe)}return he}}toGeoJSON(he,ue,xe){return io.call(this,he,ue,xe)}}(this._features[ge])}}(K.features);let ce=fn(te);0===ce.byteOffset&&ce.byteLength===ce.buffer.byteLength||(ce=new Uint8Array(ce)),V(null,{vectorTile:te,rawData:ce.buffer})}Sn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Sn.prototype.splitTile=function(J,V,$,K,te,ce,ge){for(var he=[J,V,$,K],ue=this.options,xe=ue.debug;he.length;){K=he.pop(),$=he.pop(),V=he.pop(),J=he.pop();var Me=1<<V,je=Fl(V,$,K),Te=this.tiles[je];if(!Te&&(xe>1&&console.time("creation"),Te=this.tiles[je]=Ru(J,V,$,K,ue),this.tileCoords.push({z:V,x:$,y:K}),xe)){xe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,$,K,Te.numFeatures,Te.numPoints,Te.numSimplified),console.timeEnd("creation"));var Dt="z"+V;this.stats[Dt]=(this.stats[Dt]||0)+1,this.total++}if(Te.source=J,te){if(V===ue.maxZoom||V===te)continue;var ht=1<<te-V;if($!==Math.floor(ce/ht)||K!==Math.floor(ge/ht))continue}else if(V===ue.indexMaxZoom||Te.numPoints<=ue.indexMaxPoints)continue;if(Te.source=null,0!==J.length){xe>1&&console.time("clipping");var dt,xt,ln,qn,sn,an,Zn=.5*ue.buffer/ue.extent,lr=.5-Zn,ai=.5+Zn,Pr=1+Zn;dt=xt=ln=qn=null,sn=Ei(J,Me,$-Zn,$+ai,0,Te.minX,Te.maxX,ue),an=Ei(J,Me,$+lr,$+Pr,0,Te.minX,Te.maxX,ue),J=null,sn&&(dt=Ei(sn,Me,K-Zn,K+ai,1,Te.minY,Te.maxY,ue),xt=Ei(sn,Me,K+lr,K+Pr,1,Te.minY,Te.maxY,ue),sn=null),an&&(ln=Ei(an,Me,K-Zn,K+ai,1,Te.minY,Te.maxY,ue),qn=Ei(an,Me,K+lr,K+Pr,1,Te.minY,Te.maxY,ue),an=null),xe>1&&console.timeEnd("clipping"),he.push(dt||[],V+1,2*$,2*K),he.push(xt||[],V+1,2*$,2*K+1),he.push(ln||[],V+1,2*$+1,2*K),he.push(qn||[],V+1,2*$+1,2*K+1)}}},Sn.prototype.getTile=function(J,V,$){var K=this.options,te=K.extent,ce=K.debug;if(J<0||J>24)return null;var ge=1<<J,he=Fl(J,V=(V%ge+ge)%ge,$);if(this.tiles[he])return Oc(this.tiles[he],te);ce>1&&console.log("drilling down to z%d-%d-%d",J,V,$);for(var ue,xe=J,Me=V,je=$;!ue&&xe>0;)xe--,Me=Math.floor(Me/2),je=Math.floor(je/2),ue=this.tiles[Fl(xe,Me,je)];return ue&&ue.source?(ce>1&&console.log("found parent tile z%d-%d-%d",xe,Me,je),ce>1&&console.time("drilling down"),this.splitTile(ue.source,xe,Me,je,J,V,$),ce>1&&console.timeEnd("drilling down"),this.tiles[he]?Oc(this.tiles[he],te):null):null};class gi extends Ps{constructor(V,$,K,te){super(V,$,K,mi),this._dataUpdateable=new Map,this.loadGeoJSON=(ce,ge)=>{const{promoteId:he}=ce;if(ce.request)return b.getJSON(ce.request,(ue,xe,Me,je)=>{this._dataUpdateable=Xr(xe,he)?$r(xe,he):void 0,ge(ue,xe,Me,je)});if("string"==typeof ce.data)try{const ue=JSON.parse(ce.data);this._dataUpdateable=Xr(ue,he)?$r(ue,he):void 0,ge(null,ue)}catch{ge(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`))}else ce.dataDiff?this._dataUpdateable?(function(ue,xe,Me){var je,Te,Dt,ht;if(xe.removeAll&&ue.clear(),xe.remove)for(const dt of xe.remove)ue.delete(dt);if(xe.add)for(const dt of xe.add){const xt=co(dt,Me);null!=xt&&ue.set(xt,dt)}if(xe.update)for(const dt of xe.update){let xt=ue.get(dt.id);if(null==xt)continue;const ln=!dt.removeAllProperties&&((null===(je=dt.removeProperties)||void 0===je?void 0:je.length)>0||(null===(Te=dt.addOrUpdateProperties)||void 0===Te?void 0:Te.length)>0);if((dt.newGeometry||dt.removeAllProperties||ln)&&(xt={...xt},ue.set(dt.id,xt),ln&&(xt.properties={...xt.properties})),dt.newGeometry&&(xt.geometry=dt.newGeometry),dt.removeAllProperties)xt.properties={};else if((null===(Dt=dt.removeProperties)||void 0===Dt?void 0:Dt.length)>0)for(const qn of dt.removeProperties)Object.prototype.hasOwnProperty.call(xt.properties,qn)&&delete xt.properties[qn];if((null===(ht=dt.addOrUpdateProperties)||void 0===ht?void 0:ht.length)>0)for(const{key:qn,value:sn}of dt.addOrUpdateProperties)xt.properties[qn]=sn}}(this._dataUpdateable,ce.dataDiff,he),ge(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):ge(new Error(`Cannot update existing geojson data in ${ce.source}`)):ge(new Error(`Input data given to '${ce.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},te&&(this.loadGeoJSON=te)}loadData(V,$){var K;null===(K=this._pendingRequest)||void 0===K||K.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const te=!!(V&&V.request&&V.request.collectResourceTiming)&&new b.RequestPerformance(V.request);this._pendingCallback=$,this._pendingRequest=this.loadGeoJSON(V,(ce,ge)=>{if(delete this._pendingCallback,delete this._pendingRequest,ce||!ge)return $(ce);if("object"!=typeof ge)return $(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{Pa(ge,!0);try{if(V.filter){const ue=b.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ue.result)throw new Error(ue.value.map(Me=>`${Me.key}: ${Me.message}`).join(", "));const xe=ge.features.filter(Me=>ue.value.evaluate({zoom:0},Me));ge={type:"FeatureCollection",features:xe}}this._geoJSONIndex=V.cluster?new pi(function({superclusterOptions:ue,clusterProperties:xe}){if(!xe||!ue)return ue;const Me={},je={},Te={accumulated:null,zoom:0},Dt={properties:null},ht=Object.keys(xe);for(const dt of ht){const[xt,ln]=xe[dt],qn=b.createExpression(ln),sn=b.createExpression("string"==typeof xt?[xt,["accumulated"],["get",dt]]:xt);Me[dt]=qn.value,je[dt]=sn.value}return ue.map=dt=>{Dt.properties=dt;const xt={};for(const ln of ht)xt[ln]=Me[ln].evaluate(Te,Dt);return xt},ue.reduce=(dt,xt)=>{Dt.properties=xt;for(const ln of ht)Te.accumulated=dt[ln],dt[ln]=je[ln].evaluate(Te,Dt)},ue}(V)).load(ge.features):new Sn(ue=ge,V.geojsonVtOptions)}catch(ue){return $(ue)}this.loaded={};const he={};if(te){const ue=te.finish();ue&&(he.resourceTiming={},he.resourceTiming[V.source]=JSON.parse(JSON.stringify(ue)))}$(null,he)}var ue})}reloadTile(V,$){const K=this.loaded;return K&&K[V.uid]?super.reloadTile(V,$):this.loadTile(V,$)}removeSource(V,$){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),$()}getClusterExpansionZoom(V,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(K){$(K)}}getClusterChildren(V,$){try{$(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(K){$(K)}}getClusterLeaves(V,$){try{$(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(K){$(K)}}}class Ns{constructor(V){this.self=V,this.actor=new b.Actor(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ps,geojson:gi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=($,K)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=K},this.self.registerRTLTextPlugin=$=>{if(b.plugin.isParsed())throw new Error("RTL text plugin already registered.");b.plugin.applyArabicShaping=$.applyArabicShaping,b.plugin.processBidirectionalText=$.processBidirectionalText,b.plugin.processStyledBidirectionalText=$.processStyledBidirectionalText}}setReferrer(V,$){this.referrer=$}setImages(V,$,K){this.availableImages[V]=$;for(const te in this.workerSources[V]){const ce=this.workerSources[V][te];for(const ge in ce)ce[ge].availableImages=$}K()}setLayers(V,$,K){this.getLayerIndex(V).replace($),K()}updateLayers(V,$,K){this.getLayerIndex(V).update($.layers,$.removedIds),K()}loadTile(V,$,K){this.getWorkerSource(V,$.type,$.source).loadTile($,K)}loadDEMTile(V,$,K){this.getDEMWorkerSource(V,$.source).loadTile($,K)}reloadTile(V,$,K){this.getWorkerSource(V,$.type,$.source).reloadTile($,K)}abortTile(V,$,K){this.getWorkerSource(V,$.type,$.source).abortTile($,K)}removeTile(V,$,K){this.getWorkerSource(V,$.type,$.source).removeTile($,K)}removeDEMTile(V,$){this.getDEMWorkerSource(V,$.source).removeTile($)}removeSource(V,$,K){if(!this.workerSources[V]||!this.workerSources[V][$.type]||!this.workerSources[V][$.type][$.source])return;const te=this.workerSources[V][$.type][$.source];delete this.workerSources[V][$.type][$.source],void 0!==te.removeSource?te.removeSource($,K):K()}loadWorkerSource(V,$,K){try{this.self.importScripts($.url),K()}catch(te){K(te.toString())}}syncRTLPluginState(V,$,K){try{b.plugin.setState($);const te=b.plugin.getPluginURL();if(b.plugin.isLoaded()&&!b.plugin.isParsed()&&null!=te){this.self.importScripts(te);const ce=b.plugin.isParsed();K(ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${te}`),ce)}}catch(te){K(te.toString())}}getAvailableImages(V){let $=this.availableImages[V];return $||($=[]),$}getLayerIndex(V){let $=this.layerIndexes[V];return $||($=this.layerIndexes[V]=new us),$}getWorkerSource(V,$,K){return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][$]||(this.workerSources[V][$]={}),this.workerSources[V][$][K]||(this.workerSources[V][$][K]=new this.workerSourceTypes[$]({send:(ce,ge,he)=>{this.actor.send(ce,ge,he,V)}},this.getLayerIndex(V),this.getAvailableImages(V))),this.workerSources[V][$][K]}getDEMWorkerSource(V,$){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][$]||(this.demWorkerSources[V][$]=new Rs),this.demWorkerSources[V][$]}}return b.isWorker()&&(self.worker=new Ns(self)),Ns}),qh(0,function(b){var wr=ks;function ks(g){return s=g,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,y,w=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(w);try{y=new Worker(S),m=!0}catch{m=!1}return y&&y.terminate(),URL.revokeObjectURL(S),m}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var m=document.createElement("canvas");m.width=m.height=1;var y=m.getContext("2d");if(!y)return!1;var w=y.getImageData(0,0,1,1);return w&&w.width===m.width}()||(void 0===us[h=s&&s.failIfMajorPerformanceCaveat]&&(us[h]=function(m){var y,S,I,k,w=(S=m,I=document.createElement("canvas"),(k=Object.create(ks.webGLContextAttributes)).failIfMajorPerformanceCaveat=S,I.getContext("webgl",k)||I.getContext("experimental-webgl",k));if(!w)return!1;try{y=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!y||w.isContextLost())&&(w.shaderSource(y,"void main() {}"),w.compileShader(y),!0===w.getShaderParameter(y,w.COMPILE_STATUS))}(h)),!us[h]||document.documentMode));var s,h}var us={};ks.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};function Zt(g,s){if(Array.isArray(g)){if(!Array.isArray(s)||g.length!==s.length)return!1;for(let h=0;h<g.length;h++)if(!Zt(g[h],s[h]))return!1;return!0}if("object"==typeof g&&null!==g&&null!==s){if("object"!=typeof s||Object.keys(g).length!==Object.keys(s).length)return!1;for(const h in g)if(!Zt(g[h],s[h]))return!1;return!0}return g===s}class Ie{static testProp(s){if(!Ie.docStyle)return s[0];for(let h=0;h<s.length;h++)if(s[h]in Ie.docStyle)return s[h];return s[0]}static create(s,h,m){const y=window.document.createElement(s);return void 0!==h&&(y.className=h),m&&m.appendChild(y),y}static createNS(s,h){return window.document.createElementNS(s,h)}static disableDrag(){Ie.docStyle&&Ie.selectProp&&(Ie.userSelect=Ie.docStyle[Ie.selectProp],Ie.docStyle[Ie.selectProp]="none")}static enableDrag(){Ie.docStyle&&Ie.selectProp&&(Ie.docStyle[Ie.selectProp]=Ie.userSelect)}static setTransform(s,h){s.style[Ie.transformProp]=h}static addEventListener(s,h,m,y={}){s.addEventListener(h,m,"passive"in y?y:y.capture)}static removeEventListener(s,h,m,y={}){s.removeEventListener(h,m,"passive"in y?y:y.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",Ie.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Ie.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Ie.suppressClickInternal,!0)},0)}static mousePos(s,h){const m=s.getBoundingClientRect();return new b.pointGeometry(h.clientX-m.left-s.clientLeft,h.clientY-m.top-s.clientTop)}static touchPos(s,h){const m=s.getBoundingClientRect(),y=[];for(let w=0;w<h.length;w++)y.push(new b.pointGeometry(h[w].clientX-m.left-s.clientLeft,h[w].clientY-m.top-s.clientTop));return y}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}Ie.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Ie.selectProp=Ie.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Ie.transformProp=Ie.testProp(["transform","WebkitTransform"]);const Bi={supported:!1,testSupport:function(g){!Pa&&Rs&&(Al?Ci(g):Ps=g)}};let Ps,Rs,Pa=!1,Al=!1;function Ci(g){const s=g.createTexture();g.bindTexture(g.TEXTURE_2D,s);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,Rs),g.isContextLost())return;Bi.supported=!0}catch{}g.deleteTexture(s),Pa=!0}var io;typeof document<"u"&&(Rs=document.createElement("img"),Rs.onload=function(){Ps&&Ci(Ps),Ps=null,Al=!0},Rs.onerror=function(){Pa=!0,Ps=null},Rs.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let s,h,m,y;g.resetRequestQueue=()=>{s=[],h=0,m=0,y={}},g.addThrottleControl=I=>{const k=m++;return y[k]=I,k},g.removeThrottleControl=I=>{delete y[I]};const w=()=>{const I=Object.keys(y);let k=!1;if(I.length>0)for(const R of I)if(k=y[R](),k)break;return k};g.getImage=(I,k)=>{Bi.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*");const R={requestParameters:I,callback:k,cancelled:!1,completed:!1,cancel:()=>{}};return s.push(R),w()||g.processQueue(),R};const S=I=>{const{requestParameters:k,callback:R}=I;return b.getArrayBuffer(k,(z,L,j,Q)=>{var ee,Y;z?R(z):L&&(ee=L,Y=(ee,Y)=>{null!=ee?R(ee):null!=Y&&R(null,Y,{cacheControl:j,expires:Q})},"function"==typeof createImageBitmap?b.arrayBufferToImageBitmap(ee,Y):b.arrayBufferToImage(ee,Y)),I.cancelled||(I.completed=!0,h--,w()||g.processQueue())})};g.processQueue=(I=0)=>{I<=0&&(I=w()?b.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:b.config.MAX_PARALLEL_IMAGE_REQUESTS);for(let k=h;k<I&&s.length>0;k++){const R=s.shift();if(R.cancelled)continue;const z=S(R);h++,R.innerRequest=z,R.cancel=()=>{var L;(L=R).completed||L.cancelled||(h--,L.cancelled=!0,L.innerRequest.cancel(),g.processQueue())}}return s.length}}(io||(io={})),io.resetRequestQueue();var fn,g,si=io;(g=fn||(fn={})).Glyphs="Glyphs",g.Image="Image",g.Source="Source",g.SpriteImage="SpriteImage",g.SpriteJSON="SpriteJSON",g.Style="Style",g.Tile="Tile",g.Unknown="Unknown";class kc{constructor(s){this._transformRequestFn=s}transformRequest(s,h){return this._transformRequestFn&&this._transformRequestFn(s,h)||{url:s}}normalizeSpriteURL(s,h,m){const y=function(w){const S=w.match(To);if(!S)throw new Error(`Unable to parse URL "${w}"`);return{protocol:S[1],authority:S[2],path:S[3]||"/",params:S[4]?S[4].split("&"):[]}}(s);return y.path+=`${h}${m}`,function(w){const S=w.params.length?`?${w.params.join("&")}`:"";return`${w.protocol}://${w.authority}${w.path}${S}`}(y)}setTransformRequest(s){this._transformRequestFn=s}}const To=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ta(g){var s=new b.ARRAY_TYPE(3);return s[0]=g[0],s[1]=g[1],s[2]=g[2],s}var Fs,oo=function(g,s,h){return g[0]=s[0]-h[0],g[1]=s[1]-h[1],g[2]=s[2]-h[2],g};Fs=new b.ARRAY_TYPE(3),b.ARRAY_TYPE!=Float32Array&&(Fs[0]=0,Fs[1]=0,Fs[2]=0);var Ra=function(g){var s=g[0],h=g[1];return s*s+h*h};function hs(g){return"string"==typeof g?[{id:"default",url:g}]:g??[]}!function(){var g=new b.ARRAY_TYPE(2);b.ARRAY_TYPE!=Float32Array&&(g[0]=0,g[1]=0)}();class Gn{constructor(s,h,m,y){this.context=s,this.format=m,this.texture=s.gl.createTexture(),this.update(h,y)}update(s,h,m){const{width:y,height:w}=s,S=!(this.size&&this.size[0]===y&&this.size[1]===w||m),{context:I}=this,{gl:k}=I;if(this.useMipmap=Boolean(h&&h.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),I.pixelStoreUnpackFlipY.set(!1),I.pixelStoreUnpack.set(1),I.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!h||!1!==h.premultiply)),S)this.size=[y,w],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||b.isImageBitmap(s)?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,s):k.texImage2D(k.TEXTURE_2D,0,this.format,y,w,0,this.format,k.UNSIGNED_BYTE,s.data);else{const{x:R,y:z}=m||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||b.isImageBitmap(s)?k.texSubImage2D(k.TEXTURE_2D,0,R,z,k.RGBA,k.UNSIGNED_BYTE,s):k.texSubImage2D(k.TEXTURE_2D,0,R,z,y,w,k.RGBA,k.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)}bind(s,h,m){const{context:y}=this,{gl:w}=y;w.bindTexture(w.TEXTURE_2D,this.texture),m!==w.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=w.LINEAR),s!==this.filter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,s),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,m||s),this.filter=s),h!==this.wrap&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,h),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function Pu(g){const{userImage:s}=g;return!!(s&&s.render&&s.render())&&(g.data.replace(new Uint8Array(s.data.buffer)),!0)}class It extends b.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new b.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,callback:m}of this.requestors)this._notify(h,m);this.requestors=[]}}getImage(s){const h=this.images[s];if(h&&!h.data&&h.spriteData){const m=h.spriteData;h.data=new b.RGBAImage({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),h.spriteData=null}return h}addImage(s,h){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let m=!0;const y=h.data||h.spriteData;return this._validateStretch(h.stretchX,y&&y.width)||(this.fire(new b.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),m=!1),this._validateStretch(h.stretchY,y&&y.height)||(this.fire(new b.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),m=!1),this._validateContent(h.content,h)||(this.fire(new b.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),m=!1),m}_validateStretch(s,h){if(!s)return!0;let m=0;for(const y of s){if(y[0]<m||y[1]<y[0]||h<y[1])return!1;m=y[1]}return!0}_validateContent(s,h){if(!s)return!0;if(4!==s.length)return!1;const m=h.spriteData,y=m&&m.width||h.data.width,w=m&&m.height||h.data.height;return!(s[0]<0||y<s[0]||s[1]<0||w<s[1]||s[2]<0||y<s[2]||s[3]<0||w<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,h,m=!0){const y=this.getImage(s);if(m&&(y.data.width!==h.data.width||y.data.height!==h.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=y.version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,h){let m=!0;if(!this.isLoaded())for(const y of s)this.images[y]||(m=!1);this.isLoaded()||m?this._notify(s,h):this.requestors.push({ids:s,callback:h})}_notify(s,h){const m={};for(const y of s){const w=this.getImage(y);w?m[y]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:Boolean(w.userImage&&w.userImage.render)}:(this.fire(new b.Event("styleimagemissing",{id:y})),b.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`))}h(null,m)}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],m=this.getImage(s);if(!m)return null;if(h&&h.position.version===m.version)return h.position;if(h)h.position.version=m.version;else{const y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},w=new b.ImagePosition(y,m);this.patterns[s]={bin:y,position:w}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Gn(s,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const w in this.patterns)s.push(this.patterns[w].bin);const{w:h,h:m}=b.potpack(s),y=this.atlasImage;y.resize({width:h||1,height:m||1});for(const w in this.patterns){const{bin:S}=this.patterns[w],I=S.x+1,k=S.y+1,R=this.getImage(w).data,z=R.width,L=R.height;b.RGBAImage.copy(R,y,{x:0,y:0},{x:I,y:k},{width:z,height:L}),b.RGBAImage.copy(R,y,{x:0,y:L-1},{x:I,y:k-1},{width:z,height:1}),b.RGBAImage.copy(R,y,{x:0,y:0},{x:I,y:k+L},{width:z,height:1}),b.RGBAImage.copy(R,y,{x:z-1,y:0},{x:I-1,y:k},{width:1,height:L}),b.RGBAImage.copy(R,y,{x:0,y:0},{x:I+z,y:k},{width:1,height:L})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const m=this.getImage(h);m||b.warnOnce(`Image with ID: "${h}" was not found`),Pu(m)&&this.updateImage(h,m)}}}const Wr=1e20;function Fa(g,s,h,m,y,w,S,I,k){for(let R=s;R<s+m;R++)Os(g,h*w+R,w,y,S,I,k);for(let R=h;R<h+y;R++)Os(g,R*w+s,1,m,S,I,k)}function Os(g,s,h,m,y,w,S){w[0]=0,S[0]=-Wr,S[1]=Wr,y[0]=g[s];for(let I=1,k=0,R=0;I<m;I++){y[I]=g[s+I*h];const z=I*I;do{const L=w[k];R=(y[I]-y[L]+z-L*L)/(I-L)/2}while(R<=S[k]&&--k>-1);k++,w[k]=I,S[k]=R,S[k+1]=Wr}for(let I=0,k=0;I<m;I++){for(;S[k+1]<I;)k++;const R=w[k],z=I-R;g[s+I*h]=y[R]+z*z}}class Bn{constructor(s,h){this.requestManager=s,this.localIdeographFontFamily=h,this.entries={}}setURL(s){this.url=s}getGlyphs(s,h){const m=[];for(const y in s)for(const w of s[y])m.push({stack:y,id:w});b.asyncAll(m,({stack:y,id:w},S)=>{let I=this.entries[y];I||(I=this.entries[y]={glyphs:{},requests:{},ranges:{}});let k=I.glyphs[w];if(void 0!==k)return void S(null,{stack:y,id:w,glyph:k});if(k=this._tinySDF(I,y,w),k)return I.glyphs[w]=k,void S(null,{stack:y,id:w,glyph:k});const R=Math.floor(w/256);if(256*R>65535)return void S(new Error("glyphs > 65535 not supported"));if(I.ranges[R])return void S(null,{stack:y,id:w,glyph:k});if(!this.url)return void S(new Error("glyphsUrl is not set"));let z=I.requests[R];z||(z=I.requests[R]=[],Bn.loadGlyphRange(y,R,this.url,this.requestManager,(L,j)=>{if(j){for(const Q in j)this._doesCharSupportLocalGlyph(+Q)||(I.glyphs[+Q]=j[+Q]);I.ranges[R]=!0}for(const Q of z)Q(L,j);delete I.requests[R]})),z.push((L,j)=>{L?S(L):j&&S(null,{stack:y,id:w,glyph:j[w]||null})})},(y,w)=>{if(y)h(y);else if(w){const S={};for(const{stack:I,id:k,glyph:R}of w)(S[I]||(S[I]={}))[k]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};h(null,S)}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(b.unicodeBlockLookup["CJK Unified Ideographs"](s)||b.unicodeBlockLookup["Hangul Syllables"](s)||b.unicodeBlockLookup.Hiragana(s)||b.unicodeBlockLookup.Katakana(s))}_tinySDF(s,h,m){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(m))return;let w=s.tinySDF;if(!w){let I="400";/bold/i.test(h)?I="900":/medium/i.test(h)?I="500":/light/i.test(h)&&(I="200"),w=s.tinySDF=new Bn.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:y,fontWeight:I})}const S=w.draw(String.fromCharCode(m));return{id:m,bitmap:new b.AlphaImage({width:S.width||30,height:S.height||30},S.data),metrics:{width:S.glyphWidth||24,height:S.glyphHeight||24,left:S.glyphLeft||0,top:S.glyphTop-27||-8,advance:S.glyphAdvance||24}}}}Bn.loadGlyphRange=function(g,s,h,m,y){const w=256*s,S=w+255,I=m.transformRequest(h.replace("{fontstack}",g).replace("{range}",`${w}-${S}`),fn.Glyphs);b.getArrayBuffer(I,(k,R)=>{if(k)y(k);else if(R){const z={};for(const L of b.parseGlyphPbf(R))z[L.id]=L;y(null,z)}})},Bn.TinySDF=class{constructor({fontSize:g=24,buffer:s=3,radius:h=8,cutoff:m=.25,fontFamily:y="sans-serif",fontWeight:w="normal",fontStyle:S="normal"}={}){this.buffer=s,this.cutoff=m,this.radius=h;const I=this.size=g+4*s,k=this._createCanvas(I),R=this.ctx=k.getContext("2d",{willReadFrequently:!0});R.font=`${S} ${w} ${g}px ${y}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(g){const s=document.createElement("canvas");return s.width=s.height=g,s}draw(g){const{width:s,actualBoundingBoxAscent:h,actualBoundingBoxDescent:m,actualBoundingBoxLeft:y,actualBoundingBoxRight:w}=this.ctx.measureText(g),S=Math.ceil(h),I=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-y))),k=Math.min(this.size-this.buffer,S+Math.ceil(m)),R=I+2*this.buffer,z=k+2*this.buffer,L=Math.max(R*z,0),j=new Uint8ClampedArray(L),Q={data:j,width:R,height:z,glyphWidth:I,glyphHeight:k,glyphTop:S,glyphLeft:0,glyphAdvance:s};if(0===I||0===k)return Q;const{ctx:ee,buffer:Y,gridInner:ae,gridOuter:_e}=this;ee.clearRect(Y,Y,I,k),ee.fillText(g,Y,Y+S);const ye=ee.getImageData(Y,Y,I,k);_e.fill(Wr,0,L),ae.fill(0,0,L);for(let ie=0;ie<k;ie++)for(let we=0;we<I;we++){const De=ye.data[4*(ie*I+we)+3]/255;if(0===De)continue;const Se=(ie+Y)*R+we+Y;if(1===De)_e[Se]=0,ae[Se]=Wr;else{const ke=.5-De;_e[Se]=ke>0?ke*ke:0,ae[Se]=ke<0?ke*ke:0}}Fa(_e,0,0,R,z,R,this.f,this.v,this.z),Fa(ae,Y,Y,I,k,R,this.f,this.v,this.z);for(let ie=0;ie<L;ie++){const we=Math.sqrt(_e[ie])-Math.sqrt(ae[ie]);j[ie]=Math.round(255-255*(we/this.radius+this.cutoff))}return Q}};const Pc=new b.Properties({anchor:new b.DataConstantProperty(b.spec.light.anchor),position:new class{constructor(){this.specification=b.spec.light.position}possiblyEvaluate(g,s){return b.sphericalToCartesian(g.expression.evaluate(s))}interpolate(g,s,h){return{x:b.number(g.x,s.x,h),y:b.number(g.y,s.y,h),z:b.number(g.z,s.z,h)}}},color:new b.DataConstantProperty(b.spec.light.color),intensity:new b.DataConstantProperty(b.spec.light.intensity)}),kl="-transition";class Oa extends b.Evented{constructor(s){super(),this._transitionable=new b.Transitionable(Pc),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(b.validateLight,s,h))for(const m in s){const y=s[m];m.endsWith(kl)?this._transitionable.setTransition(m.slice(0,-kl.length),y):this._transitionable.setValue(m,y)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,m){return(!m||!1!==m.validate)&&b.emitValidationErrors(this,s.call(b.validateStyle,b.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:b.spec})))}}class Rc{constructor(s,h){this.width=s,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,h){const m=s.join(",")+String(h);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(s,h)),this.dashEntry[m]}getDashRanges(s,h,m){const y=[];let w=s.length%2==1?-s[s.length-1]*m:0,S=s[0]*m,I=!0;y.push({left:w,right:S,isDash:I,zeroLength:0===s[0]});let k=s[0];for(let R=1;R<s.length;R++){I=!I;const z=s[R];w=k*m,k+=z,S=k*m,y.push({left:w,right:S,isDash:I,zeroLength:0===z})}return y}addRoundDash(s,h,m){const y=h/2;for(let w=-m;w<=m;w++){const S=this.width*(this.nextRow+m+w);let I=0,k=s[I];for(let R=0;R<this.width;R++){R/k.right>1&&(k=s[++I]);const z=Math.abs(R-k.left),L=Math.abs(R-k.right),j=Math.min(z,L);let Q;const ee=w/m*(y+1);if(k.isDash){const Y=y-Math.abs(ee);Q=Math.sqrt(j*j+Y*Y)}else Q=y-Math.sqrt(j*j+ee*ee);this.data[S+R]=Math.max(0,Math.min(255,Q+128))}}}addRegularDash(s){for(let I=s.length-1;I>=0;--I){const k=s[I],R=s[I+1];k.zeroLength?s.splice(I,1):R&&R.isDash===k.isDash&&(R.left=k.left,s.splice(I,1))}const h=s[0],m=s[s.length-1];h.isDash===m.isDash&&(h.left=m.left-this.width,m.right=h.right+this.width);const y=this.width*this.nextRow;let w=0,S=s[w];for(let I=0;I<this.width;I++){I/S.right>1&&(S=s[++w]);const k=Math.abs(I-S.left),R=Math.abs(I-S.right),z=Math.min(k,R);this.data[y+I]=Math.max(0,Math.min(255,(S.isDash?z:-z)+128))}}addDash(s,h){const m=h?7:0,y=2*m+1;if(this.nextRow+y>this.height)return b.warnOnce("LineAtlas out of space"),null;let w=0;for(let I=0;I<s.length;I++)w+=s[I];if(0!==w){const I=this.width/w,k=this.getDashRanges(s,this.width,I);h?this.addRoundDash(k,I,m):this.addRegularDash(k)}const S={y:(this.nextRow+m+.5)/this.height,height:2*m/this.height,width:w};return this.nextRow+=y,this.dirty=!0,S}bind(s){const h=s.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}class pi{constructor(s,h,m){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=m;const y=this.workerPool.acquire(m);for(let w=0;w<y.length;w++){const S=new pi.Actor(y[w],h,m);S.name=`Worker ${w}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,h,m){b.asyncAll(this.actors,(y,w)=>{y.send(s,h,w)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}}function La(g,s,h){const m=function(y,w){if(y)return h(y);if(w){const S=b.pick(b.extend(w,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(S.vectorLayers=w.vector_layers,S.vectorLayerIds=S.vectorLayers.map(I=>I.id)),h(null,S)}};return g.url?b.getJSON(s.transformRequest(g.url,fn.Source),m):b.exported.frame(()=>m(null,g))}pi.Actor=b.Actor;class na{constructor(s,h,m){this.bounds=b.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=m||24}validateBounds(s){return Array.isArray(s)&&4===s.length?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),m=Math.floor(b.mercatorXfromLng(this.bounds.getWest())*h),y=Math.floor(b.mercatorYfromLat(this.bounds.getNorth())*h),w=Math.ceil(b.mercatorXfromLng(this.bounds.getEast())*h),S=Math.ceil(b.mercatorYfromLat(this.bounds.getSouth())*h);return s.x>=m&&s.x<w&&s.y>=y&&s.y<S}}class yr extends b.Evented{constructor(s,h,m,y){if(super(),this.id=s,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,b.extend(this,b.pick(h,["url","scheme","tileSize","promoteId"])),this._options=b.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){this._loaded=!1,this.fire(new b.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=La(this._options,this.map._requestManager,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s?this.fire(new b.ErrorEvent(s)):h&&(b.extend(this,h),h.bounds&&(this.tileBounds=new na(h.bounds,this.minzoom,this.maxzoom)),this.fire(new b.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new b.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return b.extend({},this._options)}loadTile(s,h){const m=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y={request:this.map._requestManager.transformRequest(m,fn.Tile),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function w(S,I){return delete s.request,s.aborted?h(null):S&&404!==S.status?h(S):(I&&I.resourceTiming&&(s.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&s.setExpiryData(I),s.loadVectorData(I,this.map.painter),h(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}y.request.collectResourceTiming=this._collectResourceTiming,s.actor&&"expired"!==s.state?"loading"===s.state?s.reloadCallback=h:s.request=s.actor.send("reloadTile",y,w.bind(this)):(s.actor=this.dispatcher.getActor(),s.request=s.actor.send("loadTile",y,w.bind(this)))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id},void 0)}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class tr extends b.Evented{constructor(s,h,m,y){super(),this.id=s,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=b.extend({type:"raster"},h),b.extend(this,b.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new b.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=La(this._options,this.map._requestManager,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new b.ErrorEvent(s)):h&&(b.extend(this,h),h.bounds&&(this.tileBounds=new na(h.bounds,this.minzoom,this.maxzoom)),this.fire(new b.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new b.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return b.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const m=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.request=si.getImage(this.map._requestManager.transformRequest(m,fn.Tile),(y,w,S)=>{if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(y)s.state="errored",h(y);else if(w){this.map._refreshExpiredTiles&&s.setExpiryData(S);const I=this.map.painter.context,k=I.gl;s.texture=this.map.painter.getTileTexture(w.width),s.texture?s.texture.update(w,{useMipmap:!0}):(s.texture=new Gn(I,w,k.RGBA,{useMipmap:!0}),s.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),I.extTextureFilterAnisotropic&&k.texParameterf(k.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax)),s.state="loaded",h(null)}})}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h()}unloadTile(s,h){s.texture&&this.map.painter.saveTileTexture(s.texture),h()}hasTransition(){return!1}}let Ae;class Pe extends tr{constructor(s,h,m,y){super(s,h,m,y),this.type="raster-dem",this.maxzoom=22,this._options=b.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(s,h){const m=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function y(w,S){w&&(s.state="errored",h(w)),S&&(s.dem=S,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded",h(null))}s.request=si.getImage(this.map._requestManager.transformRequest(m,fn.Tile),function(w,S){if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(w)s.state="errored",h(w);else if(S){this.map._refreshExpiredTiles&&s.setExpiryData(S),delete S.cacheControl,delete S.expires;const I=b.isImageBitmap(S)&&(null==Ae&&(Ae=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),Ae)?S:b.exported.getImageData(S,1),k={uid:s.uid,coord:s.tileID,source:this.id,rawImageData:I,encoding:this.encoding};s.actor&&"expired"!==s.state||(s.actor=this.dispatcher.getActor(),s.actor.send("loadDEMTile",k,y.bind(this)))}}.bind(this)),s.neighboringTiles=this._getNeighboringTiles(s.tileID)}_getNeighboringTiles(s){const h=s.canonical,m=Math.pow(2,h.z),y=(h.x-1+m)%m,w=0===h.x?s.wrap-1:s.wrap,S=(h.x+1+m)%m,I=h.x+1===m?s.wrap+1:s.wrap,k={};return k[new b.OverscaledTileID(s.overscaledZ,w,h.z,y,h.y).key]={backfilled:!1},k[new b.OverscaledTileID(s.overscaledZ,I,h.z,S,h.y).key]={backfilled:!1},h.y>0&&(k[new b.OverscaledTileID(s.overscaledZ,w,h.z,y,h.y-1).key]={backfilled:!1},k[new b.OverscaledTileID(s.overscaledZ,s.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},k[new b.OverscaledTileID(s.overscaledZ,I,h.z,S,h.y-1).key]={backfilled:!1}),h.y+1<m&&(k[new b.OverscaledTileID(s.overscaledZ,w,h.z,y,h.y+1).key]={backfilled:!1},k[new b.OverscaledTileID(s.overscaledZ,s.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},k[new b.OverscaledTileID(s.overscaledZ,I,h.z,S,h.y+1).key]={backfilled:!1}),k}unloadTile(s){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&s.actor.send("removeDEMTile",{uid:s.uid,source:this.id})}}class Na extends b.Evented{constructor(s,h,m,y){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=m.getActor(),this.setEventedParent(y),this._data=h.data,this._options=b.extend({},h),this._collectResourceTiming=h.collectResourceTiming,void 0!==h.maxzoom&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const w=b.EXTENT/this.tileSize;this.workerOptions=b.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(void 0!==h.buffer?h.buffer:128)*w,tolerance:(void 0!==h.tolerance?h.tolerance:.375)*w,extent:b.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:void 0!==h.clusterMaxZoom?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:b.EXTENT,radius:(h.clusterRadius||50)*w,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}load(){this._updateWorkerData()}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(void 0!==s.clusterRadius&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),void 0!==s.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(s,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:s,source:this.id},h),this}getClusterChildren(s,h){return this.actor.send("geojson.getClusterChildren",{clusterId:s,source:this.id},h),this}getClusterLeaves(s,h,m,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:s,limit:h,offset:m},y),this}_updateWorkerData(s){const h=b.extend({},this.workerOptions);s?h.dataDiff=s:"string"==typeof this._data?(h.request=this.map._requestManager.transformRequest(b.exported.resolveURL(this._data),fn.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new b.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,h,(m,y)=>{if(this._pendingLoads--,this._removed||y&&y.abandoned)return void this.fire(new b.Event("dataabort",{dataType:"source"}));let w=null;if(y&&y.resourceTiming&&y.resourceTiming[this.id]&&(w=y.resourceTiming[this.id].slice(0)),m)return void this.fire(new b.ErrorEvent(m));const S={dataType:"source"};this._collectResourceTiming&&w&&w.length>0&&b.extend(S,{resourceTiming:w}),this.fire(new b.Event("data",{...S,sourceDataType:"metadata"})),this.fire(new b.Event("data",{...S,sourceDataType:"content"}))})}loaded(){return 0===this._pendingLoads}loadTile(s,h){const m=s.actor?"reloadTile":"loadTile";s.actor=this.actor;const y={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.request=this.actor.send(m,y,(w,S)=>(delete s.request,s.unloadVectorData(),s.aborted?h(null):w?h(w):(s.loadVectorData(S,this.map.painter,"reloadTile"===m),h(null))))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.aborted=!0}unloadTile(s){s.unloadVectorData(),this.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return b.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Vi=b.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Vn extends b.Evented{constructor(s,h,m,y){super(),this.id=s,this.dispatcher=m,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=h}load(s,h){this._loaded=!1,this.fire(new b.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=si.getImage(this.map._requestManager.transformRequest(this.url,fn.Image),(m,y)=>{this._request=null,this._loaded=!0,m?this.fire(new b.ErrorEvent(m)):y&&(this.image=y,s&&(this.coordinates=s),h&&h(),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=s.url,this.load(s.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new b.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(s){this.coordinates=s;const h=s.map(b.MercatorCoordinate.fromLngLat);this.tileID=function(y){let w=1/0,S=1/0,I=-1/0,k=-1/0;for(const j of y)w=Math.min(w,j.x),S=Math.min(S,j.y),I=Math.max(I,j.x),k=Math.max(k,j.y);const R=Math.max(I-w,k-S),z=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),L=Math.pow(2,z);return new b.CanonicalTileID(z,Math.floor((w+I)/2*L),Math.floor((S+k)/2*L))}(h),this.minzoom=this.maxzoom=this.tileID.z;const m=h.map(y=>this.tileID.getTilePoint(y)._round());return this._boundsArray=new b.RasterBoundsArray,this._boundsArray.emplaceBack(m[0].x,m[0].y,0,0),this._boundsArray.emplaceBack(m[1].x,m[1].y,b.EXTENT,0),this._boundsArray.emplaceBack(m[3].x,m[3].y,0,b.EXTENT),this._boundsArray.emplaceBack(m[2].x,m[2].y,b.EXTENT,b.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new b.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Vi.members)),this.boundsSegments||(this.boundsSegments=b.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Gn(s,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const m in this.tiles){const y=this.tiles[m];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}loadTile(s,h){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},h(null)):(s.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ds extends Vn{constructor(s,h,m,y){super(s,h,m,y),this.roundZoom=!0,this.type="video",this.options=h}load(){this._loaded=!1;const s=this.options;this.urls=[];for(const h of s.urls)this.urls.push(this.map._requestManager.transformRequest(h,fn.Source).url);b.getVideo(this.urls,(h,m)=>{this._loaded=!0,h?this.fire(new b.ErrorEvent(h)):m&&(this.video=m,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const h=this.video.seekable;s<h.start(0)||s>h.end(0)?this.fire(new b.ErrorEvent(new b.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Vi.members)),this.boundsSegments||(this.boundsSegments=b.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new Gn(s,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const m in this.tiles){const y=this.tiles[m];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ui extends Vn{constructor(s,h,m,y){super(s,h,m,y),h.coordinates?Array.isArray(h.coordinates)&&4===h.coordinates.length&&!h.coordinates.some(w=>!Array.isArray(w)||2!==w.length||w.some(S=>"number"!=typeof S))||this.fire(new b.ErrorEvent(new b.ValidationError(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new b.ErrorEvent(new b.ValidationError(`sources.${s}`,null,'missing required property "coordinates"'))),h.animate&&"boolean"!=typeof h.animate&&this.fire(new b.ErrorEvent(new b.ValidationError(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),h.canvas?"string"==typeof h.canvas||h.canvas instanceof HTMLCanvasElement||this.fire(new b.ErrorEvent(new b.ValidationError(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new b.ErrorEvent(new b.ValidationError(`sources.${s}`,null,'missing required property "canvas"'))),this.options=h,this.animate=void 0===h.animate||h.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new b.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const h=this.map.painter.context,m=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Vi.members)),this.boundsSegments||(this.boundsSegments=b.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Gn(h,this.canvas,m.RGBA,{premultiply:!0});for(const y in this.tiles){const w=this.tiles[y];"loaded"!==w.state&&(w.state="loaded",w.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const Pl={vector:yr,raster:tr,"raster-dem":Pe,geojson:Na,video:ds,image:Vn,canvas:Ui};function fs(g,s){const h=b.create();return b.translate(h,h,[1,1,0]),b.scale(h,h,[.5*g.width,.5*g.height,1]),b.multiply(h,h,g.calculatePosMatrix(s.toUnwrapped()))}function rt(g,s,h,m,y,w){const S=function(L,j,Q){if(L)for(const ee of L){const Y=j[ee];if(Y&&Y.source===Q&&"fill-extrusion"===Y.type)return!0}else for(const ee in j){const Y=j[ee];if(Y.source===Q&&"fill-extrusion"===Y.type)return!0}return!1}(y&&y.layers,s,g.id),I=w.maxPitchScaleFactor(),k=g.tilesIn(m,I,S);k.sort(Jt);const R=[];for(const L of k)R.push({wrappedTileID:L.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(s,h,g._state,L.queryGeometry,L.cameraQueryGeometry,L.scale,y,w,I,fs(g.transform,L.tileID))});const z=function(L){const j={},Q={};for(const ee of L){const Y=ee.queryResults,ae=ee.wrappedTileID,_e=Q[ae]=Q[ae]||{};for(const ye in Y){const ie=Y[ye],we=_e[ye]=_e[ye]||{},De=j[ye]=j[ye]||[];for(const Se of ie)we[Se.featureIndex]||(we[Se.featureIndex]=!0,De.push(Se))}}return j}(R);for(const L in z)z[L].forEach(j=>{const Q=j.feature,ee=g.getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=ee});return z}function Jt(g,s){const h=g.tileID,m=s.tileID;return h.overscaledZ-m.overscaledZ||h.canonical.y-m.canonical.y||h.wrap-m.wrap||h.canonical.x-m.canonical.x}class jt{constructor(s,h){this.tileID=s,this.uid=b.uniqueId(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const h=s+this.timeAdded;h<b.exported.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,h,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(y,w){const S={};if(!w)return S;for(const I of y){const k=I.layerIds.map(R=>w.getLayer(R)).filter(Boolean);if(0!==k.length){I.layers=k,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map(R=>k.filter(z=>z.id===R)[0]));for(const R of k)S[R.id]=I}}return S}(s.buckets,h.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const w=this.buckets[y];if(w instanceof b.SymbolBucket){if(this.hasSymbolBuckets=!0,!m)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const w=this.buckets[y];if(w instanceof b.SymbolBucket&&w.hasRTLText){this.hasRTLText=!0,b.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const y in this.buckets){const w=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(y).queryRadius(w))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new b.CollisionBoxArray}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const m in this.buckets){const y=this.buckets[m];y.uploadPending()&&y.upload(s)}const h=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Gn(s,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Gn(s,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,h,m,y,w,S,I,k,R,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:w,scale:S,tileSize:this.tileSize,pixelPosMatrix:z,transform:k,params:I,queryPadding:this.queryPadding*R},s,h,m):{}}querySourceFeatures(s,h){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const y=m.loadVTLayers(),w=h&&h.sourceLayer?h.sourceLayer:"",S=y._geojsonTileLayer||y[w];if(!S)return;const I=b.createFilter(h&&h.filter),{z:k,x:R,y:z}=this.tileID.canonical,L={z:k,x:R,y:z};for(let j=0;j<S.length;j++){const Q=S.feature(j);if(I.needGeometry){const ae=b.toEvaluationFeature(Q,!0);if(!I.filter(new b.EvaluationParameters(this.tileID.overscaledZ),ae,this.tileID.canonical))continue}else if(!I.filter(new b.EvaluationParameters(this.tileID.overscaledZ),Q))continue;const ee=m.getId(Q,w),Y=new b.GeoJSONFeature(Q,k,R,z,ee);Y.tile=L,s.push(Y)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const h=this.expirationTime;if(s.cacheControl){const m=b.parseCacheControl(s.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const m=Date.now();let y=!1;if(this.expirationTime>m)y=!1;else if(h)if(this.expirationTime<h)y=!0;else{const w=this.expirationTime-h;w?this.expirationTime=m+Math.max(w,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(s,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(s).length)return;const m=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!h.style.hasLayer(y))continue;const w=this.buckets[y],S=w.layers[0].sourceLayer||"_geojsonTileLayer",I=m[S],k=s[S];if(!I||!k||0===Object.keys(k).length)continue;w.update(k,I,this.imageAtlas&&this.imageAtlas.patternPositions||{});const R=h&&h.style&&h.style.getLayer(y);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(w)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<b.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=b.exported.now()+s}setDependencies(s,h){const m={};for(const y of h)m[y]=!0;this.dependencies[s]=m}hasDependency(s,h){for(const m of s){const y=this.dependencies[m];if(y)for(const w of h)if(y[w])return!0}return!1}}class so{constructor(s,h){this.max=s,this.onRemove=h,this.reset()}reset(){for(const s in this.data)for(const h of this.data[s])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(s,h,m){const y=s.wrapped().key;void 0===this.data[y]&&(this.data[y]=[]);const w={value:h,timeout:void 0};if(void 0!==m&&(w.timeout=setTimeout(()=>{this.remove(s,w)},m)),this.data[y].push(w),this.order.push(y),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const h=this.data[s].shift();return h.timeout&&clearTimeout(h.timeout),0===this.data[s].length&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),h.value}getByKey(s){const h=this.data[s];return h?h[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,h){if(!this.has(s))return this;const m=s.wrapped().key,y=void 0===h?0:this.data[m].indexOf(h),w=this.data[m][y];return this.data[m].splice(y,1),w.timeout&&clearTimeout(w.timeout),0===this.data[m].length&&delete this.data[m],this.onRemove(w.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(s){const h=[];for(const m in this.data)for(const y of this.data[m])s(y.value)||h.push(y);for(const m of h)this.remove(m.value.tileID,m)}}class ps{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,h,m){const y=String(h);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][y]=this.stateChanges[s][y]||{},b.extend(this.stateChanges[s][y],m),null===this.deletedStates[s]){this.deletedStates[s]={};for(const w in this.state[s])w!==y&&(this.deletedStates[s][w]=null)}else if(this.deletedStates[s]&&null===this.deletedStates[s][y]){this.deletedStates[s][y]={};for(const w in this.state[s][y])m[w]||(this.deletedStates[s][y][w]=null)}else for(const w in m)this.deletedStates[s]&&this.deletedStates[s][y]&&null===this.deletedStates[s][y][w]&&delete this.deletedStates[s][y][w]}removeFeatureState(s,h,m){if(null===this.deletedStates[s])return;const y=String(h);if(this.deletedStates[s]=this.deletedStates[s]||{},m&&void 0!==h)null!==this.deletedStates[s][y]&&(this.deletedStates[s][y]=this.deletedStates[s][y]||{},this.deletedStates[s][y][m]=null);else if(void 0!==h)if(this.stateChanges[s]&&this.stateChanges[s][y])for(m in this.deletedStates[s][y]={},this.stateChanges[s][y])this.deletedStates[s][y][m]=null;else this.deletedStates[s][y]=null;else this.deletedStates[s]=null}getState(s,h){const m=String(h),y=b.extend({},(this.state[s]||{})[m],(this.stateChanges[s]||{})[m]);if(null===this.deletedStates[s])return{};if(this.deletedStates[s]){const w=this.deletedStates[s][h];if(null===w)return{};for(const S in w)delete y[S]}return y}initializeTileState(s,h){s.setFeatureState(this.state,h)}coalesceChanges(s,h){const m={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const w={};for(const S in this.stateChanges[y])this.state[y][S]||(this.state[y][S]={}),b.extend(this.state[y][S],this.stateChanges[y][S]),w[S]=this.state[y][S];m[y]=w}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const w={};if(null===this.deletedStates[y])for(const S in this.state[y])w[S]={},this.state[y][S]={};else for(const S in this.deletedStates[y]){if(null===this.deletedStates[y][S])this.state[y][S]={};else for(const I of Object.keys(this.deletedStates[y][S]))delete this.state[y][S][I];w[S]=this.state[y][S]}m[y]=m[y]||{},b.extend(m[y],w)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(m).length)for(const y in s)s[y].setFeatureState(m,h)}}class At extends b.Evented{constructor(s,h,m){super(),this.id=s,this.dispatcher=m,this.on("data",y=>{"source"===y.dataType&&"metadata"===y.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===y.dataType&&"content"===y.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(y,w,S,I){const k=new Pl[w.type](y,w,S,I);if(k.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${k.id}`);return b.bindAll(["load","abort","unload","serialize","prepare"],k),k}(s,h,m,this),this._tiles={},this._cache=new so(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ps}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles){const h=this._tiles[s];if("loaded"!==h.state&&"errored"!==h.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,h){return this._source.loadTile(s,h)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s,()=>{})}_abortTile(s){this._source.abortTile&&this._source.abortTile(s,()=>{}),this._source.fire(new b.Event("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const m=this._tiles[h];m.upload(s),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(Ls).map(s=>s.key)}getRenderableIds(s){const h=[];for(const m in this._tiles)this._isIdRenderable(m,s)&&h.push(this._tiles[m]);return s?h.sort((m,y)=>{const w=m.tileID,S=y.tileID,I=new b.pointGeometry(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),k=new b.pointGeometry(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-S.overscaledZ||k.y-I.y||k.x-I.x}).map(m=>m.tileID.key):h.map(m=>m.tileID).sort(Ls).map(m=>m.key)}hasRenderableParent(s){const h=this.findLoadedParent(s,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(s,h){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(h||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)"errored"!==this._tiles[s].state&&this._reloadTile(s,"reloading")}}_reloadTile(s,h){const m=this._tiles[s];m&&("loading"!==m.state&&(m.state=h),this._loadTile(m,this._tileLoaded.bind(this,m,s,h)))}_tileLoaded(s,h,m,y){if(y)return s.state="errored",void(404!==y.status?this._source.fire(new b.ErrorEvent(y,{tile:s})):this.update(this.transform,this.terrain));s.timeAdded=b.exported.now(),"expired"===m&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(h,s),"raster-dem"===this.getSource().type&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new b.Event("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const h=this.getRenderableIds();for(let y=0;y<h.length;y++){const w=h[y];if(s.neighboringTiles&&s.neighboringTiles[w]){const S=this.getTileByID(w);m(s,S),m(S,s)}}function m(y,w){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let S=w.tileID.canonical.x-y.tileID.canonical.x;const I=w.tileID.canonical.y-y.tileID.canonical.y,k=Math.pow(2,y.tileID.canonical.z),R=w.tileID.key;0===S&&0===I||Math.abs(I)>1||(Math.abs(S)>1&&(1===Math.abs(S+k)?S+=k:1===Math.abs(S-k)&&(S-=k)),w.dem&&y.dem&&(y.dem.backfillBorder(w.dem,S,I),y.neighboringTiles&&y.neighboringTiles[R]&&(y.neighboringTiles[R].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,h,m,y){for(const w in this._tiles){let S=this._tiles[w];if(y[w]||!S.hasData()||S.tileID.overscaledZ<=h||S.tileID.overscaledZ>m)continue;let I=S.tileID;for(;S&&S.tileID.overscaledZ>h+1;){const R=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[R.key],S&&S.hasData()&&(I=R)}let k=I;for(;k.overscaledZ>h;)if(k=k.scaledTo(k.overscaledZ-1),s[k.key]){y[I.key]=I;break}}}findLoadedParent(s,h){if(s.key in this._loadedParentTiles){const m=this._loadedParentTiles[s.key];return m&&m.tileID.overscaledZ>=h?m:null}for(let m=s.overscaledZ-1;m>=h;m--){const y=s.scaledTo(m),w=this._getLoadedTile(y);if(w)return w}}_getLoadedTile(s){const h=this._tiles[s.key];return h&&h.hasData()?h:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const h=Math.ceil(s.width/this._source.tileSize)+1,m=Math.ceil(s.height/this._source.tileSize)+1,y=Math.floor(h*m*5),w="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(w)}handleWrapJump(s){const h=Math.round((s-(void 0===this._prevLng?s:this._prevLng))/360);if(this._prevLng=s,h){const m={};for(const y in this._tiles){const w=this._tiles[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+h),m[w.tileID.key]=w}this._tiles=m;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}update(s,h){if(this.transform=s,this.terrain=h,!this._sourceLoaded||this._paused)return;let m;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(R=>new b.OverscaledTileID(R.canonical.z,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y)):(m=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(m=m.filter(R=>this._source.hasTile(R)))):m=[];const y=s.coveringZoomLevel(this._source),w=Math.max(y-At.maxOverzooming,this._source.minzoom),S=Math.max(y+At.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const R={};for(const z of m)if(z.canonical.z>this._source.minzoom){const L=z.scaledTo(z.canonical.z-1);R[L.key]=L;const j=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));R[j.key]=j}m=m.concat(Object.values(R))}const I=this._updateRetainedTiles(m,y);if(Ei(this._source.type)){const R={},z={},L=Object.keys(I);for(const j of L){const Q=I[j],ee=this._tiles[j];if(!ee||ee.fadeEndTime&&ee.fadeEndTime<=b.exported.now())continue;const Y=this.findLoadedParent(Q,w);Y&&(this._addTile(Y.tileID),R[Y.tileID.key]=Y.tileID),z[j]=Q}this._retainLoadedChildren(z,y,S,I);for(const j in R)I[j]||(this._coveredTiles[j]=!0,I[j]=R[j]);if(h){const j={},Q={};for(const ee of m)this._tiles[ee.key].hasData()?j[ee.key]=ee:Q[ee.key]=ee;for(const ee in Q){const Y=Q[ee].children(this._source.maxzoom);this._tiles[Y[0].key]&&this._tiles[Y[1].key]&&this._tiles[Y[2].key]&&this._tiles[Y[3].key]&&(j[Y[0].key]=I[Y[0].key]=Y[0],j[Y[1].key]=I[Y[1].key]=Y[1],j[Y[2].key]=I[Y[2].key]=Y[2],j[Y[3].key]=I[Y[3].key]=Y[3],delete Q[ee])}for(const ee in Q){const Y=this.findLoadedParent(Q[ee],this._source.minzoom);if(Y){j[Y.tileID.key]=I[Y.tileID.key]=Y.tileID;for(const ae in j)j[ae].isChildOf(Y.tileID)&&delete j[ae]}}for(const ee in this._tiles)j[ee]||(this._coveredTiles[ee]=!0)}}for(const R in I)this._tiles[R].clearFadeHold();const k=b.keysDifference(this._tiles,I);for(const R of k){const z=this._tiles[R];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(R)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,h){const m={},y={},w=Math.max(h-At.maxOverzooming,this._source.minzoom),S=Math.max(h+At.maxUnderzooming,this._source.minzoom),I={};for(const k of s){const R=this._addTile(k);m[k.key]=k,R.hasData()||h<this._source.maxzoom&&(I[k.key]=k)}this._retainLoadedChildren(I,h,S,m);for(const k of s){let R=this._tiles[k.key];if(R.hasData())continue;if(h+1>this._source.maxzoom){const L=k.children(this._source.maxzoom)[0],j=this.getTile(L);if(j&&j.hasData()){m[L.key]=L;continue}}else{const L=k.children(this._source.maxzoom);if(m[L[0].key]&&m[L[1].key]&&m[L[2].key]&&m[L[3].key])continue}let z=R.wasRequested();for(let L=k.overscaledZ-1;L>=w;--L){const j=k.scaledTo(L);if(y[j.key]||(y[j.key]=!0,R=this.getTile(j),!R&&z&&(R=this._addTile(j)),R&&(m[j.key]=j,z=R.wasRequested(),R.hasData())))break}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const h=[];let m,y=this._tiles[s].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){m=this._loadedParentTiles[y.key];break}h.push(y.key);const w=y.scaledTo(y.overscaledZ-1);if(m=this._getLoadedTile(w),m)break;y=w}for(const w of h)this._loadedParentTiles[w]=m}}_addTile(s){let h=this._tiles[s.key];if(h)return h;h=this._cache.getAndRemove(s),h&&(this._setTileReloadTimer(s.key,h),h.tileID=s,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,h)));const m=h;return h||(h=new jt(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,s.key,h.state))),h.uses++,this._tiles[s.key]=h,m||this._source.fire(new b.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(s,h){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const m=h.getExpiryTimeout();m&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},m))}_removeTile(s){const h=this._tiles[s];h&&(h.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),h.uses>0||(h.hasData()&&"reloading"!==h.state?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,h,m){const y=[],w=this.transform;if(!w)return y;const S=m?w.getCameraQueryGeometry(s):s,I=s.map(ee=>w.pointCoordinate(ee,this.terrain)),k=S.map(ee=>w.pointCoordinate(ee,this.terrain)),R=this.getIds();let z=1/0,L=1/0,j=-1/0,Q=-1/0;for(const ee of k)z=Math.min(z,ee.x),L=Math.min(L,ee.y),j=Math.max(j,ee.x),Q=Math.max(Q,ee.y);for(let ee=0;ee<R.length;ee++){const Y=this._tiles[R[ee]];if(Y.holdingForFade())continue;const ae=Y.tileID,_e=Math.pow(2,w.zoom-Y.tileID.overscaledZ),ye=h*Y.queryPadding*b.EXTENT/Y.tileSize/_e,ie=[ae.getTilePoint(new b.MercatorCoordinate(z,L)),ae.getTilePoint(new b.MercatorCoordinate(j,Q))];if(ie[0].x-ye<b.EXTENT&&ie[0].y-ye<b.EXTENT&&ie[1].x+ye>=0&&ie[1].y+ye>=0){const we=I.map(Se=>ae.getTilePoint(Se)),De=k.map(Se=>ae.getTilePoint(Se));y.push({tile:Y,tileID:ae,queryGeometry:we,cameraQueryGeometry:De,scale:_e})}}return y}getVisibleCoordinates(s){const h=this.getRenderableIds(s).map(m=>this._tiles[m].tileID);for(const m of h)m.posMatrix=this.transform.calculatePosMatrix(m.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(Ei(this._source.type))for(const s in this._tiles){const h=this._tiles[s];if(void 0!==h.fadeEndTime&&h.fadeEndTime>=b.exported.now())return!0}return!1}setFeatureState(s,h,m){this._state.updateState(s=s||"_geojsonTileLayer",h,m)}removeFeatureState(s,h,m){this._state.removeFeatureState(s=s||"_geojsonTileLayer",h,m)}getFeatureState(s,h){return this._state.getState(s=s||"_geojsonTileLayer",h)}setDependencies(s,h,m){const y=this._tiles[s];y&&y.setDependencies(h,m)}reloadTilesForDependencies(s,h){for(const m in this._tiles)this._tiles[m].hasDependency(s,h)&&this._reloadTile(m,"reloading");this._cache.filter(m=>!m.hasDependency(s,h))}}function Ls(g,s){const h=Math.abs(2*g.wrap)-+(g.wrap<0),m=Math.abs(2*s.wrap)-+(s.wrap<0);return g.overscaledZ-s.overscaledZ||m-h||s.canonical.y-g.canonical.y||s.canonical.x-g.canonical.x}function Ei(g){return"raster"===g||"image"===g||"video"===g}At.maxOverzooming=10,At.maxUnderzooming=3;const ra="mapboxgl_preloaded_worker_pool";class ao{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<ao.workerCount;)this.workers.push(new Worker(pa.workerUrl));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ra]}numActive(){return Object.keys(this.active).length}}const $i=Math.floor(b.exported.hardwareConcurrency/2);let Nn;function Fc(){return Nn||(Nn=new ao),Nn}function lo(g,s){const h={};for(const m in g)"ref"!==m&&(h[m]=g[m]);return b.refProperties.forEach(m=>{m in s&&(h[m]=s[m])}),h}function Rl(g){g=g.slice();const s=Object.create(null);for(let h=0;h<g.length;h++)s[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=lo(g[h],s[g[h].ref]));return g}ao.workerCount=Math.max(Math.min($i,6),1);const pn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ia(g,s,h){h.push({command:pn.addSource,args:[g,s[g]]})}function Oc(g,s,h){s.push({command:pn.removeSource,args:[g]}),h[g]=!0}function za(g,s,h,m){Oc(g,h,m),ia(g,s,h)}function Ru(g,s,h){let m;for(m in g[h])if(Object.prototype.hasOwnProperty.call(g[h],m)&&"data"!==m&&!Zt(g[h][m],s[h][m]))return!1;for(m in s[h])if(Object.prototype.hasOwnProperty.call(s[h],m)&&"data"!==m&&!Zt(g[h][m],s[h][m]))return!1;return!0}function oa(g,s,h,m,y,w){let S;for(S in s=s||{},g=g||{})Object.prototype.hasOwnProperty.call(g,S)&&(Zt(g[S],s[S])||h.push({command:w,args:[m,S,s[S],y]}));for(S in s)Object.prototype.hasOwnProperty.call(s,S)&&!Object.prototype.hasOwnProperty.call(g,S)&&(Zt(g[S],s[S])||h.push({command:w,args:[m,S,s[S],y]}))}function Ba(g){return g.id}function Sn(g,s){return g[s.id]=s,g}class Fl{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(1===this.points.length)return this.points[0];s=b.clamp(s,0,1);let h=1,m=this._distances[h];const y=s*this.paddedLength+this.padding;for(;m<y&&h<this._distances.length;)m=this._distances[++h];const w=h-1,S=this._distances[w],I=m-S,k=I>0?(y-S)/I:0;return this.points[w].mult(1-k).add(this.points[h].mult(k))}}function co(g,s){let h=!0;return"always"===g||"never"!==g&&"never"!==s||(h=!1),h}class Xr{constructor(s,h,m){const y=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(s/m),this.yCellCount=Math.ceil(h/m);for(let S=0;S<this.xCellCount*this.yCellCount;S++)y.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,m,y,w){this._forEachCell(h,m,y,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(w)}insertCircle(s,h,m,y){this._forEachCell(h-y,m-y,h+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(m),this.circles.push(y)}_insertBoxCell(s,h,m,y,w,S){this.boxCells[w].push(S)}_insertCircleCell(s,h,m,y,w,S){this.circleCells[w].push(S)}_query(s,h,m,y,w,S,I){if(m<0||s>this.width||y<0||h>this.height)return[];const k=[];if(s<=0&&h<=0&&this.width<=m&&this.height<=y){if(w)return[{key:null,x1:s,y1:h,x2:m,y2:y}];for(let R=0;R<this.boxKeys.length;R++)k.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const z=this.circles[3*R],L=this.circles[3*R+1],j=this.circles[3*R+2];k.push({key:this.circleKeys[R],x1:z-j,y1:L-j,x2:z+j,y2:L+j})}}else this._forEachCell(s,h,m,y,this._queryCell,k,{hitTest:w,overlapMode:S,seenUids:{box:{},circle:{}}},I);return k}query(s,h,m,y){return this._query(s,h,m,y,!1,null)}hitTest(s,h,m,y,w,S){return this._query(s,h,m,y,!0,w,S).length>0}hitTestCircle(s,h,m,y,w){const S=s-m,I=s+m,k=h-m,R=h+m;if(I<0||S>this.width||R<0||k>this.height)return!1;const z=[];return this._forEachCell(S,k,I,R,this._queryCellCircle,z,{hitTest:!0,overlapMode:y,circle:{x:s,y:h,radius:m},seenUids:{box:{},circle:{}}},w),z.length>0}_queryCell(s,h,m,y,w,S,I,k){const{seenUids:R,hitTest:z,overlapMode:L}=I,j=this.boxCells[w];if(null!==j){const ee=this.bboxes;for(const Y of j)if(!R.box[Y]){R.box[Y]=!0;const ae=4*Y,_e=this.boxKeys[Y];if(s<=ee[ae+2]&&h<=ee[ae+3]&&m>=ee[ae+0]&&y>=ee[ae+1]&&(!k||k(_e))&&(!z||!co(L,_e.overlapMode))&&(S.push({key:_e,x1:ee[ae],y1:ee[ae+1],x2:ee[ae+2],y2:ee[ae+3]}),z))return!0}}const Q=this.circleCells[w];if(null!==Q){const ee=this.circles;for(const Y of Q)if(!R.circle[Y]){R.circle[Y]=!0;const ae=3*Y,_e=this.circleKeys[Y];if(this._circleAndRectCollide(ee[ae],ee[ae+1],ee[ae+2],s,h,m,y)&&(!k||k(_e))&&(!z||!co(L,_e.overlapMode))){const ye=ee[ae],ie=ee[ae+1],we=ee[ae+2];if(S.push({key:_e,x1:ye-we,y1:ie-we,x2:ye+we,y2:ie+we}),z)return!0}}}return!1}_queryCellCircle(s,h,m,y,w,S,I,k){const{circle:R,seenUids:z,overlapMode:L}=I,j=this.boxCells[w];if(null!==j){const ee=this.bboxes;for(const Y of j)if(!z.box[Y]){z.box[Y]=!0;const ae=4*Y,_e=this.boxKeys[Y];if(this._circleAndRectCollide(R.x,R.y,R.radius,ee[ae+0],ee[ae+1],ee[ae+2],ee[ae+3])&&(!k||k(_e))&&!co(L,_e.overlapMode))return S.push(!0),!0}}const Q=this.circleCells[w];if(null!==Q){const ee=this.circles;for(const Y of Q)if(!z.circle[Y]){z.circle[Y]=!0;const ae=3*Y,_e=this.circleKeys[Y];if(this._circlesCollide(ee[ae],ee[ae+1],ee[ae+2],R.x,R.y,R.radius)&&(!k||k(_e))&&!co(L,_e.overlapMode))return S.push(!0),!0}}}_forEachCell(s,h,m,y,w,S,I,k){const R=this._convertToXCellCoord(s),z=this._convertToYCellCoord(h),L=this._convertToXCellCoord(m),j=this._convertToYCellCoord(y);for(let Q=R;Q<=L;Q++)for(let ee=z;ee<=j;ee++)if(w.call(this,s,h,m,y,this.xCellCount*ee+Q,S,I,k))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,m,y,w,S){const I=y-s,k=w-h,R=m+S;return R*R>I*I+k*k}_circleAndRectCollide(s,h,m,y,w,S,I){const k=(S-y)/2,R=Math.abs(s-(y+k));if(R>k+m)return!1;const z=(I-w)/2,L=Math.abs(h-(w+z));if(L>z+m)return!1;if(R<=k||L<=z)return!0;const j=R-k,Q=L-z;return j*j+Q*Q<=m*m}}function $r(g,s,h,m,y){const w=b.create();return s?(b.scale(w,w,[1/y,1/y,1]),h||b.rotateZ(w,w,m.angle)):b.multiply(w,m.labelPlaneMatrix,g),w}function mi(g,s,h,m,y){if(s){const w=b.clone(g);return b.scale(w,w,[y,y,1]),h||b.rotateZ(w,w,-m.angle),w}return m.glCoordMatrix}function gi(g,s,h){let m;h?(m=[g.x,g.y,h(g.x,g.y),1],b.transformMat4(m,m,s)):(m=[g.x,g.y,0,1],xe(m,m,s));const y=m[3];return{point:new b.pointGeometry(m[0]/y,m[1]/y),signedDistanceFromCamera:y}}function Ns(g,s){return.5+g/s*.5}function J(g,s){const h=g[0]/g[3],m=g[1]/g[3];return h>=-s[0]&&h<=s[0]&&m>=-s[1]&&m<=s[1]}function V(g,s,h,m,y,w,S,I,k,R){const z=m?g.textSizeData:g.iconSizeData,L=b.evaluateSizeForZoom(z,h.transform.zoom),j=[256/h.width*2+1,256/h.height*2+1],Q=m?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;Q.clear();const ee=g.lineVertexArray,Y=m?g.text.placedSymbolArray:g.icon.placedSymbolArray,ae=h.transform.width/h.transform.height;let _e=!1;for(let ye=0;ye<Y.length;ye++){const ie=Y.get(ye);if(ie.hidden||ie.writingMode===b.WritingMode.vertical&&!_e){ue(ie.numGlyphs,Q);continue}let we;if(_e=!1,R?(we=[ie.anchorX,ie.anchorY,R(ie.anchorX,ie.anchorY),1],b.transformMat4(we,we,s)):(we=[ie.anchorX,ie.anchorY,0,1],xe(we,we,s)),!J(we,j)){ue(ie.numGlyphs,Q);continue}const De=Ns(h.transform.cameraToCenterDistance,we[3]),Se=b.evaluateSizeForFeature(z,L,ie),ke=S?Se/De:Se*De,Be=new b.pointGeometry(ie.anchorX,ie.anchorY),Le=gi(Be,y,R).point,Ne={},ze=te(ie,ke,!1,I,s,y,w,g.glyphOffsetArray,ee,Q,Le,Be,Ne,ae,k,R);_e=ze.useVertical,(ze.notEnoughRoom||_e||ze.needsFlipping&&te(ie,ke,!0,I,s,y,w,g.glyphOffsetArray,ee,Q,Le,Be,Ne,ae,k,R).notEnoughRoom)&&ue(ie.numGlyphs,Q)}m?g.text.dynamicLayoutVertexBuffer.updateData(Q):g.icon.dynamicLayoutVertexBuffer.updateData(Q)}function $(g,s,h,m,y,w,S,I,k,R,z,L,j){const Q=I.glyphStartIndex+I.numGlyphs,ee=I.lineStartIndex,Y=I.lineStartIndex+I.lineLength,ae=s.getoffsetX(I.glyphStartIndex),_e=s.getoffsetX(Q-1),ye=ge(g*ae,h,m,y,w,S,I.segment,ee,Y,k,R,z,L,j);if(!ye)return null;const ie=ge(g*_e,h,m,y,w,S,I.segment,ee,Y,k,R,z,L,j);return ie?{first:ye,last:ie}:null}function K(g,s,h,m){return g===b.WritingMode.horizontal&&Math.abs(h.y-s.y)>Math.abs(h.x-s.x)*m?{useVertical:!0}:(g===b.WritingMode.vertical?s.y<h.y:s.x>h.x)?{needsFlipping:!0}:null}function te(g,s,h,m,y,w,S,I,k,R,z,L,j,Q,ee,Y){const ae=s/24,_e=g.lineOffsetX*ae,ye=g.lineOffsetY*ae;let ie;if(g.numGlyphs>1){const we=g.glyphStartIndex+g.numGlyphs,De=g.lineStartIndex,Se=g.lineStartIndex+g.lineLength,ke=$(ae,I,_e,ye,h,z,L,g,k,w,j,ee,Y);if(!ke)return{notEnoughRoom:!0};const Be=gi(ke.first.point,S,Y).point,Le=gi(ke.last.point,S,Y).point;if(m&&!h){const Ne=K(g.writingMode,Be,Le,Q);if(Ne)return Ne}ie=[ke.first];for(let Ne=g.glyphStartIndex+1;Ne<we-1;Ne++)ie.push(ge(ae*I.getoffsetX(Ne),_e,ye,h,z,L,g.segment,De,Se,k,w,j,ee,Y));ie.push(ke.last)}else{if(m&&!h){const De=gi(L,y,Y).point,Se=g.lineStartIndex+g.segment+1,ke=new b.pointGeometry(k.getx(Se),k.gety(Se)),Be=gi(ke,y,Y),Le=Be.signedDistanceFromCamera>0?Be.point:ce(L,ke,De,1,y,Y),Ne=K(g.writingMode,De,Le,Q);if(Ne)return Ne}const we=ge(ae*I.getoffsetX(g.glyphStartIndex),_e,ye,h,z,L,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,k,w,j,ee,Y);if(!we)return{notEnoughRoom:!0};ie=[we]}for(const we of ie)b.addDynamicAttributes(R,we.point,we.angle);return{}}function ce(g,s,h,m,y,w){const S=gi(g.add(g.sub(s)._unit()),y,w).point,I=h.sub(S);return h.add(I._mult(m/I.mag()))}function ge(g,s,h,m,y,w,S,I,k,R,z,L,j,Q){const ee=m?g-s:g+s;let Y=ee>0?1:-1,ae=0;m&&(Y*=-1,ae=Math.PI),Y<0&&(ae+=Math.PI);let _e=Y>0?I+S:I+S+1,ye=y,ie=y,we=0,De=0;const Se=Math.abs(ee),ke=[];for(;we+De<=Se;){if(_e+=Y,_e<I||_e>=k)return null;if(ie=ye,ke.push(ye),ye=L[_e],void 0===ye){const ft=new b.pointGeometry(R.getx(_e),R.gety(_e)),Pt=gi(ft,z,Q);if(Pt.signedDistanceFromCamera>0)ye=L[_e]=Pt.point;else{const Nt=_e-Y;ye=ce(0===we?w:new b.pointGeometry(R.getx(Nt),R.gety(Nt)),ft,ie,Se-we+1,z,Q)}}we+=De,De=ie.dist(ye)}const Be=(Se-we)/De,Le=ye.sub(ie),Ne=Le.mult(Be)._add(ie);Ne._add(Le._unit()._perp()._mult(h*Y));const ze=ae+Math.atan2(ye.y-ie.y,ye.x-ie.x);return ke.push(Ne),{point:Ne,angle:j?ze:0,path:ke}}const he=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ue(g,s){for(let h=0;h<g;h++){const m=s.length;s.resize(m+4),s.float32.set(he,3*m)}}function xe(g,s,h){const m=s[0],y=s[1];return g[0]=h[0]*m+h[4]*y+h[12],g[1]=h[1]*m+h[5]*y+h[13],g[3]=h[3]*m+h[7]*y+h[15],g}const Me=100;class je{constructor(s,h=new Xr(s.width+200,s.height+200,25),m=new Xr(s.width+200,s.height+200,25)){this.transform=s,this.grid=h,this.ignoredGrid=m,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Me,this.screenBottomBoundary=s.height+Me,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,h,m,y,w,S){const I=this.projectAndGetPerspectiveRatio(y,s.anchorPointX,s.anchorPointY,S),k=m*I.perspectiveRatio,R=s.x1*k+I.point.x,z=s.y1*k+I.point.y,L=s.x2*k+I.point.x,j=s.y2*k+I.point.y;return!this.isInsideGrid(R,z,L,j)||"always"!==h&&this.grid.hitTest(R,z,L,j,h,w)||I.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[R,z,L,j],offscreen:this.isOffscreen(R,z,L,j)}}placeCollisionCircles(s,h,m,y,w,S,I,k,R,z,L,j,Q,ee){const Y=[],ae=new b.pointGeometry(h.anchorX,h.anchorY),_e=gi(ae,S,ee),ye=Ns(this.transform.cameraToCenterDistance,_e.signedDistanceFromCamera),ie=(z?w/ye:w*ye)/b.ONE_EM,we=gi(ae,I,ee).point,De=$(ie,y,h.lineOffsetX*ie,h.lineOffsetY*ie,!1,we,ae,h,m,I,{},!1,ee);let Se=!1,ke=!1,Be=!0;if(De){const Le=.5*j*ye+Q,Ne=new b.pointGeometry(-100,-100),ze=new b.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),ft=new Fl,Pt=De.first,Nt=De.last;let mt=[];for(let Ht=Pt.path.length-1;Ht>=1;Ht--)mt.push(Pt.path[Ht]);for(let Ht=1;Ht<Nt.path.length;Ht++)mt.push(Nt.path[Ht]);const In=2.5*Le;if(k){const Ht=mt.map(rn=>gi(rn,k,ee));mt=Ht.some(rn=>rn.signedDistanceFromCamera<=0)?[]:Ht.map(rn=>rn.point)}let An=[];if(mt.length>0){const Ht=mt[0].clone(),rn=mt[0].clone();for(let Fn=1;Fn<mt.length;Fn++)Ht.x=Math.min(Ht.x,mt[Fn].x),Ht.y=Math.min(Ht.y,mt[Fn].y),rn.x=Math.max(rn.x,mt[Fn].x),rn.y=Math.max(rn.y,mt[Fn].y);An=Ht.x>=Ne.x&&rn.x<=ze.x&&Ht.y>=Ne.y&&rn.y<=ze.y?[mt]:rn.x<Ne.x||Ht.x>ze.x||rn.y<Ne.y||Ht.y>ze.y?[]:b.clipLine([mt],Ne.x,Ne.y,ze.x,ze.y)}for(const Ht of An){ft.reset(Ht,.25*Le);let rn=0;rn=ft.length<=.5*Le?1:Math.ceil(ft.paddedLength/In)+1;for(let Fn=0;Fn<rn;Fn++){const yn=Fn/Math.max(rn-1,1),yo=ft.lerp(yn),Fo=yo.x+Me,vr=yo.y+Me;Y.push(Fo,vr,Le,0);const ci=Fo-Le,Ii=vr-Le,Jo=Fo+Le,Oo=vr+Le;if(Be=Be&&this.isOffscreen(ci,Ii,Jo,Oo),ke=ke||this.isInsideGrid(ci,Ii,Jo,Oo),"always"!==s&&this.grid.hitTestCircle(Fo,vr,Le,s,L)&&(Se=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Se}}}}return{circles:!R&&Se||!ke||ye<this.perspectiveRatioCutoff?[]:Y,offscreen:Be,collisionDetected:Se}}queryRenderedSymbols(s){if(0===s.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let m=1/0,y=1/0,w=-1/0,S=-1/0;for(const z of s){const L=new b.pointGeometry(z.x+Me,z.y+Me);m=Math.min(m,L.x),y=Math.min(y,L.y),w=Math.max(w,L.x),S=Math.max(S,L.y),h.push(L)}const I=this.grid.query(m,y,w,S).concat(this.ignoredGrid.query(m,y,w,S)),k={},R={};for(const z of I){const L=z.key;if(void 0===k[L.bucketInstanceId]&&(k[L.bucketInstanceId]={}),k[L.bucketInstanceId][L.featureIndex])continue;const j=[new b.pointGeometry(z.x1,z.y1),new b.pointGeometry(z.x2,z.y1),new b.pointGeometry(z.x2,z.y2),new b.pointGeometry(z.x1,z.y2)];b.polygonIntersectsPolygon(h,j)&&(k[L.bucketInstanceId][L.featureIndex]=!0,void 0===R[L.bucketInstanceId]&&(R[L.bucketInstanceId]=[]),R[L.bucketInstanceId].push(L.featureIndex))}return R}insertCollisionBox(s,h,m,y,w,S){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:w,collisionGroupID:S,overlapMode:h},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,m,y,w,S){const I=m?this.ignoredGrid:this.grid,k={bucketInstanceId:y,featureIndex:w,collisionGroupID:S,overlapMode:h};for(let R=0;R<s.length;R+=4)I.insertCircle(k,s[R],s[R+1],s[R+2])}projectAndGetPerspectiveRatio(s,h,m,y){let w;return y?(w=[h,m,y(h,m),1],b.transformMat4(w,w,s)):(w=[h,m,0,1],xe(w,w,s)),{point:new b.pointGeometry((w[0]/w[3]+1)/2*this.transform.width+Me,(-w[1]/w[3]+1)/2*this.transform.height+Me),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w[3]*.5}}isOffscreen(s,h,m,y){return m<Me||s>=this.screenRightBoundary||y<Me||h>this.screenBottomBoundary}isInsideGrid(s,h,m,y){return m>=0&&s<this.gridRightBoundary&&y>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=b.identity([]);return b.translate(s,s,[-100,-100,0]),s}}function Te(g,s,h){return s*(b.EXTENT/(g.tileSize*Math.pow(2,h-g.tileID.overscaledZ)))}class Dt{constructor(s,h,m,y){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):y&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class ht{constructor(s,h,m,y,w){this.text=new Dt(s?s.text:null,h,m,w),this.icon=new Dt(s?s.icon:null,h,y,w)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class dt{constructor(s,h,m){this.text=s,this.icon=h,this.skipFade=m}}class xt{constructor(){this.invProjMatrix=b.create(),this.viewportMatrix=b.create(),this.circles=[]}}class ln{constructor(s,h,m,y,w){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=w}}class qn{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:m=>m.collisionGroupID===h}}return this.collisionGroups[s]}}function sn(g,s,h,m,y){const{horizontalAlign:w,verticalAlign:S}=b.getAnchorAlignment(g),I=-(w-.5)*s,k=-(S-.5)*h,R=b.evaluateVariableOffset(g,m);return new b.pointGeometry(I+R[0]*y,k+R[1]*y)}function an(g,s,h,m,y,w){const{x1:S,x2:I,y1:k,y2:R,anchorPointX:z,anchorPointY:L}=g,j=new b.pointGeometry(s,h);return m&&j._rotate(y?w:-w),{x1:S+j.x,y1:k+j.y,x2:I+j.x,y2:R+j.y,anchorPointX:z,anchorPointY:L}}class Zn{constructor(s,h,m,y,w){this.transform=s.clone(),this.terrain=h,this.collisionIndex=new je(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new qn(y),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,m,y){const w=m.getBucket(h),S=m.latestFeatureIndex;if(!w||!S||h.id!==w.layerIds[0])return;const I=m.collisionBoxArray,k=w.layers[0].layout,R=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),z=m.tileSize/b.EXTENT,L=this.transform.calculatePosMatrix(m.tileID.toUnwrapped()),j="map"===k.get("text-pitch-alignment"),Q="map"===k.get("text-rotation-alignment"),ee=Te(m,1,this.transform.zoom),Y=$r(L,j,Q,this.transform,ee);let ae=null;if(j){const ye=mi(L,j,Q,this.transform,ee);ae=b.multiply([],this.transform.labelPlaneMatrix,ye)}this.retainedQueryData[w.bucketInstanceId]=new ln(w.bucketInstanceId,S,w.sourceLayerIndex,w.index,m.tileID);const _e={bucket:w,layout:k,posMatrix:L,textLabelPlaneMatrix:Y,labelToScreenMatrix:ae,scale:R,textPixelRatio:z,holdingForFade:m.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:b.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(y)for(const ye of w.sortKeyRanges){const{sortKey:ie,symbolInstanceStart:we,symbolInstanceEnd:De}=ye;s.push({sortKey:ie,symbolInstanceStart:we,symbolInstanceEnd:De,parameters:_e})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:_e})}attemptAnchorPlacement(s,h,m,y,w,S,I,k,R,z,L,j,Q,ee,Y,ae){const _e=[j.textOffset0,j.textOffset1],ye=sn(s,m,y,_e,w),ie=this.collisionIndex.placeCollisionBox(an(h,ye.x,ye.y,S,I,this.transform.angle),L,k,R,z.predicate,ae);if((!Y||0!==this.collisionIndex.placeCollisionBox(an(Y,ye.x,ye.y,S,I,this.transform.angle),L,k,R,z.predicate,ae).box.length)&&ie.box.length>0){let we;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(we=this.prevPlacement.variableOffsets[j.crossTileID].anchor),0===j.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:_e,width:m,height:y,anchor:s,textBoxScale:w,prevAnchor:we},this.markUsedJustification(Q,s,j,ee),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,ee,j),this.placedOrientations[j.crossTileID]=ee),{shift:ye,placedGlyphBoxes:ie}}}placeLayerBucketPart(s,h,m){const{bucket:y,layout:w,posMatrix:S,textLabelPlaneMatrix:I,labelToScreenMatrix:k,textPixelRatio:R,holdingForFade:z,collisionBoxArray:L,partiallyEvaluatedTextSize:j,collisionGroup:Q}=s.parameters,ee=w.get("text-optional"),Y=w.get("icon-optional"),ae=b.getOverlapMode(w,"text-overlap","text-allow-overlap"),_e="always"===ae,ye=b.getOverlapMode(w,"icon-overlap","icon-allow-overlap"),ie="always"===ye,we="map"===w.get("text-rotation-alignment"),De="map"===w.get("text-pitch-alignment"),Se="none"!==w.get("icon-text-fit"),ke="viewport-y"===w.get("symbol-z-order"),Be=_e&&(ie||!y.hasIconData()||Y),Le=ie&&(_e||!y.hasTextData()||ee);!y.collisionArrays&&L&&y.deserializeCollisionBoxes(L);const Ne=(ze,ft)=>{if(h[ze.crossTileID])return;if(z)return void(this.placements[ze.crossTileID]=new dt(!1,!1,!1));let Pt=!1,Nt=!1,mt=!0,In=null,An={box:null,offscreen:null},Ht={box:null,offscreen:null},rn=null,Fn=null,yn=null,yo=0,Fo=0,vr=0;ft.textFeatureIndex?yo=ft.textFeatureIndex:ze.useRuntimeCollisionCircles&&(yo=ze.featureIndex),ft.verticalTextFeatureIndex&&(Fo=ft.verticalTextFeatureIndex);const ci=this.retainedQueryData[y.bucketInstanceId].tileID,Ii=this.terrain?(Fr,dr)=>this.terrain.getElevation(ci,Fr,dr):null;for(const Fr of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const dr=ft[Fr];dr&&(dr.elevation=Ii?Ii(dr.anchorPointX,dr.anchorPointY):0)}const Jo=ft.textBox;if(Jo){const Fr=On=>{let Zi=b.WritingMode.horizontal;if(y.allowVerticalPlacement&&!On&&this.prevPlacement){const Jr=this.prevPlacement.placedOrientations[ze.crossTileID];Jr&&(this.placedOrientations[ze.crossTileID]=Jr,Zi=Jr,this.markUsedOrientation(y,Zi,ze))}return Zi},dr=(On,Zi)=>{if(y.allowVerticalPlacement&&ze.numVerticalGlyphVertices>0&&ft.verticalTextBox){for(const Jr of y.writingModes)if(Jr===b.WritingMode.vertical?(An=Zi(),Ht=An):An=On(),An&&An.box&&An.box.length)break}else An=On()};if(w.get("text-variable-anchor")){let On=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ze.crossTileID]){const rr=this.prevPlacement.variableOffsets[ze.crossTileID];On.indexOf(rr.anchor)>0&&(On=On.filter(Qo=>Qo!==rr.anchor),On.unshift(rr.anchor))}const Zi=(rr,Qo,Wi)=>{const sh=rr.x2-rr.x1,ma=rr.y2-rr.y1,Hs=ze.textBoxScale,ah=Se&&"never"===ye?Qo:null;let xs={box:[],offscreen:!1};const wd="never"!==ae?2*On.length:On.length;for(let Mr=0;Mr<wd;++Mr){const tl=this.attemptAnchorPlacement(On[Mr%On.length],rr,sh,ma,Hs,we,De,R,S,Q,Mr>=On.length?ae:"never",ze,y,Wi,ah,Ii);if(tl&&(xs=tl.placedGlyphBoxes,xs&&xs.box&&xs.box.length)){Pt=!0,In=tl.shift;break}}return xs};dr(()=>Zi(Jo,ft.iconBox,b.WritingMode.horizontal),()=>{const rr=ft.verticalTextBox;return y.allowVerticalPlacement&&!(An&&An.box&&An.box.length)&&ze.numVerticalGlyphVertices>0&&rr?Zi(rr,ft.verticalIconBox,b.WritingMode.vertical):{box:null,offscreen:null}}),An&&(Pt=An.box,mt=An.offscreen);const Jr=Fr(An&&An.box);if(!Pt&&this.prevPlacement){const rr=this.prevPlacement.variableOffsets[ze.crossTileID];rr&&(this.variableOffsets[ze.crossTileID]=rr,this.markUsedJustification(y,rr.anchor,ze,Jr))}}else{const On=(Zi,Jr)=>{const rr=this.collisionIndex.placeCollisionBox(Zi,ae,R,S,Q.predicate,Ii);return rr&&rr.box&&rr.box.length&&(this.markUsedOrientation(y,Jr,ze),this.placedOrientations[ze.crossTileID]=Jr),rr};dr(()=>On(Jo,b.WritingMode.horizontal),()=>{const Zi=ft.verticalTextBox;return y.allowVerticalPlacement&&ze.numVerticalGlyphVertices>0&&Zi?On(Zi,b.WritingMode.vertical):{box:null,offscreen:null}}),Fr(An&&An.box&&An.box.length)}}if(rn=An,Pt=rn&&rn.box&&rn.box.length>0,mt=rn&&rn.offscreen,ze.useRuntimeCollisionCircles){const Fr=y.text.placedSymbolArray.get(ze.centerJustifiedTextSymbolIndex),dr=b.evaluateSizeForFeature(y.textSizeData,j,Fr),On=w.get("text-padding");Fn=this.collisionIndex.placeCollisionCircles(ae,Fr,y.lineVertexArray,y.glyphOffsetArray,dr,S,I,k,m,De,Q.predicate,ze.collisionCircleDiameter,On,Ii),Fn.circles.length&&Fn.collisionDetected&&!m&&b.warnOnce("Collisions detected, but collision boxes are not shown"),Pt=_e||Fn.circles.length>0&&!Fn.collisionDetected,mt=mt&&Fn.offscreen}if(ft.iconFeatureIndex&&(vr=ft.iconFeatureIndex),ft.iconBox){const Fr=dr=>{const On=Se&&In?an(dr,In.x,In.y,we,De,this.transform.angle):dr;return this.collisionIndex.placeCollisionBox(On,ye,R,S,Q.predicate,Ii)};Ht&&Ht.box&&Ht.box.length&&ft.verticalIconBox?(yn=Fr(ft.verticalIconBox),Nt=yn.box.length>0):(yn=Fr(ft.iconBox),Nt=yn.box.length>0),mt=mt&&yn.offscreen}const Oo=ee||0===ze.numHorizontalGlyphVertices&&0===ze.numVerticalGlyphVertices,Wl=Y||0===ze.numIconVertices;if(Oo||Wl?Wl?Oo||(Nt=Nt&&Pt):Pt=Nt&&Pt:Nt=Pt=Nt&&Pt,Pt&&rn&&rn.box&&this.collisionIndex.insertCollisionBox(rn.box,ae,w.get("text-ignore-placement"),y.bucketInstanceId,Ht&&Ht.box&&Fo?Fo:yo,Q.ID),Nt&&yn&&this.collisionIndex.insertCollisionBox(yn.box,ye,w.get("icon-ignore-placement"),y.bucketInstanceId,vr,Q.ID),Fn&&(Pt&&this.collisionIndex.insertCollisionCircles(Fn.circles,ae,w.get("text-ignore-placement"),y.bucketInstanceId,yo,Q.ID),m)){const Fr=y.bucketInstanceId;let dr=this.collisionCircleArrays[Fr];void 0===dr&&(dr=this.collisionCircleArrays[Fr]=new xt);for(let On=0;On<Fn.circles.length;On+=4)dr.circles.push(Fn.circles[On+0]),dr.circles.push(Fn.circles[On+1]),dr.circles.push(Fn.circles[On+2]),dr.circles.push(Fn.collisionDetected?1:0)}if(0===ze.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===y.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ze.crossTileID]=new dt(Pt||Be,Nt||Le,mt||y.justReloaded),h[ze.crossTileID]=!0};if(ke){if(0!==s.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const ze=y.getSortedSymbolIndexes(this.transform.angle);for(let ft=ze.length-1;ft>=0;--ft){const Pt=ze[ft];Ne(y.symbolInstances.get(Pt),y.collisionArrays[Pt])}}else for(let ze=s.symbolInstanceStart;ze<s.symbolInstanceEnd;ze++)Ne(y.symbolInstances.get(ze),y.collisionArrays[ze]);if(m&&y.bucketInstanceId in this.collisionCircleArrays){const ze=this.collisionCircleArrays[y.bucketInstanceId];b.invert(ze.invProjMatrix,S),ze.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(s,h,m,y){let w;w=y===b.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[b.getAnchorJustification(h)];const S=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const I of S)I>=0&&(s.text.placedSymbolArray.get(I).crossTileID=w>=0&&I!==w?0:m.crossTileID)}markUsedOrientation(s,h,m){const y=h===b.WritingMode.horizontal||h===b.WritingMode.horizontalOnly?h:0,w=h===b.WritingMode.vertical?h:0,S=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const I of S)s.text.placedSymbolArray.get(I).placedOrientation=y;m.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let m=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const y=h?h.symbolFadeChange(s):1,w=h?h.opacities:{},S=h?h.variableOffsets:{},I=h?h.placedOrientations:{};for(const k in this.placements){const R=this.placements[k],z=w[k];z?(this.opacities[k]=new ht(z,y,R.text,R.icon),m=m||R.text!==z.text.placed||R.icon!==z.icon.placed):(this.opacities[k]=new ht(null,y,R.text,R.icon,R.skipFade),m=m||R.text||R.icon)}for(const k in w){const R=w[k];if(!this.opacities[k]){const z=new ht(R,y,!1,!1);z.isHidden()||(this.opacities[k]=z,m=m||R.text.placed||R.icon.placed)}}for(const k in S)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=S[k]);for(const k in I)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=I[k]);if(h&&void 0===h.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=s:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const m={};for(const y of h){const w=y.getBucket(s);w&&y.latestFeatureIndex&&s.id===w.layerIds[0]&&this.updateBucketOpacities(w,m,y.collisionBoxArray)}}updateBucketOpacities(s,h,m){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const y=s.layers[0].layout,w=new ht(null,0,!1,!1,!0),S=y.get("text-allow-overlap"),I=y.get("icon-allow-overlap"),k=y.get("text-variable-anchor"),R="map"===y.get("text-rotation-alignment"),z="map"===y.get("text-pitch-alignment"),L="none"!==y.get("icon-text-fit"),j=new ht(null,0,S&&(I||!s.hasIconData()||y.get("icon-optional")),I&&(S||!s.hasTextData()||y.get("text-optional")),!0);!s.collisionArrays&&m&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(m);const Q=(ee,Y,ae)=>{for(let _e=0;_e<Y/4;_e++)ee.opacityVertexArray.emplaceBack(ae);ee.hasVisibleVertices=ee.hasVisibleVertices||ae!==sa};for(let ee=0;ee<s.symbolInstances.length;ee++){const Y=s.symbolInstances.get(ee),{numHorizontalGlyphVertices:ae,numVerticalGlyphVertices:_e,crossTileID:ye}=Y;let ie=this.opacities[ye];h[ye]?ie=w:ie||(ie=j,this.opacities[ye]=ie),h[ye]=!0;const we=Y.numIconVertices>0,De=this.placedOrientations[Y.crossTileID],Se=De===b.WritingMode.vertical,ke=De===b.WritingMode.horizontal||De===b.WritingMode.horizontalOnly;if(ae>0||_e>0){const Be=$a(ie.text);Q(s.text,ae,Se?sa:Be),Q(s.text,_e,ke?sa:Be);const Le=ie.text.isHidden();[Y.rightJustifiedTextSymbolIndex,Y.centerJustifiedTextSymbolIndex,Y.leftJustifiedTextSymbolIndex].forEach(ft=>{ft>=0&&(s.text.placedSymbolArray.get(ft).hidden=Le||Se?1:0)}),Y.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(Y.verticalPlacedTextSymbolIndex).hidden=Le||ke?1:0);const Ne=this.variableOffsets[Y.crossTileID];Ne&&this.markUsedJustification(s,Ne.anchor,Y,De);const ze=this.placedOrientations[Y.crossTileID];ze&&(this.markUsedJustification(s,"left",Y,ze),this.markUsedOrientation(s,ze,Y))}if(we){const Be=$a(ie.icon),Le=!(L&&Y.verticalPlacedIconSymbolIndex&&Se);Y.placedIconSymbolIndex>=0&&(Q(s.icon,Y.numIconVertices,Le?Be:sa),s.icon.placedSymbolArray.get(Y.placedIconSymbolIndex).hidden=ie.icon.isHidden()),Y.verticalPlacedIconSymbolIndex>=0&&(Q(s.icon,Y.numVerticalIconVertices,Le?sa:Be),s.icon.placedSymbolArray.get(Y.verticalPlacedIconSymbolIndex).hidden=ie.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Be=s.collisionArrays[ee];if(Be){let Le=new b.pointGeometry(0,0);if(Be.textBox||Be.verticalTextBox){let ze=!0;if(k){const ft=this.variableOffsets[ye];ft?(Le=sn(ft.anchor,ft.width,ft.height,ft.textOffset,ft.textBoxScale),R&&Le._rotate(z?this.transform.angle:-this.transform.angle)):ze=!1}Be.textBox&&lr(s.textCollisionBox.collisionVertexArray,ie.text.placed,!ze||Se,Le.x,Le.y),Be.verticalTextBox&&lr(s.textCollisionBox.collisionVertexArray,ie.text.placed,!ze||ke,Le.x,Le.y)}const Ne=Boolean(!ke&&Be.verticalIconBox);Be.iconBox&&lr(s.iconCollisionBox.collisionVertexArray,ie.icon.placed,Ne,L?Le.x:0,L?Le.y:0),Be.verticalIconBox&&lr(s.iconCollisionBox.collisionVertexArray,ie.icon.placed,!Ne,L?Le.x:0,L?Le.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const ee=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=ee.invProjMatrix,s.placementViewportMatrix=ee.viewportMatrix,s.collisionCircleArray=ee.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return 0===this.fadeDuration?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const m=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*m>s}setStale(){this.stale=!0}}function lr(g,s,h,m,y){g.emplaceBack(s?1:0,h?1:0,m||0,y||0),g.emplaceBack(s?1:0,h?1:0,m||0,y||0),g.emplaceBack(s?1:0,h?1:0,m||0,y||0),g.emplaceBack(s?1:0,h?1:0,m||0,y||0)}const ai=Math.pow(2,25),Pr=Math.pow(2,24),Va=Math.pow(2,17),kf=Math.pow(2,16),Pf=Math.pow(2,9),Ua=Math.pow(2,8),Fu=Math.pow(2,1);function $a(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const s=g.placed?1:0,h=Math.floor(127*g.opacity);return h*ai+s*Pr+h*Va+s*kf+h*Pf+s*Ua+h*Fu+s}const sa=0;class Ou{constructor(s){this._sortAcrossTiles="viewport-y"!==s.layout.get("symbol-z-order")&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,h,m,y,w){const S=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(S,y,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((I,k)=>I.sortKey-k.sortKey));this._currentPartIndex<S.length;)if(h.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,w())return!0;return!1}}class Cr{constructor(s,h,m,y,w,S,I,k){this.placement=new Zn(s,h,S,I,k),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(s,h,m){const y=b.exported.now(),w=()=>{const S=b.exported.now()-y;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=h[s[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if("symbol"===S.type&&(!S.minzoom||S.minzoom<=I)&&(!S.maxzoom||S.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new Ou(S)),this._inProgressLayer.continuePlacement(m[S.source],this.placement,this._showCollisionBoxes,S,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Ol=512/b.EXTENT/2;class Zh{constructor(s,h,m){this.tileID=s,this.bucketInstanceId=m,this._symbolsByKey={};const y=new Map;for(let w=0;w<h.length;w++){const S=h.get(w),I=S.key,k=y.get(I);k?k.push(S):y.set(I,[S])}for(const[w,S]of y){const I={positions:S.map(k=>({x:Math.floor(k.anchorX*Ol),y:Math.floor(k.anchorY*Ol)})),crossTileIDs:S.map(k=>k.crossTileID)};if(I.positions.length>128){const k=new b.KDBush(I.positions,R=>R.x,R=>R.y,16,Uint16Array);delete k.points,delete I.positions,I.index=k}this._symbolsByKey[w]=I}}getScaledCoordinates(s,h){const{x:m,y,z:w}=this.tileID.canonical,{x:S,y:I,z:k}=h.canonical,R=Ol/Math.pow(2,k-w),z=(I*b.EXTENT+s.anchorY)*R,L=y*b.EXTENT*Ol;return{x:Math.floor((S*b.EXTENT+s.anchorX)*R-m*b.EXTENT*Ol),y:Math.floor(z-L)}}findMatches(s,h,m){const y=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let w=0;w<s.length;w++){const S=s.get(w);if(S.crossTileID)continue;const I=this._symbolsByKey[S.key];if(!I)continue;const k=this.getScaledCoordinates(S,h);if(I.index){const R=I.index.range(k.x-y,k.y-y,k.x+y,k.y+y).sort();for(const z of R){const L=I.crossTileIDs[z];if(!m[L]){m[L]=!0,S.crossTileID=L;break}}}else if(I.positions)for(let R=0;R<I.positions.length;R++){const z=I.positions[R],L=I.crossTileIDs[R];if(Math.abs(z.x-k.x)<=y&&Math.abs(z.y-k.y)<=y&&!m[L]){m[L]=!0,S.crossTileID=L;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class Ll{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class zn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(0!==h)for(const m in this.indexes){const y=this.indexes[m],w={};for(const S in y){const I=y[S];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+h),w[I.tileID.key]=I}this.indexes[m]=w}this.lng=s}addBucket(s,h,m){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let w=0;w<h.symbolInstances.length;w++)h.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const y=this.usedCrossTileIDs[s.overscaledZ];for(const w in this.indexes){const S=this.indexes[w];if(Number(w)>s.overscaledZ)for(const I in S){const k=S[I];k.tileID.isChildOf(s)&&k.findMatches(h.symbolInstances,s,y)}else{const I=S[s.scaledTo(Number(w)).key];I&&I.findMatches(h.symbolInstances,s,y)}}for(let w=0;w<h.symbolInstances.length;w++){const S=h.symbolInstances.get(w);S.crossTileID||(S.crossTileID=m.generate(),y[S.crossTileID]=!0)}return void 0===this.indexes[s.overscaledZ]&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Zh(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const m of h.getCrossTileIDsLists())for(const y of m)delete this.usedCrossTileIDs[s][y]}removeStaleBuckets(s){let h=!1;for(const m in this.indexes){const y=this.indexes[m];for(const w in y)s[y[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[w]),delete y[w],h=!0)}return h}}class Kn{constructor(){this.layerIndexes={},this.crossTileIDs=new Ll,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,m){let y=this.layerIndexes[s.id];void 0===y&&(y=this.layerIndexes[s.id]=new zn);let w=!1;const S={};y.handleWrapJump(m);for(const I of h){const k=I.getBucket(s);k&&s.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(I.tileID,k,this.crossTileIDs)&&(w=!0),S[k.bucketInstanceId]=!0)}return y.removeStaleBuckets(S)&&(w=!0),w}pruneUnusedLayers(s){const h={};s.forEach(m=>{h[m]=!0});for(const m in this.layerIndexes)h[m]||delete this.layerIndexes[m]}}const Mn=(g,s)=>b.emitValidationErrors(g,s&&s.filter(h=>"source.canvas"!==h.identifier)),Lu=b.pick(pn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Rf=b.pick(pn,["setCenter","setZoom","setBearing","setPitch"]),Jn=function(){const g={},s=b.spec.$version;for(const h in b.spec.$root){const m=b.spec.$root[h];if(m.required){let y=null;y="version"===h?s:"array"===m.type?[]:{},null!=y&&(g[h]=y)}}return g}();class Mt extends b.Evented{constructor(s,h={}){super(),this.map=s,this.dispatcher=new pi(Fc(),this,s._getMapId()),this.imageManager=new It,this.imageManager.setEventedParent(this),this.glyphManager=new Bn(s._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Rc(256,512),this.crossTileSymbolIndex=new Kn,this._spritesImagesIds={},this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new b.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",b.getReferrer());const m=this;this._rtlTextPluginCallback=Mt.registerForPluginStateChange(y=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(w,S)=>{if(b.triggerPluginCompletionEvent(w),S&&S.every(I=>I))for(const I in m.sourceCaches)m.sourceCaches[I].reload()})}),this.on("data",y=>{if("source"!==y.dataType||"metadata"!==y.sourceDataType)return;const w=this.sourceCaches[y.sourceId];if(!w)return;const S=w.getSource();if(S&&S.vectorLayerIds)for(const I in this._layers){const k=this._layers[I];k.source===S.id&&this._validateLayer(k)}})}loadURL(s,h={},m){this.fire(new b.Event("dataloading",{dataType:"style"})),h.validate="boolean"!=typeof h.validate||h.validate;const y=this.map._requestManager.transformRequest(s,fn.Style);this._request=b.getJSON(y,(w,S)=>{this._request=null,w?this.fire(new b.ErrorEvent(w)):S&&this._load(S,h,m)})}loadJSON(s,h={},m){this.fire(new b.Event("dataloading",{dataType:"style"})),this._request=b.exported.frame(()=>{this._request=null,h.validate=!1!==h.validate,this._load(s,h,m)})}loadEmpty(){this.fire(new b.Event("dataloading",{dataType:"style"})),this._load(Jn,{validate:!1})}_load(s,h,m){const y=h.transformStyle?h.transformStyle(m,s):s;if(h.validate&&Mn(this,b.validateStyle(y)))return;this._loaded=!0,this.stylesheet=y;for(const S in y.sources)this.addSource(S,y.sources[S],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs);const w=Rl(this.stylesheet.layers);this._order=w.map(S=>S.id),this._layers={},this._serializedLayers={};for(let S of w)S=b.createStyleLayer(S),S.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S,this._serializedLayers[S.id]=S.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Oa(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain),this.fire(new b.Event("data",{dataType:"style"})),this.fire(new b.Event("style.load"))}_loadSprite(s,h=!1,m){this.imageManager.setLoaded(!1),this._spriteRequest=function(y,w,S,I){const k=hs(y),R=S>1?"@2x":"";let z;const L=[],j=[],Q={},ee={};for(const{id:ae,url:_e}of k){const ye=L.push(b.getJSON(w.transformRequest(w.normalizeSpriteURL(_e,R,".json"),fn.SpriteJSON),(we,De)=>{L.splice(ye,1),z||(z=we,Q[ae]=De,Y())})),ie=j.push(si.getImage(w.transformRequest(w.normalizeSpriteURL(_e,R,".png"),fn.SpriteImage),(we,De)=>{j.splice(ie,1),z||(z=we,ee[ae]=De,Y())}))}function Y(){const ae=Object.values(Q).length,_e=Object.values(ee).length;if(z)I(z);else if(k.length===ae&&ae===_e){const ye={};for(const ie in Q){ye[ie]={};const we=b.exported.getImageCanvasContext(ee[ie]),De=Q[ie];for(const Se in De){const{width:ke,height:Be,x:Le,y:Ne,sdf:ze,pixelRatio:ft,stretchX:Pt,stretchY:Nt,content:mt}=De[Se];ye[ie][Se]={data:null,pixelRatio:ft,sdf:ze,stretchX:Pt,stretchY:Nt,content:mt,spriteData:{width:ke,height:Be,x:Le,y:Ne,context:we}}}}I(null,ye)}}return{cancel(){if(L.length)for(const ae of L)ae.cancel(),L.splice(L.indexOf(ae),1);if(j.length)for(const ae of j)ae.cancel(),j.splice(j.indexOf(ae),1)}}}(s,this.map._requestManager,this.map.getPixelRatio(),(y,w)=>{if(this._spriteRequest=null,y)this.fire(new b.ErrorEvent(y));else if(w)for(const S in w){this._spritesImagesIds[S]=[];const I=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter(k=>!(k in w)):[];for(const k of I)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in w[S]){const R="default"===S?k:`${S}:${k}`;this._spritesImagesIds[S].push(R),R in this.imageManager.images?this.imageManager.updateImage(R,w[S][k],!1):this.imageManager.addImage(R,w[S][k]),h&&(this._changedImages[R]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new b.Event("data",{dataType:"style"})),m&&m(y)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new b.Event("data",{dataType:"style"}))}_validateLayer(s){const h=this.sourceCaches[s.source];if(!h)return;const m=s.sourceLayer;if(!m)return;const y=h.getSource();("geojson"===y.type||y.vectorLayerIds&&-1===y.vectorLayerIds.indexOf(m))&&this.fire(new b.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${y.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const h=[];for(const m of s){const y=this._layers[m];"custom"!==y.type&&h.push(y.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const h=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(y.length||w.length)&&this._updateWorkerLayers(y,w);for(const S in this._updatedSources){const I=this._updatedSources[S];if("reload"===I)this._reloadSource(S);else{if("clear"!==I)throw new Error(`Invalid action ${I}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const m={};for(const y in this.sourceCaches){const w=this.sourceCaches[y];m[y]=w.used,w.used=!1}for(const y of this._order){const w=this._layers[y];w.recalculate(s,this._availableImages),!w.isHidden(s.zoom)&&w.source&&(this.sourceCaches[w.source].used=!0)}for(const y in m){const w=this.sourceCaches[y];m[y]!==w.used&&w.fire(new b.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(s),this.z=s.zoom,h&&this.fire(new b.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,h={}){if(this._checkLoaded(),s=h.transformStyle?h.transformStyle(this.serialize(),s):s,Mn(this,b.validateStyle(s)))return!1;(s=b.clone$1(s)).layers=Rl(s.layers);const m=function(w,S){if(!w)return[{command:pn.setStyle,args:[S]}];let I=[];try{if(!Zt(w.version,S.version))return[{command:pn.setStyle,args:[S]}];Zt(w.center,S.center)||I.push({command:pn.setCenter,args:[S.center]}),Zt(w.zoom,S.zoom)||I.push({command:pn.setZoom,args:[S.zoom]}),Zt(w.bearing,S.bearing)||I.push({command:pn.setBearing,args:[S.bearing]}),Zt(w.pitch,S.pitch)||I.push({command:pn.setPitch,args:[S.pitch]}),Zt(w.sprite,S.sprite)||I.push({command:pn.setSprite,args:[S.sprite]}),Zt(w.glyphs,S.glyphs)||I.push({command:pn.setGlyphs,args:[S.glyphs]}),Zt(w.transition,S.transition)||I.push({command:pn.setTransition,args:[S.transition]}),Zt(w.light,S.light)||I.push({command:pn.setLight,args:[S.light]});const k={},R=[];!function(L,j,Q,ee){let Y;for(Y in j=j||{},L=L||{})Object.prototype.hasOwnProperty.call(L,Y)&&(Object.prototype.hasOwnProperty.call(j,Y)||Oc(Y,Q,ee));for(Y in j)Object.prototype.hasOwnProperty.call(j,Y)&&(Object.prototype.hasOwnProperty.call(L,Y)?Zt(L[Y],j[Y])||("geojson"===L[Y].type&&"geojson"===j[Y].type&&Ru(L,j,Y)?Q.push({command:pn.setGeoJSONSourceData,args:[Y,j[Y].data]}):za(Y,j,Q,ee)):ia(Y,j,Q))}(w.sources,S.sources,R,k);const z=[];w.layers&&w.layers.forEach(L=>{k[L.source]?I.push({command:pn.removeLayer,args:[L.id]}):z.push(L)}),I=I.concat(R),function(L,j,Q){j=j||[];const ee=(L=L||[]).map(Ba),Y=j.map(Ba),ae=L.reduce(Sn,{}),_e=j.reduce(Sn,{}),ye=ee.slice(),ie=Object.create(null);let we,De,Se,ke,Be,Le,Ne;for(we=0,De=0;we<ee.length;we++)Se=ee[we],Object.prototype.hasOwnProperty.call(_e,Se)?De++:(Q.push({command:pn.removeLayer,args:[Se]}),ye.splice(ye.indexOf(Se,De),1));for(we=0,De=0;we<Y.length;we++)Se=Y[Y.length-1-we],ye[ye.length-1-we]!==Se&&(Object.prototype.hasOwnProperty.call(ae,Se)?(Q.push({command:pn.removeLayer,args:[Se]}),ye.splice(ye.lastIndexOf(Se,ye.length-De),1)):De++,Le=ye[ye.length-we],Q.push({command:pn.addLayer,args:[_e[Se],Le]}),ye.splice(ye.length-we,0,Se),ie[Se]=!0);for(we=0;we<Y.length;we++)if(Se=Y[we],ke=ae[Se],Be=_e[Se],!ie[Se]&&!Zt(ke,Be))if(Zt(ke.source,Be.source)&&Zt(ke["source-layer"],Be["source-layer"])&&Zt(ke.type,Be.type)){for(Ne in oa(ke.layout,Be.layout,Q,Se,null,pn.setLayoutProperty),oa(ke.paint,Be.paint,Q,Se,null,pn.setPaintProperty),Zt(ke.filter,Be.filter)||Q.push({command:pn.setFilter,args:[Se,Be.filter]}),Zt(ke.minzoom,Be.minzoom)&&Zt(ke.maxzoom,Be.maxzoom)||Q.push({command:pn.setLayerZoomRange,args:[Se,Be.minzoom,Be.maxzoom]}),ke)Object.prototype.hasOwnProperty.call(ke,Ne)&&"layout"!==Ne&&"paint"!==Ne&&"filter"!==Ne&&"metadata"!==Ne&&"minzoom"!==Ne&&"maxzoom"!==Ne&&(0===Ne.indexOf("paint.")?oa(ke[Ne],Be[Ne],Q,Se,Ne.slice(6),pn.setPaintProperty):Zt(ke[Ne],Be[Ne])||Q.push({command:pn.setLayerProperty,args:[Se,Ne,Be[Ne]]}));for(Ne in Be)Object.prototype.hasOwnProperty.call(Be,Ne)&&!Object.prototype.hasOwnProperty.call(ke,Ne)&&"layout"!==Ne&&"paint"!==Ne&&"filter"!==Ne&&"metadata"!==Ne&&"minzoom"!==Ne&&"maxzoom"!==Ne&&(0===Ne.indexOf("paint.")?oa(ke[Ne],Be[Ne],Q,Se,Ne.slice(6),pn.setPaintProperty):Zt(ke[Ne],Be[Ne])||Q.push({command:pn.setLayerProperty,args:[Se,Ne,Be[Ne]]}))}else Q.push({command:pn.removeLayer,args:[Se]}),Le=ye[ye.lastIndexOf(Se)+1],Q.push({command:pn.addLayer,args:[Be,Le]})}(z,S.layers,I)}catch(k){console.warn("Unable to compute style diff:",k),I=[{command:pn.setStyle,args:[S]}]}return I}(this.serialize(),s).filter(w=>!(w.command in Rf));if(0===m.length)return!1;const y=m.filter(w=>!(w.command in Lu));if(y.length>0)throw new Error(`Unimplemented: ${y.map(w=>w.command).join(", ")}.`);return m.forEach(w=>{"setTransition"!==w.command&&this[w.command].apply(this,w.args)}),this.stylesheet=s,!0}addImage(s,h){if(this.getImage(s))return this.fire(new b.ErrorEvent(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,h),this._afterImageUpdated(s)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new b.ErrorEvent(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new b.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,h,m={}){if(this._checkLoaded(),void 0!==this.sourceCaches[s])throw new Error(`Source "${s}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(b.validateStyle.source,`sources.${s}`,h,null,m))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const y=this.sourceCaches[s]=new At(s,h,this.dispatcher);y.style=this,y.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:y.serialize(),sourceId:s})),y.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),void 0===this.sourceCaches[s])throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===s)return this.fire(new b.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${m}" is using it.`)));const h=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],h.fire(new b.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,h){if(this._checkLoaded(),void 0===this.sourceCaches[s])throw new Error(`There is no source with this ID=${s}`);const m=this.sourceCaches[s].getSource();if("geojson"!==m.type)throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(h),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,h,m={}){this._checkLoaded();const y=s.id;if(this.getLayer(y))return void this.fire(new b.ErrorEvent(new Error(`Layer "${y}" already exists on this map.`)));let w;if("custom"===s.type){if(Mn(this,b.validateCustomStyleLayer(s)))return;w=b.createStyleLayer(s)}else{if("object"==typeof s.source&&(this.addSource(y,s.source),s=b.clone$1(s),s=b.extend(s,{source:y})),this._validate(b.validateStyle.layer,`layers.${y}`,s,{arrayIndex:-1},m))return;w=b.createStyleLayer(s),this._validateLayer(w),w.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[w.id]=w.serialize()}const S=h?this._order.indexOf(h):this._order.length;if(h&&-1===S)this.fire(new b.ErrorEvent(new Error(`Cannot add layer "${y}" before non-existing layer "${h}".`)));else{if(this._order.splice(S,0,y),this._layerOrderChanged=!0,this._layers[y]=w,this._removedLayers[y]&&w.source&&"custom"!==w.type){const I=this._removedLayers[y];delete this._removedLayers[y],I.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",this.sourceCaches[w.source].pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map)}}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new b.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const m=this._order.indexOf(s);this._order.splice(m,1);const y=h?this._order.indexOf(h):this._order.length;h&&-1===y?this.fire(new b.ErrorEvent(new Error(`Cannot move layer "${s}" before non-existing layer "${h}".`))):(this._order.splice(y,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new b.ErrorEvent(new Error(`Cannot remove non-existing layer "${s}".`)));h.setEventedParent(null);const m=this._order.indexOf(s);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map)}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,h,m){this._checkLoaded();const y=this.getLayer(s);y?y.minzoom===h&&y.maxzoom===m||(null!=h&&(y.minzoom=h),null!=m&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new b.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,h,m={}){this._checkLoaded();const y=this.getLayer(s);if(y){if(!Zt(y.filter,h))return null==h?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(b.validateStyle.filter,`layers.${y.id}.filter`,h,null,m)||(y.filter=b.clone$1(h),this._updateLayer(y)))}else this.fire(new b.ErrorEvent(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return b.clone$1(this.getLayer(s).filter)}setLayoutProperty(s,h,m,y={}){this._checkLoaded();const w=this.getLayer(s);w?Zt(w.getLayoutProperty(h),m)||(w.setLayoutProperty(h,m,y),this._updateLayer(w)):this.fire(new b.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,h){const m=this.getLayer(s);if(m)return m.getLayoutProperty(h);this.fire(new b.ErrorEvent(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,h,m,y={}){this._checkLoaded();const w=this.getLayer(s);w?Zt(w.getPaintProperty(h),m)||(w.setPaintProperty(h,m,y)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new b.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,h){return this.getLayer(s).getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const m=s.source,y=s.sourceLayer,w=this.sourceCaches[m];if(void 0===w)return void this.fire(new b.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const S=w.getSource().type;"geojson"===S&&y?this.fire(new b.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==S||y?(void 0===s.id&&this.fire(new b.ErrorEvent(new Error("The feature id parameter must be provided."))),w.setFeatureState(y,s.id,h)):this.fire(new b.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,h){this._checkLoaded();const m=s.source,y=this.sourceCaches[m];if(void 0===y)return void this.fire(new b.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const w=y.getSource().type,S="vector"===w?s.sourceLayer:void 0;"vector"!==w||S?h&&"string"!=typeof s.id&&"number"!=typeof s.id?this.fire(new b.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(S,s.id,h):this.fire(new b.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const h=s.source,m=s.sourceLayer,y=this.sourceCaches[h];if(void 0!==y)return"vector"!==y.getSource().type||m?(void 0===s.id&&this.fire(new b.ErrorEvent(new Error("The feature id parameter must be provided."))),y.getFeatureState(m,s.id)):void this.fire(new b.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new b.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return b.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return b.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:b.mapObject(this.sourceCaches,s=>s.serialize()),layers:this._serializeLayers(this._order)},s=>void 0!==s)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&"raster"!==this.sourceCaches[s.source].getSource().type&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(s){const h=S=>"fill-extrusion"===this._layers[S].type,m={},y=[];for(let S=this._order.length-1;S>=0;S--){const I=this._order[S];if(h(I)){m[I]=S;for(const k of s){const R=k[I];if(R)for(const z of R)y.push(z)}}}y.sort((S,I)=>I.intersectionZ-S.intersectionZ);const w=[];for(let S=this._order.length-1;S>=0;S--){const I=this._order[S];if(h(I))for(let k=y.length-1;k>=0;k--){const R=y[k].feature;if(m[R.layer.id]<S)break;w.push(R),y.pop()}else for(const k of s){const R=k[I];if(R)for(const z of R)w.push(z.feature)}}return w}queryRenderedFeatures(s,h,m){h&&h.filter&&this._validate(b.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);const y={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new b.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const S of h.layers){const I=this._layers[S];if(!I)return this.fire(new b.ErrorEvent(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];y[I.source]=!0}}const w=[];h.availableImages=this._availableImages;for(const S in this.sourceCaches)h.layers&&!y[S]||w.push(rt(this.sourceCaches[S],this._layers,this._serializedLayers,s,h,m));return this.placement&&w.push(function(S,I,k,R,z,L,j){const Q={},ee=L.queryRenderedSymbols(R),Y=[];for(const ae of Object.keys(ee).map(Number))Y.push(j[ae]);Y.sort(Jt);for(const ae of Y){const _e=ae.featureIndex.lookupSymbolFeatures(ee[ae.bucketInstanceId],I,ae.bucketIndex,ae.sourceLayerIndex,z.filter,z.layers,z.availableImages,S);for(const ye in _e){const ie=Q[ye]=Q[ye]||[],we=_e[ye];we.sort((De,Se)=>{const ke=ae.featureSortOrder;if(ke){const Be=ke.indexOf(De.featureIndex);return ke.indexOf(Se.featureIndex)-Be}return Se.featureIndex-De.featureIndex});for(const De of we)ie.push(De)}}for(const ae in Q)Q[ae].forEach(_e=>{const ye=_e.feature,ie=k[S[ae].source].getFeatureState(ye.layer["source-layer"],ye.id);ye.source=ye.layer.source,ye.layer["source-layer"]&&(ye.sourceLayer=ye.layer["source-layer"]),ye.state=ie});return Q}(this._layers,this._serializedLayers,this.sourceCaches,s,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(s,h){h&&h.filter&&this._validate(b.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);const m=this.sourceCaches[s];return m?function(y,w){const S=y.getRenderableIds().map(R=>y.getTileByID(R)),I=[],k={};for(let R=0;R<S.length;R++){const z=S[R],L=z.tileID.canonical.key;k[L]||(k[L]=!0,z.querySourceFeatures(I,w))}return I}(m,h):[]}addSourceType(s,h,m){return Mt.getSourceType(s)?m(new Error(`A source type called "${s}" already exists.`)):(Mt.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const S in s)if(!Zt(s[S],m[S])){y=!0;break}if(!y)return;const w={now:b.exported.now(),transition:b.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,h),this.light.updateTransitions(w)}_validate(s,h,m,y,w={}){return(!w||!1!==w.validate)&&Mn(this,s.call(b.validateStyle,b.extend({key:h,style:this.serialize(),value:m,styleSpec:b.spec},y)))}_remove(s=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),b.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const m=this.sourceCaches[h];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const h in this.sourceCaches)this.sourceCaches[h].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,h,m,y,w=!1){let S=!1,I=!1;const k={};for(const R of this._order){const z=this._layers[R];if("symbol"!==z.type)continue;if(!k[z.source]){const j=this.sourceCaches[z.source];k[z.source]=j.getRenderableIds(!0).map(Q=>j.getTileByID(Q)).sort((Q,ee)=>ee.tileID.overscaledZ-Q.tileID.overscaledZ||(Q.tileID.isLessThan(ee.tileID)?-1:1))}const L=this.crossTileSymbolIndex.addLayer(z,k[z.source],s.center.lng);S=S||L}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((w=w||this._layerOrderChanged||0===m)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(b.exported.now(),s.zoom))&&(this.pauseablePlacement=new Cr(s,this.map.terrain,this._order,w,h,m,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(b.exported.now()),I=!0),S&&this.pauseablePlacement.placement.setStale()),I||S)for(const R of this._order){const z=this._layers[R];"symbol"===z.type&&this.placement.updateLayerOpacities(z,k[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(b.exported.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h,m){this.imageManager.getImages(h.icons,m),this._updateTilesForChangedImages();const y=this.sourceCaches[h.source];y&&y.setDependencies(h.tileID.key,h.type,h.icons)}getGlyphs(s,h,m){this.glyphManager.getGlyphs(h.stacks,m);const y=this.sourceCaches[h.source];y&&y.setDependencies(h.tileID.key,h.type,[""])}getResource(s,h,m){return b.makeRequest(h,m)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,h={}){this._checkLoaded(),s&&this._validate(b.validateStyle.glyphs,"glyphs",s,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,h,m={},y){this._checkLoaded();const w=[{id:s,url:h}],S=[...hs(this.stylesheet.sprite),...w];this._validate(b.validateStyle.sprite,"sprite",S,null,m)||(this.stylesheet.sprite=S,this._loadSprite(w,!0,y))}removeSprite(s){this._checkLoaded();const h=hs(this.stylesheet.sprite);if(h.find(m=>m.id===s)){if(this._spritesImagesIds[s])for(const m of this._spritesImagesIds[s])this.imageManager.removeImage(m),this._changedImages[m]=!0;h.splice(h.findIndex(m=>m.id===s),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new b.Event("data",{dataType:"style"}))}else this.fire(new b.ErrorEvent(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return hs(this.stylesheet.sprite)}setSprite(s,h={},m){this._checkLoaded(),s&&this._validate(b.validateStyle.sprite,"sprite",s,null,h)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,m):(this._unloadSprite(),m(null)))}}Mt.getSourceType=function(g){return Pl[g]},Mt.setSourceType=function(g,s){Pl[g]=s},Mt.registerForPluginStateChange=b.registerForPluginStateChange;var Nl=b.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ff="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const nt={prelude:wn("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}"),background:wn("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:wn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:wn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:wn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:wn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:wn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:wn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:wn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:wn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:wn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:wn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:wn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:wn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:wn("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat baseDelta=10.0;float ele=get_elevation(a_centroid);\n#else\nfloat baseDelta=0.0;float ele=0.0;\n#endif\nbase=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:wn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat baseDelta=10.0;float ele=get_elevation(a_centroid);\n#else\nfloat baseDelta=0.0;float ele=0.0;\n#endif\nbase=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:wn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:wn("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:wn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:wn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:wn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:wn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:wn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:wn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:wn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:wn("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ff),terrainDepth:wn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ff),terrainCoords:wn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ff)};function wn(g,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=s.match(/attribute ([\w]+) ([\w]+)/g),y=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=w?w.concat(y):y,I={};return{fragmentSource:g=g.replace(h,(k,R,z,L,j)=>(I[j]=!0,"define"===R?`\n#ifndef HAS_UNIFORM_u_${j}\nvarying ${z} ${L} ${j};\n#else\nuniform ${z} ${L} u_${j};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${j}\n    ${z} ${L} ${j} = u_${j};\n#endif\n`)),vertexSource:s=s.replace(h,(k,R,z,L,j)=>{const Q="float"===L?"vec2":"vec4",ee=j.match(/color/)?"color":Q;return I[j]?"define"===R?`\n#ifndef HAS_UNIFORM_u_${j}\nuniform lowp float u_${j}_t;\nattribute ${z} ${Q} a_${j};\nvarying ${z} ${L} ${j};\n#else\nuniform ${z} ${L} u_${j};\n#endif\n`:"vec4"===ee?`\n#ifndef HAS_UNIFORM_u_${j}\n    ${j} = a_${j};\n#else\n    ${z} ${L} ${j} = u_${j};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${j}\n    ${j} = unpack_mix_${ee}(a_${j}, u_${j}_t);\n#else\n    ${z} ${L} ${j} = u_${j};\n#endif\n`:"define"===R?`\n#ifndef HAS_UNIFORM_u_${j}\nuniform lowp float u_${j}_t;\nattribute ${z} ${Q} a_${j};\n#else\nuniform ${z} ${L} u_${j};\n#endif\n`:"vec4"===ee?`\n#ifndef HAS_UNIFORM_u_${j}\n    ${z} ${L} ${j} = a_${j};\n#else\n    ${z} ${L} ${j} = u_${j};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${j}\n    ${z} ${L} ${j} = unpack_mix_${ee}(a_${j}, u_${j}_t);\n#else\n    ${z} ${L} ${j} = u_${j};\n#endif\n`}),staticAttributes:m,staticUniforms:S}}class $t{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,h,m,y,w,S,I,k,R){this.context=s;let z=this.boundPaintVertexBuffers.length!==y.length;for(let L=0;!z&&L<y.length;L++)this.boundPaintVertexBuffers[L]!==y[L]&&(z=!0);s.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===m&&!z&&this.boundIndexBuffer===w&&this.boundVertexOffset===S&&this.boundDynamicVertexBuffer===I&&this.boundDynamicVertexBuffer2===k&&this.boundDynamicVertexBuffer3===R?(s.bindVertexArrayOES.set(this.vao),I&&I.bind(),w&&w.dynamicDraw&&w.bind(),k&&k.bind(),R&&R.bind()):this.freshBind(h,m,y,w,S,I,k,R)}freshBind(s,h,m,y,w,S,I,k){let R;const z=s.numAttributes,L=this.context,j=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=I,this.boundDynamicVertexBuffer3=k;else{R=L.currentNumAttributes||0;for(let Q=z;Q<R;Q++)j.disableVertexAttribArray(Q)}h.enableAttributes(j,s);for(const Q of m)Q.enableAttributes(j,s);S&&S.enableAttributes(j,s),I&&I.enableAttributes(j,s),k&&k.enableAttributes(j,s),h.bind(),h.setVertexAttribPointers(j,s,w);for(const Q of m)Q.bind(),Q.setVertexAttribPointers(j,s,w);S&&(S.bind(),S.setVertexAttribPointers(j,s,w)),y&&y.bind(),I&&(I.bind(),I.setVertexAttribPointers(j,s,w)),k&&(k.bind(),k.setVertexAttribPointers(j,s,w)),L.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function gn(g){const s=[];for(let h=0;h<g.length;h++){if(null===g[h])continue;const m=g[h].split(" ");s.push(m.pop())}return s}class Wh{constructor(s,h,m,y,w,S,I){const k=s.gl;this.program=k.createProgram();const R=gn(m.staticAttributes),z=y?y.getBinderAttributes():[],L=R.concat(z),j=nt.prelude.staticUniforms?gn(nt.prelude.staticUniforms):[],Q=m.staticUniforms?gn(m.staticUniforms):[],ee=y?y.getBinderUniforms():[],Y=j.concat(Q).concat(ee),ae=[];for(const ke of Y)ae.indexOf(ke)<0&&ae.push(ke);const _e=y?y.defines():[];S&&_e.push("#define OVERDRAW_INSPECTOR;"),I&&_e.push("#define TERRAIN3D;");const ye=_e.concat(nt.prelude.fragmentSource,m.fragmentSource).join("\n"),ie=_e.concat(nt.prelude.vertexSource,m.vertexSource).join("\n"),we=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(we,ye),k.compileShader(we),k.attachShader(this.program,we);const De=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(De,ie),k.compileShader(De),k.attachShader(this.program,De),this.attributes={};const Se={};this.numAttributes=L.length;for(let ke=0;ke<this.numAttributes;ke++)L[ke]&&(k.bindAttribLocation(this.program,ke,L[ke]),this.attributes[L[ke]]=ke);k.linkProgram(this.program),k.deleteShader(De),k.deleteShader(we);for(let ke=0;ke<ae.length;ke++){const Be=ae[ke];if(Be&&!Se[Be]){const Le=k.getUniformLocation(this.program,Be);Le&&(Se[Be]=Le)}}var ke,Be;this.fixedUniforms=w(s,Se),this.terrainUniforms={u_depth:new b.Uniform1i(ke=s,(Be=Se).u_depth),u_terrain:new b.Uniform1i(ke,Be.u_terrain),u_terrain_dim:new b.Uniform1f(ke,Be.u_terrain_dim),u_terrain_matrix:new b.UniformMatrix4f(ke,Be.u_terrain_matrix),u_terrain_unpack:new b.Uniform4f(ke,Be.u_terrain_unpack),u_terrain_exaggeration:new b.Uniform1f(ke,Be.u_terrain_exaggeration)},this.binderUniforms=y?y.getUniforms(s,Se):[]}draw(s,h,m,y,w,S,I,k,R,z,L,j,Q,ee,Y,ae,_e,ye){const ie=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(m),s.setStencilMode(y),s.setColorMode(w),s.setCullFace(S),k){s.activeTexture.set(ie.TEXTURE2),ie.bindTexture(ie.TEXTURE_2D,k.depthTexture),s.activeTexture.set(ie.TEXTURE3),ie.bindTexture(ie.TEXTURE_2D,k.texture);for(const De in this.terrainUniforms)this.terrainUniforms[De].set(k[De])}for(const De in this.fixedUniforms)this.fixedUniforms[De].set(I[De]);Y&&Y.setUniforms(s,this.binderUniforms,Q,{zoom:ee});let we=0;switch(h){case ie.LINES:we=2;break;case ie.TRIANGLES:we=3;break;case ie.LINE_STRIP:we=1}for(const De of j.get()){const Se=De.vaos||(De.vaos={});(Se[R]||(Se[R]=new $t)).bind(s,this,z,Y?Y.getPaintVertexBuffers():[],L,De.vertexOffset,ae,_e,ye),ie.drawElements(h,De.primitiveLength*we,ie.UNSIGNED_SHORT,De.primitiveOffset*we*2)}}}function Of(g,s,h){const m=1/Te(h,1,s.transform.tileZoom),y=Math.pow(2,h.tileID.overscaledZ),w=h.tileSize*Math.pow(2,s.transform.tileZoom)/y,S=w*(h.tileID.canonical.x+h.tileID.wrap*y),I=w*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[m,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[S>>16,I>>16],u_pixel_coord_lower:[65535&S,65535&I]}}const Xh=(g,s,h,m)=>{const y=s.style.light,w=y.properties.get("position"),S=[w.x,w.y,w.z],I=(R=new b.ARRAY_TYPE(9),b.ARRAY_TYPE!=Float32Array&&(R[1]=0,R[2]=0,R[3]=0,R[5]=0,R[6]=0,R[7]=0),R[0]=1,R[4]=1,R[8]=1,R);var R;"viewport"===y.properties.get("anchor")&&function(R,z){var L=Math.sin(z),j=Math.cos(z);R[0]=j,R[1]=L,R[2]=0,R[3]=-L,R[4]=j,R[5]=0,R[6]=0,R[7]=0,R[8]=1}(I,-s.transform.angle),function(R,z,L){var j=z[0],Q=z[1],ee=z[2];R[0]=j*L[0]+Q*L[3]+ee*L[6],R[1]=j*L[1]+Q*L[4]+ee*L[7],R[2]=j*L[2]+Q*L[5]+ee*L[8]}(S,S,I);const k=y.properties.get("color");return{u_matrix:g,u_lightpos:S,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+h,u_opacity:m}},Nu=(g,s,h,m,y,w,S)=>b.extend(Xh(g,s,h,m),Of(w,s,S),{u_height_factor:-Math.pow(2,y.overscaledZ)/S.tileSize/8}),Yr=g=>({u_matrix:g}),Lc=(g,s,h,m)=>b.extend(Yr(g),Of(h,s,m)),Lf=(g,s)=>({u_matrix:g,u_world:s}),Io=(g,s,h,m,y)=>b.extend(Lc(g,s,h,m),{u_world:y}),Zo=(g,s,h,m)=>{const y=g.transform;let w,S;if("map"===m.paint.get("circle-pitch-alignment")){const I=Te(h,1,y.zoom);w=!0,S=[I,I]}else w=!1,S=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+("map"===m.paint.get("circle-pitch-scale")),u_matrix:g.translatePosMatrix(s.posMatrix,h,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:S}},Yh=(g,s,h)=>{const m=Te(h,1,s.zoom),y=Math.pow(2,s.zoom-h.tileID.overscaledZ),w=h.tileID.overscaleFactor();return{u_matrix:g,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[s.pixelsToGLUnits[0]/(m*y),s.pixelsToGLUnits[1]/(m*y)],u_overscale_factor:w}},zu=(g,s,h=1)=>({u_matrix:g,u_color:s,u_overlay:0,u_overlay_scale:h}),Kh=g=>({u_matrix:g}),Nf=(g,s,h,m)=>({u_matrix:g,u_extrude_scale:Te(s,1,h),u_intensity:m});function Bu(g,s){const h=Math.pow(2,s.canonical.z),m=s.canonical.y;return[new b.MercatorCoordinate(0,m/h).toLngLat().lat,new b.MercatorCoordinate(0,(m+1)/h).toLngLat().lat]}const Vu=(g,s,h,m)=>{const y=g.transform;return{u_matrix:zl(g,s,h,m),u_ratio:1/Te(s,1,y.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Jh=(g,s,h,m,y)=>b.extend(Vu(g,s,h,y),{u_image:0,u_image_height:m}),Qh=(g,s,h,m,y)=>{const w=g.transform,S=Rn(s,w);return{u_matrix:zl(g,s,h,y),u_texsize:s.imageAtlasTexture.size,u_ratio:1/Te(s,1,w.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[S,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},ji=(g,s,h,m,y,w)=>{const S=g.lineAtlas,I=Rn(s,g.transform),k="round"===h.layout.get("line-cap"),R=S.getDash(m.from,k),z=S.getDash(m.to,k),L=R.width*y.fromScale,j=z.width*y.toScale;return b.extend(Vu(g,s,h,w),{u_patternscale_a:[I/L,-R.height/2],u_patternscale_b:[I/j,-z.height/2],u_sdfgamma:S.width/(256*Math.min(L,j)*g.pixelRatio)/2,u_image:0,u_tex_y_a:R.y,u_tex_y_b:z.y,u_mix:y.t})};function Rn(g,s){return 1/Te(g,1,s.tileZoom)}function zl(g,s,h,m){return g.translatePosMatrix(m?m.posMatrix:s.tileID.posMatrix,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const M_=(g,s,h,m,y)=>{return{u_matrix:g,u_tl_parent:s,u_scale_parent:h,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(S=y.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(w=y.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:T_(y.paint.get("raster-hue-rotate"))};var w,S};function T_(g){g*=Math.PI/180;const s=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const zt=(g,s,h,m,y,w,S,I,k,R)=>{const z=y.transform;return{u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:z.cameraToCenterDistance,u_pitch:z.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:z.width/z.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:S,u_coord_matrix:I,u_is_text:+k,u_pitch_with_map:+m,u_texsize:R,u_texture:0}},zm=(g,s,h,m,y,w,S,I,k,R,z)=>{const L=y.transform;return b.extend(zt(g,s,h,m,y,w,S,I,k,R),{u_gamma_scale:m?Math.cos(L._pitch)*L.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:+z})},Di=(g,s,h,m,y,w,S,I,k,R)=>b.extend(zm(g,s,h,m,y,w,S,I,!0,k,!0),{u_texsize_icon:R,u_texture_icon:1}),Uu=(g,s,h)=>({u_matrix:g,u_opacity:s,u_color:h}),ed=(g,s,h,m,y,w)=>b.extend(function(S,I,k,R){const z=k.imageManager.getPattern(S.from.toString()),L=k.imageManager.getPattern(S.to.toString()),{width:j,height:Q}=k.imageManager.getPixelSize(),ee=Math.pow(2,R.tileID.overscaledZ),Y=R.tileSize*Math.pow(2,k.transform.tileZoom)/ee,ae=Y*(R.tileID.canonical.x+R.tileID.wrap*ee),_e=Y*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:L.tl,u_pattern_br_b:L.br,u_texsize:[j,Q],u_mix:I.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:L.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/Te(R,1,k.transform.tileZoom),u_pixel_coord_upper:[ae>>16,_e>>16],u_pixel_coord_lower:[65535&ae,65535&_e]}}(m,w,h,y),{u_matrix:g,u_opacity:s}),Nc={fillExtrusion:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_lightpos:new b.Uniform3f(g,s.u_lightpos),u_lightintensity:new b.Uniform1f(g,s.u_lightintensity),u_lightcolor:new b.Uniform3f(g,s.u_lightcolor),u_vertical_gradient:new b.Uniform1f(g,s.u_vertical_gradient),u_opacity:new b.Uniform1f(g,s.u_opacity)}),fillExtrusionPattern:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_lightpos:new b.Uniform3f(g,s.u_lightpos),u_lightintensity:new b.Uniform1f(g,s.u_lightintensity),u_lightcolor:new b.Uniform3f(g,s.u_lightcolor),u_vertical_gradient:new b.Uniform1f(g,s.u_vertical_gradient),u_height_factor:new b.Uniform1f(g,s.u_height_factor),u_image:new b.Uniform1i(g,s.u_image),u_texsize:new b.Uniform2f(g,s.u_texsize),u_pixel_coord_upper:new b.Uniform2f(g,s.u_pixel_coord_upper),u_pixel_coord_lower:new b.Uniform2f(g,s.u_pixel_coord_lower),u_scale:new b.Uniform3f(g,s.u_scale),u_fade:new b.Uniform1f(g,s.u_fade),u_opacity:new b.Uniform1f(g,s.u_opacity)}),fill:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix)}),fillPattern:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_image:new b.Uniform1i(g,s.u_image),u_texsize:new b.Uniform2f(g,s.u_texsize),u_pixel_coord_upper:new b.Uniform2f(g,s.u_pixel_coord_upper),u_pixel_coord_lower:new b.Uniform2f(g,s.u_pixel_coord_lower),u_scale:new b.Uniform3f(g,s.u_scale),u_fade:new b.Uniform1f(g,s.u_fade)}),fillOutline:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_world:new b.Uniform2f(g,s.u_world)}),fillOutlinePattern:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_world:new b.Uniform2f(g,s.u_world),u_image:new b.Uniform1i(g,s.u_image),u_texsize:new b.Uniform2f(g,s.u_texsize),u_pixel_coord_upper:new b.Uniform2f(g,s.u_pixel_coord_upper),u_pixel_coord_lower:new b.Uniform2f(g,s.u_pixel_coord_lower),u_scale:new b.Uniform3f(g,s.u_scale),u_fade:new b.Uniform1f(g,s.u_fade)}),circle:(g,s)=>({u_camera_to_center_distance:new b.Uniform1f(g,s.u_camera_to_center_distance),u_scale_with_map:new b.Uniform1i(g,s.u_scale_with_map),u_pitch_with_map:new b.Uniform1i(g,s.u_pitch_with_map),u_extrude_scale:new b.Uniform2f(g,s.u_extrude_scale),u_device_pixel_ratio:new b.Uniform1f(g,s.u_device_pixel_ratio),u_matrix:new b.UniformMatrix4f(g,s.u_matrix)}),collisionBox:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_camera_to_center_distance:new b.Uniform1f(g,s.u_camera_to_center_distance),u_pixels_to_tile_units:new b.Uniform1f(g,s.u_pixels_to_tile_units),u_extrude_scale:new b.Uniform2f(g,s.u_extrude_scale),u_overscale_factor:new b.Uniform1f(g,s.u_overscale_factor)}),collisionCircle:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_inv_matrix:new b.UniformMatrix4f(g,s.u_inv_matrix),u_camera_to_center_distance:new b.Uniform1f(g,s.u_camera_to_center_distance),u_viewport_size:new b.Uniform2f(g,s.u_viewport_size)}),debug:(g,s)=>({u_color:new b.UniformColor(g,s.u_color),u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_overlay:new b.Uniform1i(g,s.u_overlay),u_overlay_scale:new b.Uniform1f(g,s.u_overlay_scale)}),clippingMask:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix)}),heatmap:(g,s)=>({u_extrude_scale:new b.Uniform1f(g,s.u_extrude_scale),u_intensity:new b.Uniform1f(g,s.u_intensity),u_matrix:new b.UniformMatrix4f(g,s.u_matrix)}),heatmapTexture:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_world:new b.Uniform2f(g,s.u_world),u_image:new b.Uniform1i(g,s.u_image),u_color_ramp:new b.Uniform1i(g,s.u_color_ramp),u_opacity:new b.Uniform1f(g,s.u_opacity)}),hillshade:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_image:new b.Uniform1i(g,s.u_image),u_latrange:new b.Uniform2f(g,s.u_latrange),u_light:new b.Uniform2f(g,s.u_light),u_shadow:new b.UniformColor(g,s.u_shadow),u_highlight:new b.UniformColor(g,s.u_highlight),u_accent:new b.UniformColor(g,s.u_accent)}),hillshadePrepare:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_image:new b.Uniform1i(g,s.u_image),u_dimension:new b.Uniform2f(g,s.u_dimension),u_zoom:new b.Uniform1f(g,s.u_zoom),u_unpack:new b.Uniform4f(g,s.u_unpack)}),line:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_ratio:new b.Uniform1f(g,s.u_ratio),u_device_pixel_ratio:new b.Uniform1f(g,s.u_device_pixel_ratio),u_units_to_pixels:new b.Uniform2f(g,s.u_units_to_pixels)}),lineGradient:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_ratio:new b.Uniform1f(g,s.u_ratio),u_device_pixel_ratio:new b.Uniform1f(g,s.u_device_pixel_ratio),u_units_to_pixels:new b.Uniform2f(g,s.u_units_to_pixels),u_image:new b.Uniform1i(g,s.u_image),u_image_height:new b.Uniform1f(g,s.u_image_height)}),linePattern:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_texsize:new b.Uniform2f(g,s.u_texsize),u_ratio:new b.Uniform1f(g,s.u_ratio),u_device_pixel_ratio:new b.Uniform1f(g,s.u_device_pixel_ratio),u_image:new b.Uniform1i(g,s.u_image),u_units_to_pixels:new b.Uniform2f(g,s.u_units_to_pixels),u_scale:new b.Uniform3f(g,s.u_scale),u_fade:new b.Uniform1f(g,s.u_fade)}),lineSDF:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_ratio:new b.Uniform1f(g,s.u_ratio),u_device_pixel_ratio:new b.Uniform1f(g,s.u_device_pixel_ratio),u_units_to_pixels:new b.Uniform2f(g,s.u_units_to_pixels),u_patternscale_a:new b.Uniform2f(g,s.u_patternscale_a),u_patternscale_b:new b.Uniform2f(g,s.u_patternscale_b),u_sdfgamma:new b.Uniform1f(g,s.u_sdfgamma),u_image:new b.Uniform1i(g,s.u_image),u_tex_y_a:new b.Uniform1f(g,s.u_tex_y_a),u_tex_y_b:new b.Uniform1f(g,s.u_tex_y_b),u_mix:new b.Uniform1f(g,s.u_mix)}),raster:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_tl_parent:new b.Uniform2f(g,s.u_tl_parent),u_scale_parent:new b.Uniform1f(g,s.u_scale_parent),u_buffer_scale:new b.Uniform1f(g,s.u_buffer_scale),u_fade_t:new b.Uniform1f(g,s.u_fade_t),u_opacity:new b.Uniform1f(g,s.u_opacity),u_image0:new b.Uniform1i(g,s.u_image0),u_image1:new b.Uniform1i(g,s.u_image1),u_brightness_low:new b.Uniform1f(g,s.u_brightness_low),u_brightness_high:new b.Uniform1f(g,s.u_brightness_high),u_saturation_factor:new b.Uniform1f(g,s.u_saturation_factor),u_contrast_factor:new b.Uniform1f(g,s.u_contrast_factor),u_spin_weights:new b.Uniform3f(g,s.u_spin_weights)}),symbolIcon:(g,s)=>({u_is_size_zoom_constant:new b.Uniform1i(g,s.u_is_size_zoom_constant),u_is_size_feature_constant:new b.Uniform1i(g,s.u_is_size_feature_constant),u_size_t:new b.Uniform1f(g,s.u_size_t),u_size:new b.Uniform1f(g,s.u_size),u_camera_to_center_distance:new b.Uniform1f(g,s.u_camera_to_center_distance),u_pitch:new b.Uniform1f(g,s.u_pitch),u_rotate_symbol:new b.Uniform1i(g,s.u_rotate_symbol),u_aspect_ratio:new b.Uniform1f(g,s.u_aspect_ratio),u_fade_change:new b.Uniform1f(g,s.u_fade_change),u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_label_plane_matrix:new b.UniformMatrix4f(g,s.u_label_plane_matrix),u_coord_matrix:new b.UniformMatrix4f(g,s.u_coord_matrix),u_is_text:new b.Uniform1i(g,s.u_is_text),u_pitch_with_map:new b.Uniform1i(g,s.u_pitch_with_map),u_texsize:new b.Uniform2f(g,s.u_texsize),u_texture:new b.Uniform1i(g,s.u_texture)}),symbolSDF:(g,s)=>({u_is_size_zoom_constant:new b.Uniform1i(g,s.u_is_size_zoom_constant),u_is_size_feature_constant:new b.Uniform1i(g,s.u_is_size_feature_constant),u_size_t:new b.Uniform1f(g,s.u_size_t),u_size:new b.Uniform1f(g,s.u_size),u_camera_to_center_distance:new b.Uniform1f(g,s.u_camera_to_center_distance),u_pitch:new b.Uniform1f(g,s.u_pitch),u_rotate_symbol:new b.Uniform1i(g,s.u_rotate_symbol),u_aspect_ratio:new b.Uniform1f(g,s.u_aspect_ratio),u_fade_change:new b.Uniform1f(g,s.u_fade_change),u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_label_plane_matrix:new b.UniformMatrix4f(g,s.u_label_plane_matrix),u_coord_matrix:new b.UniformMatrix4f(g,s.u_coord_matrix),u_is_text:new b.Uniform1i(g,s.u_is_text),u_pitch_with_map:new b.Uniform1i(g,s.u_pitch_with_map),u_texsize:new b.Uniform2f(g,s.u_texsize),u_texture:new b.Uniform1i(g,s.u_texture),u_gamma_scale:new b.Uniform1f(g,s.u_gamma_scale),u_device_pixel_ratio:new b.Uniform1f(g,s.u_device_pixel_ratio),u_is_halo:new b.Uniform1i(g,s.u_is_halo)}),symbolTextAndIcon:(g,s)=>({u_is_size_zoom_constant:new b.Uniform1i(g,s.u_is_size_zoom_constant),u_is_size_feature_constant:new b.Uniform1i(g,s.u_is_size_feature_constant),u_size_t:new b.Uniform1f(g,s.u_size_t),u_size:new b.Uniform1f(g,s.u_size),u_camera_to_center_distance:new b.Uniform1f(g,s.u_camera_to_center_distance),u_pitch:new b.Uniform1f(g,s.u_pitch),u_rotate_symbol:new b.Uniform1i(g,s.u_rotate_symbol),u_aspect_ratio:new b.Uniform1f(g,s.u_aspect_ratio),u_fade_change:new b.Uniform1f(g,s.u_fade_change),u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_label_plane_matrix:new b.UniformMatrix4f(g,s.u_label_plane_matrix),u_coord_matrix:new b.UniformMatrix4f(g,s.u_coord_matrix),u_is_text:new b.Uniform1i(g,s.u_is_text),u_pitch_with_map:new b.Uniform1i(g,s.u_pitch_with_map),u_texsize:new b.Uniform2f(g,s.u_texsize),u_texsize_icon:new b.Uniform2f(g,s.u_texsize_icon),u_texture:new b.Uniform1i(g,s.u_texture),u_texture_icon:new b.Uniform1i(g,s.u_texture_icon),u_gamma_scale:new b.Uniform1f(g,s.u_gamma_scale),u_device_pixel_ratio:new b.Uniform1f(g,s.u_device_pixel_ratio),u_is_halo:new b.Uniform1i(g,s.u_is_halo)}),background:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_opacity:new b.Uniform1f(g,s.u_opacity),u_color:new b.UniformColor(g,s.u_color)}),backgroundPattern:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_opacity:new b.Uniform1f(g,s.u_opacity),u_image:new b.Uniform1i(g,s.u_image),u_pattern_tl_a:new b.Uniform2f(g,s.u_pattern_tl_a),u_pattern_br_a:new b.Uniform2f(g,s.u_pattern_br_a),u_pattern_tl_b:new b.Uniform2f(g,s.u_pattern_tl_b),u_pattern_br_b:new b.Uniform2f(g,s.u_pattern_br_b),u_texsize:new b.Uniform2f(g,s.u_texsize),u_mix:new b.Uniform1f(g,s.u_mix),u_pattern_size_a:new b.Uniform2f(g,s.u_pattern_size_a),u_pattern_size_b:new b.Uniform2f(g,s.u_pattern_size_b),u_scale_a:new b.Uniform1f(g,s.u_scale_a),u_scale_b:new b.Uniform1f(g,s.u_scale_b),u_pixel_coord_upper:new b.Uniform2f(g,s.u_pixel_coord_upper),u_pixel_coord_lower:new b.Uniform2f(g,s.u_pixel_coord_lower),u_tile_units_to_pixels:new b.Uniform1f(g,s.u_tile_units_to_pixels)}),terrain:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_texture:new b.Uniform1i(g,s.u_texture),u_ele_delta:new b.Uniform1f(g,s.u_ele_delta)}),terrainDepth:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_ele_delta:new b.Uniform1f(g,s.u_ele_delta)}),terrainCoords:(g,s)=>({u_matrix:new b.UniformMatrix4f(g,s.u_matrix),u_texture:new b.Uniform1i(g,s.u_texture),u_terrain_coords_id:new b.Uniform1f(g,s.u_terrain_coords_id),u_ele_delta:new b.Uniform1f(g,s.u_ele_delta)})};class td{constructor(s,h,m){this.context=s;const y=s.gl;this.buffer=y.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const nd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ja{constructor(s,h,m,y){this.length=h.length,this.attributes=m,this.itemSize=h.bytesPerElement,this.dynamicDraw=y,this.context=s;const w=s.gl;this.buffer=w.createBuffer(),s.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let m=0;m<this.attributes.length;m++){const y=h.attributes[this.attributes[m].name];void 0!==y&&s.enableVertexAttribArray(y)}}setVertexAttribPointers(s,h,m){for(let y=0;y<this.attributes.length;y++){const w=this.attributes[y],S=h.attributes[w.name];void 0!==S&&s.vertexAttribPointer(S,w.components,s[nd[w.type]],!1,this.itemSize,w.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class mn{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class $u extends mn{getDefault(){return b.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class ju extends mn{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Ha extends mn{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Rt extends mn{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class aa extends mn{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Bl extends mn{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class uo extends mn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Hu extends mn{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Un extends mn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class Wo extends mn{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Xo extends mn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class Bm extends mn{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Gu extends mn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class ms extends mn{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class nr extends mn{getDefault(){return b.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Vm extends mn{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class I_ extends mn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class la extends mn{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Cn extends mn{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class Ga extends mn{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class zc extends mn{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Bc extends mn{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class rd extends mn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Ao extends mn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ca extends mn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class ko extends mn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class zs extends mn{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class id extends mn{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class od extends mn{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class qa extends mn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class li extends mn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class qu extends mn{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class zf extends qu{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Ot extends qu{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Hi{constructor(s,h,m,y){this.context=s,this.width=h,this.height=m;const w=s.gl,S=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new zf(s,S),y&&(this.depthAttachment=new Ot(s,S)),w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const m=this.depthAttachment.get();m&&s.deleteRenderbuffer(m)}s.deleteFramebuffer(this.framebuffer)}}class Lt{constructor(s,h,m){this.blendFunction=s,this.blendColor=h,this.mask=m}}Lt.Replace=[1,0],Lt.disabled=new Lt(Lt.Replace,b.Color.transparent,[!1,!1,!1,!1]),Lt.unblended=new Lt(Lt.Replace,b.Color.transparent,[!0,!0,!0,!0]),Lt.alphaBlended=new Lt([1,771],b.Color.transparent,[!0,!0,!0,!0]);class Kr{constructor(s){this.gl=s,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new $u(this),this.clearDepth=new ju(this),this.clearStencil=new Ha(this),this.colorMask=new Rt(this),this.depthMask=new aa(this),this.stencilMask=new Bl(this),this.stencilFunc=new uo(this),this.stencilOp=new Hu(this),this.stencilTest=new Un(this),this.depthRange=new Wo(this),this.depthTest=new Xo(this),this.depthFunc=new Bm(this),this.blend=new Gu(this),this.blendFunc=new ms(this),this.blendColor=new nr(this),this.blendEquation=new Vm(this),this.cullFace=new I_(this),this.cullFaceSide=new la(this),this.frontFace=new Cn(this),this.program=new Ga(this),this.activeTexture=new zc(this),this.viewport=new Bc(this),this.bindFramebuffer=new rd(this),this.bindRenderbuffer=new Ao(this),this.bindTexture=new ca(this),this.bindVertexBuffer=new ko(this),this.bindElementBuffer=new zs(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new id(this),this.pixelStoreUnpack=new od(this),this.pixelStoreUnpackPremultiplyAlpha=new qa(this),this.pixelStoreUnpackFlipY=new li(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=s.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(s.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new td(this,s,h)}createVertexBuffer(s,h,m){return new ja(this,s,h,m)}createRenderbuffer(s,h,m){const y=this.gl,w=y.createRenderbuffer();return this.bindRenderbuffer.set(w),y.renderbufferStorage(y.RENDERBUFFER,s,h,m),this.bindRenderbuffer.set(null),w}createFramebuffer(s,h,m){return new Hi(this,s,h,m)}clear({color:s,depth:h}){const m=this.gl;let y=0;s&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),m.clear(y)}setCullFace(s){!1===s.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){Zt(s.blendFunction,Lt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class kt{constructor(s,h,m){this.func=s,this.mask=h,this.range=m}}kt.ReadOnly=!1,kt.ReadWrite=!0,kt.disabled=new kt(519,kt.ReadOnly,[0,1]);class cn{constructor(s,h,m,y,w,S){this.test=s,this.ref=h,this.mask=m,this.fail=y,this.depthFail=w,this.pass=S}}cn.disabled=new cn({func:519,mask:0},0,0,7680,7680,7680);class nn{constructor(s,h,m){this.enable=s,this.mode=h,this.frontFace=m}}let ut;function Wt(g,s,h,m,y,w,S){const I=g.context,k=I.gl,R=g.useProgram("collisionBox"),z=[];let L=0,j=0;for(let ie=0;ie<m.length;ie++){const we=m[ie],De=s.getTile(we),Se=De.getBucket(h);if(!Se)continue;let ke=we.posMatrix;0===y[0]&&0===y[1]||(ke=g.translatePosMatrix(we.posMatrix,De,y,w));const Be=S?Se.textCollisionBox:Se.iconCollisionBox,Le=Se.collisionCircleArray;if(Le.length>0){const Ne=b.create(),ze=ke;b.mul(Ne,Se.placementInvProjMatrix,g.transform.glCoordMatrix),b.mul(Ne,Ne,Se.placementViewportMatrix),z.push({circleArray:Le,circleOffset:j,transform:ze,invTransform:Ne,coord:we}),L+=Le.length/4,j=L}Be&&R.draw(I,k.LINES,kt.disabled,cn.disabled,g.colorModeForRenderPass(),nn.disabled,Yh(ke,g.transform,De),g.style.map.terrain&&g.style.map.terrain.getTerrainData(we),h.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,g.transform.zoom,null,null,Be.collisionVertexBuffer)}if(!S||!z.length)return;const Q=g.useProgram("collisionCircle"),ee=new b.CollisionCircleLayoutArray;ee.resize(4*L),ee._trim();let Y=0;for(const ie of z)for(let we=0;we<ie.circleArray.length/4;we++){const De=4*we,Se=ie.circleArray[De+0],ke=ie.circleArray[De+1],Be=ie.circleArray[De+2],Le=ie.circleArray[De+3];ee.emplace(Y++,Se,ke,Be,Le,0),ee.emplace(Y++,Se,ke,Be,Le,1),ee.emplace(Y++,Se,ke,Be,Le,2),ee.emplace(Y++,Se,ke,Be,Le,3)}(!ut||ut.length<2*L)&&(ut=function(ie){const we=2*ie,De=new b.QuadTriangleArray;De.resize(we),De._trim();for(let Se=0;Se<we;Se++){const ke=6*Se;De.uint16[ke+0]=4*Se+0,De.uint16[ke+1]=4*Se+1,De.uint16[ke+2]=4*Se+2,De.uint16[ke+3]=4*Se+2,De.uint16[ke+4]=4*Se+3,De.uint16[ke+5]=4*Se+0}return De}(L));const ae=I.createIndexBuffer(ut,!0),_e=I.createVertexBuffer(ee,b.collisionCircleLayout.members,!0);for(const ie of z){const we={u_matrix:ie.transform,u_inv_matrix:ie.invTransform,u_camera_to_center_distance:(ye=g.transform).cameraToCenterDistance,u_viewport_size:[ye.width,ye.height]};Q.draw(I,k.TRIANGLES,kt.disabled,cn.disabled,g.colorModeForRenderPass(),nn.disabled,we,g.style.map.terrain&&g.style.map.terrain.getTerrainData(ie.coord),h.id,_e,ae,b.SegmentVector.simpleSegment(0,2*ie.circleOffset,ie.circleArray.length,ie.circleArray.length/2),null,g.transform.zoom,null,null,null)}var ye;_e.destroy(),ae.destroy()}nn.disabled=new nn(!1,1029,2305),nn.backCCW=new nn(!0,1029,2305);const cr=b.identity(new Float32Array(16));function Gi(g,s,h,m,y,w){const{horizontalAlign:S,verticalAlign:I}=b.getAnchorAlignment(g),k=-(S-.5)*s,R=-(I-.5)*h,z=b.evaluateVariableOffset(g,m);return new b.pointGeometry((k/y+z[0])*w,(R/y+z[1])*w)}function ua(g,s,h,m,y,w,S,I,k,R,z){const L=g.text.placedSymbolArray,j=g.text.dynamicLayoutVertexArray,Q=g.icon.dynamicLayoutVertexArray,ee={};j.clear();for(let Y=0;Y<L.length;Y++){const ae=L.get(Y),_e=ae.hidden||!ae.crossTileID||g.allowVerticalPlacement&&!ae.placedOrientation?null:m[ae.crossTileID];if(_e){const ye=new b.pointGeometry(ae.anchorX,ae.anchorY),ie=gi(ye,h?S:w,z),we=Ns(y.cameraToCenterDistance,ie.signedDistanceFromCamera);let De=b.evaluateSizeForFeature(g.textSizeData,k,ae)*we/b.ONE_EM;h&&(De*=g.tilePixelRatio/I);const{width:Se,height:ke,anchor:Be,textOffset:Le,textBoxScale:Ne}=_e,ze=Gi(Be,Se,ke,Le,Ne,De),ft=h?gi(ye.add(ze),w,z).point:ie.point.add(s?ze.rotate(-y.angle):ze),Pt=g.allowVerticalPlacement&&ae.placedOrientation===b.WritingMode.vertical?Math.PI/2:0;for(let Nt=0;Nt<ae.numGlyphs;Nt++)b.addDynamicAttributes(j,ft,Pt);R&&ae.associatedIconIndex>=0&&(ee[ae.associatedIconIndex]={shiftedAnchor:ft,angle:Pt})}else ue(ae.numGlyphs,j)}if(R){Q.clear();const Y=g.icon.placedSymbolArray;for(let ae=0;ae<Y.length;ae++){const _e=Y.get(ae);if(_e.hidden)ue(_e.numGlyphs,Q);else{const ye=ee[ae];if(ye)for(let ie=0;ie<_e.numGlyphs;ie++)b.addDynamicAttributes(Q,ye.shiftedAnchor,ye.angle);else ue(_e.numGlyphs,Q)}}g.icon.dynamicLayoutVertexBuffer.updateData(Q)}g.text.dynamicLayoutVertexBuffer.updateData(j)}function jr(g,s,h){return h.iconsInText&&s?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function qi(g,s,h,m,y,w,S,I,k,R,z,L){const j=g.context,Q=j.gl,ee=g.transform,Y="map"===I,ae="map"===k,_e="viewport"!==I&&"point"!==h.layout.get("symbol-placement"),ye=Y&&!ae&&!_e,ie=!h.layout.get("symbol-sort-key").isConstant();let we=!1;const De=g.depthModeForSublayer(0,kt.ReadOnly),Se=h.layout.get("text-variable-anchor"),ke=[];for(const Be of m){const Le=s.getTile(Be),Ne=Le.getBucket(h);if(!Ne)continue;const ze=y?Ne.text:Ne.icon;if(!ze||!ze.segments.get().length||!ze.hasVisibleVertices)continue;const ft=ze.programConfigurations.get(h.id),Pt=y||Ne.sdfIcons,Nt=y?Ne.textSizeData:Ne.iconSizeData,mt=ae||0!==ee.pitch,In=g.useProgram(jr(Pt,y,Ne),ft),An=b.evaluateSizeForZoom(Nt,ee.zoom),Ht=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Be);let rn,Fn,yn,yo,Fo=[0,0],vr=null;if(y)Fn=Le.glyphAtlasTexture,yn=Q.LINEAR,rn=Le.glyphAtlasTexture.size,Ne.iconsInText&&(Fo=Le.imageAtlasTexture.size,vr=Le.imageAtlasTexture,yo=mt||g.options.rotating||g.options.zooming||"composite"===Nt.kind||"camera"===Nt.kind?Q.LINEAR:Q.NEAREST);else{const Qo=1!==h.layout.get("icon-size").constantOr(0)||Ne.iconsNeedLinear;Fn=Le.imageAtlasTexture,yn=Pt||g.options.rotating||g.options.zooming||Qo||mt?Q.LINEAR:Q.NEAREST,rn=Le.imageAtlasTexture.size}const ci=Te(Le,1,g.transform.zoom),Ii=$r(Be.posMatrix,ae,Y,g.transform,ci),Jo=mi(Be.posMatrix,ae,Y,g.transform,ci),Oo=Se&&Ne.hasTextData(),Wl="none"!==h.layout.get("icon-text-fit")&&Oo&&Ne.hasIconData();if(_e){const Qo=g.style.map.terrain?(sh,ma)=>g.style.map.terrain.getElevation(Be,sh,ma):null,Wi="map"===h.layout.get("text-rotation-alignment");V(Ne,Be.posMatrix,g,y,Ii,Jo,ae,R,Wi,Qo)}const Fr=g.translatePosMatrix(Be.posMatrix,Le,w,S),dr=_e||y&&Se||Wl?cr:Ii,On=g.translatePosMatrix(Jo,Le,w,S,!0),Zi=Pt&&0!==h.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1);let Jr;Jr=Pt?Ne.iconsInText?Di(Nt.kind,An,ye,ae,g,Fr,dr,On,rn,Fo):zm(Nt.kind,An,ye,ae,g,Fr,dr,On,y,rn,!0):zt(Nt.kind,An,ye,ae,g,Fr,dr,On,y,rn);const rr={program:In,buffers:ze,uniformValues:Jr,atlasTexture:Fn,atlasTextureIcon:vr,atlasInterpolation:yn,atlasInterpolationIcon:yo,isSDF:Pt,hasHalo:Zi};if(ie&&Ne.canOverlap){we=!0;const Qo=ze.segments.get();for(const Wi of Qo)ke.push({segments:new b.SegmentVector([Wi]),sortKey:Wi.sortKey,state:rr,terrainData:Ht})}else ke.push({segments:ze.segments,sortKey:0,state:rr,terrainData:Ht})}we&&ke.sort((Be,Le)=>Be.sortKey-Le.sortKey);for(const Be of ke){const Le=Be.state;if(j.activeTexture.set(Q.TEXTURE0),Le.atlasTexture.bind(Le.atlasInterpolation,Q.CLAMP_TO_EDGE),Le.atlasTextureIcon&&(j.activeTexture.set(Q.TEXTURE1),Le.atlasTextureIcon&&Le.atlasTextureIcon.bind(Le.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),Le.isSDF){const Ne=Le.uniformValues;Le.hasHalo&&(Ne.u_is_halo=1,_r(Le.buffers,Be.segments,h,g,Le.program,De,z,L,Ne,Be.terrainData)),Ne.u_is_halo=0}_r(Le.buffers,Be.segments,h,g,Le.program,De,z,L,Le.uniformValues,Be.terrainData)}}function _r(g,s,h,m,y,w,S,I,k,R){const z=m.context;y.draw(z,z.gl.TRIANGLES,w,S,I,nn.disabled,k,R,h.id,g.layoutVertexBuffer,g.indexBuffer,s,h.paint,m.transform.zoom,g.programConfigurations.get(h.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Za(g,s,h,m,y){if(!h||!m||!m.imageAtlas)return;const w=m.imageAtlas.patternPositions;let S=w[h.to.toString()],I=w[h.from.toString()];if(!S||!I){const k=y.getPaintProperty(s);S=w[k],I=w[k]}S&&I&&g.setConstantPatternPositions(S,I)}function Wa(g,s,h,m,y,w,S){const I=g.context.gl,k="fill-pattern",R=h.paint.get(k),z=R&&R.constantOr(1),L=h.getCrossfadeParameters();let j,Q,ee,Y,ae;S?(Q=z&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=I.LINES):(Q=z?"fillPattern":"fill",j=I.TRIANGLES);const _e=R.constantOr(null);for(const ye of m){const ie=s.getTile(ye);if(z&&!ie.patternsLoaded())continue;const we=ie.getBucket(h);if(!we)continue;const De=we.programConfigurations.get(h.id),Se=g.useProgram(Q,De),ke=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ye);z&&(g.context.activeTexture.set(I.TEXTURE0),ie.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),De.updatePaintBuffers(L)),Za(De,k,_e,ie,h);const Be=ke?ye:null,Le=g.translatePosMatrix(Be?Be.posMatrix:ye.posMatrix,ie,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(S){Y=we.indexBuffer2,ae=we.segments2;const Ne=[I.drawingBufferWidth,I.drawingBufferHeight];ee="fillOutlinePattern"===Q&&z?Io(Le,g,L,ie,Ne):Lf(Le,Ne)}else Y=we.indexBuffer,ae=we.segments,ee=z?Lc(Le,g,L,ie):Yr(Le);Se.draw(g.context,j,y,g.stencilModeForClipping(ye),w,nn.disabled,ee,ke,h.id,we.layoutVertexBuffer,Y,ae,h.paint,g.transform.zoom,De)}}function Xt(g,s,h,m,y,w,S){const I=g.context,k=I.gl,R="fill-extrusion-pattern",z=h.paint.get(R),L=z.constantOr(1),j=h.getCrossfadeParameters(),Q=h.paint.get("fill-extrusion-opacity"),ee=z.constantOr(null);for(const Y of m){const ae=s.getTile(Y),_e=ae.getBucket(h);if(!_e)continue;const ye=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Y),ie=_e.programConfigurations.get(h.id),we=g.useProgram(L?"fillExtrusionPattern":"fillExtrusion",ie);L&&(g.context.activeTexture.set(k.TEXTURE0),ae.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ie.updatePaintBuffers(j)),Za(ie,R,ee,ae,h);const De=g.translatePosMatrix(Y.posMatrix,ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Se=h.paint.get("fill-extrusion-vertical-gradient"),ke=L?Nu(De,g,Se,Q,Y,j,ae):Xh(De,g,Se,Q);we.draw(I,I.gl.TRIANGLES,y,w,S,nn.backCCW,ke,ye,h.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,h.paint,g.transform.zoom,ie,g.style.map.terrain&&_e.centroidVertexBuffer)}}function Vc(g,s,h,m,y,w,S){const I=g.context,k=I.gl,R=h.fbo;if(!R)return;const z=g.useProgram("hillshade"),L=g.style.map.terrain&&g.style.map.terrain.getTerrainData(s);I.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,R.colorAttachment.get()),z.draw(I,k.TRIANGLES,y,w,S,nn.disabled,((j,Q,ee,Y)=>{const ae=ee.paint.get("hillshade-shadow-color"),_e=ee.paint.get("hillshade-highlight-color"),ye=ee.paint.get("hillshade-accent-color");let ie=ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ee.paint.get("hillshade-illumination-anchor")&&(ie-=j.transform.angle);const we=!j.options.moving;return{u_matrix:Y?Y.posMatrix:j.transform.calculatePosMatrix(Q.tileID.toUnwrapped(),we),u_image:0,u_latrange:Bu(0,Q.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),ie],u_shadow:ae,u_highlight:_e,u_accent:ye}})(g,h,m,L?s:null),L,m.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}function Xa(g,s,h,m,y,w){const S=g.context,I=S.gl,k=s.dem;if(k&&k.data){const R=k.dim,z=k.stride,L=k.getPixels();if(S.activeTexture.set(I.TEXTURE1),S.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||g.getTileTexture(z),s.demTexture){const Q=s.demTexture;Q.update(L,{premultiply:!1}),Q.bind(I.NEAREST,I.CLAMP_TO_EDGE)}else s.demTexture=new Gn(S,L,I.RGBA,{premultiply:!1}),s.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);S.activeTexture.set(I.TEXTURE0);let j=s.fbo;if(!j){const Q=new Gn(S,{width:R,height:R,data:null},I.RGBA);Q.bind(I.LINEAR,I.CLAMP_TO_EDGE),j=s.fbo=S.createFramebuffer(R,R,!0),j.colorAttachment.set(Q.texture)}S.bindFramebuffer.set(j.framebuffer),S.viewport.set([0,0,R,R]),g.useProgram("hillshadePrepare").draw(S,I.TRIANGLES,m,y,w,nn.disabled,((Q,ee)=>{const Y=ee.stride,ae=b.create();return b.ortho(ae,0,b.EXTENT,-b.EXTENT,0,0,1),b.translate(ae,ae,[0,-b.EXTENT,0]),{u_matrix:ae,u_image:1,u_dimension:[Y,Y],u_zoom:Q.overscaledZ,u_unpack:ee.getUnpackVector()}})(s.tileID,k),null,h.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function Ya(g,s,h,m,y,w){const S=m.paint.get("raster-fade-duration");if(!w&&S>0){const I=b.exported.now(),k=(I-g.timeAdded)/S,R=s?(I-s.timeAdded)/S:-1,z=h.getSource(),L=y.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),j=!s||Math.abs(s.tileID.overscaledZ-L)>Math.abs(g.tileID.overscaledZ-L),Q=j&&g.refreshedUponExpiration?1:b.clamp(j?k:1-R,0,1);return g.refreshedUponExpiration&&k>=1&&(g.refreshedUponExpiration=!1),s?{opacity:1,mix:1-Q}:{opacity:Q,mix:0}}return{opacity:1,mix:0}}const ha=new b.Color(1,0,0,1),ur=new b.Color(0,1,0,1),ho=new b.Color(0,0,1,1),Ka=new b.Color(1,0,1,1),Hr=new b.Color(0,1,1,1);function Yo(g,s,h,m){$n(g,0,s+h/2,g.transform.width,h,m)}function sd(g,s,h,m){$n(g,s-h/2,0,h,g.transform.height,m)}function $n(g,s,h,m,y,w){const S=g.context,I=S.gl;I.enable(I.SCISSOR_TEST),I.scissor(s*g.pixelRatio,h*g.pixelRatio,m*g.pixelRatio,y*g.pixelRatio),S.clear({color:w}),I.disable(I.SCISSOR_TEST)}function Um(g,s,h){const m=g.context,y=m.gl,w=h.posMatrix,S=g.useProgram("debug"),I=kt.disabled,k=cn.disabled,R=g.colorModeForRenderPass(),z="$debug",L=g.style.map.terrain&&g.style.map.terrain.getTerrainData(h);m.activeTexture.set(y.TEXTURE0),g.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE);const j=s.getTileByID(h.key).latestRawTileData,Q=Math.floor((j&&j.byteLength||0)/1024),ee=s.getTile(h).tileSize,Y=512/Math.min(ee,512)*(h.overscaledZ/g.transform.zoom)*.5;let ae=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ae+=` => ${h.overscaledZ}`),function(_e,ye){_e.initDebugOverlayCanvas();const ie=_e.debugOverlayCanvas,we=_e.context.gl,De=_e.debugOverlayCanvas.getContext("2d");De.clearRect(0,0,ie.width,ie.height),De.shadowColor="white",De.shadowBlur=2,De.lineWidth=1.5,De.strokeStyle="white",De.textBaseline="top",De.font="bold 36px Open Sans, sans-serif",De.fillText(ye,5,5),De.strokeText(ye,5,5),_e.debugOverlayTexture.update(ie),_e.debugOverlayTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE)}(g,`${ae} ${Q}kB`),S.draw(m,y.TRIANGLES,I,k,Lt.alphaBlended,nn.disabled,zu(w,b.Color.transparent,Y),null,z,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),S.draw(m,y.LINE_STRIP,I,k,R,nn.disabled,zu(w,b.Color.red),L,z,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function ad(g,s,h){const m=g.context,y=m.gl,w=g.colorModeForRenderPass(),S=new kt(y.LEQUAL,kt.ReadWrite,g.depthRangeFor3D),I=g.useProgram("terrain"),k=s.getTerrainMesh();m.bindFramebuffer.set(null),m.viewport.set([0,0,g.width,g.height]);for(const R of h){const z=g.renderToTexture.getTexture(R),L=s.getTerrainData(R.tileID);m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,z.texture);const j={u_matrix:g.transform.calculatePosMatrix(R.tileID.toUnwrapped()),u_texture:0,u_ele_delta:s.getMeshFrameDelta(g.transform.zoom)};I.draw(m,y.TRIANGLES,S,cn.disabled,w,nn.backCCW,j,L,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}}const Vs={symbol:function(g,s,h,m,y){if("translucent"!==g.renderPass)return;const w=cn.disabled,S=g.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(I,k,R,z,L,j,Q){const ee=k.transform,Y="map"===L,ae="map"===j;for(const _e of I){const ye=z.getTile(_e),ie=ye.getBucket(R);if(!ie||!ie.text||!ie.text.segments.get().length)continue;const we=b.evaluateSizeForZoom(ie.textSizeData,ee.zoom),De=Te(ye,1,k.transform.zoom),Se=$r(_e.posMatrix,ae,Y,k.transform,De),ke="none"!==R.layout.get("icon-text-fit")&&ie.hasIconData();if(we){const Be=Math.pow(2,ee.zoom-ye.tileID.overscaledZ);ua(ie,Y,ae,Q,ee,Se,_e.posMatrix,Be,we,ke,k.style.map.terrain?(Le,Ne)=>k.style.map.terrain.getElevation(_e,Le,Ne):null)}}}(m,g,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),y),0!==h.paint.get("icon-opacity").constantOr(1)&&qi(g,s,h,m,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),w,S),0!==h.paint.get("text-opacity").constantOr(1)&&qi(g,s,h,m,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),w,S),s.map.showCollisionBoxes&&(Wt(g,s,h,m,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Wt(g,s,h,m,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,s,h,m){if("translucent"!==g.renderPass)return;const y=h.paint.get("circle-opacity"),w=h.paint.get("circle-stroke-width"),S=h.paint.get("circle-stroke-opacity"),I=!h.layout.get("circle-sort-key").isConstant();if(0===y.constantOr(1)&&(0===w.constantOr(1)||0===S.constantOr(1)))return;const k=g.context,R=k.gl,z=g.depthModeForSublayer(0,kt.ReadOnly),L=cn.disabled,j=g.colorModeForRenderPass(),Q=[];for(let ee=0;ee<m.length;ee++){const Y=m[ee],ae=s.getTile(Y),_e=ae.getBucket(h);if(!_e)continue;const ye=_e.programConfigurations.get(h.id),ie=g.useProgram("circle",ye),we=_e.layoutVertexBuffer,De=_e.indexBuffer,Se=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Y),ke={programConfiguration:ye,program:ie,layoutVertexBuffer:we,indexBuffer:De,uniformValues:Zo(g,Y,ae,h),terrainData:Se};if(I){const Be=_e.segments.get();for(const Le of Be)Q.push({segments:new b.SegmentVector([Le]),sortKey:Le.sortKey,state:ke})}else Q.push({segments:_e.segments,sortKey:0,state:ke})}I&&Q.sort((ee,Y)=>ee.sortKey-Y.sortKey);for(const ee of Q){const{programConfiguration:Y,program:ae,layoutVertexBuffer:_e,indexBuffer:ye,uniformValues:ie,terrainData:we}=ee.state;ae.draw(k,R.TRIANGLES,z,L,j,nn.disabled,ie,we,h.id,_e,ye,ee.segments,h.paint,g.transform.zoom,Y)}},heatmap:function(g,s,h,m){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const y=g.context,w=y.gl,S=cn.disabled,I=new Lt([w.ONE,w.ONE],b.Color.transparent,[!0,!0,!0,!0]);(function(k,R,z){const L=k.gl;k.activeTexture.set(L.TEXTURE1),k.viewport.set([0,0,R.width/4,R.height/4]);let j=z.heatmapFbo;if(j)L.bindTexture(L.TEXTURE_2D,j.colorAttachment.get()),k.bindFramebuffer.set(j.framebuffer);else{const Q=L.createTexture();L.bindTexture(L.TEXTURE_2D,Q),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,L.LINEAR),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MAG_FILTER,L.LINEAR),j=z.heatmapFbo=k.createFramebuffer(R.width/4,R.height/4,!1),function(ee,Y,ae,_e){const ye=ee.gl;ye.texImage2D(ye.TEXTURE_2D,0,ye.RGBA,Y.width/4,Y.height/4,0,ye.RGBA,ee.extRenderToTextureHalfFloat?ee.extTextureHalfFloat.HALF_FLOAT_OES:ye.UNSIGNED_BYTE,null),_e.colorAttachment.set(ae)}(k,R,Q,j)}})(y,g,h),y.clear({color:b.Color.transparent});for(let k=0;k<m.length;k++){const R=m[k];if(s.hasRenderableParent(R))continue;const z=s.getTile(R),L=z.getBucket(h);if(!L)continue;const j=L.programConfigurations.get(h.id),Q=g.useProgram("heatmap",j),{zoom:ee}=g.transform;Q.draw(y,w.TRIANGLES,kt.disabled,S,I,nn.disabled,Nf(R.posMatrix,z,ee,h.paint.get("heatmap-intensity")),null,h.id,L.layoutVertexBuffer,L.indexBuffer,L.segments,h.paint,g.transform.zoom,j)}y.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(y,w){const S=y.context,I=S.gl,k=w.heatmapFbo;if(!k)return;S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,k.colorAttachment.get()),S.activeTexture.set(I.TEXTURE1);let R=w.colorRampTexture;R||(R=w.colorRampTexture=new Gn(S,w.colorRamp,I.RGBA)),R.bind(I.LINEAR,I.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(S,I.TRIANGLES,kt.disabled,cn.disabled,y.colorModeForRenderPass(),nn.disabled,((z,L,j,Q)=>{const ee=b.create();b.ortho(ee,0,z.width,z.height,0,0,1);const Y=z.context.gl;return{u_matrix:ee,u_world:[Y.drawingBufferWidth,Y.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:L.paint.get("heatmap-opacity")}})(y,w),null,w.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,w.paint,y.transform.zoom)}(g,h))},line:function(g,s,h,m){if("translucent"!==g.renderPass)return;const y=h.paint.get("line-opacity"),w=h.paint.get("line-width");if(0===y.constantOr(1)||0===w.constantOr(1))return;const S=g.depthModeForSublayer(0,kt.ReadOnly),I=g.colorModeForRenderPass(),k=h.paint.get("line-dasharray"),R=h.paint.get("line-pattern"),z=R.constantOr(1),L=h.paint.get("line-gradient"),j=h.getCrossfadeParameters(),Q=z?"linePattern":k?"lineSDF":L?"lineGradient":"line",ee=g.context,Y=ee.gl;let ae=!0;for(const _e of m){const ye=s.getTile(_e);if(z&&!ye.patternsLoaded())continue;const ie=ye.getBucket(h);if(!ie)continue;const we=ie.programConfigurations.get(h.id),De=g.context.program.get(),Se=g.useProgram(Q,we),ke=ae||Se.program!==De,Be=g.style.map.terrain&&g.style.map.terrain.getTerrainData(_e),Le=R.constantOr(null);if(Le&&ye.imageAtlas){const ft=ye.imageAtlas,Pt=ft.patternPositions[Le.to.toString()],Nt=ft.patternPositions[Le.from.toString()];Pt&&Nt&&we.setConstantPatternPositions(Pt,Nt)}const Ne=Be?_e:null,ze=z?Qh(g,ye,h,j,Ne):k?ji(g,ye,h,k,j,Ne):L?Jh(g,ye,h,ie.lineClipsArray.length,Ne):Vu(g,ye,h,Ne);if(z)ee.activeTexture.set(Y.TEXTURE0),ye.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),we.updatePaintBuffers(j);else if(k&&(ke||g.lineAtlas.dirty))ee.activeTexture.set(Y.TEXTURE0),g.lineAtlas.bind(ee);else if(L){const ft=ie.gradients[h.id];let Pt=ft.texture;if(h.gradientVersion!==ft.version){let Nt=256;if(h.stepInterpolant){const mt=s.getSource().maxzoom,In=_e.canonical.z===mt?Math.ceil(1<<g.transform.maxZoom-_e.canonical.z):1;Nt=b.clamp(b.nextPowerOfTwo(ie.maxLineLength/b.EXTENT*1024*In),256,ee.maxTextureSize)}ft.gradient=b.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Nt,image:ft.gradient||void 0,clips:ie.lineClipsArray}),ft.texture?ft.texture.update(ft.gradient):ft.texture=new Gn(ee,ft.gradient,Y.RGBA),ft.version=h.gradientVersion,Pt=ft.texture}ee.activeTexture.set(Y.TEXTURE0),Pt.bind(h.stepInterpolant?Y.NEAREST:Y.LINEAR,Y.CLAMP_TO_EDGE)}Se.draw(ee,Y.TRIANGLES,S,g.stencilModeForClipping(_e),I,nn.disabled,ze,Be,h.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,h.paint,g.transform.zoom,we,ie.layoutVertexBuffer2),ae=!1}},fill:function(g,s,h,m){const y=h.paint.get("fill-color"),w=h.paint.get("fill-opacity");if(0===w.constantOr(1))return;const S=g.colorModeForRenderPass(),I=h.paint.get("fill-pattern"),k=g.opaquePassEnabledForLayer()&&!I.constantOr(1)&&1===y.constantOr(b.Color.transparent).a&&1===w.constantOr(0)?"opaque":"translucent";if(g.renderPass===k){const R=g.depthModeForSublayer(1,"opaque"===g.renderPass?kt.ReadWrite:kt.ReadOnly);Wa(g,s,h,m,R,S,!1)}if("translucent"===g.renderPass&&h.paint.get("fill-antialias")){const R=g.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,kt.ReadOnly);Wa(g,s,h,m,R,S,!0)}},"fill-extrusion":function(g,s,h,m){const y=h.paint.get("fill-extrusion-opacity");if(0!==y&&"translucent"===g.renderPass){const w=new kt(g.context.gl.LEQUAL,kt.ReadWrite,g.depthRangeFor3D);if(1!==y||h.paint.get("fill-extrusion-pattern").constantOr(1))Xt(g,s,h,m,w,cn.disabled,Lt.disabled),Xt(g,s,h,m,w,g.stencilModeFor3D(),g.colorModeForRenderPass());else{const S=g.colorModeForRenderPass();Xt(g,s,h,m,w,cn.disabled,S)}}},hillshade:function(g,s,h,m){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass)return;const y=g.context,w=g.depthModeForSublayer(0,kt.ReadOnly),S=g.colorModeForRenderPass(),[I,k]="translucent"===g.renderPass?g.stencilConfigForOverlap(m):[{},m];for(const R of k){const z=s.getTile(R);void 0!==z.needsHillshadePrepare&&z.needsHillshadePrepare&&"offscreen"===g.renderPass?Xa(g,z,h,w,cn.disabled,S):"translucent"===g.renderPass&&Vc(g,R,z,h,w,I[R.overscaledZ],S)}y.viewport.set([0,0,g.width,g.height])},raster:function(g,s,h,m){if("translucent"!==g.renderPass||0===h.paint.get("raster-opacity")||!m.length)return;const y=g.context,w=y.gl,S=s.getSource(),I=g.useProgram("raster"),k=g.colorModeForRenderPass(),[R,z]=S instanceof Vn?[{},m]:g.stencilConfigForOverlap(m),L=z[z.length-1].overscaledZ,j=!g.options.moving;for(const Q of z){const ee=g.depthModeForSublayer(Q.overscaledZ-L,1===h.paint.get("raster-opacity")?kt.ReadWrite:kt.ReadOnly,w.LESS),Y=s.getTile(Q);Y.registerFadeDuration(h.paint.get("raster-fade-duration"));const ae=s.findLoadedParent(Q,0),_e=Ya(Y,ae,s,h,g.transform,g.style.map.terrain);let ye,ie;const we="nearest"===h.paint.get("raster-resampling")?w.NEAREST:w.LINEAR;y.activeTexture.set(w.TEXTURE0),Y.texture.bind(we,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),y.activeTexture.set(w.TEXTURE1),ae?(ae.texture.bind(we,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),ye=Math.pow(2,ae.tileID.overscaledZ-Y.tileID.overscaledZ),ie=[Y.tileID.canonical.x*ye%1,Y.tileID.canonical.y*ye%1]):Y.texture.bind(we,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);const De=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Q),Se=De?Q:null,ke=Se?Se.posMatrix:g.transform.calculatePosMatrix(Q.toUnwrapped(),j),Be=M_(ke,ie||[0,0],ye||1,_e,h);S instanceof Vn?I.draw(y,w.TRIANGLES,ee,cn.disabled,k,nn.disabled,Be,De,h.id,S.boundsBuffer,g.quadTriangleIndexBuffer,S.boundsSegments):I.draw(y,w.TRIANGLES,ee,R[Q.overscaledZ],k,nn.disabled,Be,De,h.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}},background:function(g,s,h,m){const y=h.paint.get("background-color"),w=h.paint.get("background-opacity");if(0===w)return;const S=g.context,I=S.gl,k=g.transform,R=k.tileSize,z=h.paint.get("background-pattern");if(g.isPatternMissing(z))return;const L=!z&&1===y.a&&1===w&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==L)return;const j=cn.disabled,Q=g.depthModeForSublayer(0,"opaque"===L?kt.ReadWrite:kt.ReadOnly),ee=g.colorModeForRenderPass(),Y=g.useProgram(z?"backgroundPattern":"background"),ae=m||k.coveringTiles({tileSize:R,terrain:g.style.map.terrain});z&&(S.activeTexture.set(I.TEXTURE0),g.imageManager.bind(g.context));const _e=h.getCrossfadeParameters();for(const ye of ae){const ie=m?ye.posMatrix:g.transform.calculatePosMatrix(ye.toUnwrapped()),we=z?ed(ie,w,g,z,{tileID:ye,tileSize:R},_e):Uu(ie,w,y),De=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ye);Y.draw(S,I.TRIANGLES,Q,j,ee,nn.disabled,we,De,h.id,g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}},debug:function(g,s,h){for(let m=0;m<h.length;m++)Um(g,s,h[m])},custom:function(g,s,h){const m=g.context,y=h.implementation;if("offscreen"===g.renderPass){const w=y.prerender;w&&(g.setCustomLayerDefaults(),m.setColorMode(g.colorModeForRenderPass()),w.call(y,m.gl,g.transform.customLayerMatrix()),m.setDirty(),g.setBaseState())}else if("translucent"===g.renderPass){g.setCustomLayerDefaults(),m.setColorMode(g.colorModeForRenderPass()),m.setStencilMode(cn.disabled);const w="3d"===y.renderingMode?new kt(g.context.gl.LEQUAL,kt.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,kt.ReadOnly);m.setDepthMode(w),y.render(m.gl,g.transform.customLayerMatrix()),m.setDirty(),g.setBaseState(),m.bindFramebuffer.set(null)}}};class gs{constructor(s,h){this.context=new Kr(s),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:b.create(),renderTime:0},this.setup(),this.numSublayers=At.maxUnderzooming+At.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Kn,this.gpuTimers={}}resize(s,h,m){if(this.width=s*m,this.height=h*m,this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const s=this.context,h=new b.PosArray;h.emplaceBack(0,0),h.emplaceBack(b.EXTENT,0),h.emplaceBack(0,b.EXTENT),h.emplaceBack(b.EXTENT,b.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(h,Nl.members),this.tileExtentSegments=b.SegmentVector.simpleSegment(0,0,4,2);const m=new b.PosArray;m.emplaceBack(0,0),m.emplaceBack(b.EXTENT,0),m.emplaceBack(0,b.EXTENT),m.emplaceBack(b.EXTENT,b.EXTENT),this.debugBuffer=s.createVertexBuffer(m,Nl.members),this.debugSegments=b.SegmentVector.simpleSegment(0,0,4,5);const y=new b.RasterBoundsArray;y.emplaceBack(0,0,0,0),y.emplaceBack(b.EXTENT,0,b.EXTENT,0),y.emplaceBack(0,b.EXTENT,0,b.EXTENT),y.emplaceBack(b.EXTENT,b.EXTENT,b.EXTENT,b.EXTENT),this.rasterBoundsBuffer=s.createVertexBuffer(y,Vi.members),this.rasterBoundsSegments=b.SegmentVector.simpleSegment(0,0,4,2);const w=new b.PosArray;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(w,Nl.members),this.viewportSegments=b.SegmentVector.simpleSegment(0,0,4,2);const S=new b.LineStripIndexArray;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(S);const I=new b.TriangleIndexArray;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(I),this.emptyTexture=new Gn(s,{width:1,height:1,data:new Uint8Array([0,0,0,0])},s.gl.RGBA);const k=this.context.gl;this.stencilClearMode=new cn({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=b.create();b.ortho(m,0,this.width,this.height,0,0,1),b.scale(m,m,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,h.TRIANGLES,kt.disabled,this.stencilClearMode,Lt.disabled,nn.disabled,Kh(m),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,h){if(this.currentStencilSource===s.source||!s.isTileClipped()||!h||!h.length)return;this.currentStencilSource=s.source;const m=this.context,y=m.gl;this.nextStencilID+h.length>256&&this.clearStencil(),m.setColorMode(Lt.disabled),m.setDepthMode(kt.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of h){const I=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S);w.draw(m,y.TRIANGLES,kt.disabled,new cn({func:y.ALWAYS,mask:0},I,255,y.KEEP,y.KEEP,y.REPLACE),Lt.disabled,nn.disabled,Kh(S.posMatrix),k,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new cn({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){const h=this.context.gl;return new cn({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,m=s.sort((S,I)=>I.overscaledZ-S.overscaledZ),y=m[m.length-1].overscaledZ,w=m[0].overscaledZ-y+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const S={};for(let I=0;I<w;I++)S[I+y]=new cn({func:h.GEQUAL,mask:255},I+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=w,[S,m]}return[{[y]:cn.disabled},m]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Lt([s.CONSTANT_COLOR,s.ONE],new b.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Lt.unblended:Lt.alphaBlended}depthModeForSublayer(s,h,m){if(!this.opaquePassEnabledForLayer())return kt.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new kt(m||this.context.gl.LEQUAL,h,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){this.style=s,this.options=h,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(b.exported.now()),this.imageManager.beginFrame();const m=this.style._order,y=this.style.sourceCaches,w={},S={},I={};for(const k in y){const R=y[k];R.used&&R.prepare(this.context),w[k]=R.getVisibleCoordinates(),S[k]=w[k].slice().reverse(),I[k]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<m.length;k++)if(this.style._layers[m[k]].is3D()){this.opaquePassCutoff=k;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const k=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!b.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||k.length)&&(b.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(R,z){const L=R.context,j=L.gl,Q=Lt.unblended,ee=new kt(j.LEQUAL,kt.ReadWrite,[0,1]),Y=z.getTerrainMesh(),ae=z.sourceCache.getRenderableTiles(),_e=R.useProgram("terrainDepth");L.bindFramebuffer.set(z.getFramebuffer("depth").framebuffer),L.viewport.set([0,0,R.width/devicePixelRatio,R.height/devicePixelRatio]),L.clear({color:b.Color.transparent,depth:1});for(const ye of ae){const ie=z.getTerrainData(ye.tileID),we={u_matrix:R.transform.calculatePosMatrix(ye.tileID.toUnwrapped()),u_ele_delta:z.getMeshFrameDelta(R.transform.zoom)};_e.draw(L,j.TRIANGLES,ee,cn.disabled,Q,nn.backCCW,we,ie,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments)}L.bindFramebuffer.set(null),L.viewport.set([0,0,R.width,R.height])}(this,this.style.map.terrain),function(R,z){const L=R.context,j=L.gl,Q=Lt.unblended,ee=new kt(j.LEQUAL,kt.ReadWrite,[0,1]),Y=z.getTerrainMesh(),ae=z.getCoordsTexture(),_e=z.sourceCache.getRenderableTiles(),ye=R.useProgram("terrainCoords");L.bindFramebuffer.set(z.getFramebuffer("coords").framebuffer),L.viewport.set([0,0,R.width/devicePixelRatio,R.height/devicePixelRatio]),L.clear({color:b.Color.transparent,depth:1}),z.coordsIndex=[];for(const ie of _e){const we=z.getTerrainData(ie.tileID);L.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,ae.texture);const De={u_matrix:R.transform.calculatePosMatrix(ie.tileID.toUnwrapped()),u_terrain_coords_id:(255-z.coordsIndex.length)/255,u_texture:0,u_ele_delta:z.getMeshFrameDelta(R.transform.zoom)};ye.draw(L,j.TRIANGLES,ee,cn.disabled,Q,nn.backCCW,De,we,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments),z.coordsIndex.push(ie.tileID.key)}L.bindFramebuffer.set(null),L.viewport.set([0,0,R.width,R.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const k of m){const R=this.style._layers[k];if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const z=S[R.source];("custom"===R.type||z.length)&&this.renderLayer(this,y[R.source],R,z)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?b.Color.black:b.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[m[this.currentLayer]],R=y[k.source],z=w[k.source];this._renderTileClippingMasks(k,z),this.renderLayer(this,R,k,z)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const k=this.style._layers[m[this.currentLayer]],R=y[k.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(k))continue;const z=("symbol"===k.type?I:S)[k.source];this._renderTileClippingMasks(k,w[k.source]),this.renderLayer(this,R,k,z)}if(this.options.showTileBoundaries){const k=function(R,z){let L=null;const j=Object.values(R._layers).flatMap(ae=>ae.source&&!ae.isHidden(z)?[R.sourceCaches[ae.source]]:[]),Q=j.filter(ae=>"vector"===ae.getSource().type),ee=j.filter(ae=>"vector"!==ae.getSource().type),Y=ae=>{(!L||L.getSource().maxzoom<ae.getSource().maxzoom)&&(L=ae)};return Q.forEach(ae=>Y(ae)),L||ee.forEach(ae=>Y(ae)),L}(this.style,this.transform.zoom);k&&Vs.debug(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const R=k.transform.padding;Yo(k,k.transform.height-(R.top||0),3,ha),Yo(k,R.bottom||0,3,ur),sd(k,R.left||0,3,ho),sd(k,k.transform.width-(R.right||0),3,Ka);const z=k.transform.centerPoint;var L,j,Q,ee;$n(L=k,(j=z.x)-1,(Q=k.transform.height-z.y)-10,2,20,ee=Hr),$n(L,j-10,Q-1,20,2,ee)}(this),this.context.setDefault()}renderLayer(s,h,m,y){m.isHidden(this.transform.zoom)||("background"===m.type||"custom"===m.type||(y||[]).length)&&(this.id=m.id,this.gpuTimingStart(m),Vs[m.type](s,h,m,y,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let m=this.gpuTimers[s.id];m||(m=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),m.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,m.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}queryGpuTimers(s){const h={};for(const m in s){const y=s[m],w=this.context.extTimerQuery,S=w.getQueryObjectEXT(y.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(y.query),h[m]=S}return h}translatePosMatrix(s,h,m,y,w){if(!m[0]&&!m[1])return s;const S=w?"map"===y?this.transform.angle:0:"viewport"===y?-this.transform.angle:0;if(S){const R=Math.sin(S),z=Math.cos(S);m=[m[0]*z-m[1]*R,m[0]*R+m[1]*z]}const I=[w?m[0]:Te(h,m[0],this.transform.zoom),w?m[1]:Te(h,m[1],this.transform.zoom),0],k=new Float32Array(16);return b.translate(k,s,I),k}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const h=this.imageManager.getPattern(s.from.toString()),m=this.imageManager.getPattern(s.to.toString());return!h||!m}useProgram(s,h){this.cache=this.cache||{};const m=s+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[m]||(this.cache[m]=new Wh(this.context,s,nt[s],h,Nc[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[m]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Gn(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class ct{constructor(s,h){this.points=s,this.planes=h}static fromInvProjectionMatrix(s,h,m){const y=Math.pow(2,m),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const k=1/(I=b.transformMat4([],I,s))[3]/h*y;return b.mul$1(I,I,[k,k,1/I[3],k])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const k=function(j,Q){var ee=Q[0],Y=Q[1],ae=Q[2],_e=ee*ee+Y*Y+ae*ae;return _e>0&&(_e=1/Math.sqrt(_e)),j[0]=Q[0]*_e,j[1]=Q[1]*_e,j[2]=Q[2]*_e,j}([],(j=[],Q=oo([],w[I[0]],w[I[1]]),ee=oo([],w[I[2]],w[I[1]]),Y=Q[0],ye=ee[0],j[0]=(ae=Q[1])*(we=ee[2])-(_e=Q[2])*(ie=ee[1]),j[1]=_e*ye-Y*we,j[2]=Y*ie-ae*ye,j)),R=-((z=k)[0]*(L=w[I[1]])[0]+z[1]*L[1]+z[2]*L[2]);var j,Q,ee,Y,ae,_e,ye,ie,we,z,L;return k.concat(R)});return new ct(w,S)}}class da{constructor(s,h){var m,y,w;this.min=s,this.max=h,this.center=function(m,y,w){return m[0]=.5*y[0],m[1]=.5*y[1],m[2]=.5*y[2],m}([],((m=[])[0]=(y=this.min)[0]+(w=this.max)[0],m[1]=y[1]+w[1],m[2]=y[2]+w[2],m))}quadrant(s){const h=[s%2==0,s<2],m=ta(this.min),y=ta(this.max);for(let w=0;w<h.length;w++)m[w]=h[w]?this.min[w]:this.center[w],y[w]=h[w]?this.center[w]:this.max[w];return y[2]=this.max[2],new da(m,y)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let m=!0;for(let y=0;y<s.planes.length;y++){const w=s.planes[y];let S=0;for(let I=0;I<h.length;I++)b.dot(w,h[I])>=0&&S++;if(0===S)return 0;S!==h.length&&(m=!1)}if(m)return 2;for(let y=0;y<3;y++){let w=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let I=0;I<s.points.length;I++){const k=s.points[I][y]-this.min[y];w=Math.min(w,k),S=Math.max(S,k)}if(S<0||w>this.max[y]-this.min[y])return 0}return 1}}class fo{constructor(s=0,h=0,m=0,y=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=m,this.right=y}interpolate(s,h,m){return null!=h.top&&null!=s.top&&(this.top=b.number(s.top,h.top,m)),null!=h.bottom&&null!=s.bottom&&(this.bottom=b.number(s.bottom,h.bottom,m)),null!=h.left&&null!=s.left&&(this.left=b.number(s.left,h.left,m)),null!=h.right&&null!=s.right&&(this.right=b.number(s.right,h.right,m)),this}getCenter(s,h){const m=b.clamp((this.left+s-this.right)/2,0,s),y=b.clamp((this.top+h-this.bottom)/2,0,h);return new b.pointGeometry(m,y)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new fo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Er{constructor(s,h,m,y,w){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=void 0===w||!!w,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=m??0,this._maxPitch=y??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new b.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new fo,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const s=new Er(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.tileSize=this.tileSize,s.latRange=this.latRange,s.width=this.width,s.height=this.height,s._center=this._center,s._elevation=this._elevation,s.zoom=this.zoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){void 0===s?s=!0:null===s&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new b.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const h=-b.wrap(s,-180,180)*Math.PI/180;var m;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(m=new b.ARRAY_TYPE(4),b.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(m,y,w){var S=y[0],I=y[1],k=y[2],R=y[3],z=Math.sin(w),L=Math.cos(w);m[0]=S*L+k*z,m[1]=I*L+R*z,m[2]=S*-z+k*L,m[3]=I*-z+R*L}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=b.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,m){this._unmodified=!1,this._edgeInsets.interpolate(s,h,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new b.UnwrappedTileID(0,s)];if(this._renderWorldCopies){const m=this.pointCoordinate(new b.pointGeometry(0,0)),y=this.pointCoordinate(new b.pointGeometry(this.width,0)),w=this.pointCoordinate(new b.pointGeometry(this.width,this.height)),S=this.pointCoordinate(new b.pointGeometry(0,this.height)),I=Math.floor(Math.min(m.x,y.x,w.x,S.x)),k=Math.floor(Math.max(m.x,y.x,w.x,S.x)),R=1;for(let z=I-R;z<=k+R;z++)0!==z&&h.push(new b.UnwrappedTileID(z,s))}return h}coveringTiles(s){var h,m;let y=this.coveringZoomLevel(s);const w=y;if(void 0!==s.minzoom&&y<s.minzoom)return[];void 0!==s.maxzoom&&y>s.maxzoom&&(y=s.maxzoom);const S=this.pointCoordinate(this.getCameraPoint()),I=b.MercatorCoordinate.fromLngLat(this.center),k=Math.pow(2,y),R=[k*S.x,k*S.y,0],z=[k*I.x,k*I.y,0],L=ct.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,y);let j=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(j=y);const Q=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,ee=ie=>({aabb:new da([ie*k,0,0],[(ie+1)*k,k,0]),zoom:0,x:0,y:0,wrap:ie,fullyVisible:!1}),Y=[],ae=[],_e=y,ye=s.reparseOverscaled?w:y;if(this._renderWorldCopies)for(let ie=1;ie<=3;ie++)Y.push(ee(-ie)),Y.push(ee(ie));for(Y.push(ee(0));Y.length>0;){const ie=Y.pop(),we=ie.x,De=ie.y;let Se=ie.fullyVisible;if(!Se){const ze=ie.aabb.intersects(L);if(0===ze)continue;Se=2===ze}const ke=s.terrain?R:z,Be=ie.aabb.distanceX(ke),Le=ie.aabb.distanceY(ke),Ne=Math.max(Math.abs(Be),Math.abs(Le));if(ie.zoom===_e||Ne>Q+(1<<_e-ie.zoom)-2&&ie.zoom>=j){const ze=_e-ie.zoom,ft=R[0]-.5-(we<<ze),Pt=R[1]-.5-(De<<ze);ae.push({tileID:new b.OverscaledTileID(ie.zoom===_e?ye:ie.zoom,ie.wrap,ie.zoom,we,De),distanceSq:Ra([z[0]-.5-we,z[1]-.5-De]),tileDistanceToCamera:Math.sqrt(ft*ft+Pt*Pt)})}else for(let ze=0;ze<4;ze++){const ft=(we<<1)+ze%2,Pt=(De<<1)+(ze>>1),Nt=ie.zoom+1;let mt=ie.aabb.quadrant(ze);if(s.terrain){const In=new b.OverscaledTileID(Nt,ie.wrap,Nt,ft,Pt),An=s.terrain.getMinMaxElevation(In),Ht=null!==(h=An.minElevation)&&void 0!==h?h:this.elevation,rn=null!==(m=An.maxElevation)&&void 0!==m?m:this.elevation;mt=new da([mt.min[0],mt.min[1],Ht],[mt.max[0],mt.max[1],rn])}Y.push({aabb:mt,zoom:Nt,x:ft,y:Pt,wrap:ie.wrap,fullyVisible:Se})}}return ae.sort((ie,we)=>ie.distanceSq-we.distanceSq).map(ie=>ie.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const h=b.clamp(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new b.pointGeometry(b.mercatorXfromLng(s.lng)*this.worldSize,b.mercatorYfromLat(h)*this.worldSize)}unproject(s){return new b.MercatorCoordinate(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(s){this.freezeElevation||(this.elevation=s?this.getElevation(this._center,s):0)}getElevation(s,h){const m=b.MercatorCoordinate.fromLngLat(s),y=(1<<this.tileZoom)*b.EXTENT,w=m.x*y,S=m.y*y,I=Math.floor(w/b.EXTENT),k=Math.floor(S/b.EXTENT),R=new b.OverscaledTileID(this.tileZoom,0,this.tileZoom,I,k);return h.getElevation(R,w%b.EXTENT,S%b.EXTENT,b.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const h=this.pointLocation(this.centerPoint,s),m=this.getElevation(h,s);if(!(this.elevation-m))return;const y=this.getCameraPosition(),w=b.MercatorCoordinate.fromLngLat(y.lngLat,y.altitude),S=b.MercatorCoordinate.fromLngLat(h,m),I=w.x-S.x,k=w.y-S.y,R=w.z-S.z,z=Math.sqrt(I*I+k*k+R*R),L=this.scaleZoom(this.cameraToCenterDistance/z/this.tileSize);this._elevation=m,this._center=h,this.zoom=L}setLocationAtPoint(s,h){const m=this.pointCoordinate(h),y=this.pointCoordinate(this.centerPoint),w=this.locationCoordinate(s),S=new b.MercatorCoordinate(w.x-(m.x-y.x),w.y-(m.y-y.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,h){return h?this.coordinatePoint(this.locationCoordinate(s),this.getElevation(s,h),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,h){return this.coordinateLocation(this.pointCoordinate(s,h))}locationCoordinate(s){return b.MercatorCoordinate.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,h){if(h){const j=h.pointCoordinate(s);if(null!=j)return j}const m=[s.x,s.y,0,1],y=[s.x,s.y,1,1];b.transformMat4(m,m,this.pixelMatrixInverse),b.transformMat4(y,y,this.pixelMatrixInverse);const w=m[3],S=y[3],I=m[1]/w,k=y[1]/S,R=m[2]/w,z=y[2]/S,L=R===z?0:(0-R)/(z-R);return new b.MercatorCoordinate(b.number(m[0]/w,y[0]/S,L)/this.worldSize,b.number(I,k,L)/this.worldSize)}coordinatePoint(s,h=0,m=this.pixelMatrix){const y=[s.x*this.worldSize,s.y*this.worldSize,h,1];return b.transformMat4(y,y,m),new b.pointGeometry(y[0]/y[3],y[1]/y[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return(new b.LngLatBounds).extend(this.pointLocation(new b.pointGeometry(0,s))).extend(this.pointLocation(new b.pointGeometry(this.width,s))).extend(this.pointLocation(new b.pointGeometry(this.width,this.height))).extend(this.pointLocation(new b.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new b.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(s,h=!1){const m=s.key,y=h?this._alignedPosMatrixCache:this._posMatrixCache;if(y[m])return y[m];const w=s.canonical,S=this.worldSize/this.zoomScale(w.z),I=w.x+Math.pow(2,w.z)*s.wrap,k=b.identity(new Float64Array(16));return b.translate(k,k,[I*S,w.y*S,0]),b.scale(k,k,[S/b.EXTENT,S/b.EXTENT,1]),b.multiply(k,h?this.alignedProjMatrix:this.projMatrix,k),y[m]=new Float32Array(k),y[m]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s,h,m,y,w=-90,S=90,I=-180,k=180;const R=this.size,z=this._unmodified;if(this.latRange){const Q=this.latRange;w=b.mercatorYfromLat(Q[1])*this.worldSize,S=b.mercatorYfromLat(Q[0])*this.worldSize,s=S-w<R.y?R.y/(S-w):0}if(this.lngRange){const Q=this.lngRange;I=b.wrap(b.mercatorXfromLng(Q[0])*this.worldSize,0,this.worldSize),k=b.wrap(b.mercatorXfromLng(Q[1])*this.worldSize,0,this.worldSize),k<I&&(k+=this.worldSize),h=k-I<R.x?R.x/(k-I):0}const L=this.point,j=Math.max(h||0,s||0);if(j)return this.center=this.unproject(new b.pointGeometry(h?(k+I)/2:L.x,s?(S+w)/2:L.y)),this.zoom+=this.scaleZoom(j),this._unmodified=z,void(this._constraining=!1);if(this.latRange){const Q=L.y,ee=R.y/2;Q-ee<w&&(y=w+ee),Q+ee>S&&(y=S-ee)}if(this.lngRange){const Q=(I+k)/2,ee=b.wrap(L.x,Q-this.worldSize/2,Q+this.worldSize/2),Y=R.x/2;ee-Y<I&&(m=I+Y),ee+Y>k&&(m=k-Y)}void 0===m&&void 0===y||(this.center=this.unproject(new b.pointGeometry(void 0!==m?m:L.x,void 0!==y?y:L.y)).wrap()),this._unmodified=z,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,h=this.point.x,m=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=b.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let y=b.identity(new Float64Array(16));b.scale(y,y,[this.width/2,-this.height/2,1]),b.translate(y,y,[1,-1,0]),this.labelPlaneMatrix=y,y=b.identity(new Float64Array(16)),b.scale(y,y,[1,-1,1]),b.translate(y,y,[-1,-1,0]),b.scale(y,y,[2/this.width,2/this.height,1]),this.glCoordMatrix=y,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const w=this._elevation<0?this.cameraToCenterDistance:this.cameraToSeaLevelDistance,S=Math.PI/2+this._pitch,I=this._fov*(.5+s.y/this.height),k=Math.sin(I)*w/Math.sin(b.clamp(Math.PI-S-I,.01,Math.PI-.01)),R=this.getHorizon(),z=2*Math.atan(R/this.cameraToCenterDistance)*(.5+s.y/(2*R)),L=Math.sin(z)*w/Math.sin(b.clamp(Math.PI-S-z,.01,Math.PI-.01)),j=Math.min(k,L),Q=1.01*(Math.cos(Math.PI/2-this._pitch)*j+w),ee=this.height/50;y=new Float64Array(16),b.perspective(y,this._fov,this.width/this.height,ee,Q),y[8]=2*-s.x/this.width,y[9]=2*s.y/this.height,b.scale(y,y,[1,-1,1]),b.translate(y,y,[0,0,-this.cameraToCenterDistance]),b.rotateX(y,y,this._pitch),b.rotateZ(y,y,this.angle),b.translate(y,y,[-h,-m,0]),this.mercatorMatrix=b.scale([],y,[this.worldSize,this.worldSize,this.worldSize]),b.scale(y,y,[1,1,this._pixelPerMeter]),this.pixelMatrix=b.multiply(new Float64Array(16),this.labelPlaneMatrix,y),b.translate(y,y,[0,0,-this.elevation]),this.projMatrix=y,this.invProjMatrix=b.invert([],y),this.pixelMatrix3D=b.multiply(new Float64Array(16),this.labelPlaneMatrix,y);const Y=this.width%2/2,ae=this.height%2/2,_e=Math.cos(this.angle),ye=Math.sin(this.angle),ie=h-Math.round(h)+_e*Y+ye*ae,we=m-Math.round(m)+_e*ae+ye*Y,De=new Float64Array(y);if(b.translate(De,De,[ie>.5?ie-1:ie,we>.5?we-1:we,0]),this.alignedProjMatrix=De,y=b.invert(new Float64Array(16),this.pixelMatrix),!y)throw new Error("failed to invert matrix");this.pixelMatrixInverse=y,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new b.pointGeometry(0,0)),h=[s.x*this.worldSize,s.y*this.worldSize,0,1];return b.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new b.pointGeometry(0,s))}getCameraQueryGeometry(s){const h=this.getCameraPoint();if(1===s.length)return[s[0],h];{let m=h.x,y=h.y,w=h.x,S=h.y;for(const I of s)m=Math.min(m,I.x),y=Math.min(y,I.y),w=Math.max(w,I.x),S=Math.max(S,I.y);return[new b.pointGeometry(m,y),new b.pointGeometry(w,y),new b.pointGeometry(w,S),new b.pointGeometry(m,S),new b.pointGeometry(m,y)]}}}class Bf{constructor(s){this._hashName=s&&encodeURIComponent(s),b.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(h,m){let y=!1,w=null;const S=()=>{w=null,y&&(h(),w=setTimeout(S,300),y=!1)};return()=>(y=!0,w||S(),w)}(this._updateHashUnthrottled.bind(this))}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const h=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,y),S=Math.round(h.lng*w)/w,I=Math.round(h.lat*w)/w,k=this._map.getBearing(),R=this._map.getPitch();let z="";if(z+=s?`/${S}/${I}/${m}`:`${m}/${I}/${S}`,(k||R)&&(z+="/"+Math.round(10*k)/10),R&&(z+=`/${Math.round(R)}`),this._hashName){const L=this._hashName;let j=!1;const Q=window.location.hash.slice(1).split("&").map(ee=>{const Y=ee.split("=")[0];return Y===L?(j=!0,`${Y}=${z}`):ee}).filter(ee=>ee);return j||Q.push(`${L}=${z}`),`#${Q.join("&")}`}return`#${z}`}_getCurrentHash(){const s=window.location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(h=m)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,s)}catch{}}}const Xe={linearity:.3,easing:b.bezier(0,0,.3,1)},po=b.extend({deceleration:2500,maxSpeed:1400},Xe),ld=b.extend({deceleration:20,maxSpeed:1400},Xe),Zu=b.extend({deceleration:1e3,maxSpeed:360},Xe),Vl=b.extend({deceleration:1e3,maxSpeed:90},Xe);class Po{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:b.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=b.exported.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new b.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)h.zoom+=w.zoomDelta||0,h.bearing+=w.bearingDelta||0,h.pitch+=w.pitchDelta||0,w.panDelta&&h.pan._add(w.panDelta),w.around&&(h.around=w.around),w.pinchAround&&(h.pinchAround=w.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(h.pan.mag()){const w=cd(h.pan.mag(),m,b.extend({},po,s||{}));y.offset=h.pan.mult(w.amount/h.pan.mag()),y.center=this._map.transform.center,Uc(y,w)}if(h.zoom){const w=cd(h.zoom,m,ld);y.zoom=this._map.transform.zoom+w.amount,Uc(y,w)}if(h.bearing){const w=cd(h.bearing,m,Zu);y.bearing=this._map.transform.bearing+b.clamp(w.amount,-179,179),Uc(y,w)}if(h.pitch){const w=cd(h.pitch,m,Vl);y.pitch=this._map.transform.pitch+w.amount,Uc(y,w)}if(y.zoom||y.bearing){const w=void 0===h.pinchAround?h.around:h.pinchAround;y.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),b.extend(y,{noMoveStart:!0})}}function Uc(g,s){(!g.duration||g.duration<s.duration)&&(g.duration=s.duration,g.easing=s.easing)}function cd(g,s,h){const{maxSpeed:m,linearity:y,deceleration:w}=h,S=b.clamp(g*y/(s/1e3),-m,m),I=Math.abs(S)/(w*y);return{easing:h.easing,duration:1e3*I,amount:S*(I/2)}}class Ro extends b.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,m,y={}){const w=Ie.mousePos(h.getCanvasContainer(),m),S=h.unproject(w);super(s,b.extend({point:w,lngLat:S,originalEvent:m},y)),this._defaultPrevented=!1,this.target=h}}class Ul extends b.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,m){const y="touchend"===s?m.changedTouches:m.touches,w=Ie.touchPos(h.getCanvasContainer(),y),S=w.map(k=>h.unproject(k)),I=w.reduce((k,R,z,L)=>k.add(R.div(L.length)),new b.pointGeometry(0,0));super(s,{points:w,point:I,lngLats:S,lngLat:h.unproject(I),originalEvent:m}),this._defaultPrevented=!1}}class Vf extends b.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,m){super(s,{originalEvent:m}),this._defaultPrevented=!1}}class Uf{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new Vf(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new Ro(s.type,this._map,s))}mouseup(s){this._map.fire(new Ro(s.type,this._map,s))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Ro(s.type,this._map,s))}dblclick(s){return this._firePreventable(new Ro(s.type,this._map,s))}mouseover(s){this._map.fire(new Ro(s.type,this._map,s))}mouseout(s){this._map.fire(new Ro(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Ul(s.type,this._map,s))}touchmove(s){this._map.fire(new Ul(s.type,this._map,s))}touchend(s){this._map.fire(new Ul(s.type,this._map,s))}touchcancel(s){this._map.fire(new Ul(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $f{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new Ro(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ro("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new Ro(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mo{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&0===s.button&&(Ie.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const m=h;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=m,this._box||(this._box=Ie.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const w=Math.min(y.x,m.x),S=Math.max(y.x,m.x),I=Math.min(y.y,m.y),k=Math.max(y.y,m.y);Ie.setTransform(this._box,`translate(${w}px,${I}px)`),this._box.style.width=S-w+"px",this._box.style.height=k-I+"px"}mouseupWindow(s,h){if(!this._active||0!==s.button)return;const m=this._startPos,y=h;if(this.reset(),Ie.suppressClick(),m.x!==y.x||m.y!==y.y)return this._map.fire(new b.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:w=>w.fitScreenCoordinates(m,y,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&27===s.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Ie.remove(this._box),this._box=null),Ie.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new b.Event(s,{originalEvent:h}))}}function Us(g,s){if(g.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${s.length}`);const h={};for(let m=0;m<g.length;m++)h[g[m].identifier]=s[m];return h}class $m{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,h,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=s.timeStamp),m.length===this.numTouches&&(this.centroid=function(y){const w=new b.pointGeometry(0,0);for(const S of y)w._add(S);return w.div(y.length)}(h),this.touches=Us(m,h)))}touchmove(s,h,m){if(this.aborted||!this.centroid)return;const y=Us(m,h);for(const w in this.touches){const S=y[w];(!S||S.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(s,h,m){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Wu{constructor(s){this.singleTap=new $m(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,h,m){this.singleTap.touchstart(s,h,m)}touchmove(s,h,m){this.singleTap.touchmove(s,h,m)}touchend(s,h,m){const y=this.singleTap.touchend(s,h,m);if(y){const w=s.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(y)<30;if(w&&S||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class jf{constructor(){this._zoomIn=new Wu({numTouches:1,numTaps:2}),this._zoomOut=new Wu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,m){this._zoomIn.touchstart(s,h,m),this._zoomOut.touchstart(s,h,m)}touchmove(s,h,m){this._zoomIn.touchmove(s,h,m),this._zoomOut.touchmove(s,h,m)}touchend(s,h,m){const y=this._zoomIn.touchend(s,h,m),w=this._zoomOut.touchend(s,h,m);return y?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(y)},{originalEvent:s})}):w?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(w)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $l{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const h=this._moveFunction(...s);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(s,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,h){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const y=h.length?h[0]:h;return!this._moved&&y.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(m,y))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&Ie.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const jm={0:1,2:2};class go{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const h=Ie.mouseButton(s);this._eventButton=h}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(h,m){const y=jm[m];return void 0===h.buttons||(h.buttons&y)!==y}(s,this._eventButton)}isValidEndEvent(s){return Ie.mouseButton(s)===this._eventButton}}class hr{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return 1===s.targetTouches.length}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const $c=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=function(s){s.preventDefault()}},ud=({enable:g,clickTolerance:s,bearingDegreesPerPixelMoved:h=.8})=>{const m=new go({checkCorrectEvent:y=>0===Ie.mouseButton(y)&&y.ctrlKey||2===Ie.mouseButton(y)});return new $l({clickTolerance:s,move:(y,w)=>({bearingDelta:(w.x-y.x)*h}),moveStateManager:m,enable:g,assignEvents:$c})},Xu=({enable:g,clickTolerance:s,pitchDegreesPerPixelMoved:h=-.5})=>{const m=new go({checkCorrectEvent:y=>0===Ie.mouseButton(y)&&y.ctrlKey||2===Ie.mouseButton(y)});return new $l({clickTolerance:s,move:(y,w)=>({pitchDelta:(w.y-y.y)*h}),moveStateManager:m,enable:g,assignEvents:$c})};class Yu{constructor(s,h){this._minTouches=s.cooperativeGestures?2:1,this._clickTolerance=s.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new b.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(s,h,m){return this._calculateTransform(s,h,m)}touchmove(s,h,m){if(this._map._cooperativeGestures&&(2===this._minTouches&&m.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(s,!1,m.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(m.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,h,m)}touchend(s,h,m){this._calculateTransform(s,h,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,m){m.length>0&&(this._active=!0);const y=Us(m,h),w=new b.pointGeometry(0,0),S=new b.pointGeometry(0,0);let I=0;for(const R in y){const z=y[R],L=this._touches[R];L&&(w._add(z),S._add(z.sub(L)),I++,y[R]=z)}if(this._touches=y,I<this._minTouches||!S.mag())return;const k=S.div(I);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(I),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hd{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(s){}_move(s,h,m){return{}}touchstart(s,h,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,m){if(!this._firstTwoTouches)return;s.preventDefault();const[y,w]=this._firstTwoTouches,S=dd(m,h,y),I=dd(m,h,w);if(!S||!I)return;const k=this._aroundCenter?null:S.add(I).div(2);return this._move([S,I],k,s)}touchend(s,h,m){if(!this._firstTwoTouches)return;const[y,w]=this._firstTwoTouches,S=dd(m,h,y),I=dd(m,h,w);S&&I||(this._active&&Ie.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function dd(g,s,h){for(let m=0;m<g.length;m++)if(g[m].identifier===h)return s[m]}function ys(g,s){return Math.log(g/s)/Math.LN2}class _s extends hd{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const m=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(ys(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ys(this._distance,m),pinchAround:h}}}function wt(g,s){return 180*g.angleWith(s)/Math.PI}class yt extends hd{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const m=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:wt(this._vector,m),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,m=wt(s,this._startVector);return Math.abs(m)<h}}function Ja(g){return Math.abs(g.y)>Math.abs(g.x)}class fd extends hd{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,h,m){super.touchstart(s,h,m),this._currentTouchCount=m.length}_start(s){this._lastPoints=s,Ja(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,m){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const y=s[0].sub(this._lastPoints[0]),w=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,w,m.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(y.y+w.y)/2*-.5}):void 0}gestureBeginsVertically(s,h,m){if(void 0!==this._valid)return this._valid;const y=s.mag()>=2,w=h.mag()>=2;if(!y&&!w)return;if(!y||!w)return void 0===this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const S=s.y>0==h.y>0;return Ja(s)&&Ja(h)&&S}}const pd={panStep:100,bearingStep:15,pitchStep:10};class Si{constructor(){const s=pd;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,m=0,y=0,w=0,S=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?m=-1:(s.preventDefault(),w=-1);break;case 39:s.shiftKey?m=1:(s.preventDefault(),w=1);break;case 38:s.shiftKey?y=1:(s.preventDefault(),S=-1);break;case 40:s.shiftKey?y=-1:(s.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:I=>{const k=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:jc,zoom:h?Math.round(k)+h*(s.shiftKey?2:1):k,bearing:I.getBearing()+m*this._bearingStep,pitch:I.getPitch()+y*this._pitchStep,offset:[-w*this._panStep,-S*this._panStep],center:I.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jc(g){return g*(2-g)}const Ko=4.000244140625;class md{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,b.bindAll(["_onTimeout"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=s&&"center"===s.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;s.preventDefault()}let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const m=b.exported.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==h&&h%Ko==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(y*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=Ie.mousePos(this._el,s);this._around=b.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;if(0!==this._delta){const I="wheel"===this._type&&Math.abs(this._delta)>Ko?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&0!==k&&(k=1/k);const R="number"==typeof this._targetZoom?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(R*k))),"wheel"===this._type&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h="number"==typeof this._targetZoom?this._targetZoom:s.zoom,m=this._startZoom,y=this._easing;let w,S=!1;if("wheel"===this._type&&m&&y){const I=Math.min((b.exported.now()-this._lastWheelEventTime)/200,1),k=y(I);w=b.number(m,h,k),I<1?this._frameId||(this._frameId=!0):S=!0}else w=h,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:w-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=b.ease;if(this._prevEase){const m=this._prevEase,y=(b.exported.now()-m.start)/m.duration,w=m.easing(y+.01)-m.easing(y),S=.27/Math.sqrt(w*w+1e-4)*.01,I=Math.sqrt(.0729-S*S);h=b.bezier(S,I,.25,1)}return this._prevEase={start:b.exported.now(),duration:s,easing:h},h}reset(){this._active=!1}}class Ku{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Tn{constructor(){this.reset()}reset(){this._active=!1}dblclick(s,h){return s.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(s.shiftKey?-1:1),around:m.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dr{constructor(){this._tap=new Wu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(s,h,m){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=h[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(s,h,m))}touchmove(s,h,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=h[0],w=y.y-this._swipePoint.y;return this._swipePoint=y,s.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(s,h,m)}touchend(s,h,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(s,h,m)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hf{constructor(s,h,m){this._el=s,this._mousePan=h,this._touchPan=m}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qa{constructor(s,h,m){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ju{constructor(s,h,m,y){this._el=s,this._touchZoom=h,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Hc=g=>g.zoom||g.drag||g.pitch||g.rotate;class Sr extends b.Event{}function Gc(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Qu{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Po(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),b.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,w,S]of this._listeners)Ie.addEventListener(y,w,y===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[s,h,m]of this._listeners)Ie.removeEventListener(s,h,s===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(s){const h=this._map,m=h.getCanvasContainer();this._add("mapEvent",new Uf(h,s));const y=h.boxZoom=new mo(h,s);this._add("boxZoom",y);const w=new jf,S=new Tn;h.doubleClickZoom=new Ku(S,w),this._add("tapZoom",w),this._add("clickZoom",S);const I=new Dr;this._add("tapDragZoom",I);const k=h.touchPitch=new fd(h);this._add("touchPitch",k);const R=ud(s),z=Xu(s);h.dragRotate=new Qa(s,R,z),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const L=(({enable:_e,clickTolerance:ye})=>{const ie=new go({checkCorrectEvent:we=>0===Ie.mouseButton(we)&&!we.ctrlKey});return new $l({clickTolerance:ye,move:(we,De)=>({around:De,panDelta:De.sub(we)}),activateOnStart:!0,moveStateManager:ie,enable:_e,assignEvents:$c})})(s),j=new Yu(s,h);h.dragPan=new Hf(m,L,j),this._add("mousePan",L),this._add("touchPan",j,["touchZoom","touchRotate"]);const Q=new yt,ee=new _s;h.touchZoomRotate=new Ju(m,ee,Q,I),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]);const Y=h.scrollZoom=new md(h,this);this._add("scrollZoom",Y,["mousePan"]);const ae=h.keyboard=new Si;this._add("keyboard",ae),this._add("blockableMapEvent",new $f(h));for(const _e of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[_e]&&h[_e].enable(s[_e])}_add(s,h,m){this._handlers.push({handlerName:s,handler:h,allowed:m}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Hc(this._eventsInProgress))||this.isZooming()}_blockedByActive(s,h,m){for(const y in s)if(y!==m&&(!h||h.indexOf(y)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const h=[];for(const m of s)this._el.contains(m.target)&&h.push(m);return h}handleEvent(s,h){if("blur"===s.type)return void this.stop(!0);this._updatingCamera=!0;const m="renderFrame"===s.type?void 0:s,y={needsRenderFrame:!1},w={},S={},I=s.touches,k=I?this._getMapTouches(I):void 0,R=k?Ie.touchPos(this._el,k):Ie.mousePos(this._el,s);for(const{handlerName:j,handler:Q,allowed:ee}of this._handlers){if(!Q.isEnabled())continue;let Y;this._blockedByActive(S,ee,j)?Q.reset():Q[h||s.type]&&(Y=Q[h||s.type](s,R,k),this.mergeHandlerResult(y,w,Y,j,m),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||Q.isActive())&&(S[j]=Q)}const z={};for(const j in this._previousActiveHandlers)S[j]||(z[j]=m);this._previousActiveHandlers=S,(Object.keys(z).length||Gc(y))&&(this._changes.push([y,w,z]),this._triggerRenderFrame()),(Object.keys(S).length||Gc(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:L}=y;L&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],L(this._map))}mergeHandlerResult(s,h,m,y,w){if(!m)return;b.extend(s,m);const S={handlerName:y,originalEvent:m.originalEvent||w};void 0!==m.zoomDelta&&(h.zoom=S),void 0!==m.panDelta&&(h.drag=S),void 0!==m.pitchDelta&&(h.pitch=S),void 0!==m.bearingDelta&&(h.rotate=S)}_applyChanges(){const s={},h={},m={};for(const[y,w,S]of this._changes)y.panDelta&&(s.panDelta=(s.panDelta||new b.pointGeometry(0,0))._add(y.panDelta)),y.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+y.pitchDelta),void 0!==y.around&&(s.around=y.around),void 0!==y.pinchAround&&(s.pinchAround=y.pinchAround),y.noInertia&&(s.noInertia=y.noInertia),b.extend(h,w),b.extend(m,S);this._updateMapTransform(s,h,m),this._changes=[]}_updateMapTransform(s,h,m){const y=this._map,w=y.transform,S=y.terrain;if(!(Gc(s)||S&&this._terrainMovement))return this._fireEvents(h,m,!0);let{panDelta:I,zoomDelta:k,bearingDelta:R,pitchDelta:z,around:L,pinchAround:j}=s;void 0!==j&&(L=j),y._stop(!0),L=L||y.transform.centerPoint;const Q=w.pointLocation(I?L.sub(I):L);R&&(w.bearing+=R),z&&(w.pitch+=z),k&&(w.zoom+=k),S?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?w.center=w.pointLocation(w.centerPoint.sub(I)):w.setLocationAtPoint(Q,L):(this._terrainMovement=!0,w.freezeElevation=!0,w.setLocationAtPoint(Q,L),this._map.once("moveend",()=>{w.freezeElevation=!1,this._terrainMovement=!1,w.recalculateZoom(y.terrain)})):w.setLocationAtPoint(Q,L),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,m,!0)}_fireEvents(s,h,m){const y=Hc(this._eventsInProgress),w=Hc(s),S={};for(const z in s){const{originalEvent:L}=s[z];this._eventsInProgress[z]||(S[`${z}start`]=L),this._eventsInProgress[z]=s[z]}!y&&w&&this._fireEvent("movestart",w.originalEvent);for(const z in S)this._fireEvent(z,S[z]);w&&this._fireEvent("move",w.originalEvent);for(const z in s){const{originalEvent:L}=s[z];this._fireEvent(z,L)}const I={};let k;for(const z in this._eventsInProgress){const{handlerName:L,originalEvent:j}=this._eventsInProgress[z];this._handlersById[L].isActive()||(delete this._eventsInProgress[z],k=h[L]||j,I[`${z}end`]=k)}for(const z in I)this._fireEvent(z,I[z]);const R=Hc(this._eventsInProgress);if(m&&(y||w)&&!R){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=j=>0!==j&&-this._bearingSnap<j&&j<this._bearingSnap;z?(L(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:k})):(this._map.fire(new b.Event("moveend",{originalEvent:k})),L(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new b.Event(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Sr("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const jl={extend:(g,...s)=>b.extend(g,...s),run(g){g()},logToElement(g,s=!1,h="log"){const m=window.document.getElementById(h);m&&(s&&(m.innerHTML=""),m.innerHTML+=`<br>${g}`)}};class Mi extends b.Evented{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,b.bindAll(["_renderFrameCallback"],this)}getCenter(){return new b.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,m){return s=b.pointGeometry.convert(s).mult(-1),this.panTo(this.transform.center,b.extend({offset:s},h),m)}panTo(s,h,m){return this.easeTo(b.extend({center:s},h),m)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,m){return this.easeTo(b.extend({zoom:s},h),m)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,m){return this.easeTo(b.extend({bearing:s},h),m)}resetNorth(s,h){return this.rotateTo(0,b.extend({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(b.extend({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=b.LngLatBounds.convert(s);const m=h&&h.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),m,h)}_cameraForBoxAndBearing(s,h,m,y){const w={top:0,bottom:0,right:0,left:0};if("number"==typeof(y=b.extend({padding:w,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding){const De=y.padding;y.padding={top:De,bottom:De,right:De,left:De}}y.padding=b.extend(w,y.padding);const S=this.transform,I=S.padding,k=S.project(b.LngLat.convert(s)),R=S.project(b.LngLat.convert(h)),z=k.rotate(-m*Math.PI/180),L=R.rotate(-m*Math.PI/180),j=new b.pointGeometry(Math.max(z.x,L.x),Math.max(z.y,L.y)),Q=new b.pointGeometry(Math.min(z.x,L.x),Math.min(z.y,L.y)),ee=j.sub(Q),Y=(S.width-(I.left+I.right+y.padding.left+y.padding.right))/ee.x,ae=(S.height-(I.top+I.bottom+y.padding.top+y.padding.bottom))/ee.y;if(ae<0||Y<0)return void b.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const _e=Math.min(S.scaleZoom(S.scale*Math.min(Y,ae)),y.maxZoom),ye=b.pointGeometry.convert(y.offset),ie=new b.pointGeometry((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(m*Math.PI/180),we=ye.add(ie).mult(S.scale/S.zoomScale(_e));return{center:S.unproject(k.add(R).div(2).sub(we)),zoom:_e,bearing:m}}fitBounds(s,h,m){return this._fitInternal(this.cameraForBounds(s,h),h,m)}fitScreenCoordinates(s,h,m,y,w){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(b.pointGeometry.convert(s)),this.transform.pointLocation(b.pointGeometry.convert(h)),m,y),y,w)}_fitInternal(s,h,m){return s?(delete(h=b.extend(s,h)).padding,h.linear?this.easeTo(h,m):this.flyTo(h,m)):this}jumpTo(s,h){this.stop();const m=this.transform;let y=!1,w=!1,S=!1;return"zoom"in s&&m.zoom!==+s.zoom&&(y=!0,m.zoom=+s.zoom),void 0!==s.center&&(m.center=b.LngLat.convert(s.center)),"bearing"in s&&m.bearing!==+s.bearing&&(w=!0,m.bearing=+s.bearing),"pitch"in s&&m.pitch!==+s.pitch&&(S=!0,m.pitch=+s.pitch),null==s.padding||m.isPaddingEqual(s.padding)||(m.padding=s.padding),this.fire(new b.Event("movestart",h)).fire(new b.Event("move",h)),y&&this.fire(new b.Event("zoomstart",h)).fire(new b.Event("zoom",h)).fire(new b.Event("zoomend",h)),w&&this.fire(new b.Event("rotatestart",h)).fire(new b.Event("rotate",h)).fire(new b.Event("rotateend",h)),S&&this.fire(new b.Event("pitchstart",h)).fire(new b.Event("pitch",h)).fire(new b.Event("pitchend",h)),this.fire(new b.Event("moveend",h))}calculateCameraOptionsFromTo(s,h,m,y=0){const w=b.MercatorCoordinate.fromLngLat(s,h),S=b.MercatorCoordinate.fromLngLat(m,y),I=S.x-w.x,k=S.y-w.y,R=S.z-w.z,z=Math.hypot(I,k,R);if(0===z)throw new Error("Can't calculate camera options with same From and To");const L=Math.hypot(I,k),j=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),Q=180*Math.atan2(I,-k)/Math.PI;let ee=180*Math.acos(L/z)/Math.PI;return ee=R<0?90-ee:90+ee,{center:S.toLngLat(),zoom:j,pitch:ee,bearing:Q}}easeTo(s,h){this._stop(!1,s.easeId),(!1===(s=b.extend({offset:[0,0],duration:500,easing:b.ease},s)).animate||!s.essential&&b.exported.prefersReducedMotion)&&(s.duration=0);const m=this.transform,y=this.getZoom(),w=this.getBearing(),S=this.getPitch(),I=this.getPadding(),k="zoom"in s?+s.zoom:y,R="bearing"in s?this._normalizeBearing(s.bearing,w):w,z="pitch"in s?+s.pitch:S,L="padding"in s?s.padding:m.padding,j=b.pointGeometry.convert(s.offset);let Q=m.centerPoint.add(j);const ee=m.pointLocation(Q),Y=b.LngLat.convert(s.center||ee);this._normalizeCenter(Y);const ae=m.project(ee),_e=m.project(Y).sub(ae),ye=m.zoomScale(k-y);let ie,we;s.around&&(ie=b.LngLat.convert(s.around),we=m.locationPoint(ie));const De={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||k!==y,this._rotating=this._rotating||w!==R,this._pitching=this._pitching||z!==S,this._padding=!m.isPaddingEqual(L),this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,De),this.terrain&&this._prepareElevation(Y),this._ease(Se=>{if(this._zooming&&(m.zoom=b.number(y,k,Se)),this._rotating&&(m.bearing=b.number(w,R,Se)),this._pitching&&(m.pitch=b.number(S,z,Se)),this._padding&&(m.interpolatePadding(I,L,Se),Q=m.centerPoint.add(j)),this.terrain&&!s.freezeElevation&&this._updateElevation(Se),ie)m.setLocationAtPoint(ie,we);else{const ke=m.zoomScale(m.zoom-y),Be=k>y?Math.min(2,ye):Math.max(.5,ye),Le=Math.pow(Be,1-Se),Ne=m.unproject(ae.add(_e.mult(Se*Le)).mult(ke));m.setLocationAtPoint(m.renderWorldCopies?Ne.wrap():Ne,Q)}this._fireMoveEvents(h)},Se=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,Se)},s),this}_prepareEase(s,h,m={}){this._moving=!0,h||m.moving||this.fire(new b.Event("movestart",s)),this._zooming&&!m.zooming&&this.fire(new b.Event("zoomstart",s)),this._rotating&&!m.rotating&&this.fire(new b.Event("rotatestart",s)),this._pitching&&!m.pitching&&this.fire(new b.Event("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.transform.getElevation(s,this.terrain),this.transform.freezeElevation=!0}_updateElevation(s){const h=this.transform.getElevation(this._elevationCenter,this.terrain);if(s<1&&h!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(m-(h-(m*s+this._elevationStart))/(1-s)),this._elevationTarget=h}this.transform.elevation=b.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this.transform.freezeElevation=!1,this.transform.recalculateZoom(this.terrain)}_fireMoveEvents(s){this.fire(new b.Event("move",s)),this._zooming&&this.fire(new b.Event("zoom",s)),this._rotating&&this.fire(new b.Event("rotate",s)),this._pitching&&this.fire(new b.Event("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const m=this._zooming,y=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new b.Event("zoomend",s)),y&&this.fire(new b.Event("rotateend",s)),w&&this.fire(new b.Event("pitchend",s)),this.fire(new b.Event("moveend",s))}flyTo(s,h){if(!s.essential&&b.exported.prefersReducedMotion){const mt=b.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(mt,h)}this.stop(),s=b.extend({offset:[0,0],speed:1.2,curve:1.42,easing:b.ease},s);const m=this.transform,y=this.getZoom(),w=this.getBearing(),S=this.getPitch(),I=this.getPadding(),k="zoom"in s?b.clamp(+s.zoom,m.minZoom,m.maxZoom):y,R="bearing"in s?this._normalizeBearing(s.bearing,w):w,z="pitch"in s?+s.pitch:S,L="padding"in s?s.padding:m.padding,j=m.zoomScale(k-y),Q=b.pointGeometry.convert(s.offset);let ee=m.centerPoint.add(Q);const Y=m.pointLocation(ee),ae=b.LngLat.convert(s.center||Y);this._normalizeCenter(ae);const _e=m.project(Y),ye=m.project(ae).sub(_e);let ie=s.curve;const we=Math.max(m.width,m.height),De=we/j,Se=ye.mag();if("minZoom"in s){const mt=b.clamp(Math.min(s.minZoom,y,k),m.minZoom,m.maxZoom),In=we/m.zoomScale(mt-y);ie=Math.sqrt(In/Se*2)}const ke=ie*ie;function Be(mt){const In=(De*De-we*we+(mt?-1:1)*ke*ke*Se*Se)/(2*(mt?De:we)*ke*Se);return Math.log(Math.sqrt(In*In+1)-In)}function Le(mt){return(Math.exp(mt)-Math.exp(-mt))/2}function Ne(mt){return(Math.exp(mt)+Math.exp(-mt))/2}const ze=Be(0);let ft=function(mt){return Ne(ze)/Ne(ze+ie*mt)},Pt=function(mt){return we*((Ne(ze)*(Le(In=ze+ie*mt)/Ne(In))-Le(ze))/ke)/Se;var In},Nt=(Be(1)-ze)/ie;if(Math.abs(Se)<1e-6||!isFinite(Nt)){if(Math.abs(we-De)<1e-6)return this.easeTo(s,h);const mt=De<we?-1:1;Nt=Math.abs(Math.log(De/we))/ie,Pt=function(){return 0},ft=function(In){return Math.exp(mt*ie*In)}}return s.duration="duration"in s?+s.duration:1e3*Nt/("screenSpeed"in s?+s.screenSpeed/ie:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=w!==R,this._pitching=z!==S,this._padding=!m.isPaddingEqual(L),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(ae),this._ease(mt=>{const In=mt*Nt,An=1/ft(In);m.zoom=1===mt?k:y+m.scaleZoom(An),this._rotating&&(m.bearing=b.number(w,R,mt)),this._pitching&&(m.pitch=b.number(S,z,mt)),this._padding&&(m.interpolatePadding(I,L,mt),ee=m.centerPoint.add(Q)),this.terrain&&!s.freezeElevation&&this._updateElevation(mt);const Ht=1===mt?ae:m.unproject(_e.add(ye.mult(Pt(In))).mult(An));m.setLocationAtPoint(m.renderWorldCopies?Ht.wrap():Ht,ee),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,h)}if(!s){const m=this.handlers;m&&m.stop(!1)}return this}_ease(s,h,m){!1===m.animate||0===m.duration?(s(1),h()):(this._easeStart=b.exported.now(),this._easeOptions=m,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((b.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=b.wrap(s,-180,180);const m=Math.abs(s-h);return Math.abs(s-360-h)<m&&(s-=360),Math.abs(s+360-h)<m&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const m=s.lng-h.center.lng;s.lng+=m>180?-360:m<-180?360:0}}class eh{constructor(s={}){this.options=s,b.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options&&this.options.compact,this._container=Ie.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Ie.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ie.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Ie.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const m=this._map._getUIString(`AttributionControl.${h}`);s.title=m,s.setAttribute("aria-label",m)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))}_updateData(s){!s||"metadata"!==s.sourceDataType&&"visibility"!==s.sourceDataType&&"style"!==s.dataType&&"terrain"!==s.type||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(y=>"string"!=typeof y?"":y)):"string"==typeof this.options.customAttribution&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const h=this._map.style.sourceCaches;for(const y in h){const w=h[y];if(w.used||w.usedForTerrain){const S=w.getSource();S.attribution&&s.indexOf(S.attribution)<0&&s.push(S.attribution)}}s=s.filter(y=>String(y).trim()),s.sort((y,w)=>y.length-w.length),s=s.filter((y,w)=>{for(let S=w+1;S<s.length;S++)if(s[S].indexOf(y)>=0)return!1;return!0});const m=s.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,s.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")}}class Hl{constructor(s={}){this.options=s,b.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=Ie.create("div","maplibregl-ctrl");const h=Ie.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Ie.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const s=this._container.children;if(s.length){const h=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&h.classList.add("maplibregl-compact"):h.classList.remove("maplibregl-compact")}}}class fa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,m=h?this._queue.concat(h):this._queue;for(const y of m)if(y.id===s)return void(y.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const m of h)if(!m.cancelled&&(m.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Ti={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var gd=b.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class Gl extends b.Evented{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,h){this.sourceCache.update(s,h),this._renderableTilesKeys=[];const m={};for(const y of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))m[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.posMatrix=new Float64Array(16),b.ortho(y.posMatrix,0,b.EXTENT,0,b.EXTENT,0,1),this._tiles[y.key]=new jt(y,this.tileSize));for(const y in this._tiles)m[y]||delete this._tiles[y]}freeRtt(s){for(const h in this._tiles){const m=this._tiles[h];(!s||m.tileID.equals(s)||m.tileID.isChildOf(s)||s.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const h={};for(const m of this._renderableTilesKeys){const y=this._tiles[m].tileID;if(y.canonical.equals(s.canonical)){const w=s.clone();w.posMatrix=new Float64Array(16),b.ortho(w.posMatrix,0,b.EXTENT,0,b.EXTENT,0,1),h[m]=w}else if(y.canonical.isChildOf(s.canonical)){const w=s.clone();w.posMatrix=new Float64Array(16);const S=y.canonical.z-s.canonical.z,I=y.canonical.x-(y.canonical.x>>S<<S),k=y.canonical.y-(y.canonical.y>>S<<S),R=b.EXTENT>>S;b.ortho(w.posMatrix,0,R,0,R,0,1),b.translate(w.posMatrix,w.posMatrix,[-I*R,-k*R,0]),h[m]=w}else if(s.canonical.isChildOf(y.canonical)){const w=s.clone();w.posMatrix=new Float64Array(16);const S=s.canonical.z-y.canonical.z,I=s.canonical.x-(s.canonical.x>>S<<S),k=s.canonical.y-(s.canonical.y>>S<<S),R=b.EXTENT>>S;b.ortho(w.posMatrix,0,b.EXTENT,0,b.EXTENT,0,1),b.translate(w.posMatrix,w.posMatrix,[I*R,k*R,0]),b.scale(w.posMatrix,w.posMatrix,[1/2**S,1/2**S,0]),h[m]=w}}return h}getSourceTile(s,h){const m=this.sourceCache._source;let y=s.overscaledZ-this.deltaZoom;if(y>m.maxzoom&&(y=m.maxzoom),y<m.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(y).key);let w=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!w||!w.dem)&&h)for(;y>=m.minzoom&&(!w||!w.dem);)w=this.sourceCache.getTileByID(s.scaledTo(y--).key);return w}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=s)}}class th{constructor(s,h,m){this.painter=s,this.sourceCache=new Gl(h),this.options=m,this.exaggeration="number"==typeof m.exaggeration?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,h,m,y=b.EXTENT){if(!(h>=0&&h<y&&m>=0&&m<y))return 0;let w=0;const S=this.getTerrainData(s);if(S.tile&&S.tile.dem){const I=((ee=[])[0]=(ae=S.u_terrain_matrix)[0]*(_e=(Y=[h/y*b.EXTENT,m/y*b.EXTENT])[0])+ae[4]*(ye=Y[1])+ae[12],ee[1]=ae[1]*_e+ae[5]*ye+ae[13],ee),k=[I[0]*S.tile.dem.dim,I[1]*S.tile.dem.dim],R=[Math.floor(k[0]),Math.floor(k[1])],z=S.tile.dem.get(R[0],R[1]),L=S.tile.dem.get(R[0],R[1]+1),j=S.tile.dem.get(R[0]+1,R[1]),Q=S.tile.dem.get(R[0]+1,R[1]+1);w=b.number(b.number(z,L,k[0]-R[0]),b.number(j,Q,k[0]-R[0]),k[1]-R[1])}var ee,Y,ae,_e,ye;return w}getElevation(s,h,m,y=b.EXTENT){return this.getDEMElevation(s,h,m,y)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const y=this.painter.context,w=new b.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Gn(y,w,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Gn(y,new b.RGBAImage({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=b.identity([])}const h=this.sourceCache.getSourceTile(s,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const y=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new Gn(y,h.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),h.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const m=h&&h+h.tileID.key+s.key;if(m&&!this._demMatrixCache[m]){const y=this.sourceCache.sourceCache._source.maxzoom;let w=s.canonical.z-h.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=y?w=s.canonical.z-y:b.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=s.canonical.x-(s.canonical.x>>w<<w),I=s.canonical.y-(s.canonical.y>>w<<w),k=b.fromScaling(new Float64Array(16),[1/(b.EXTENT<<w),1/(b.EXTENT<<w),0]);b.translate(k,k,[S*b.EXTENT,I*b.EXTENT,0]),this._demMatrixCache[s.key]={matrix:k,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(s){const h=this.painter,m=h.width/devicePixelRatio,y=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Gn(h.context,{width:m,height:y,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Gn(h.context,{width:m,height:y,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(m,y,!0),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,m,y))),this._fbo.colorAttachment.set("coords"===s?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let w=0,S=0;w<this._coordsTextureSize;w++)for(let I=0;I<this._coordsTextureSize;I++,S+=4)h[S+0]=255&I,h[S+1]=255&w,h[S+2]=I>>8<<4|w>>8,h[S+3]=0;const m=new b.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),y=new Gn(s,m,s.gl.RGBA,{premultiply:!1});return y.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(s){const h=new Uint8Array(4),m=this.painter.context,y=m.gl;m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,h),m.bindFramebuffer.set(null);const w=h[0]+(h[2]>>4<<8),S=h[1]+((15&h[2])<<8),I=this.coordsIndex[255-h[3]],k=I&&this.sourceCache.getTileByID(I);if(!k)return null;const R=this._coordsTextureSize,z=(1<<k.tileID.canonical.z)*R;return new b.MercatorCoordinate((k.tileID.canonical.x*R+w)/z,(k.tileID.canonical.y*R+S)/z,this.getElevation(k.tileID,w,S,R))}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.painter.context,h=new b.Pos3dArray,m=new b.TriangleIndexArray,y=this.meshSize,w=b.EXTENT/y,S=y*y;for(let L=0;L<=y;L++)for(let j=0;j<=y;j++)h.emplaceBack(j*w,L*w,0);for(let L=0;L<S;L+=y+1)for(let j=0;j<y;j++)m.emplaceBack(j+L,y+j+L+1,y+j+L+2),m.emplaceBack(j+L,y+j+L+2,j+L+1);const I=h.length,k=I+2*(y+1);for(const L of[0,1])for(let j=0;j<=y;j++)for(const Q of[0,1])h.emplaceBack(j*w,L*b.EXTENT,Q);for(let L=0;L<2*y;L+=2)m.emplaceBack(k+L,k+L+1,k+L+3),m.emplaceBack(k+L,k+L+3,k+L+2),m.emplaceBack(I+L,I+L+3,I+L+1),m.emplaceBack(I+L,I+L+2,I+L+3);const R=h.length,z=R+2*(y+1);for(const L of[0,1])for(let j=0;j<=y;j++)for(const Q of[0,1])h.emplaceBack(L*b.EXTENT,j*w,Q);for(let L=0;L<2*y;L+=2)m.emplaceBack(R+L,R+L+1,R+L+3),m.emplaceBack(R+L,R+L+3,R+L+2),m.emplaceBack(z+L,z+L+3,z+L+1),m.emplaceBack(z+L,z+L+2,z+L+3);return this._mesh={indexBuffer:s.createIndexBuffer(m),vertexBuffer:s.createVertexBuffer(h,gd.members),segments:b.SegmentVector.simpleSegment(0,0,h.length,m.length)},this._mesh}getMeshFrameDelta(s){return 2*Math.PI*b.earthRadius/Math.pow(2,s)/5}getMinMaxElevation(s){const h=this.getTerrainData(s).tile,m={minElevation:null,maxElevation:null};return h&&h.dem&&(m.minElevation=h.dem.min*this.exaggeration,m.maxElevation=h.dem.max*this.exaggeration),m}}class vs{constructor(s,h,m){this._context=s,this._size=h,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0),m=new Gn(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_COMPONENT16,this._tileSize,this._tileSize)),h.colorAttachment.set(m.texture),{id:s,fbo:h,texture:m,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>s.id!==h),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some(s=>!s.inUse)}}const $s={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ql{constructor(s,h){this.painter=s,this.terrain=h,this.pool=new vs(s.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(m=>!s._layers[m].isHidden(h)),this._coordsDescendingInv={};for(const m in s.sourceCaches){this._coordsDescendingInv[m]={};const y=s.sourceCaches[m].getVisibleCoordinates();for(const w of y){const S=this.terrain.sourceCache.getTerrainCoords(w);for(const I in S)this._coordsDescendingInv[m][I]||(this._coordsDescendingInv[m][I]=[]),this._coordsDescendingInv[m][I].push(S[I])}}this._coordsDescendingInvStr={};for(const m of s._order){const y=s._layers[m],w=y.source;if($s[y.type]&&!this._coordsDescendingInvStr[w]){this._coordsDescendingInvStr[w]={};for(const S in this._coordsDescendingInv[w])this._coordsDescendingInvStr[w][S]=this._coordsDescendingInv[w][S].map(I=>I.key).sort().join()}}for(const m of this._renderableTiles)for(const y in this._coordsDescendingInvStr){const w=this._coordsDescendingInvStr[y][m.tileID.key];w&&w!==m.rttCoords[y]&&(m.rtt=[])}}renderLayer(s){if(s.isHidden(this.painter.transform.zoom))return!1;const h=s.type,m=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if($s[h]&&(this._prevType&&$s[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(s.id),!y))return!0;if($s[this._prevType]||$s[h]&&y){this._prevType=h;const w=this._stacks.length-1,S=this._stacks[w]||[];for(const I of this._renderableTiles){if(this.pool.isFull()&&(ad(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(I),I.rtt[w]){const R=this.pool.getObjectForId(I.rtt[w].id);if(R.stamp===I.rtt[w].stamp){this.pool.useObject(R);continue}}const k=this.pool.getOrCreateFreeObject();this.pool.useObject(k),this.pool.stampObject(k),I.rtt[w]={id:k.id,stamp:k.stamp},m.context.bindFramebuffer.set(k.fbo.framebuffer),m.context.clear({color:b.Color.transparent});for(let R=0;R<S.length;R++){const z=m.style._layers[S[R]],L=z.source?this._coordsDescendingInv[z.source][I.tileID.key]:[I.tileID];m.context.viewport.set([0,0,k.fbo.width,k.fbo.height]),m._renderTileClippingMasks(z,L),m.renderLayer(m,m.style.sourceCaches[z.source],z,L),z.source&&(I.rttCoords[z.source]=this._coordsDescendingInvStr[z.source][I.tileID.key])}}return ad(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),$s[h]}return!1}}const nh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},yd=g=>{g.touchstart=g.dragStart,g.touchmoveWindow=g.dragMove,g.touchend=g.dragEnd},_d={showCompass:!0,showZoom:!0,visualizePitch:!1};class Gf{constructor(s,h,m=!1){this._clickTolerance=10;const y=s.dragRotate._mouseRotate.getClickTolerance(),w=s.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=ud({clickTolerance:y,enable:!0}),this.touchRotate=(({enable:S,clickTolerance:I,bearingDegreesPerPixelMoved:k=.8})=>{const R=new hr;return new $l({clickTolerance:I,move:(z,L)=>({bearingDelta:(L.x-z.x)*k}),moveStateManager:R,enable:S,assignEvents:yd})})({clickTolerance:y,enable:!0}),this.map=s,m&&(this.mousePitch=Xu({clickTolerance:w,enable:!0}),this.touchPitch=(({enable:S,clickTolerance:I,pitchDegreesPerPixelMoved:k=-.5})=>{const R=new hr;return new $l({clickTolerance:I,move:(z,L)=>({pitchDelta:(L.y-z.y)*k}),moveStateManager:R,enable:S,assignEvents:yd})})({clickTolerance:w,enable:!0})),b.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Ie.addEventListener(h,"mousedown",this.mousedown),Ie.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),Ie.addEventListener(h,"touchcancel",this.reset)}startMouse(s,h){this.mouseRotate.dragStart(s,h),this.mousePitch&&this.mousePitch.dragStart(s,h),Ie.disableDrag()}startTouch(s,h){this.touchRotate.dragStart(s,h),this.touchPitch&&this.touchPitch.dragStart(s,h),Ie.disableDrag()}moveMouse(s,h){const m=this.map,{bearingDelta:y}=this.mouseRotate.dragMove(s,h)||{};if(y&&m.setBearing(m.getBearing()+y),this.mousePitch){const{pitchDelta:w}=this.mousePitch.dragMove(s,h)||{};w&&m.setPitch(m.getPitch()+w)}}moveTouch(s,h){const m=this.map,{bearingDelta:y}=this.touchRotate.dragMove(s,h)||{};if(y&&m.setBearing(m.getBearing()+y),this.touchPitch){const{pitchDelta:w}=this.touchPitch.dragMove(s,h)||{};w&&m.setPitch(m.getPitch()+w)}}off(){const s=this.element;Ie.removeEventListener(s,"mousedown",this.mousedown),Ie.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),Ie.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ie.removeEventListener(window,"touchend",this.touchend),Ie.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){Ie.enableDrag(),Ie.removeEventListener(window,"mousemove",this.mousemove),Ie.removeEventListener(window,"mouseup",this.mouseup),Ie.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ie.removeEventListener(window,"touchend",this.touchend)}mousedown(s){this.startMouse(b.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),Ie.mousePos(this.element,s)),Ie.addEventListener(window,"mousemove",this.mousemove),Ie.addEventListener(window,"mouseup",this.mouseup)}mousemove(s){this.moveMouse(s,Ie.mousePos(this.element,s))}mouseup(s){this.mouseRotate.dragEnd(s),this.mousePitch&&this.mousePitch.dragEnd(s),this.offTemp()}touchstart(s){1!==s.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ie.touchPos(this.element,s.targetTouches)[0],this.startTouch(s,this._startPos),Ie.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ie.addEventListener(window,"touchend",this.touchend))}touchmove(s){1!==s.targetTouches.length?this.reset():(this._lastPos=Ie.touchPos(this.element,s.targetTouches)[0],this.moveTouch(s,this._lastPos))}touchend(s){0===s.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function vd(g,s,h){if(g=new b.LngLat(g.lng,g.lat),s){const m=new b.LngLat(g.lng-360,g.lat),y=new b.LngLat(g.lng+360,g.lat),w=h.locationPoint(g).distSqr(s);h.locationPoint(m).distSqr(s)<w?g=m:h.locationPoint(y).distSqr(s)<w&&(g=y)}for(;Math.abs(g.lng-h.center.lng)>180;){const m=h.locationPoint(g);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const qc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function bd(g,s,h){const m=g.classList;for(const y in qc)m.remove(`maplibregl-${h}-anchor-${y}`);m.add(`maplibregl-${h}-anchor-${s}`)}class rh extends b.Evented{constructor(s,h){if(super(),(s instanceof HTMLElement||h)&&(s=b.extend({element:s},h)),b.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&"auto"!==s.pitchAlignment?s.pitchAlignment:this._rotationAlignment,s&&s.element)this._element=s.element,this._offset=b.pointGeometry.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ie.create("div"),this._element.setAttribute("aria-label","Map marker");const m=Ie.createNS("http://www.w3.org/2000/svg","svg"),y=41,w=27;m.setAttributeNS(null,"display","block"),m.setAttributeNS(null,"height",`${y}px`),m.setAttributeNS(null,"width",`${w}px`),m.setAttributeNS(null,"viewBox",`0 0 ${w} ${y}`);const S=Ie.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const I=Ie.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const k=Ie.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");const R=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ye of R){const ie=Ie.createNS("http://www.w3.org/2000/svg","ellipse");ie.setAttributeNS(null,"opacity","0.04"),ie.setAttributeNS(null,"cx","10.5"),ie.setAttributeNS(null,"cy","5.80029008"),ie.setAttributeNS(null,"rx",ye.rx),ie.setAttributeNS(null,"ry",ye.ry),k.appendChild(ie)}const z=Ie.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const L=Ie.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(L);const j=Ie.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"fill","#000000");const Q=Ie.createNS("http://www.w3.org/2000/svg","path");Q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),j.appendChild(Q);const ee=Ie.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ee.setAttributeNS(null,"fill","#FFFFFF");const Y=Ie.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ae=Ie.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#000000"),ae.setAttributeNS(null,"opacity","0.25"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962");const _e=Ie.createNS("http://www.w3.org/2000/svg","circle");_e.setAttributeNS(null,"fill","#FFFFFF"),_e.setAttributeNS(null,"cx","5.5"),_e.setAttributeNS(null,"cy","5.5"),_e.setAttributeNS(null,"r","5.4999962"),Y.appendChild(ae),Y.appendChild(_e),I.appendChild(k),I.appendChild(z),I.appendChild(j),I.appendChild(ee),I.appendChild(Y),m.appendChild(I),m.setAttributeNS(null,"height",y*this._scale+"px"),m.setAttributeNS(null,"width",w*this._scale+"px"),this._element.appendChild(m),this._offset=b.pointGeometry.convert(s&&s.offset||[0,-14])}this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()}),bd(this._element,this._anchor,"marker"),this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Ie.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=b.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(24.6+y)],"bottom-right":[-y,-1*(24.6+y)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(s){const h=s.code,m=s.charCode||s.keyCode;"Space"!==h&&"Enter"!==h&&32!==m&&13!==m||this.togglePopup()}_onMapClick(s){const h=s.originalEvent.target,m=this._element;this._popup&&(h===m||m.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?s.remove():s.addTo(this._map),this):this}_update(s){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=vd(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let h="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?h=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?m="rotateX(0deg)":"map"===this._pitchAlignment&&(m=`rotateX(${this._map.getPitch()}deg)`),s&&"moveend"!==s.type||(this._pos=this._pos.round()),Ie.setTransform(this._element,`${qc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${h}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const y=this._map.unproject(this._pos),w=40075016.686*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=y.distanceTo(this._lngLat)>20*w?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(s){return this._offset=b.pointGeometry.convert(s),this._update(),this}_onMove(s){if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new b.Event("dragstart"))),this.fire(new b.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new b.Event("dragend")),this._state="inactive"}_addDragHandler(s){this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&"auto"!==s?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const He={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let en,Zl=0,el=!1;const Rr={maxWidth:100,unit:"metric"};function ih(g,s,h){const m=h&&h.maxWidth||100,y=g._container.clientHeight/2,w=g.unproject([0,y]),S=g.unproject([m,y]),I=w.distanceTo(S);if(h&&"imperial"===h.unit){const k=3.2808*I;k>5280?js(s,m,k/5280,g._getUIString("ScaleControl.Miles")):js(s,m,k,g._getUIString("ScaleControl.Feet"))}else h&&"nautical"===h.unit?js(s,m,I/1852,g._getUIString("ScaleControl.NauticalMiles")):I>=1e3?js(s,m,I/1e3,g._getUIString("ScaleControl.Kilometers")):js(s,m,I,g._getUIString("ScaleControl.Meters"))}function js(g,s,h,m){const y=function(w){const S=Math.pow(10,`${Math.floor(w)}`.length-1);let I=w/S;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(k){const R=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*R)/R}(I),S*I}(h);g.style.width=s*(y/h)+"px",g.innerHTML=`${y}&nbsp;${m}`}const bs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},xd=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function oh(g){if(g){if("number"==typeof g){const s=Math.round(Math.sqrt(.5*Math.pow(g,2)));return{center:new b.pointGeometry(0,0),top:new b.pointGeometry(0,g),"top-left":new b.pointGeometry(s,s),"top-right":new b.pointGeometry(-s,s),bottom:new b.pointGeometry(0,-g),"bottom-left":new b.pointGeometry(s,-s),"bottom-right":new b.pointGeometry(-s,-s),left:new b.pointGeometry(g,0),right:new b.pointGeometry(-g,0)}}if(g instanceof b.pointGeometry||Array.isArray(g)){const s=b.pointGeometry.convert(g);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:b.pointGeometry.convert(g.center||[0,0]),top:b.pointGeometry.convert(g.top||[0,0]),"top-left":b.pointGeometry.convert(g["top-left"]||[0,0]),"top-right":b.pointGeometry.convert(g["top-right"]||[0,0]),bottom:b.pointGeometry.convert(g.bottom||[0,0]),"bottom-left":b.pointGeometry.convert(g["bottom-left"]||[0,0]),"bottom-right":b.pointGeometry.convert(g["bottom-right"]||[0,0]),left:b.pointGeometry.convert(g.left||[0,0]),right:b.pointGeometry.convert(g.right||[0,0])}}return oh(new b.pointGeometry(0,0))}const pa={supported:wr,setRTLTextPlugin:b.setRTLTextPlugin,getRTLTextPluginStatus:b.getRTLTextPluginStatus,Map:class extends Mi{constructor(g){var s;if(b.PerformanceUtils.mark(b.PerformanceMarkers.create),null!=(g=b.extend({},nh,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Er(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),{bearingSnap:g.bearingSnap}),this._interactive=g.interactive,this._cooperativeGestures=g.cooperativeGestures,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new fa,this._controls=[],this._mapId=b.uniqueId(),this._locale=b.extend({},Ti,g.locale),this._clickTolerance=g.clickTolerance,this._pixelRatio=null!==(s=g.pixelRatio)&&void 0!==s?s:devicePixelRatio,this._imageQueueHandle=si.addThrottleControl(()=>this.isMoving()),this._requestManager=new kc(g.transformRequest),"string"==typeof g.container){if(this._container=document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}g.maxBounds&&this.setMaxBounds(g.maxBounds),b.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Qu(this,g),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=g.hash&&new Bf("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,b.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new eh({customAttribution:g.customAttribution})),g.maplibreLogo&&this.addControl(new Hl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update("style"===h.dataType),this.fire(new b.Event(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new b.Event(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new b.Event("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(g,s){if(void 0===s&&(s=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new b.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const m=this._controlPositions[s];return-1!==s.indexOf("bottom")?m.insertBefore(h,m.firstChild):m.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new b.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(g);return s>-1&&this._controls.splice(s,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,s,h,m){return null==m&&this.terrain&&(m=this.transform.getElevation(h,this.terrain)),super.calculateCameraOptionsFromTo(g,s,h,m)}resize(g){const s=this._containerDimensions(),h=s[0],m=s[1];this._resizeCanvas(h,m,this.getPixelRatio()),this.transform.resize(h,m),this.painter.resize(h,m,this.getPixelRatio());const y=!this._moving;return y&&(this.stop(),this.fire(new b.Event("movestart",g)).fire(new b.Event("move",g))),this.fire(new b.Event("resize",g)),y&&this.fire(new b.Event("moveend",g)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(g){const[s,h]=this._containerDimensions();this._pixelRatio=g,this._resizeCanvas(s,h,g),this.painter.resize(s,h,g)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(b.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}project(g){return this.transform.locationPoint(b.LngLat.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.pointLocation(b.pointGeometry.convert(g),this.terrain)}isMoving(){var g;return this._moving||(null===(g=this.handlers)||void 0===g?void 0:g.isMoving())}isZooming(){var g;return this._zooming||(null===(g=this.handlers)||void 0===g?void 0:g.isZooming())}isRotating(){var g;return this._rotating||(null===(g=this.handlers)||void 0===g?void 0:g.isRotating())}_createDelegatedListener(g,s,h){if("mouseenter"===g||"mouseover"===g){let m=!1;return{layer:s,listener:h,delegates:{mousemove:w=>{const S=this.getLayer(s)?this.queryRenderedFeatures(w.point,{layers:[s]}):[];S.length?m||(m=!0,h.call(this,new Ro(g,this,w.originalEvent,{features:S}))):m=!1},mouseout:()=>{m=!1}}}}if("mouseleave"===g||"mouseout"===g){let m=!1;return{layer:s,listener:h,delegates:{mousemove:S=>{(this.getLayer(s)?this.queryRenderedFeatures(S.point,{layers:[s]}):[]).length?m=!0:m&&(m=!1,h.call(this,new Ro(g,this,S.originalEvent)))},mouseout:S=>{m&&(m=!1,h.call(this,new Ro(g,this,S.originalEvent)))}}}}{const m=y=>{const w=this.getLayer(s)?this.queryRenderedFeatures(y.point,{layers:[s]}):[];w.length&&(y.features=w,h.call(this,y),delete y.features)};return{layer:s,listener:h,delegates:{[g]:m}}}}on(g,s,h){if(void 0===h)return super.on(g,s);const m=this._createDelegatedListener(g,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(m);for(const y in m.delegates)this.on(y,m.delegates[y]);return this}once(g,s,h){if(void 0===h)return super.once(g,s);const m=this._createDelegatedListener(g,s,h);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(g,s,h){return void 0===h?super.off(g,s):(this._delegatedListeners&&this._delegatedListeners[g]&&(m=>{const y=this._delegatedListeners[g];for(let w=0;w<y.length;w++){const S=y[w];if(S.layer===s&&S.listener===h){for(const I in S.delegates)this.off(I,S.delegates[I]);return y.splice(w,1),this}}})(),this)}queryRenderedFeatures(g,s){if(!this.style)return[];let h;const m=g instanceof b.pointGeometry||Array.isArray(g),y=m?g:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(m?{}:g)||{},y instanceof b.pointGeometry||"number"==typeof y[0])h=[b.pointGeometry.convert(y)];else{const w=b.pointGeometry.convert(y[0]),S=b.pointGeometry.convert(y[1]);h=[w,new b.pointGeometry(S.x,w.y),S,new b.pointGeometry(w.x,S.y),w]}return this.style.queryRenderedFeatures(h,s,this.transform)}querySourceFeatures(g,s){return this.style.querySourceFeatures(g,s)}setStyle(g,s){return!1!==(s=b.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},s)).diff&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(g,s))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const s=this._locale[g];if(null==s)throw new Error(`Missing UI string '${g}'`);return s}_updateStyle(g,s){if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,s));const h=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new Mt(this,s||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof g?this.style.loadURL(g,s,h):this.style.loadJSON(g,s,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Mt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,s){if("string"==typeof g){const h=this._requestManager.transformRequest(g,fn.Style);b.getJSON(h,(m,y)=>{m?this.fire(new b.ErrorEvent(m)):y&&this._updateDiff(y,s)})}else"object"==typeof g&&this._updateDiff(g,s)}_updateDiff(g,s){try{this.style.setState(g,s)&&this._update(!0)}catch(h){b.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(g,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():b.warnOnce("There is no style added to the map.")}addSource(g,s){return this._lazyInitEmptyStyle(),this.style.addSource(g,s),this._update(!0)}isSourceLoaded(g){const s=this.style&&this.style.sourceCaches[g];if(void 0!==s)return s.loaded();this.fire(new b.ErrorEvent(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const s=this.style.sourceCaches[g.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain=new th(this.painter,s,g),this.painter.renderToTexture=new ql(this.painter,this.terrain),this.transform.updateElevation(this.terrain),this._terrainDataCallback=h=>{"style"===h.dataType?this.terrain.sourceCache.freeRtt():"source"===h.dataType&&h.tile&&(h.sourceId===g.source&&this.transform.updateElevation(this.terrain),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.updateElevation(this.terrain);return this.fire(new b.Event("terrain",{terrain:g})),this}getTerrain(){return this.terrain&&this.terrain.options}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const s in g){const h=g[s]._tiles;for(const m in h){const y=h[m];if("loaded"!==y.state&&"errored"!==y.state)return!1}}return!0}addSourceType(g,s,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,s,h)}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,s,{pixelRatio:h=1,sdf:m=!1,stretchX:y,stretchY:w,content:S}={}){if(this._lazyInitEmptyStyle(),s instanceof HTMLImageElement||b.isImageBitmap(s)){const{width:I,height:k,data:R}=b.exported.getImageData(s);this.style.addImage(g,{data:new b.RGBAImage({width:I,height:k},R),pixelRatio:h,stretchX:y,stretchY:w,content:S,sdf:m,version:0})}else{if(void 0===s.width||void 0===s.height)return this.fire(new b.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:k,data:R}=s,z=s;this.style.addImage(g,{data:new b.RGBAImage({width:I,height:k},new Uint8Array(R)),pixelRatio:h,stretchX:y,stretchY:w,content:S,sdf:m,version:0,userImage:z}),z.onAdd&&z.onAdd(this,g)}}}updateImage(g,s){const h=this.style.getImage(g);if(!h)return this.fire(new b.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=s instanceof HTMLImageElement||b.isImageBitmap(s)?b.exported.getImageData(s):s,{width:y,height:w,data:S}=m;if(void 0===y||void 0===w)return this.fire(new b.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==h.data.width||w!==h.data.height)return this.fire(new b.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const I=!(s instanceof HTMLImageElement||b.isImageBitmap(s));h.data.replace(S,I),this.style.updateImage(g,h)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new b.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,s){si.getImage(this._requestManager.transformRequest(g,fn.Image),s)}listImages(){return this.style.listImages()}addLayer(g,s){return this._lazyInitEmptyStyle(),this.style.addLayer(g,s),this._update(!0)}moveLayer(g,s){return this.style.moveLayer(g,s),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,s,h){return this.style.setLayerZoomRange(g,s,h),this._update(!0)}setFilter(g,s,h={}){return this.style.setFilter(g,s,h),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,s,h,m={}){return this.style.setPaintProperty(g,s,h,m),this._update(!0)}getPaintProperty(g,s){return this.style.getPaintProperty(g,s)}setLayoutProperty(g,s,h,m={}){return this.style.setLayoutProperty(g,s,h,m),this._update(!0)}getLayoutProperty(g,s){return this.style.getLayoutProperty(g,s)}setGlyphs(g,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,s,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,s,h,m=>{m||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,s,h=>{h||this._update(!0)}),this}setLight(g,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(g,s){return this.style.setFeatureState(g,s),this._update()}removeFeatureState(g,s){return this.style.removeFeatureState(g,s),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,s=0;return this._container&&(g=this._container.clientWidth||400,s=this._container.clientHeight||300),[g,s]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const s=this._canvasContainer=Ie.create("div","maplibregl-canvas-container",g);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=Ie.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions();this._resizeCanvas(h[0],h[1],this.getPixelRatio());const m=this._controlContainer=Ie.create("div","maplibregl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{y[w]=Ie.create("div",`maplibregl-ctrl-${w} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const g=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=Ie.create("div","maplibregl-cooperative-gesture-screen",g);let s="Control",h="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";0===navigator.platform.indexOf("Mac")&&(h="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map",s="Meta"),this._cooperativeGesturesScreen.innerHTML=`\n            <div class="maplibregl-desktop-message">${h}</div>\n            <div class="maplibregl-mobile-message">${"boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>\n        `,document.addEventListener("keydown",m=>{m.key===s&&(this._metaPress=!0)}),document.addEventListener("keyup",m=>{m.key===s&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",m=>{this._onCooperativeGesture(m,this._metaPress,1)},!1),this._canvasContainer.classList.remove("maplibregl-touch-drag-pan")}_resizeCanvas(g,s,h){this._canvas.width=h*g,this._canvas.height=h*s,this._canvas.style.width=`${g}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const g=b.extend({},wr.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1});let s=null;this._canvas.addEventListener("webglcontextcreationerror",m=>{s={requestedAttributes:g},m&&(s.statusMessage=m.statusMessage,s.type=m.type)},{once:!0});const h=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);if(!h){const m="Failed to initialize WebGL";throw s?(s.message=m,new Error(JSON.stringify(s))):new Error(m)}this.painter=new gs(h,this.transform),Bi.testSupport(h)}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new b.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new b.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(g,s,h){return!s&&h<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){let s,h=0;const m=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(s=m.createQueryEXT(),m.beginQueryEXT(m.TIME_ELAPSED_EXT,s),h=b.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let y=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,I=b.exported.now();this.style.zoomHistory.update(S,I);const k=new b.EvaluationParameters(S,{now:I,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),R=k.crossFadingFactor();1===R&&R===this._crossFadingFactor||(y=!0,this._crossFadingFactor=R),this.style.update(k)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain&&this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.updateElevation(this.terrain),this._imageQueueDirty=si.processQueue()>0,this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new b.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,b.PerformanceUtils.mark(b.PerformanceMarkers.load),this.fire(new b.Event("load"))),this.style&&(this.style.hasTransitions()||y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const S=b.exported.now()-h;m.endQueryEXT(m.TIME_ELAPSED_EXT,s),setTimeout(()=>{const I=m.getQueryObjectEXT(s,m.QUERY_RESULT_EXT)/1e6;m.deleteQueryEXT(s),this.fire(new b.Event("gpu-timing-frame",{cpuTime:S,gpuTime:I}))},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(S);this.fire(new b.Event("gpu-timing-layer",{layerTimes:I}))},50)}const w=this._sourcesDirty||this._styleDirty||this._placementDirty||this._imageQueueDirty;return w||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new b.Event("idle")),!this._loaded||this._fullyLoaded||w||(this._fullyLoaded=!0,b.PerformanceUtils.mark(b.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1)),si.removeThrottleControl(this._imageQueueHandle);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Ie.remove(this._canvasContainer),Ie.remove(this._controlContainer),this._cooperativeGestures&&Ie.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map"),b.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new b.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=b.exported.frame(g=>{b.PerformanceUtils.frame(g),this._frame=null,this._render(g)}))}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return"3.0.0-pre.4"}getCameraTargetElevation(){return this.transform.elevation}},NavigationControl:class{constructor(g){this.options=b.extend({},_d,g),this._container=Ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(b.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),Ie.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),Ie.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(b.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=Ie.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map.getZoom(),s=g===this._map.getMaxZoom(),h=g===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const g=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=g}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Gf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Ie.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,s){const h=Ie.create("button",g,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(g,s){const h=this._map._getUIString(`NavigationControl.${s}`);g.title=h,g.setAttribute("aria-label",h)}},GeolocateControl:class extends b.Evented{constructor(g){super(),this.options=b.extend({},He,g),b.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(g){var s;return this._map=g,this._container=Ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),s=this._setupUI,void 0!==en?s(en):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(h=>{en="denied"!==h.state,s(en)}):(en=!!window.navigator.geolocation,s(en)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Ie.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Zl=0,el=!1}_isOutOfMapMaxBounds(g){const s=this._map.getMaxBounds(),h=g.coords;return s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new b.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new b.Event("geolocate",g)),this._finish()}}_updateCamera(g){const s=new b.LngLat(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,m=this._map.getBearing(),y=b.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),y,{geolocateSource:!0})}_updateMarker(g){if(g){const s=new b.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map._container.clientHeight/2,s=this._map.unproject([0,g]),h=this._map.unproject([1,g]),m=s.distanceTo(h),y=Math.ceil(2*this._accuracy/m);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&el)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new b.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=Ie.create("button","maplibregl-ctrl-geolocate",this._container),Ie.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===g){b.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ie.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new rh(this._dotElement),this._circleElement=Ie.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new rh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||"ACTIVE_LOCK"!==this._watchState||s.originalEvent&&"resize"===s.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new b.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return b.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new b.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Zl--,el=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new b.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new b.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Zl++,Zl>1?(g={maximumAge:6e5,timeout:0},el=!0):(g=this.options.positionOptions,el=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:eh,LogoControl:Hl,ScaleControl:class{constructor(g){this.options=b.extend({},Rr,g),b.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){ih(this._map,this._container,this.options)}onAdd(g){return this._map=g,this._container=Ie.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Ie.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(g){this.options.unit=g,ih(this._map,this._container,this.options)}},FullscreenControl:class extends b.Evented{constructor(g={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:b.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Ie.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=Ie.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Ie.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this.fire(new b.Event(this._fullscreen?"fullscreenstart":"fullscreenend"))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},TerrainControl:class{constructor(g){this.options=g,b.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(g){return this._map=g,this._container=Ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Ie.create("button","maplibregl-ctrl-terrain",this._container),Ie.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Ie.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends b.Evented{constructor(g){super(),this.options=b.extend(Object.create(bs),g),b.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new b.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&Ie.remove(this._content),this._container&&(Ie.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new b.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=b.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const s=document.createDocumentFragment(),h=document.createElement("body");let m;for(h.innerHTML=g;m=h.firstChild,m;)s.appendChild(m);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Ie.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){this._container&&this._container.classList.add(g)}removeClassName(g){this._container&&this._container.classList.remove(g)}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}_createCloseButton(){this.options.closeButton&&(this._closeButton=Ie.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(g){this._update(g.point)}_onMouseMove(g){this._update(g.point)}_onDrag(g){this._update(g.point)}_update(g){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=Ie.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Ie.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(w=>this._container.classList.add(w)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=vd(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!g))return;const s=this._pos=this._trackPointer&&g?g:this._map.project(this._lngLat);let h=this.options.anchor;const m=oh(this.options.offset);if(!h){const w=this._container.offsetWidth,S=this._container.offsetHeight;let I;I=s.y+m.bottom.y<S?["top"]:s.y>this._map.transform.height-S?["bottom"]:[],s.x<w/2?I.push("left"):s.x>this._map.transform.width-w/2&&I.push("right"),h=0===I.length?"bottom":I.join("-")}const y=s.add(m[h]).round();Ie.setTransform(this._container,`${qc[h]} translate(${y.x}px,${y.y}px)`),bd(this._container,h,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(xd);g&&g.focus()}_onClose(){this.remove()}},Marker:rh,Style:Mt,LngLat:b.LngLat,LngLatBounds:b.LngLatBounds,Point:b.pointGeometry,MercatorCoordinate:b.MercatorCoordinate,Evented:b.Evented,AJAXError:b.AJAXError,config:b.config,CanvasSource:Ui,GeoJSONSource:Na,ImageSource:Vn,RasterDEMTileSource:Pe,RasterTileSource:tr,VectorTileSource:yr,VideoSource:ds,prewarm:function(){Fc().acquire(ra)},clearPrewarmedResources:function(){const g=Nn;g&&(g.isPreloaded()&&1===g.numActive()?(g.release(ra),Nn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"3.0.0-pre.4"},get workerCount(){return ao.workerCount},set workerCount(g){ao.workerCount=g},get maxParallelImageRequests(){return b.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){b.config.MAX_PARALLEL_IMAGE_REQUESTS=g},workerUrl:"",addProtocol(g,s){b.config.REGISTERED_PROTOCOLS[g]=s},removeProtocol(g){delete b.config.REGISTERED_PROTOCOLS[g]}};return jl.extend(pa,{isSafari:b.isSafari,getPerformanceMetrics:b.PerformanceUtils.getPerformanceMetrics}),pa}),ar}()}},Lm=>{Lm(Lm.s=751)}]);